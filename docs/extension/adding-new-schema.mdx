---
title: â• New Output Schema
sidebar_position: 2
---

import { Conversation, User, Assistant } from '@site/src/components/convengine';

# â• Adding a New Output Schema

An **Output Schema** defines the *structured data* ConvEngine must extract
before it can move a conversation forward.

Schemas are **intent + state bound** and are the backbone of deterministic,
LLM-safe extraction.

---

## ğŸ§  Why Schemas Matter

Schemas ensure:

- âœ… Deterministic extraction  
- ğŸš« No hallucinated fields  
- ğŸ” Multi-turn data collection  
- âš™ï¸ Automatic state transitions  

ConvEngine never asks *â€œwhat should I do?â€* â€”  
it asks *â€œwhat fields are missing?â€*

---

## ğŸ—‚ Schema Binding Rules

Each schema is bound to:

- **intent_code**
- **state_code**

Only when:
- intent matches  
- state matches  
- schema is **enabled**

does extraction run.

---

## ğŸ§¾ Example: Move Action Schema

```json
{
  "type": "object",
  "required": ["from", "to"],
  "properties": {
    "from": {
      "type": "object",
      "required": ["subAccount"],
      "properties": {
        "subAccount": { "type": "string" }
      }
    },
    "to": {
      "type": "object",
      "required": ["subAccount"],
      "properties": {
        "subAccount": { "type": "string" }
      }
    }
  }
}
```

---

## ğŸ’¾ Database Entry

```sql
INSERT INTO ce_output_schema (
  intent_code,
  state_code,
  json_schema,
  priority,
  enabled,
  description
)
VALUES (
  'ACTION',
  'READY',
  '{ ... }',
  1,
  true,
  'Move subAccount extraction schema'
);
```

---

## ğŸ”„ Runtime Flow

<Conversation
  engineStatus="RUNNING"
  engineDetails={
    <>
      <div className="ce-engine-item success">intent = ACTION</div>
      <div className="ce-engine-item warn">schema incomplete</div>
    </>
  }
>
  <User>move from A</User>
  <Assistant>Where do you want to move the service?</Assistant>
</Conversation>

---

<Conversation
  engineStatus="RUNNING"
  engineDetails={
    <>
      <div className="ce-engine-item success">schema complete</div>
      <div className="ce-engine-item success strong">state â†’ READY</div>
    </>
  }
>
  <User>to B</User>
  <Assistant>Please confirm your request.</Assistant>
</Conversation>

---

## âš¡ Auto-Advance Rule

When **all required fields are present**:

- schema = complete  
- engine automatically sets next state  
- no rule required  

This keeps flows clean and predictable.

---

## ğŸš« What Schemas Cannot Do

- âŒ Execute business logic  
- âŒ Change intent  
- âŒ Override rules  

Schemas only **validate completeness**.

---

## âœ… Best Practices

- Keep schemas **small & composable**
- One schema per **logical step**
- Avoid optional fields unless necessary
- Let **rules** decide state, not schemas

---

Schemas turn LLMs into **safe data parsers**.  
Thatâ€™s the ConvEngine superpower ğŸ’ª
