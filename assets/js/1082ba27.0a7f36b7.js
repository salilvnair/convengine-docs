"use strict";(globalThis.webpackChunkconvengine_docs=globalThis.webpackChunkconvengine_docs||[]).push([[4],{6977(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>c,toc:()=>d});const c=JSON.parse('{"id":"consumer/caching-and-persistence","title":"Caching & Persistence","description":"ConvEngine v2 is heavily optimized to decouple real-time generative latency from slow relational database I/O. The framework accomplishes this by utilizing Asynchronous Persistence Threads alongside Spring\'s Abstract CacheManager.","source":"@site/docs/v2/consumer/caching-and-persistence.mdx","sourceDirName":"consumer","slug":"/consumer/caching-and-persistence","permalink":"/docs/v2/consumer/caching-and-persistence","draft":false,"unlisted":false,"editUrl":"https://github.com/salilvnair/convengine-docs/tree/main/docs/v2/consumer/caching-and-persistence.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Caching & Persistence","sidebar_position":4},"sidebar":"docSidebar","previous":{"title":"Backend Integration","permalink":"/docs/v2/consumer/backend-integration"},"next":{"title":"Configuration","permalink":"/docs/v2/consumer/configuration"}}');var t=i(4848),r=i(8453),a=i(9131);const s={title:"Caching & Persistence",sidebar_position:4},o="Caching & Persistence",l={},d=[{value:"1. Ehcache 3 (JSR-107)",id:"1-ehcache-3-jsr-107",level:2},{value:"2. Caffeine Cache",id:"2-caffeine-cache",level:2},{value:"3. Redis",id:"3-redis",level:2},{value:"4. Static Configuration Preloading",id:"4-static-configuration-preloading",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"caching--persistence",children:"Caching & Persistence"})}),"\n",(0,t.jsxs)(n.p,{children:["ConvEngine v2 is heavily optimized to decouple real-time generative latency from slow relational database I/O. The framework accomplishes this by utilizing ",(0,t.jsx)(n.strong,{children:"Asynchronous Persistence Threads"})," alongside ",(0,t.jsx)(n.strong,{children:"Spring's Abstract CacheManager"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"To activate this optimization on your backend, add the following decorators to your application class:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(a.pu,{children:"@EnableConvEngineCaching"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(a.pu,{children:"@EnableConvEngineAsyncConversation"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(a.f4,{type:"tip",title:"How the abstraction works",children:(0,t.jsxs)(n.p,{children:["The actual datastore powering ",(0,t.jsx)(n.code,{children:"@EnableConvEngineCaching"})," is ",(0,t.jsx)(n.strong,{children:"entirely controlled by the Consumer application"}),", not the ConvEngine framework. ConvEngine relies on the generic Spring ",(0,t.jsx)(n.code,{children:"CacheManager"})," interface to save and load ",(0,t.jsx)(n.code,{children:"CeConversation"})," instances via the ",(0,t.jsx)(n.code,{children:"ce_conversation_cache"})," routing key."]})}),"\n",(0,t.jsxs)(n.p,{children:["By default, to activate ConvEngine caching, you must pull in Spring Boot's caching abstraction layer. If you import this module but do not import any external caching dependencies (like Redis or Ehcache), Spring Boot will automatically fall back to providing a ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"ConcurrentMapCacheManager"})})," out of the box."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["Dependency requirement (",(0,t.jsx)(n.code,{children:"pom.xml"}),")"]}),":"]}),"\n",(0,t.jsx)(a.vl,{title:"pom.xml",language:"xml",children:"<dependency>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-starter-cache</artifactId>\n</dependency>"}),"\n",(0,t.jsx)(a.f4,{type:"warning",title:"Startup crashes without this dependency",children:(0,t.jsxs)(n.p,{children:["If you annotate your application class with ",(0,t.jsx)(n.code,{children:"@EnableConvEngineCaching"})," but fail to include ",(0,t.jsx)(n.code,{children:"spring-boot-starter-cache"})," in your ",(0,t.jsx)(n.code,{children:"pom.xml"}),", the Spring context will fatally crash on startup because it cannot find an underlying ",(0,t.jsx)(n.code,{children:"CacheManager"})," bean to bind to."]})}),"\n",(0,t.jsxs)(n.p,{children:["This operates seamlessly once the module is present. It holds conversation states inside a standard Java ",(0,t.jsx)(n.code,{children:"HashMap"})," residing in your server's active JVM memory."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Pros"}),": Blazing fast (",(0,t.jsx)(n.code,{children:"0ms"})," read/write latency), requires zero configuration."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cons"}),": Cache is completely wiped if the Spring Boot application restarts or crashes; not horizontal-scale (multi-pod) friendly."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"1-ehcache-3-jsr-107",children:"1. Ehcache 3 (JSR-107)"}),"\n",(0,t.jsxs)(n.p,{children:["For robust, production-grade memory bounds, ",(0,t.jsx)(n.strong,{children:"Ehcache"})," is a highly recommended on-premise memory provider. It allows conversational payloads to spill over from the active ",(0,t.jsx)(n.code,{children:"heap"})," into ",(0,t.jsx)(n.code,{children:"offheap"})," memory to prevent JVM garbage collection thrashing during large multi-turn flows."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["Dependency update (",(0,t.jsx)(n.code,{children:"pom.xml"}),")"]}),":"]}),"\n",(0,t.jsx)(a.vl,{title:"pom.xml",language:"xml",children:"<dependency>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-starter-cache</artifactId>\n</dependency>\n<dependency>\n  <groupId>javax.cache</groupId>\n  <artifactId>cache-api</artifactId>\n</dependency>\n<dependency>\n  <groupId>org.ehcache</groupId>\n  <artifactId>ehcache</artifactId>\n</dependency>"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["App configuration (",(0,t.jsx)(n.code,{children:"application.yml"}),")"]}),":"]}),"\n",(0,t.jsx)(a.vl,{title:"application.yml",language:"yaml",children:"spring:\ncache:\n  jcache:\n    config: classpath:ehcache.xml"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["Provider specification (",(0,t.jsx)(n.code,{children:"src/main/resources/ehcache.xml"}),")"]}),":"]}),"\n",(0,t.jsx)(a.vl,{title:"ehcache.xml",language:"xml",children:'<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n      xmlns="http://www.ehcache.org/v3"\n      xmlns:jsr107="http://www.ehcache.org/v3/jsr107"\n      xsi:schemaLocation="\n          http://www.ehcache.org/v3 http://www.ehcache.org/schema/ehcache-core-3.0.xsd\n          http://www.ehcache.org/v3/jsr107 http://www.ehcache.org/schema/ehcache-107-ext-3.0.xsd">\n\n  \x3c!-- This MUST exactly match ConvEngine\'s requested alias --\x3e\n  <cache alias="ce_conversation_cache">\n      <key-type>java.lang.String</key-type>\n      <value-type>com.github.salilvnair.convengine.entity.CeConversation</value-type>\n      <expiry>\n          <ttl unit="minutes">60</ttl>\n      </expiry>\n      <resources>\n          <heap unit="entries">2000</heap>\n          <offheap unit="MB">100</offheap>\n      </resources>\n  </cache>\n</config>'}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"2-caffeine-cache",children:"2. Caffeine Cache"}),"\n",(0,t.jsxs)(n.p,{children:["If you prefer a highly optimized, high-performance local cache strictly contained inside the JVM (without off-heap spillage but statistically faster hit-rates than Ehcache), ",(0,t.jsx)(n.strong,{children:"Caffeine"})," is Spring Boot's default local provider replacement."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["Dependency update (",(0,t.jsx)(n.code,{children:"pom.xml"}),")"]}),":"]}),"\n",(0,t.jsx)(a.vl,{title:"pom.xml",language:"xml",children:"<dependency>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-starter-cache</artifactId>\n</dependency>\n<dependency>\n  <groupId>com.github.ben-manes.caffeine</groupId>\n  <artifactId>caffeine</artifactId>\n</dependency>"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["App configuration (",(0,t.jsx)(n.code,{children:"application.yml"}),")"]}),":\nUnlike Ehcache, Caffeine can be fully initialized inside ",(0,t.jsx)(n.code,{children:"application.yml"})," without distinct XML files."]}),"\n",(0,t.jsx)(a.vl,{title:"application.yml",language:"yaml",children:"spring:\ncache:\n  type: caffeine\n  cache-names: ce_conversation_cache\n  caffeine:\n    # Max limits the cache to 5,000 conversational objects, expiring them 60 minutes after their last network write\n    spec: maximumSize=5000,expireAfterWrite=60m"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"3-redis",children:"3. Redis"}),"\n",(0,t.jsxs)(n.p,{children:["For horizontally scaled environments like Kubernetes (",(0,t.jsx)(n.code,{children:"k8s"}),") where your user traffic rotates across multiple server pods mid-conversation, you cannot use local memory (Ehcache/Caffeine). ",(0,t.jsx)(n.strong,{children:"Redis"})," binds ConvEngine's cache into an external centralized datastore."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["Dependency update (",(0,t.jsx)(n.code,{children:"pom.xml"}),")"]}),":"]}),"\n",(0,t.jsx)(a.vl,{title:"pom.xml",language:"xml",children:"<dependency>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-starter-data-redis</artifactId>\n</dependency>\n<dependency>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-starter-cache</artifactId>\n</dependency>"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["App configuration (",(0,t.jsx)(n.code,{children:"application.yml"}),")"]}),":"]}),"\n",(0,t.jsx)(a.vl,{title:"application.yml",language:"yaml",children:'spring:\ndata:\n  redis:\n    host: localhost\n    port: 6379\ncache:\n  type: redis\n  redis:\n    time-to-live: 60m\n    cache-null-values: false\n    use-key-prefix: true\n    key-prefix: "convengine:"'}),"\n",(0,t.jsx)(a.f4,{type:"warning",title:"A note on serialization",children:(0,t.jsxs)(n.p,{children:["Because Redis runs outside the active server JVM, it relies on network transmission. You must ensure that your Spring application has a generic ",(0,t.jsx)(n.code,{children:"RedisTemplate"})," or Jackson-configured ",(0,t.jsx)(n.code,{children:"RedisCacheConfiguration"})," bean configured to serialize ",(0,t.jsx)(n.code,{children:"CeConversation"})," entities, otherwise Java will throw ",(0,t.jsx)(n.code,{children:"NotSerializableException"})," when attempting to push the object to the internet."]})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"4-static-configuration-preloading",children:"4. Static Configuration Preloading"}),"\n",(0,t.jsxs)(n.p,{children:["Beyond dynamic conversational sessions, ConvEngine also permanently caches all non-transactional database rules (",(0,t.jsx)(n.code,{children:"ce_intent"}),", ",(0,t.jsx)(n.code,{children:"ce_rule"}),", ",(0,t.jsx)(n.code,{children:"ce_mcp_tool"}),", ",(0,t.jsx)(n.code,{children:"ce_config"}),", etc.) into a generic ",(0,t.jsx)(n.code,{children:"ce_static_configs"})," memory tree entirely upon JVM live initiation. This ensures that the engine never triggers synchronous relational fetches during the middle of a customer's turn."]}),"\n",(0,t.jsxs)(n.p,{children:["If you connect to your database and update a ",(0,t.jsx)(n.code,{children:"ce_rule"})," row manually using ",(0,t.jsx)(n.code,{children:"SQL"}),", the active Java application won't automatically see it until you flush this static cache."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Flushing the Cache Tree:"}),"\nYou can do this by hitting the integrated Admin Controller endpoint mapped generically natively into your backend:"]}),"\n",(0,t.jsx)(a.vl,{title:"Cache Refresh Trigger",language:"bash",children:'curl -X GET "http://localhost:8080/api/v1/cache/refresh"'}),"\n",(0,t.jsxs)(n.p,{children:["This endpoint executes ",(0,t.jsx)(n.code,{children:'@CacheEvict(value = "ce_static_configs", allEntries = true)'})," and immediately re-triggers the Spring Data Preloader, locking in your latest SQL tweaks live."]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}}}]);