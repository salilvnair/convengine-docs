---
title: New Consumer Onboarding
sidebar_position: 2
hide_table_of_contents: true
---

import { DbTable, Highlight, CodeBlockToggle, FlowStep, FileRef, MethodRef } from "@site/src/components/convengine";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# New Consumer Onboarding

This is the practical playbook for teams integrating ConvEngine for the first time. The framework introduces a completely revamped interaction pipeline featuring Dialogue Act detection, orchestration graphs, internal guardrails, and automated pending-action pipelines.

## What a new consumer must decide first

<DbTable
  title="Day-0 decisions"
  columns={["Decision", "Why it matters", "Recommended default"]}
  rows={[
    ["Transport", "Determines runtime event delivery and operational complexity.", "Start with SSE only; enable STOMP relay later."],
    ["Intent continuity", "Controls whether intent re-resolves each turn.", "The engine manages intent lifecycle fluidly; enable `convengine.flow.state-graph` to build strict path boundaries."],
    ["Action Orchestration", "Safely execute programmatic actions vs pure dialogue.", "Leverage `convengine.flow.action-lifecycle` and `PENDING_ACTION` states for secure operations."],
    ["Concurrency policy", "Prevents same-conversation race corruption.", "Serialize by `conversationId` at API layer from day one."],
    ["Prompt exposure policy", "Controls data leakage and prompt contamination risk.", "Use allowlist of prompt vars; do not expose raw input maps."],
  ]}
/>

## Step-by-step onboarding

<FlowStep step="1" title="Bootstrap framework and LLM adapter">
Add ConvEngine `2.0.0` dependencies. Enable <MethodRef>@EnableConvEngine</MethodRef> and provide one production-grade <MethodRef>LlmClient</MethodRef> bean with strict timeout and retry policy.
</FlowStep>

<FlowStep step="2" title="Create baseline control-plane data">
Seed minimum rows for intents, classifiers, responses, prompt templates, schemas, and pending tasks.
</FlowStep>

<Highlight type="info" title="Prompt-template contract (v2.0.9+)">
When seeding `ce_prompt_template`, treat prompt rows as both LLM text and turn-behavior metadata.

- set `interaction_mode` to the broad turn type (`COLLECT`, `CONFIRM`, `PROCESSING`, `FINAL`, etc.)
- use `interaction_contract` JSON for extensible capabilities and expectations

Recommended JSON shape:

- `{"allows":["affirm","edit","retry","reset"],"expects":["structured_input"]}`

Examples:

- intake/schema prompts: `interaction_mode=COLLECT`
- confirmation prompts: `interaction_mode=CONFIRM`
- retry-capable in-flight prompts: `interaction_mode=PROCESSING` with `allows:["retry","reset"]`
</Highlight>

<FlowStep step="3" title="Lock down safety defaults">
Apply conservative defaults for reset behavior, rules logic, MCP safety, and enable Guardrails via `convengine.flow.guardrail.enabled: true`.
</FlowStep>

<FlowStep step="4" title="Run correctness tests before UI rollout">
Validate multi-turn transitions, pending action `AFFIRM`/`NEGATE` semantics, tool invocation, and missing-field loops.
</FlowStep>

<FlowStep step="5" title="Promote with release gates">
Move from non-prod to prod only after all correctness/security/scalability gates pass.
</FlowStep>

## Minimum integration checklist

<DbTable
  title="Must-have implementation tasks"
  columns={["Area", "Task", "Done when"]}
  rows={[
    ["Spring wiring", "Add POM Dependency, Enable ConvEngine + define `LlmClient` bean.", "`/message` works and returns payload for seeded FAQ intent."],
    ["Schema", "Apply DDL and create indexes from ConvEngine schema.", "All `ce_*` tables present and writable."],
    ["Seed data", "Insert minimal rows for one end-to-end intent.", "One deterministic turn passes with expected intent/state."],
    ["Audit usage", "Wire audit API/stream into debugging workflow.", "Every test case is verified against trace timeline."],
    ["Concurrency guard", "Prevent parallel writes for same conversation.", "Load test shows no state drift under concurrent same-ID requests."],
    ["Prompt hygiene", "Allowlist exposed template vars.", "No sensitive/internal keys appear in rendered prompts."],
  ]}
/>

<DbTable
  title="Prompt-template seeding checklist"
  columns={["Prompt type", "Recommended metadata", "Why"]}
  rows={[
    ["Schema extraction (`SCHEMA_JSON`)", "`interaction_mode=COLLECT`, `expects:[\"structured_input\"]`", "Makes structured collection explicit and keeps extraction prompts self-describing."],
    ["Confirmation (`TEXT`)", "`interaction_mode=CONFIRM`, `allows:[\"affirm\",\"edit\",\"reset\"]`", "Lets `CorrectionStep` route yes/edit turns without relying on state-name parsing."],
    ["Processing (`TEXT`)", "`interaction_mode=PROCESSING`, `allows:[\"retry\",\"reset\"]`", "Enables deterministic retry after MCP/tool failures in the same state."],
    ["Final (`TEXT`/`JSON`)", "`interaction_mode=FINAL`", "Marks terminal responses and keeps turn semantics clear in config."]
  ]}
/>

## 1. Start a Spring Boot project (v2.0.0)

<Tabs groupId="bootstrap">
  <TabItem value="maven" label="pom.xml" default>

    <CodeBlockToggle title="Maven dependency" language="xml" packagePath="project build">
    {`
  <dependency>
    <groupId>com.github.salilvnair</groupId>
    <artifactId>convengine</artifactId>
    <version>2.0.0</version>
  </dependency>`}
    </CodeBlockToggle>

  </TabItem>
  <TabItem value="gradle" label="build.gradle.kts">

    <CodeBlockToggle title="Gradle dependency" language="kotlin" packagePath="project build">
    {`implementation("com.github.salilvnair:convengine:2.0.0")`}
    </CodeBlockToggle>

  </TabItem>
  <TabItem value="app" label="Application class">

    <CodeBlockToggle title="Enable ConvEngine" language="java" packagePath="com.zapper.demo" filePath="src/main/java/com/acme/demo/DemoApplication.java">
    {`@SpringBootApplication
    @EnableConvEngine(stream = true)
    @EnableConvEngineCaching
    @EnableConvEngineAsyncConversation
    public class DemoApplication {
      public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
      }
    }`}
    </CodeBlockToggle>

  </TabItem>
</Tabs>

## Recommended baseline config (new consumers)

<CodeBlockToggle title="Safe starter config (convengine.flow.*)" language="yaml">
{`
convengine:
  # Flow tuning
  flow:
    dialogue-act:
      resolute: REGEX_THEN_LLM
      llm-threshold: 0.90
    conversation-history:
      max-turns: 10
    interaction-policy:
      execute-pending-on-affirm: true
      reject-pending-on-negate: true
      fill-pending-slot-on-non-new-request: true
      require-resolved-intent-and-state: true
      matrix:
        "PENDING_ACTION:AFFIRM": EXECUTE_PENDING_ACTION
        "PENDING_ACTION:NEGATE": REJECT_PENDING_ACTION
        "PENDING_SLOT:QUESTION": FILL_PENDING_SLOT
    action-lifecycle:
      enabled: true
      ttl-turns: 3
      ttl-minutes: 30
    guardrail:
      enabled: true
      sanitize-input: true
      require-approval-for-sensitive-actions: false
      approval-gate-fail-closed: true
      sensitive-patterns: []
    state-graph:
      enabled: true
      soft-block-on-violation: false

  transport:
    sse:
      enabled: true
    stomp:
      enabled: false

  audit:
    enabled: true
    persist-meta: true
    level: ALL

  tables:
    AUDIT: CE_AUDIT
    CONTAINER_CONFIG: CE_CONTAINER_CONFIG
    CONVERSATION: CE_CONVERSATION
    INTENT: CE_INTENT
    INTENT_CLASSIFIER: CE_INTENT_CLASSIFIER
    LLM_CALL_LOG: CE_LLM_CALL_LOG
    MCP_DB_TOOL: CE_MCP_DB_TOOL
    MCP_PLANNER: CE_MCP_PLANNER
    MCP_TOOL: CE_MCP_TOOL
    OUTPUT_SCHEMA: CE_OUTPUT_SCHEMA
    PROMPT_TEMPLATE: CE_PROMPT_TEMPLATE
    RESPONSE: CE_RESPONSE
    RULE: CE_RULE

`}
</CodeBlockToggle>

## Correctness-focused test pack (required)

<DbTable
  title="Pre-production test scenarios"
  columns={["Scenario", "What to verify", "Failure signal"]}
  rows={[
    ["Pending action semantics", "System properly executes mapped tasks or cancels when the user affirms or negates.", "State gets stuck, or action executes prematurely without active confirmation."],
    ["Sticky intent shift", "New-topic user input triggers expected re-resolution/switch behavior.", "Repeated wrong-intent responses with skip stages."],
    ["Guardrail bounds", "Malicious or off-topic prompts fallback gracefully and log the event.", "Engine returns out-of-bounds topic data or leaked configuration."],
    ["Schema loop", "Missing fields converge in bounded turns.", "Infinite clarification or inconsistent required field set."],
    ["Concurrent same ID", "No last-write-wins drift under parallel requests.", "Contradictory final state for same conversation timeline."],
  ]}
/>

## Common new-consumer mistakes

<DbTable
  title="Avoid these early mistakes"
  columns={["Mistake", "Impact", "Fix"]}
  rows={[
    ["Disabling interaction policies", "Losing all built-in logic for handling 'yes', 'no', and slot-filling inputs.", "Leave \`convengine.flow.interaction-policy\` active and matrix populated."],
    ["No conversation-level concurrency control", "State drift and non-deterministic results.", "Serialize by conversation ID or add optimistic locking."],
    ["Relying purely on LLM Dialogue Acts", "Expensive token usage and slow intent determination.", "Always implement \`REGEX_THEN_LLM\` resolutes for core deterministic paths."],
    ["Shipping config changes without tests", "Production regressions from rule/template misconfig.", "Introduce lint + fixture tests + staged promotion."],
  ]}
/>

<Highlight type="info" title="Where to read next">
After this page, continue with [Configuration](/docs/v2/consumer/configuration) for a complete table-level breakdown of the Flow setup, and dive into the [Developer Guide](/docs/v2/deep-dive/developer-guide) for extension integration.
</Highlight>
