"use strict";(globalThis.webpackChunkconvengine_docs=globalThis.webpackChunkconvengine_docs||[]).push([[6008],{6489(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"architecture","title":"Architecture","description":"Layers","source":"@site/docs/v2/architecture.mdx","sourceDirName":".","slug":"/architecture","permalink":"/docs/v2/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/salilvnair/convengine-docs/tree/main/docs/v2/architecture.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Architecture","sidebar_position":2},"sidebar":"docSidebar","previous":{"title":"Overview","permalink":"/docs/v2/overview"},"next":{"title":"Flow Examples","permalink":"/docs/v2/examples"}}');var s=i(4848),t=i(8453),l=i(7555);const c={title:"Architecture",sidebar_position:2},o="Architecture",a={},d=[{value:"Layers",id:"layers",level:2},{value:"API + Transport Layer",id:"api--transport-layer",level:3},{value:"Runtime Pipeline Layer",id:"runtime-pipeline-layer",level:3},{value:"Decision + Control Layer",id:"decision--control-layer",level:3},{value:"Tooling Layer",id:"tooling-layer",level:3},{value:"Persistence + Audit Layer",id:"persistence--audit-layer",level:3},{value:"Request Path (high-level)",id:"request-path-high-level",level:2},{value:"Code references",id:"code-references",level:2}];function p(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,s.jsx)(n.h2,{id:"layers",children:"Layers"}),"\n",(0,s.jsx)(n.h3,{id:"api--transport-layer",children:"API + Transport Layer"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(l.pu,{children:"ConversationController"}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"request ingress + validation + correlation ids"}),"\n",(0,s.jsx)(n.li,{children:"SSE / STOMP event transport for audit streams"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"runtime-pipeline-layer",children:"Runtime Pipeline Layer"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(l.pu,{children:"DefaultConversationalEngine"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(l.pu,{children:"EnginePipelineFactory"})," (DAG sort + wrappers + timing + step hooks)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(l.pu,{children:"EngineSession"})," (per-turn mutable state)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"decision--control-layer",children:"Decision + Control Layer"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["dialogue act: ",(0,s.jsx)(l.pu,{children:"DialogueActStep"})]}),"\n",(0,s.jsxs)(n.li,{children:["policy: ",(0,s.jsx)(l.pu,{children:"InteractionPolicyStep"})]}),"\n",(0,s.jsxs)(n.li,{children:["correction routing: ",(0,s.jsx)(l.pu,{children:"CorrectionStep"})]}),"\n",(0,s.jsxs)(n.li,{children:["pending action lifecycle: ",(0,s.jsx)(l.pu,{children:"ActionLifecycleStep"}),", ",(0,s.jsx)(l.pu,{children:"DisambiguationStep"}),", ",(0,s.jsx)(l.pu,{children:"PendingActionStep"})]}),"\n",(0,s.jsxs)(n.li,{children:["guard + transition validation: ",(0,s.jsx)(l.pu,{children:"GuardrailStep"}),", ",(0,s.jsx)(l.pu,{children:"StateGraphStep"})]}),"\n",(0,s.jsx)(n.li,{children:"core intent/schema/rules/response path"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"tooling-layer",children:"Tooling Layer"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(l.pu,{children:"ToolOrchestrationStep"})," (unified tool request/execute/result contract)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(l.pu,{children:"McpToolStep"})," (planner loop + ",(0,s.jsx)(n.code,{children:"CALL_TOOL"})," / ",(0,s.jsx)(n.code,{children:"ANSWER"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"persistence--audit-layer",children:"Persistence + Audit Layer"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["JPA repositories on ",(0,s.jsx)(l.Mn,{children:"ce_*"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(l.Mn,{children:"ce_conversation"}),", ",(0,s.jsx)(l.Mn,{children:"ce_audit"}),", ",(0,s.jsx)(l.Mn,{children:"ce_memory"})," write path"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"request-path-high-level",children:"Request Path (high-level)"}),"\n",(0,s.jsx)(l.zM,{step:"1",title:"Controller receives request",children:(0,s.jsxs)(n.p,{children:["Builds ",(0,s.jsx)(l.pu,{children:"EngineContext"})," from ",(0,s.jsx)(l.pu,{children:"conversationId"}),", ",(0,s.jsx)(l.pu,{children:"message"}),", ",(0,s.jsx)(l.pu,{children:"inputParams"}),", optional ",(0,s.jsx)(l.pu,{children:"reset"})," flag."]})}),"\n",(0,s.jsx)(l.zM,{step:"2",title:"Engine opens session",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(l.pu,{children:"EngineSessionFactory"})," creates session and history provider injects last turns."]})}),"\n",(0,s.jsx)(l.zM,{step:"3",title:"Control steps run",children:(0,s.jsx)(n.p,{children:"Dialogue act + interaction policy + correction routing + pending-action lifecycle decide whether to execute task, clarify, confirm, patch, or continue standard intent flow."})}),"\n",(0,s.jsx)(l.zM,{step:"4",title:"Core flow resolves output",children:(0,s.jsx)(n.p,{children:"Intent/schema/rules/response steps produce deterministic state transition + assistant payload."})}),"\n",(0,s.jsx)(l.zM,{step:"5",title:"Persist + return result",children:(0,s.jsx)(n.p,{children:"Final payload is persisted and returned as TEXT/JSON response, with full audit trail."})}),"\n",(0,s.jsx)(n.h2,{id:"code-references",children:"Code references"}),"\n",(0,s.jsx)(l.vl,{title:"Engine entrypoint",language:"java",packagePath:"com.github.salilvnair.convengine.engine.provider",filePath:"src/main/java/com/github/salilvnair/convengine/engine/provider/DefaultConversationalEngine.java",children:"@Override\npublic EngineResult process(EngineContext engineContext) {\n  EngineSession session = sessionFactory.open(engineContext);\n  session.setConversationHistory(historyProvider.lastTurns(session.getConversationId(), 10));\n  EnginePipeline pipeline = pipelineFactory.create();\n  return pipeline.execute(session);\n}"}),"\n",(0,s.jsx)(l.vl,{title:"Pipeline execution loop",language:"java",packagePath:"com.github.salilvnair.convengine.engine.pipeline",filePath:"src/main/java/com/github/salilvnair/convengine/engine/pipeline/EnginePipeline.java",children:"for (EngineStep step : steps) {\n  StepResult r = step.execute(session);\n  if (r instanceof StepResult.Stop(EngineResult result)) {\n      return result;\n  }\n}"}),"\n",(0,s.jsx)(n.admonition,{title:"Intervention point",type:"tip",children:(0,s.jsxs)(n.p,{children:["You can intercept any step via ",(0,s.jsx)(l.pu,{children:"EngineStepHook"})," (",(0,s.jsx)(l.pu,{children:"beforeStep"}),", ",(0,s.jsx)(l.pu,{children:"afterStep"}),", ",(0,s.jsx)(l.pu,{children:"onStepError"}),") without forking the engine."]})}),"\n",(0,s.jsx)(l.f4,{type:"info",title:"Control phases",children:(0,s.jsxs)(n.p,{children:["Rules execute by phase: ",(0,s.jsx)(l.pu,{children:"PRE_RESPONSE_RESOLUTION"}),", ",(0,s.jsx)(l.pu,{children:"POST_AGENT_INTENT"}),", ",(0,s.jsx)(l.pu,{children:"POST_SCHEMA_EXTRACTION"}),", ",(0,s.jsx)(l.pu,{children:"PRE_AGENT_MCP"}),", ",(0,s.jsx)(l.pu,{children:"POST_AGENT_MCP"}),", and ",(0,s.jsx)(l.pu,{children:"POST_TOOL_EXECUTION"}),"."]})}),"\n",(0,s.jsx)(l.f4,{type:"warning",title:"Deterministic boundary",children:(0,s.jsxs)(n.p,{children:["Keep business transitions in ",(0,s.jsx)(l.Mn,{children:"ce_rule"})," and state graph config, not hardcoded in steps, so behavior remains data-driven and auditable."]})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}}}]);