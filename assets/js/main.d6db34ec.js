/*! For license information please see main.d6db34ec.js.LICENSE.txt */
(globalThis.webpackChunkconvengine_docs=globalThis.webpackChunkconvengine_docs||[]).push([[8792],{83(){!function(e){var t=/[*&][^\s[\]{},]+/,n=/!(?:<[\w\-%#;/?:@&=+$,.!~*'()[\]]+>|(?:[a-zA-Z\d-]*!)?[\w\-%#;/?:@&=+$.~*'()]+)?/,o="(?:"+n.source+"(?:[ \t]+"+t.source+")?|"+t.source+"(?:[ \t]+"+n.source+")?)",a=/(?:[^\s\x00-\x08\x0e-\x1f!"#%&'*,\-:>?@[\]`{|}\x7f-\x84\x86-\x9f\ud800-\udfff\ufffe\uffff]|[?:-]<PLAIN>)(?:[ \t]*(?:(?![#:])<PLAIN>|:<PLAIN>))*/.source.replace(/<PLAIN>/g,function(){return/[^\s\x00-\x08\x0e-\x1f,[\]{}\x7f-\x84\x86-\x9f\ud800-\udfff\ufffe\uffff]/.source}),i=/"(?:[^"\\\r\n]|\\.)*"|'(?:[^'\\\r\n]|\\.)*'/.source;function s(e,t){t=(t||"").replace(/m/g,"")+"m";var n=/([:\-,[{]\s*(?:\s<<prop>>[ \t]+)?)(?:<<value>>)(?=[ \t]*(?:$|,|\]|\}|(?:[\r\n]\s*)?#))/.source.replace(/<<prop>>/g,function(){return o}).replace(/<<value>>/g,function(){return e});return RegExp(n,t)}e.languages.yaml={scalar:{pattern:RegExp(/([\-:]\s*(?:\s<<prop>>[ \t]+)?[|>])[ \t]*(?:((?:\r?\n|\r)[ \t]+)\S[^\r\n]*(?:\2[^\r\n]+)*)/.source.replace(/<<prop>>/g,function(){return o})),lookbehind:!0,alias:"string"},comment:/#.*/,key:{pattern:RegExp(/((?:^|[:\-,[{\r\n?])[ \t]*(?:<<prop>>[ \t]+)?)<<key>>(?=\s*:\s)/.source.replace(/<<prop>>/g,function(){return o}).replace(/<<key>>/g,function(){return"(?:"+a+"|"+i+")"})),lookbehind:!0,greedy:!0,alias:"atrule"},directive:{pattern:/(^[ \t]*)%.+/m,lookbehind:!0,alias:"important"},datetime:{pattern:s(/\d{4}-\d\d?-\d\d?(?:[tT]|[ \t]+)\d\d?:\d{2}:\d{2}(?:\.\d*)?(?:[ \t]*(?:Z|[-+]\d\d?(?::\d{2})?))?|\d{4}-\d{2}-\d{2}|\d\d?:\d{2}(?::\d{2}(?:\.\d*)?)?/.source),lookbehind:!0,alias:"number"},boolean:{pattern:s(/false|true/.source,"i"),lookbehind:!0,alias:"important"},null:{pattern:s(/null|~/.source,"i"),lookbehind:!0,alias:"important"},string:{pattern:s(i),lookbehind:!0,greedy:!0},number:{pattern:s(/[+-]?(?:0x[\da-f]+|0o[0-7]+|(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?|\.inf|\.nan)/.source,"i"),lookbehind:!0},tag:n,important:t,punctuation:/---|[:[\]{}\-,|>?]|\.\.\./},e.languages.yml=e.languages.yaml}(Prism)},115(e){var t="undefined"!=typeof Element,n="function"==typeof Map,o="function"==typeof Set,a="function"==typeof ArrayBuffer&&!!ArrayBuffer.isView;function i(e,s){if(e===s)return!0;if(e&&s&&"object"==typeof e&&"object"==typeof s){if(e.constructor!==s.constructor)return!1;var r,l,c,u;if(Array.isArray(e)){if((r=e.length)!=s.length)return!1;for(l=r;0!==l--;)if(!i(e[l],s[l]))return!1;return!0}if(n&&e instanceof Map&&s instanceof Map){if(e.size!==s.size)return!1;for(u=e.entries();!(l=u.next()).done;)if(!s.has(l.value[0]))return!1;for(u=e.entries();!(l=u.next()).done;)if(!i(l.value[1],s.get(l.value[0])))return!1;return!0}if(o&&e instanceof Set&&s instanceof Set){if(e.size!==s.size)return!1;for(u=e.entries();!(l=u.next()).done;)if(!s.has(l.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(s)){if((r=e.length)!=s.length)return!1;for(l=r;0!==l--;)if(e[l]!==s[l])return!1;return!0}if(e.constructor===RegExp)return e.source===s.source&&e.flags===s.flags;if(e.valueOf!==Object.prototype.valueOf&&"function"==typeof e.valueOf&&"function"==typeof s.valueOf)return e.valueOf()===s.valueOf();if(e.toString!==Object.prototype.toString&&"function"==typeof e.toString&&"function"==typeof s.toString)return e.toString()===s.toString();if((r=(c=Object.keys(e)).length)!==Object.keys(s).length)return!1;for(l=r;0!==l--;)if(!Object.prototype.hasOwnProperty.call(s,c[l]))return!1;if(t&&e instanceof Element)return!1;for(l=r;0!==l--;)if(("_owner"!==c[l]&&"__v"!==c[l]&&"__o"!==c[l]||!e.$$typeof)&&!i(e[c[l]],s[c[l]]))return!1;return!0}return e!=e&&s!=s}e.exports=function(e,t){try{return i(e,t)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}}},119(e,t,n){"use strict";n.r(t)},205(e,t,n){"use strict";n.d(t,{A:()=>a});var o=n(6540);const a=n(8193).A.canUseDOM?o.useLayoutEffect:o.useEffect},253(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorCausalChain=function e(t){if(t.cause)return[t,...e(t.cause)];return[t]}},311(e){"use strict";e.exports=function(e,t,n,o,a,i,s,r){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,o,a,i,s,r],u=0;(l=new Error(t.replace(/%s/g,function(){return c[u++]}))).name="Invariant Violation"}throw l.framesToPop=1,l}}},418(e,t,n){"use strict";n.d(t,{A:()=>o});const o=()=>null},440(e,t,n){"use strict";t.rA=t.Ks=void 0;const o=n(1635);var a=n(2983);Object.defineProperty(t,"Ks",{enumerable:!0,get:function(){return o.__importDefault(a).default}});var i=n(2566);var s=n(253);Object.defineProperty(t,"rA",{enumerable:!0,get:function(){return s.getErrorCausalChain}})},478(e){"use strict";e.exports=JSON.parse('[{"id":"api/audit-trace.mdx","version":"v1","title":"audit trace","permalink":"/docs/v1/api/audit-trace","content":"Audit Trace API Endpoint GET /api/v1/conversation/audit/ /trace Response shape ], \\"stages\\": [ } ] } } Why this endpoint exists separates timeline from raw audit payload parsing easier UI rendering for runbooks and debug tools complements ce_conversation_history , which stores normalized user/AI turns even when audit persistence runs deferred preserves both domain and technical stages Use both endpoints together: /audit/ for raw forensic payload, /audit/ /trace for step flow visualization.","rawContent":"# Audit Trace API ## Endpoint GET /api/v1/conversation/audit/{conversationId}/trace ## Response shape <CodeBlockToggle title=\\"Trace response\\" language=\\"json\\" defaultOpen={true}> { { \\"conversationId\\": \\"9bf7540a-b129-4685-a120-730e8a0cb94b\\", \\"steps\\": [ { \\"step\\": \\"IntentResolutionStep\\", \\"stepClass\\": \\"com.github.salilvnair.convengine.engine.steps.IntentResolutionStep\\", \\"status\\": \\"OK\\", \\"startedAt\\": \\"2026-02-14T10:22:01.102Z\\", \\"endedAt\\": \\"2026-02-14T10:22:01.147Z\\", \\"durationMs\\": 45, \\"error\\": null, \\"stages\\": [] } ], \\"stages\\": [ { \\"auditId\\": 12031, \\"stage\\": \\"STEP_ENTER\\", \\"createdAt\\": \\"2026-02-14T10:22:01.102Z\\", \\"payload\\": { \\"step\\": \\"IntentResolutionStep\\" } } ] } } </CodeBlockToggle> ## Why this endpoint exists - separates timeline from raw audit payload parsing - easier UI rendering for runbooks and debug tools - complements ce_conversation_history , which stores normalized user/AI turns even when audit persistence runs deferred - preserves both domain and technical stages <Highlight type=\\"tip\\" title=\\"Best practice\\"> Use both endpoints together: /audit/{id} for raw forensic payload, /audit/{id}/trace for step-flow visualization. </Highlight>","excerpt":"Audit Trace API Endpoint GET /api/v1/conversation/audit/ /trace Response shape ], \\"stages\\": [ } ] } } Why this endpoint exists separates timeline from raw audit payload parsing easier UI rendering for runbooks and debug \u2026"},{"id":"api/java-api.mdx","version":"v1","title":"java api","permalink":"/docs/v1/api/java-api","content":"Java API (Core Contracts) Entry points } } default void beforeStep(EngineStep.Name stepName, EngineSession session) default void afterStep(EngineStep.Name stepName, EngineSession session, StepResult result) default void onStepError(EngineStep.Name stepName, EngineSession session, Throwable error) } } public boolean matches(String stepName) } } } Extension contracts ResponseTransformerHandler ContainerDataTransformerHandler container interceptors rule task execution pathway via SET_TASK","rawContent":"# Java API (Core Contracts) ## Entry points <DbTable title=\\"Primary interfaces\\" columns={[\\"Type\\", \\"Package\\", \\"Role\\"]} rows={[ [\\"ConversationalEngine\\", \\"engine.core\\", \\"Main process method\\"], [\\"LlmClient\\", \\"llm.core\\", \\"LLM adapter contract\\"], [\\"EngineStep\\", \\"engine.pipeline\\", \\"Step unit contract\\"], [\\"EngineStepHook\\", \\"engine.hook\\", \\"Step interception contract\\"], ]} /> <CodeBlockToggle title=\\"ConversationalEngine\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.core\\"> { public interface ConversationalEngine { EngineResult process(EngineContext engineContext); } } </CodeBlockToggle> <CodeBlockToggle title=\\"LlmClient\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.llm.core\\"> { public interface LlmClient { String generateText(String hint, String contextJson); String generateJson(String hint, String jsonSchema, String contextJson); float[] generateEmbedding(String input); } } </CodeBlockToggle> <CodeBlockToggle title=\\"EngineStepHook\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.hook\\"> { public interface EngineStepHook { default boolean supports(EngineStep.Name stepName, EngineSession session) { return true; } default void beforeStep(EngineStep.Name stepName, EngineSession session) {} default void afterStep(EngineStep.Name stepName, EngineSession session, StepResult result) {} default void onStepError(EngineStep.Name stepName, EngineSession session, Throwable error) {} } } </CodeBlockToggle> <CodeBlockToggle title=\\"EngineStep.Name enum (hook-safe matching)\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.pipeline\\"> { public interface EngineStep { enum Name { AuditUserInputStep, IntentResolutionStep, AddContainerDataStep, SchemaExtractionStep, ResponseResolutionStep, AutoAdvanceStep, McpToolStep, LoadOrCreateConversationStep, FallbackIntentStateStep, PersistConversationBootstrapStep, ResetConversationStep, PersistConversationStep, PipelineEndGuardStep, ResetResolvedIntentStep, PolicyEnforcementStep, RulesStep, Unknown; public static Name fromStepName(String stepName) { /* ... */ } public boolean matches(String stepName) { /* ... */ } } } } </CodeBlockToggle> ## Extension contracts - <MethodRef>ResponseTransformerHandler</MethodRef> - <MethodRef>ContainerDataTransformerHandler</MethodRef> - container interceptors - rule task execution pathway via <MethodRef>SET_TASK</MethodRef>","excerpt":"Java API (Core Contracts) Entry points } } default void beforeStep(EngineStep.Name stepName, EngineSession session) default void afterStep(EngineStep.Name stepName, EngineSession session, StepResult result) default void \u2026"},{"id":"api/rest-api.mdx","version":"v1","title":"rest api","permalink":"/docs/v1/api/rest-api","content":"REST API Base /api/v1/conversation Endpoints POST /message } } , \\"context\\": \\" \\" } } Experimental endpoint (feature flagged) Base: /api/v1/conversation/experimental POST /generate sql Enable with: } \' } } generate sql is designed for non transactional configuration tables ( ce_config , ce_intent , ce_rule , ce_prompt_template , ce_response , ce_output_schema , ce_container_config , optional MCP tables). It does not generate runtime conversation/audit data. Generated SQL should be reviewed before use. The endpoint applies safety checks but does not replace human review.","rawContent":"# REST API ## Base <FileRef>/api/v1/conversation</FileRef> ## Endpoints <DbTable title=\\"Conversation endpoints\\" columns={[\\"Method\\", \\"Path\\", \\"Purpose\\"]} rows={[ [\\"POST\\", \\"/message\\", \\"Process one turn and return payload\\"], [\\"GET\\", \\"/audit/{conversationId}\\", \\"Raw audit rows for conversation\\"], [\\"GET\\", \\"/audit/{conversationId}/trace\\", \\"Normalized step+stage timeline\\"], ]} /> ## POST <FileRef>/message</FileRef> <CodeBlockToggle title=\\"Request body\\" language=\\"json\\" defaultOpen={true}> { { \\"conversationId\\": \\"uuid-optional\\", \\"message\\": \\"Track request REQ-778102\\", \\"reset\\": false, \\"inputParams\\": { \\"tenant\\": \\"acme\\" } } } </CodeBlockToggle> <CodeBlockToggle title=\\"Success response\\" language=\\"json\\" defaultOpen={true}> { { \\"success\\": true, \\"conversationId\\": \\"9bf7540a-b129-4685-a120-730e8a0cb94b\\", \\"intent\\": \\"REQUEST_TRACKER\\", \\"state\\": \\"IDLE\\", \\"payload\\": { \\"type\\": \\"TEXT\\", \\"value\\": \\"Request REQ-778102 is IN_REVIEW.\\" }, \\"context\\": \\"{...}\\" } } </CodeBlockToggle> ## Experimental endpoint (feature-flagged) Base: <FileRef>/api/v1/conversation/experimental</FileRef> - <MethodRef>POST /generate-sql</MethodRef> Enable with: <CodeBlockToggle title=\\"application.yml (feature flag)\\" language=\\"yaml\\"> { convengine: experimental: enabled: true } </CodeBlockToggle> <Tabs groupId=\\"experimental-generate-sql\\"> <TabItem value=\\"postman\\" label=\\"Postman\\" default> <DbTable title=\\"Postman setup\\" columns={[\\"Field\\", \\"Value\\"]} rows={[ [\\"Method\\", \\"POST\\"], [\\"URL\\", \\"http://localhost:8080/api/v1/conversation/experimental/generate-sql\\"], [\\"Headers\\", \\"Content-Type: application/json\\"], [\\"Body Mode\\", \\"raw (JSON)\\"], ]} /> <CodeBlockToggle title=\\"Postman body (JSON)\\" language=\\"json\\"> { { \\"scenario\\": \\"Build disconnect electricity workflow\\", \\"domain\\": \\"utilities\\", \\"constraints\\": \\"Collect account number before action\\", \\"includeMcp\\": true } } </CodeBlockToggle> </TabItem> <TabItem value=\\"curl\\" label=\\"curl\\"> <CodeBlockToggle title=\\"curl request\\" language=\\"bash\\"> { curl -X POST \\"http://localhost:8080/api/v1/conversation/experimental/generate-sql\\" \\\\\\\\ -H \\"Content-Type: application/json\\" \\\\\\\\ -d \'{ \\"scenario\\": \\"Build disconnect electricity workflow\\", \\"domain\\": \\"utilities\\", \\"constraints\\": \\"Collect account number before action\\", \\"includeMcp\\": true }\' } </CodeBlockToggle> </TabItem> </Tabs> <CodeBlockToggle title=\\"/experimental/generate-sql success response\\" language=\\"json\\"> { { \\"success\\": true, \\"sql\\": \\"INSERT INTO ce_config ...;\\\\\\\\nINSERT INTO ce_intent ...;\\", \\"warnings\\": [], \\"note\\": \\"Experimental output: review before applying in production.\\" } } </CodeBlockToggle> <Highlight type=\\"info\\" title=\\"Generation scope\\"> generate-sql is designed for non-transactional configuration tables ( ce_config , ce_intent , ce_rule , ce_prompt_template , ce_response , ce_output_schema , ce_container_config , optional MCP tables). It does not generate runtime conversation/audit data. </Highlight> <Highlight type=\\"warning\\" title=\\"Experimental output\\"> Generated SQL should be reviewed before use. The endpoint applies safety checks but does not replace human review. </Highlight>","excerpt":"REST API Base /api/v1/conversation Endpoints POST /message } } , \\"context\\": \\" \\" } } Experimental endpoint (feature flagged) Base: /api/v1/conversation/experimental POST /generate sql Enable with: } \' } } generate sql is \u2026"},{"id":"api/stream-api.mdx","version":"v1","title":"stream api","permalink":"/docs/v1/api/stream-api","content":"Stream API (Socket) Base transport endpoints Conversation turns are submitted through POST /api/v1/conversation/message . Socket/SSE channels stream audit stages for that same conversationId . SSE subscription ; source.addEventListener(\\"STEP_ENTER\\", (event) = ); source.addEventListener(\\"ASSISTANT_OUTPUT\\", (event) = ); } STOMP subscription , }); client.activate(); } Socket audit payload contract } } } Socket + Audit API usage 1. Call POST /api/v1/conversation/message with conversationId . 2. Subscribe to SSE/STOMP for live stages. 3. Query GET /api/v1/conversation/audit/ \'} for raw events. 4. Query GET /api/v1/conversation/audit/ \'}/trace for normalized step timeline. Use REST endpoints for deterministic request/response behavior, and use streaming endpoints for observability UX.","rawContent":"# Stream API (Socket) ## Base transport endpoints <DbTable title=\\"Streaming endpoints\\" columns={[\\"Transport\\", \\"Endpoint / Destination\\", \\"Purpose\\"]} rows={[ [\\"SSE\\", \\"GET /api/v1/conversation/stream/{conversationId}\\", \\"Server-sent live audit events for one conversation\\"], [\\"STOMP WS\\", \\"WS handshake: /ws-convengine\\", \\"WebSocket endpoint for STOMP clients\\"], [\\"STOMP topic\\", \\"/topic/convengine/audit/{conversationId}\\", \\"Conversation-scoped audit stream destination\\"], ]} /> <Highlight type=\\"info\\" title=\\"Flow contract\\"> Conversation turns are submitted through <MethodRef>POST /api/v1/conversation/message</MethodRef>. Socket/SSE channels stream audit stages for that same <MethodRef>conversationId</MethodRef>. </Highlight> ## SSE subscription <CodeBlockToggle title=\\"SSE client (browser)\\" language=\\"javascript\\"> { const conversationId = \\"9bf7540a-b129-4685-a120-730e8a0cb94b\\"; const source = new EventSource( \\"/api/v1/conversation/stream/\\" + conversationId ); source.onmessage = (event) => { // fallback event channel console.log(\\"SSE message:\\", event.data); }; source.addEventListener(\\"STEP_ENTER\\", (event) => { console.log(\\"STEP_ENTER:\\", JSON.parse(event.data)); }); source.addEventListener(\\"ASSISTANT_OUTPUT\\", (event) => { console.log(\\"ASSISTANT_OUTPUT:\\", JSON.parse(event.data)); }); } </CodeBlockToggle> ## STOMP subscription <CodeBlockToggle title=\\"STOMP client (JS)\\" language=\\"javascript\\"> { // npm i @stomp/stompjs sockjs-client const conversationId = \\"9bf7540a-b129-4685-a120-730e8a0cb94b\\"; const client = new Client({ webSocketFactory: () => new SockJS(\\"/ws-convengine\\"), reconnectDelay: 5000, onConnect: () => { client.subscribe( \\"/topic/convengine/audit/\\" + conversationId, (message) => console.log(\\"STOMP audit:\\", JSON.parse(message.body)) ); }, }); client.activate(); } </CodeBlockToggle> ## Socket audit payload contract <CodeBlockToggle title=\\"SSE/STOMP audit event payload\\" language=\\"json\\"> { { \\"auditId\\": 12031, \\"stage\\": \\"STEP_ENTER\\", \\"createdAt\\": \\"2026-02-14T10:22:01.102Z\\", \\"payload\\": { \\"_meta\\": { \\"stage\\": \\"STEP_ENTER\\", \\"conversationId\\": \\"9bf7540a-b129-4685-a120-730e8a0cb94b\\", \\"intent\\": \\"FAQ\\", \\"state\\": \\"IDLE\\" } } } } </CodeBlockToggle> ## Socket + Audit API usage 1. Call <FileRef>POST /api/v1/conversation/message</FileRef> with conversationId . 2. Subscribe to SSE/STOMP for live stages. 3. Query <FileRef>GET /api/v1/conversation/audit/{\'{conversationId}\'}</FileRef> for raw events. 4. Query <FileRef>GET /api/v1/conversation/audit/{\'{conversationId}\'}/trace</FileRef> for normalized step timeline. <Highlight type=\\"tip\\" title=\\"Operational recommendation\\"> Use REST endpoints for deterministic request/response behavior, and use streaming endpoints for observability UX. </Highlight>","excerpt":"Stream API (Socket) Base transport endpoints Conversation turns are submitted through POST /api/v1/conversation/message . Socket/SSE channels stream audit stages for that same conversationId . SSE subscription ; source.a\u2026"},{"id":"architecture.mdx","version":"v1","title":"architecture","permalink":"/docs/v1/architecture","content":"Architecture Layers API Layer ConversationController request DTO: ConversationRequest response DTO: ConversationResponse Engine Layer DefaultConversationalEngine EnginePipelineFactory (DAG sort + wrappers + timing + step hooks) EngineSession (per turn mutable state) Resolver Layer intent: classifier + agent + collision resolver rules: type/action factories response: response type + output format factories MCP: planner + registry + DB executor Persistence Layer JPA repositories on ce_ ce_conversation and ce_audit write path Transport Layer (configurable) SSE stream endpoint STOMP/WebSocket publisher Request Path (high level) Builds EngineContext from conversationId , message , inputParams , optional reset flag. EngineSessionFactory creates session and history provider injects last turns. Each step receives same session instance and may mutate intent/state/context/payload. Final payload is persisted and returned as TEXT/JSON response. Code references } } } :::tip Intervention point You can intercept any step via EngineStepHook ( beforeStep , afterStep , onStepError ) without forking the engine. ::: Step order is never hardcoded as a list. It is computed from annotations and validated for cycles/missing dependencies.","rawContent":"# Architecture ## Layers ### API Layer - <MethodRef>ConversationController</MethodRef> - request DTO: <MethodRef>ConversationRequest</MethodRef> - response DTO: <MethodRef>ConversationResponse</MethodRef> ### Engine Layer - <MethodRef>DefaultConversationalEngine</MethodRef> - <MethodRef>EnginePipelineFactory</MethodRef> (DAG sort + wrappers + timing + step hooks) - <MethodRef>EngineSession</MethodRef> (per-turn mutable state) ### Resolver Layer - intent: classifier + agent + collision resolver - rules: type/action factories - response: response type + output format factories - MCP: planner + registry + DB executor ### Persistence Layer - JPA repositories on <FileRef>ce_*</FileRef> - <FileRef>ce_conversation</FileRef> and <FileRef>ce_audit</FileRef> write path ### Transport Layer (configurable) - SSE stream endpoint - STOMP/WebSocket publisher ## Request Path (high-level) <FlowStep step=\\"1\\" title=\\"Controller receives request\\"> Builds <MethodRef>EngineContext</MethodRef> from <MethodRef>conversationId</MethodRef>, <MethodRef>message</MethodRef>, <MethodRef>inputParams</MethodRef>, optional <MethodRef>reset</MethodRef> flag. </FlowStep> <FlowStep step=\\"2\\" title=\\"Engine opens session\\"> <MethodRef>EngineSessionFactory</MethodRef> creates session and history provider injects last turns. </FlowStep> <FlowStep step=\\"3\\" title=\\"Pipeline runs ordered steps\\"> Each step receives same session instance and may mutate intent/state/context/payload. </FlowStep> <FlowStep step=\\"4\\" title=\\"Persist + return result\\"> Final payload is persisted and returned as TEXT/JSON response. </FlowStep> ## Code references <CodeBlockToggle title=\\"Engine entrypoint\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.provider\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/provider/DefaultConversationalEngine.java\\" > { @Override public EngineResult process(EngineContext engineContext) { EngineSession session = sessionFactory.open(engineContext); session.setConversationHistory(historyProvider.lastTurns(session.getConversationId(), 10)); EnginePipeline pipeline = pipelineFactory.create(); return pipeline.execute(session); } } </CodeBlockToggle> <CodeBlockToggle title=\\"Pipeline execution loop\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.pipeline\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/pipeline/EnginePipeline.java\\" > { for (EngineStep step : steps) { StepResult r = step.execute(session); if (r instanceof StepResult.Stop(EngineResult result)) { return result; } } } </CodeBlockToggle> :::tip Intervention point You can intercept any step via <MethodRef>EngineStepHook</MethodRef> (<MethodRef>beforeStep</MethodRef>, <MethodRef>afterStep</MethodRef>, <MethodRef>onStepError</MethodRef>) without forking the engine. ::: <Highlight type=\\"warning\\" title=\\"DAG-ordering model\\"> Step order is never hardcoded as a list. It is computed from annotations and validated for cycles/missing dependencies. </Highlight>","excerpt":"Architecture Layers API Layer ConversationController request DTO: ConversationRequest response DTO: ConversationResponse Engine Layer DefaultConversationalEngine EnginePipelineFactory (DAG sort + wrappers + timing + step\u2026"},{"id":"consumer/annotations-reference.mdx","version":"v1","title":"annotations reference","permalink":"/docs/v1/consumer/annotations-reference","content":"Annotations Reference This page lists all annotation types currently present in ConvEngine and how consumers should use them. Consumer entry annotations } } } stream is an annotation parameter on @EnableConvEngine , not a YAML key. Keep it aligned with convengine.transport.sse.enabled and convengine.transport.stomp.enabled . Extension annotations (consumer customization) } } } } @Override public ContainerComponentResponse intercept(ContainerComponentResponse response, EngineSession session) } } If a class uses @ResponseTransformer or @ContainerDataTransformer but does not implement the required handler interface, startup fails. Internal pipeline annotations (advanced / framework contributors) } } Pipeline requires exactly one @ConversationBootstrapStep and one @TerminalStep . Misuse can break startup DAG validation. Quick recommendations for consumers 1. Use only @EnableConvEngine initially. 2. Add @ResponseTransformer or container annotations only when you have a concrete customization need. 3. Avoid pipeline DAG annotations unless you are intentionally adding custom engine steps and can test full ordering. 4. Keep annotation usage paired with integration tests for one real conversation flow. See , , and for end to end integration context.","rawContent":"# Annotations Reference This page lists all annotation types currently present in ConvEngine and how consumers should use them. ## Consumer entry annotations <DbTable title=\\"Use these in your consumer app\\" columns={[\\"Annotation\\", \\"Target\\", \\"Purpose\\", \\"Typical usage\\"]} rows={[ [\\" @EnableConvEngine(stream = true|false) \\", \\"Spring Boot app class\\", \\"Bootstraps ConvEngine auto-configuration and stream setting.\\", \\"Always required to activate framework.\\"], [\\" @EnableConvEngineAsyncAuditDispatch \\", \\"Spring config/app class\\", \\"Forces async audit dispatch marker mode.\\", \\"Use when you intentionally want async listener dispatch.\\"], [\\" @EnableConvEngineStompBrokerRelay \\", \\"Spring config/app class\\", \\"Forces STOMP broker relay marker mode.\\", \\"Use when deploying with external STOMP broker relay.\\"], ]} /> <CodeBlockToggle title=\\"Basic enablement\\" language=\\"java\\"> { @SpringBootApplication @EnableConvEngine(stream = true) public class MyApplication { public static void main(String[] args) { SpringApplication.run(MyApplication.class, args); } } } </CodeBlockToggle> <CodeBlockToggle title=\\"Optional relay + async markers\\" language=\\"java\\"> { @Configuration @EnableConvEngineAsyncAuditDispatch @EnableConvEngineStompBrokerRelay public class ConvEngineFeatureFlags { } } </CodeBlockToggle> <Highlight type=\\"info\\" title=\\"How stream mode works\\"> stream is an annotation parameter on @EnableConvEngine , not a YAML key. Keep it aligned with convengine.transport.sse.enabled and convengine.transport.stomp.enabled . </Highlight> ## Extension annotations (consumer customization) <DbTable title=\\"Extension points\\" columns={[\\"Annotation\\", \\"Must implement\\", \\"Purpose\\", \\"Key parameters\\"]} rows={[ [\\" @ResponseTransformer \\", \\" ResponseTransformerHandler \\", \\"Last-mile payload shaping by intent/state.\\", \\" intent , state \\"], [\\" @ContainerDataTransformer \\", \\" ContainerDataTransformerHandler \\", \\"Transforms CCF container data before session attach.\\", \\" intent , state \\"], [\\" @ContainerDataInterceptor \\", \\" ContainerDataRequestInterceptor and/or ContainerDataResponseInterceptor \\", \\"Intercepts CCF request/response around execution.\\", \\" intent , state , order \\"], ]} /> <CodeBlockToggle title=\\"Response transformer example\\" language=\\"java\\"> { @Component @ResponseTransformer(intent = \\"REQUEST_TRACKER\\", state = \\"IDLE\\") public class TrackerResponseTransformer implements ResponseTransformerHandler { @Override public OutputPayload transform(OutputPayload responsePayload, EngineSession session, Map<String, Object> inputParams) { return responsePayload; } } } </CodeBlockToggle> <CodeBlockToggle title=\\"Container transformer example\\" language=\\"java\\"> { @Component @ContainerDataTransformer(intent = \\"DISCONNECT_ELECTRICITY\\", state = \\"COLLECTING\\") public class DisconnectContainerTransformer implements ContainerDataTransformerHandler { @Override public Map<String, Object> transform(ContainerComponentResponse response, EngineSession session, Map<String, Object> inputParams) { return Map.of(\\"normalized\\", response); } } } </CodeBlockToggle> <CodeBlockToggle title=\\"Container interceptor example\\" language=\\"java\\"> { @Component @ContainerDataInterceptor(intent = \\"*\\", state = \\"*\\", order = 10) public class TraceContainerInterceptor implements ContainerDataRequestInterceptor, ContainerDataResponseInterceptor { @Override public void intercept(ContainerComponentRequest request, EngineSession session) { // mutate request if needed } @Override public ContainerComponentResponse intercept(ContainerComponentResponse response, EngineSession session) { return response; } } } </CodeBlockToggle> <Highlight type=\\"warning\\" title=\\"Transformer/interceptor registration rules\\"> If a class uses @ResponseTransformer or @ContainerDataTransformer but does not implement the required handler interface, startup fails. </Highlight> ## Internal pipeline annotations (advanced / framework contributors) <DbTable title=\\"Engine DAG annotations\\" columns={[\\"Annotation\\", \\"Role\\", \\"Who should use it\\"]} rows={[ [\\" @MustRunAfter(...) \\", \\"Declares DAG dependency: step runs after listed steps.\\", \\"Framework contributors adding new EngineStep beans.\\"], [\\" @MustRunBefore(...) \\", \\"Declares DAG dependency: step runs before listed steps.\\", \\"Framework contributors adding new EngineStep beans.\\"], [\\" @RequiresConversationPersisted \\", \\"Forces ordering after bootstrap persistence step.\\", \\"Framework/internal step authors.\\"], [\\" @ConversationBootstrapStep \\", \\"Marks the single bootstrap step in pipeline.\\", \\"Framework internals only.\\"], [\\" @TerminalStep \\", \\"Marks the single terminal step in pipeline.\\", \\"Framework internals only.\\"], [\\" @PromptVar \\", \\"Maps fields in internal prompt context models to template aliases.\\", \\"Framework internals only; not for consumer app classes.\\"], ]} /> <CodeBlockToggle title=\\"Custom step with ordering\\" language=\\"java\\"> { @Component @RequiresConversationPersisted @MustRunAfter(IntentResolutionStep.class) @MustRunBefore(ResponseResolutionStep.class) public class CustomValidationStep implements EngineStep { @Override public StepResult execute(EngineSession session) { return new StepResult.Continue(); } } } </CodeBlockToggle> <Highlight type=\\"warning\\" title=\\"Important constraints\\"> Pipeline requires exactly one @ConversationBootstrapStep and one @TerminalStep . Misuse can break startup DAG validation. </Highlight> ## Quick recommendations for consumers 1. Use only @EnableConvEngine initially. 2. Add @ResponseTransformer or container annotations only when you have a concrete customization need. 3. Avoid pipeline DAG annotations unless you are intentionally adding custom engine steps and can test full ordering. 4. Keep annotation usage paired with integration tests for one real conversation flow. <Highlight type=\\"info\\" title=\\"Related pages\\"> See [Consumer Guide](/docs/v1/consumer/), [New Consumer Onboarding](/docs/v1/consumer/new-consumer-onboarding), and [Extensions](/docs/v1/consumer/extensions) for end-to-end integration context. </Highlight>","excerpt":"Annotations Reference This page lists all annotation types currently present in ConvEngine and how consumers should use them. Consumer entry annotations } } } stream is an annotation parameter on @EnableConvEngine , not \u2026"},{"id":"consumer/backend-integration.mdx","version":"v1","title":"backend integration","permalink":"/docs/v1/consumer/backend-integration","content":"Backend Integration This page uses your demo repos directly: backend reference: convengine demo UI reference: zapper ui What each demo proves convengine demo : Spring Boot consumer setup, transport mode config, step hooks, LLM wiring. zapper ui : conversation client, SSE subscription, audit timeline UI. Add @EnableConvEngine and provide required beans. Use profile yaml ( sse , stomp , both ) to switch runtime behavior. Frontend posts to message endpoint and listens to SSE/STOMP for audit updates. convengine demo: Core app bootstrap ) @EntityScan(basePackages = ) @EnableJpaRepositories(basePackages = ) public class ConvengineDemoApplication } } @Bean public ObjectMapper objectMapper() } } convengine demo: Runtime config model: gpt 4.1 base url: https://api.openai.com lmstudio: api key: \\\\$ model: openai/gpt oss 20b base url: http://localhost:1234 transport: sse: enabled: true emitter timeout ms: 1800000 stomp: enabled: false endpoint: /ws convengine app destination prefix: /app topic prefix: /topic audit destination base: /topic/convengine/audit allowed origin pattern: \\" \\" sock js: true broker: mode: SIMPLE relay destination prefixes: /topic,/queue relay host: localhost relay port: 61613 client login: \\"\\" client passcode: \\"\\" system login: \\"\\" system passcode: \\"\\" virtual host: \\"\\" system heartbeat send interval ms: 10000 system heartbeat receive interval ms: 10000 audit: enabled: true level: ALL include stages: [] exclude stages: [] persistence: mode: IMMEDIATE jdbc batch size: 200 max buffered events: 5000 flush stages: ENGINE_KNOWN_FAILURE,ENGINE_UNKNOWN_FAILURE final step names: PipelineEndGuardStep flush on stop outcome: true dispatch: async enabled: false worker threads: 2 queue capacity: 2000 rejection policy: CALLER_RUNS keep alive seconds: 60 rate limit: enabled: false max events: 200 window ms: 1000 per conversation: true per stage: true max tracked buckets: 20000 } Keep broker.mode: SIMPLE and audit.dispatch.async enabled: false for baseline. Enable relay and async in non prod first, then tune queue capacity , rejection policy , and rate limit using audit volume. convengine demo: Transport + Hook diagnostics public static class StepHook } } } } @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) @Override public void afterStep(EngineStep.Name stepName, EngineSession session, StepResult result) @Override public void onStepError(EngineStep.Name stepName, EngineSession session, Throwable error) } } zapper ui: How frontend consumes backend ); return () = stream.close(); }, [conversationId]); } ]); // Typing indicator shown while request is in flight } 1. Start backend ( convengine demo ) with profile sse , stomp , or both . 2. Start zapper ui and point API base to backend URL. 3. Send message, verify live timeline from stream + detailed payloads from audit API.","rawContent":"# Backend Integration This page uses your demo repos directly: - backend reference: <FileRef>convengine-demo</FileRef> - UI reference: <FileRef>zapper-ui</FileRef> ## What each demo proves - <FileRef>convengine-demo</FileRef>: Spring Boot consumer setup, transport mode config, step hooks, LLM wiring. - <FileRef>zapper-ui</FileRef>: conversation client, SSE subscription, audit timeline UI. <FlowStep step=\\"1\\" title=\\"Enable ConvEngine in backend\\"> Add <MethodRef>@EnableConvEngine</MethodRef> and provide required beans. </FlowStep> <FlowStep step=\\"2\\" title=\\"Configure transport mode\\"> Use profile yaml ( sse , stomp , both ) to switch runtime behavior. </FlowStep> <FlowStep step=\\"3\\" title=\\"Connect frontend\\"> Frontend posts to message endpoint and listens to SSE/STOMP for audit updates. </FlowStep> ## convengine-demo: Core app bootstrap <CodeBlockToggle title=\\"ConvengineDemoApplication.java\\" language=\\"java\\" packagePath=\\"com.github.salilvnair\\" filePath=\\"convengine-demo/src/main/java/com/github/salilvnair/ConvengineDemoApplication.java\\" > { @SpringBootApplication @ComponentScan(basePackages = {\\"com.github.salilvnair.convengdemo\\"}) @EntityScan(basePackages = {\\"com.github.salilvnair.convengdemo.entity\\"}) @EnableJpaRepositories(basePackages = {\\"com.github.salilvnair.convengdemo.repo\\"}) public class ConvengineDemoApplication { public static void main(String[] args) { SpringApplication.run(ConvengineDemoApplication.class, args); } } } </CodeBlockToggle> <CodeBlockToggle title=\\"ConvEngineConfig.java\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengdemo.config\\" filePath=\\"convengine-demo/src/main/java/com/github/salilvnair/convengdemo/config/ConvEngineConfig.java\\" > { @Configuration @EnableConvEngine @EnableConvEngineAsyncAuditDispatch // optional @EnableConvEngineStompBrokerRelay // optional @EnableCcfCore public class ConvEngineConfig { @Bean public RestWebServiceFacade restWebServiceFacade() { return new RestWebServiceFacade(); } @Bean public ObjectMapper objectMapper() { return new ObjectMapper(); } } } </CodeBlockToggle> ## convengine-demo: Runtime config <CodeBlockToggle title=\\"application.yml\\" language=\\"yaml\\" filePath=\\"convengine-demo/src/main/resources/application.yml\\" > { server: port: 8080 spring: datasource: url: jdbc:postgresql://localhost:5432/convengine username: convengine_user password: convengine_pwd convengine: demo: stream-mode: SSE step-hook: enabled: true tables: AUDIT: CE_AUDIT CONTAINER_CONFIG: CE_CONTAINER_CONFIG CONVERSATION: CE_CONVERSATION INTENT: CE_INTENT INTENT_CLASSIFIER: CE_INTENT_CLASSIFIER LLM_CALL_LOG: CE_LLM_CALL_LOG MCP_DB_TOOL: CE_MCP_DB_TOOL MCP_TOOL: CE_MCP_TOOL OUTPUT_SCHEMA: CE_OUTPUT_SCHEMA PROMPT_TEMPLATE: CE_PROMPT_TEMPLATE RESPONSE: CE_RESPONSE RULE: CE_RULE llm: provider: openai temperature: 0.3 openai: api-key: \\\\${OPENAI_API_KEY\\\\} model: gpt-4.1 base-url: https://api.openai.com lmstudio: api-key: \\\\${LMSTUDIO_API_KEY\\\\} model: openai/gpt-oss-20b base-url: http://localhost:1234 transport: sse: enabled: true emitter-timeout-ms: 1800000 stomp: enabled: false endpoint: /ws-convengine app-destination-prefix: /app topic-prefix: /topic audit-destination-base: /topic/convengine/audit allowed-origin-pattern: \\"*\\" sock-js: true broker: mode: SIMPLE relay-destination-prefixes: /topic,/queue relay-host: localhost relay-port: 61613 client-login: \\"\\" client-passcode: \\"\\" system-login: \\"\\" system-passcode: \\"\\" virtual-host: \\"\\" system-heartbeat-send-interval-ms: 10000 system-heartbeat-receive-interval-ms: 10000 audit: enabled: true level: ALL include-stages: [] exclude-stages: [] persistence: mode: IMMEDIATE jdbc-batch-size: 200 max-buffered-events: 5000 flush-stages: ENGINE_KNOWN_FAILURE,ENGINE_UNKNOWN_FAILURE final-step-names: PipelineEndGuardStep flush-on-stop-outcome: true dispatch: async-enabled: false worker-threads: 2 queue-capacity: 2000 rejection-policy: CALLER_RUNS keep-alive-seconds: 60 rate-limit: enabled: false max-events: 200 window-ms: 1000 per-conversation: true per-stage: true max-tracked-buckets: 20000 } </CodeBlockToggle> <CodeBlockToggle title=\\"application-sse.yml\\" language=\\"yaml\\" filePath=\\"convengine-demo/src/main/resources/application-sse.yml\\"> { convengine: demo: stream-mode: SSE transport: sse: enabled: true stomp: enabled: false } </CodeBlockToggle> <CodeBlockToggle title=\\"application-stomp.yml\\" language=\\"yaml\\" filePath=\\"convengine-demo/src/main/resources/application-stomp.yml\\"> { convengine: demo: stream-mode: STOMP transport: sse: enabled: false stomp: enabled: true } </CodeBlockToggle> <CodeBlockToggle title=\\"application-both.yml\\" language=\\"yaml\\" filePath=\\"convengine-demo/src/main/resources/application-both.yml\\"> { convengine: demo: stream-mode: BOTH transport: sse: enabled: true stomp: enabled: true } </CodeBlockToggle> <Highlight type=\\"tip\\" title=\\"Relay + async audit rollout\\"> Keep broker.mode: SIMPLE and audit.dispatch.async-enabled: false for baseline. Enable relay and async in non-prod first, then tune queue-capacity , rejection-policy , and rate-limit using audit volume. </Highlight> ## convengine-demo: Transport + Hook diagnostics <CodeBlockToggle title=\\"DemoTransportProperties.java\\" language=\\"java\\" filePath=\\"convengine-demo/src/main/java/com/github/salilvnair/convengdemo/config/DemoTransportProperties.java\\" > { @Component @ConfigurationProperties(prefix = \\"convengine.demo\\") public class DemoTransportProperties { private StreamMode streamMode = StreamMode.SSE; private StepHook stepHook = new StepHook(); public enum StreamMode { SSE, STOMP, BOTH } public static class StepHook { private boolean enabled = true; } } } </CodeBlockToggle> <CodeBlockToggle title=\\"ConvEngineTransportStartupLogger.java\\" language=\\"java\\" filePath=\\"convengine-demo/src/main/java/com/github/salilvnair/convengdemo/config/ConvEngineTransportStartupLogger.java\\" > { @Component @RequiredArgsConstructor public class ConvEngineTransportStartupLogger { private final DemoTransportProperties demoTransportProperties; private final ConvEngineTransportConfig transportConfig; private final Environment environment; @EventListener(ApplicationReadyEvent.class) public void logTransportConfiguration() { boolean sseEnabled = transportConfig.getSse().isEnabled(); boolean stompEnabled = transportConfig.getStomp().isEnabled(); // validates mode and prints endpoints } } } </CodeBlockToggle> <CodeBlockToggle title=\\"DemoEngineStepHook.java\\" language=\\"java\\" filePath=\\"convengine-demo/src/main/java/com/github/salilvnair/convengdemo/config/DemoEngineStepHook.java\\" > { @Component @RequiredArgsConstructor public class DemoEngineStepHook implements EngineStepHook { private static final Set<EngineStep.Name> TRACKED_STEPS = Set.of( EngineStep.Name.IntentResolutionStep, EngineStep.Name.SchemaExtractionStep, EngineStep.Name.RulesStep, EngineStep.Name.ResponseResolutionStep ); @Override public boolean supports(EngineStep.Name stepName, EngineSession session) { return demoTransportProperties.getStepHook().isEnabled() && TRACKED_STEPS.contains(stepName); } @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) { /* logs */ } @Override public void afterStep(EngineStep.Name stepName, EngineSession session, StepResult result) { /* logs */ } @Override public void onStepError(EngineStep.Name stepName, EngineSession session, Throwable error) { /* logs */ } } } </CodeBlockToggle> ## zapper-ui: How frontend consumes backend <CodeBlockToggle title=\\"convengine.api.js (zapper-ui)\\" language=\\"js\\" filePath=\\"zapper-ui/src/api/convengine.api.js\\" > { const API_BASE = \\"http://localhost:8080/api/v1/conversation\\"; // STOMP scaffold commented for optional enablement } </CodeBlockToggle> <CodeBlockToggle title=\\"App.jsx (zapper-ui)\\" language=\\"jsx\\" filePath=\\"zapper-ui/src/App.jsx\\" > { useEffect(() => { const stream = subscribeConversationSse(conversationId, { onConnected: () => setAuditVersion(v => v + 1), onEvent: () => setAuditVersion(v => v + 1), }); return () => stream.close(); }, [conversationId]); } </CodeBlockToggle> <CodeBlockToggle title=\\"ChatPanel.jsx (zapper-ui)\\" language=\\"jsx\\" filePath=\\"zapper-ui/src/components/ChatPanel.jsx\\" > { const res = await sendMessage(conversationId, userText); setMessages(m => [...m, { role: \\"assistant\\", text: assistantText }]); // Typing indicator shown while request is in-flight } </CodeBlockToggle> <Highlight type=\\"info\\" title=\\"Backend + UI runbook\\"> 1. Start backend ( convengine-demo ) with profile <MethodRef>sse</MethodRef>, <MethodRef>stomp</MethodRef>, or <MethodRef>both</MethodRef>. 2. Start <FileRef>zapper-ui</FileRef> and point API base to backend URL. 3. Send message, verify live timeline from stream + detailed payloads from audit API. </Highlight> <CodeBlockToggle title=\\"Run commands\\" language=\\"bash\\" defaultOpen={false}> { # backend (convengine-demo) ./mvnw spring-boot:run -Dspring-boot.run.profiles=sse # or ./mvnw spring-boot:run -Dspring-boot.run.profiles=stomp # or ./mvnw spring-boot:run -Dspring-boot.run.profiles=both # frontend (zapper-ui) npm install npm run dev } </CodeBlockToggle>","excerpt":"Backend Integration This page uses your demo repos directly: backend reference: convengine demo UI reference: zapper ui What each demo proves convengine demo : Spring Boot consumer setup, transport mode config, step hook\u2026"},{"id":"consumer/configuration.mdx","version":"v1","title":"configuration","permalink":"/docs/v1/consumer/configuration","content":"Configuration Deep Guide Table mapping in application.yml (ConvEngine + CCF Core) Use this when your physical table names differ from defaults. ConvEngine reads convengine.tables. ; CCF Core reads ccf.core.tables. . If you override table names, keep mappings consistent across environments and apply the same naming strategy in JPA config. ConvEngine does not ship default application.yml values; consumers must provide convengine. properties. Complete application.yml reference (demo + full ConvEngine options) This is a complete starter reference combining convengine demo style settings and all configurable convengine. properties currently present in the framework. model: gpt 4.1 base url: https://api.openai.com lmstudio: api key: \\\\$ model: openai/gpt oss 20b base url: http://localhost:1234 ccf: core: tables: PAGE_COMMON_QUERY: ZP_PAGE_COMMON_QUERY SECTION_INFO: ZP_SECTION_INFO CONTAINER_INFO: ZP_CONTAINER_INFO CONTAINER_FIELD_INFO: ZP_CONTAINER_FIELD_INFO CONTAINER_QUERY_INFO: ZP_CONTAINER_QUERY_INFO } @EnableConvEngine(stream = true|false) is annotation driven. It is not a YAML property; keep transport flags aligned with the annotation mode. ce_prompt_template in detail ce_prompt_template holds reusable prompt text for both schema extraction and derived response generation. Use response_type to route templates: SCHEMA_JSON for schema extraction prompts TEXT for derived text response prompts JSON for derived json response prompts }\\\\nContext: }\\\\nSchema: }\', true); Derived text response template INSERT INTO ce_prompt_template (intent_code, state_code, response_type, system_prompt, user_prompt, enabled) VALUES (\'REQUEST_TRACKER\', \'IDLE\', \'TEXT\', \'You are a concise status assistant. Keep response under 3 lines.\', \'User: }\\\\nContext: }\\\\nSession: }\', true); } ce_config in detail ce_config stores runtime tunables keyed by component class. Common keys: AgentIntentResolver.MIN_CONFIDENCE AgentIntentResolver.COLLISION_GAP_THRESHOLD AgentIntentResolver.SYSTEM_PROMPT AgentIntentResolver.USER_PROMPT McpPlanner.SYSTEM_PROMPT McpPlanner.USER_PROMPT ResetResolvedIntentStep.RESET_INTENT_CODES IntentResolutionStep.STICKY_INTENT }\\\\nTools: }\\\\nContext: }\', true); } ce_output_schema in detail ce_output_schema defines extraction contract per intent/state. SchemaExtractionStep uses this JSON schema to detect missing fields and drive clarification flow. , \\"reason\\": , \\"requestedDate\\": } }\'::jsonb, true ); } ce_response in detail ce_response maps resolved intent/state to response strategy. EXACT : static response body from DB. DERIVED : runtime generated response (LLM), optionally using ce_prompt_template . \'::jsonb, true); } ce_rule in detail ce_rule is the conditional transition/action layer executed in RulesStep . rule_type : EXACT , REGEX , JSON_PATH phase : PIPELINE_RULES , AGENT_POST_INTENT state_code : NULL (all states), ANY (all states), or specific state code action : SET_INTENT , SET_STATE , SET_JSON , GET_CONTEXT , GET_SCHEMA_JSON , GET_SESSION , SET_TASK ce_rule.phase execution semantics Use phase to control where a rule executes. ce_rule.state_code execution semantics Use state_code to reduce unnecessary rule evaluations: EngineSession/inputParams include phase metadata: postIntentRule / post_intent_rule rule_phase rule_execution_source rule_execution_origin Prompt variable guidance Common variables used in templates: } } } } } schema helpers: } , } , } Prompt template extra now includes all keys present in inputParams , including runtime/system derived keys written through session.putInputParam(...) . Keep key naming and values controlled in consumer task/rule code. Runtime transport/audit properties } } New 1.0.8+ runtime controls explained 1. Async audit dispatch: Moves transport fan out off request thread when enabled. Configure with convengine.audit.dispatch. or @EnableConvEngineAsyncAuditDispatch . 2. Backpressure policy: Queue capacity + rejection policy control behavior under burst. CALLER_RUNS is safest default; DROP_ favors latency; ABORT is strict. 3. Stage level audit controls: level , include stages , exclude stages , and rate limit reduce noisy audit traffic. 4. Deferred bulk persistence: convengine.audit.persistence.mode=DEFERRED_BULK buffers events and writes batch inserts. Flushes on terminal step/error (configurable), plus request end safety flush. 5. STOMP broker mode: SIMPLE (default): in memory broker. RELAY : external STOMP broker (RabbitMQ/other relay supporting STOMP). RabbitMQ relay example Redis example (via STOMP gateway/bridge) ConvEngine STOMP relay requires a STOMP compatible broker endpoint. Redis alone is not a native STOMP broker; use a STOMP gateway/bridge in front of Redis.","rawContent":"# Configuration Deep Guide ## Table mapping in application.yml (ConvEngine + CCF Core) Use this when your physical table names differ from defaults. ConvEngine reads convengine.tables.* ; CCF Core reads ccf.core.tables.* . <CodeBlockToggle title=\\"application.yml table mappings\\" language=\\"yaml\\"> { ccf: core: tables: PAGE_COMMON_QUERY: ZP_PAGE_COMMON_QUERY SECTION_INFO: ZP_SECTION_INFO CONTAINER_INFO: ZP_CONTAINER_INFO CONTAINER_FIELD_INFO: ZP_CONTAINER_FIELD_INFO CONTAINER_QUERY_INFO: ZP_CONTAINER_QUERY_INFO convengine: tables: AUDIT: CE_AUDIT CONFIG: CE_CONFIG CONTAINER_CONFIG: CE_CONTAINER_CONFIG CONVERSATION: CE_CONVERSATION INTENT: CE_INTENT INTENT_CLASSIFIER: CE_INTENT_CLASSIFIER LLM_CALL_LOG: CE_LLM_CALL_LOG MCP_DB_TOOL: CE_MCP_DB_TOOL MCP_TOOL: CE_MCP_TOOL OUTPUT_SCHEMA: CE_OUTPUT_SCHEMA POLICY: CE_POLICY PROMPT_TEMPLATE: CE_PROMPT_TEMPLATE RESPONSE: CE_RESPONSE RULE: CE_RULE } </CodeBlockToggle> <Highlight type=\\"info\\" title=\\"Important\\"> If you override table names, keep mappings consistent across environments and apply the same naming strategy in JPA config. ConvEngine does not ship default application.yml values; consumers must provide convengine.* properties. </Highlight> ## Complete application.yml reference (demo + full ConvEngine options) This is a complete starter reference combining convengine-demo style settings and all configurable convengine.* properties currently present in the framework. <CodeBlockToggle title=\\"Complete application.yml reference\\" language=\\"yaml\\" defaultOpen={true} > { server: port: 8080 spring: application: name: convengine datasource: url: jdbc:postgresql://localhost:5432/convengine username: convengine_user password: convengine_pwd driver-class-name: org.postgresql.Driver jpa: open-in-view: false hibernate: ddl-auto: none naming: # Use the physical strategy your app needs (demo uses CCF strategy) physical-strategy: com.github.salilvnair.ccf.config.hibernate.CcfPhysicalNamingStrategy show-sql: true properties: hibernate: format_sql: true jdbc: lob: non_contextual_creation: true logging: level: root: INFO org.hibernate.SQL: DEBUG org.hibernate.type.descriptor.sql.BasicBinder: TRACE convengine: # Demo app-only block (optional, not framework-required) demo: stream-mode: SSE # SSE | STOMP | BOTH step-hook: enabled: true # Framework flags experimental: enabled: false # Dynamic table mapping for CE_* entities tables: AUDIT: CE_AUDIT CONFIG: CE_CONFIG CONTAINER_CONFIG: CE_CONTAINER_CONFIG CONVERSATION: CE_CONVERSATION INTENT: CE_INTENT INTENT_CLASSIFIER: CE_INTENT_CLASSIFIER LLM_CALL_LOG: CE_LLM_CALL_LOG MCP_DB_TOOL: CE_MCP_DB_TOOL MCP_TOOL: CE_MCP_TOOL OUTPUT_SCHEMA: CE_OUTPUT_SCHEMA POLICY: CE_POLICY PROMPT_TEMPLATE: CE_PROMPT_TEMPLATE RESPONSE: CE_RESPONSE RULE: CE_RULE transport: sse: enabled: true emitter-timeout-ms: 1800000 stomp: enabled: false endpoint: /ws-convengine app-destination-prefix: /app topic-prefix: /topic audit-destination-base: /topic/convengine/audit allowed-origin-pattern: \\"*\\" sock-js: true broker: mode: SIMPLE # SIMPLE | RELAY relay-destination-prefixes: /topic,/queue relay-host: localhost relay-port: 61613 client-login: \\"\\" client-passcode: \\"\\" system-login: \\"\\" system-passcode: \\"\\" virtual-host: \\"\\" system-heartbeat-send-interval-ms: 10000 system-heartbeat-receive-interval-ms: 10000 audit: enabled: true persist-meta: true level: ALL # ALL | STANDARD | ERROR_ONLY | NONE include-stages: [] exclude-stages: [] persistence: mode: IMMEDIATE # IMMEDIATE | DEFERRED_BULK jdbc-batch-size: 200 max-buffered-events: 5000 flush-stages: ENGINE_KNOWN_FAILURE,ENGINE_UNKNOWN_FAILURE final-step-names: PipelineEndGuardStep flush-on-stop-outcome: true dispatch: async-enabled: false worker-threads: 2 queue-capacity: 2000 rejection-policy: CALLER_RUNS # CALLER_RUNS | DROP_NEWEST | DROP_OLDEST | ABORT keep-alive-seconds: 60 rate-limit: enabled: false max-events: 200 window-ms: 1000 per-conversation: true per-stage: true max-tracked-buckets: 20000 # Example consumer-specific LLM block (optional, used by demo-style adapters) # llm: # provider: openai # temperature: 0.3 # openai: # api-key: \\\\${OPENAI_API_KEY} # model: gpt-4.1 # base-url: https://api.openai.com # lmstudio: # api-key: \\\\${LMSTUDIO_API_KEY} # model: openai/gpt-oss-20b # base-url: http://localhost:1234 ccf: core: tables: PAGE_COMMON_QUERY: ZP_PAGE_COMMON_QUERY SECTION_INFO: ZP_SECTION_INFO CONTAINER_INFO: ZP_CONTAINER_INFO CONTAINER_FIELD_INFO: ZP_CONTAINER_FIELD_INFO CONTAINER_QUERY_INFO: ZP_CONTAINER_QUERY_INFO } </CodeBlockToggle> <Highlight type=\\"tip\\" title=\\"Stream enablement note\\"> @EnableConvEngine(stream = true|false) is annotation-driven. It is not a YAML property; keep transport flags aligned with the annotation mode. </Highlight> ## ce_prompt_template in detail ce_prompt_template holds reusable prompt text for both schema extraction and derived response generation. Use response_type to route templates: - SCHEMA_JSON for schema extraction prompts - TEXT for derived text response prompts - JSON for derived json response prompts <CodeBlockToggle title=\\"Example ce_prompt_template rows\\" language=\\"sql\\"> { -- Schema extraction template INSERT INTO ce_prompt_template (intent_code, state_code, response_type, system_prompt, user_prompt, enabled) VALUES (\'DISCONNECT_ELECTRICITY\', \'COLLECTING\', \'SCHEMA_JSON\', \'Extract required fields strictly as JSON. No commentary.\', \'User: {{user_input}}\\\\nContext: {{context}}\\\\nSchema: {{schema}}\', true); -- Derived text response template INSERT INTO ce_prompt_template (intent_code, state_code, response_type, system_prompt, user_prompt, enabled) VALUES (\'REQUEST_TRACKER\', \'IDLE\', \'TEXT\', \'You are a concise status assistant. Keep response under 3 lines.\', \'User: {{user_input}}\\\\nContext: {{context}}\\\\nSession: {{session}}\', true); } </CodeBlockToggle> ## ce_config in detail ce_config stores runtime tunables keyed by component class. Common keys: - AgentIntentResolver.MIN_CONFIDENCE - AgentIntentResolver.COLLISION_GAP_THRESHOLD - AgentIntentResolver.SYSTEM_PROMPT - AgentIntentResolver.USER_PROMPT - McpPlanner.SYSTEM_PROMPT - McpPlanner.USER_PROMPT - ResetResolvedIntentStep.RESET_INTENT_CODES - IntentResolutionStep.STICKY_INTENT <CodeBlockToggle title=\\"Example ce_config rows\\" language=\\"sql\\"> { INSERT INTO ce_config (config_type, config_key, config_value, enabled) VALUES (\'AgentIntentResolver\', \'MIN_CONFIDENCE\', \'0.60\', true), (\'AgentIntentResolver\', \'COLLISION_GAP_THRESHOLD\', \'0.15\', true), (\'ResetResolvedIntentStep\', \'RESET_INTENT_CODES\', \'RESET_SESSION,START_OVER\', true), (\'IntentResolutionStep\', \'STICKY_INTENT\', \'true\', true), (\'McpPlanner\', \'SYSTEM_PROMPT\', \'You are an MCP planner. Prefer safe calls and minimal arguments.\', true), (\'McpPlanner\', \'USER_PROMPT\', \'User: {{user_input}}\\\\nTools: {{mcp_tools}}\\\\nContext: {{context}}\', true); } </CodeBlockToggle> <DbTable title=\\"Implemented type/action values\\" columns={[\\"Field\\", \\"Allowed values\\", \\"Notes\\"]} rows={[ [\\"ce_response.response_type\\", \\"EXACT, DERIVED\\", \\"EXACT bypasses LLM generation\\"], [\\"ce_response.output_format\\", \\"TEXT, JSON\\", \\"Used by output format resolver\\"], [\\"ce_rule.rule_type\\", \\"EXACT, REGEX, JSON_PATH\\", \\"Must match installed rule type resolvers\\"], [\\"ce_rule.phase\\", \\"PIPELINE_RULES, AGENT_POST_INTENT\\", \\"Controls whether rule runs in RulesStep or AgentIntentResolver post-intent pass\\"], [\\"ce_rule.state_code\\", \\"NULL, ANY, specific state code\\", \\"NULL/ANY apply across states; specific value scopes execution to that state\\"], [\\"ce_rule.action\\", \\"SET_INTENT, SET_STATE, SET_JSON, GET_CONTEXT, GET_SCHEMA_JSON, GET_SESSION, SET_TASK\\", \\"Must match installed action resolvers\\"], ]} /> ## ce_output_schema in detail ce_output_schema defines extraction contract per intent/state. SchemaExtractionStep uses this JSON schema to detect missing fields and drive clarification flow. <CodeBlockToggle title=\\"ce_output_schema shape (DDL-style)\\" language=\\"sql\\"> { -- Core columns (simplified) CREATE TABLE ce_output_schema ( schema_id BIGSERIAL PRIMARY KEY, intent_code TEXT NOT NULL, state_code TEXT NOT NULL, schema_name TEXT, schema_description TEXT, json_schema JSONB NOT NULL, enabled BOOLEAN NOT NULL DEFAULT TRUE, created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(), updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW() ); } </CodeBlockToggle> <CodeBlockToggle title=\\"Example ce_output_schema row\\" language=\\"sql\\"> { INSERT INTO ce_output_schema (intent_code, state_code, schema_name, schema_description, json_schema, enabled) VALUES ( \'DISCONNECT_ELECTRICITY\', \'COLLECTING\', \'disconnect_request\', \'Required data to process electricity disconnect request.\', \'{ \\"type\\":\\"object\\", \\"required\\":[\\"accountNumber\\",\\"reason\\"], \\"properties\\":{ \\"accountNumber\\":{\\"type\\":\\"string\\"}, \\"reason\\":{\\"type\\":\\"string\\",\\"enum\\":[\\"MOVE_OUT\\",\\"TEMP_CLOSE\\",\\"PERMANENT_CLOSE\\"]}, \\"requestedDate\\":{\\"type\\":\\"string\\",\\"format\\":\\"date\\"} } }\'::jsonb, true ); } </CodeBlockToggle> ## ce_response in detail ce_response maps resolved intent/state to response strategy. - EXACT : static response body from DB. - DERIVED : runtime generated response (LLM), optionally using ce_prompt_template . <CodeBlockToggle title=\\"ce_response shape (DDL-style)\\" language=\\"sql\\"> { CREATE TABLE ce_response ( response_id BIGSERIAL PRIMARY KEY, intent_code TEXT NOT NULL, state_code TEXT NOT NULL, response_type TEXT NOT NULL, -- EXACT | DERIVED output_format TEXT NOT NULL, -- TEXT | JSON response_text TEXT, response_json JSONB, enabled BOOLEAN NOT NULL DEFAULT TRUE, created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(), updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW() ); } </CodeBlockToggle> <CodeBlockToggle title=\\"Example ce_response rows\\" language=\\"sql\\"> { -- EXACT TEXT response INSERT INTO ce_response (intent_code, state_code, response_type, output_format, response_text, enabled) VALUES (\'FAQ\', \'IDLE\', \'EXACT\', \'TEXT\', \'Yes, you can move your connection using Zapper app.\', true); -- DERIVED JSON response INSERT INTO ce_response (intent_code, state_code, response_type, output_format, response_json, enabled) VALUES (\'REQUEST_TRACKER\', \'IDLE\', \'DERIVED\', \'JSON\', \'{\\"template\\":\\"status-card\\"}\'::jsonb, true); } </CodeBlockToggle> ## ce_rule in detail ce_rule is the conditional transition/action layer executed in RulesStep . - rule_type : EXACT , REGEX , JSON_PATH - phase : PIPELINE_RULES , AGENT_POST_INTENT - state_code : NULL (all states), ANY (all states), or specific state code - action : SET_INTENT , SET_STATE , SET_JSON , GET_CONTEXT , GET_SCHEMA_JSON , GET_SESSION , SET_TASK <CodeBlockToggle title=\\"ce_rule shape (DDL-style)\\" language=\\"sql\\"> { CREATE TABLE ce_rule ( rule_id BIGSERIAL PRIMARY KEY, phase TEXT NOT NULL DEFAULT \'PIPELINE_RULES\', intent_code TEXT NULL, state_code TEXT NULL, rule_type TEXT NOT NULL, match_pattern TEXT NOT NULL, action TEXT NOT NULL, action_value TEXT NULL, priority INT NOT NULL DEFAULT 100, enabled BOOLEAN NOT NULL DEFAULT TRUE, description TEXT NULL, created_at TIMESTAMPTZ NOT NULL DEFAULT NOW() ); } </CodeBlockToggle> <CodeBlockToggle title=\\"Example ce_rule rows\\" language=\\"sql\\"> { -- If user says reset keywords, set reset intent INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'PIPELINE_RULES\', \'FAQ\', \'ANY\', \'REGEX\', \'(?i)^(reset|restart)$\', \'SET_INTENT\', \'RESET_SESSION\', 10, true, \'Reset intent switch\'); -- Agent post-intent bootstrap INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'AGENT_POST_INTENT\', \'MAPPING_STUDIO\', \'ANY\', \'JSON_PATH\', \'$[?(@.intent == \'\'MAPPING_STUDIO\'\' && (@.state == \'\'UNKNOWN\'\' || @.state == \'\'IDLE\'\'))]\', \'SET_STATE\', \'COLLECT_INPUTS\', 5, true, \'Bootstrap mapping state during post-intent pass\'); } </CodeBlockToggle> ### ce_rule.phase execution semantics Use phase to control where a rule executes. <DbTable title=\\"Rule Phase Execution Matrix\\" columns={[\\"phase\\", \\"Executed by\\", \\"When it runs\\", \\"Typical usage\\"]} rows={[ [\\"PIPELINE_RULES\\", \\"RulesStep\\", \\"Normal pipeline pass after schema/auto-advance\\", \\"Business transitions, context actions, SET_TASK in standard flow\\"], [\\"AGENT_POST_INTENT\\", \\"AgentIntentResolver post-intent pass\\", \\"Immediately after agent accepts intent\\", \\"Bootstrap state from UNKNOWN/IDLE based on resolved intent\\"], ]} /> ### ce_rule.state_code execution semantics Use state_code to reduce unnecessary rule evaluations: <DbTable title=\\"Rule State Scope Matrix\\" columns={[\\"state_code value\\", \\"Runtime behavior\\"]} rows={[ [\\"NULL\\", \\"Rule is eligible in all states\\"], [\\"ANY\\", \\"Rule is eligible in all states\\"], [\\"Specific state (for example COLLECT_INPUTS)\\", \\"Rule is eligible only when session.state matches (case-insensitive)\\"], ]} /> <CodeBlockToggle title=\\"Phase-targeted bootstrap example\\" language=\\"sql\\"> { INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'AGENT_POST_INTENT\', \'MAPPING_STUDIO\', \'ANY\', \'JSON_PATH\', \'$[?(@.intent == \'\'MAPPING_STUDIO\'\' && (@.state == \'\'UNKNOWN\'\' || @.state == \'\'IDLE\'\'))]\', \'SET_STATE\', \'COLLECT_INPUTS\', 5, true, \'Bootstrap Mapping Studio state right after agent intent resolution\'); } </CodeBlockToggle> <Highlight type=\\"info\\" title=\\"Runtime metadata exposed during rule execution\\"> EngineSession/inputParams include phase metadata: - postIntentRule / post_intent_rule - rule_phase - rule_execution_source - rule_execution_origin </Highlight> ## Prompt variable guidance Common variables used in templates: - {{user_input}} - {{context}} - {{session}} - {{schema}} - {{conversation_history}} - schema helpers: {{missing_fields}} , {{missing_field_options}} , {{schema_description}} <Highlight type=\\"warning\\" title=\\"Prompt variable exposure\\"> Prompt template extra now includes all keys present in inputParams , including runtime/system-derived keys written through session.putInputParam(...) . Keep key naming and values controlled in consumer task/rule code. </Highlight> ## Runtime transport/audit properties <CodeBlockToggle title=\\"application.yml (feature toggles)\\" language=\\"yaml\\"> { convengine: transport: stomp: enabled: true broker: mode: SIMPLE # SIMPLE | RELAY relay-destination-prefixes: /topic,/queue relay-host: localhost relay-port: 61613 client-login: \\"\\" client-passcode: \\"\\" system-login: \\"\\" system-passcode: \\"\\" virtual-host: \\"\\" system-heartbeat-send-interval-ms: 10000 system-heartbeat-receive-interval-ms: 10000 audit: enabled: true level: ALL # ALL | STANDARD | ERROR_ONLY | NONE include-stages: [] exclude-stages: [] persistence: mode: IMMEDIATE # IMMEDIATE | DEFERRED_BULK jdbc-batch-size: 200 max-buffered-events: 5000 flush-stages: ENGINE_KNOWN_FAILURE,ENGINE_UNKNOWN_FAILURE final-step-names: PipelineEndGuardStep flush-on-stop-outcome: true dispatch: async-enabled: false worker-threads: 2 queue-capacity: 2000 rejection-policy: CALLER_RUNS # CALLER_RUNS | DROP_NEWEST | DROP_OLDEST | ABORT keep-alive-seconds: 60 rate-limit: enabled: false max-events: 200 window-ms: 1000 per-conversation: true per-stage: true max-tracked-buckets: 20000 } </CodeBlockToggle> <CodeBlockToggle title=\\"Optional annotations\\" language=\\"java\\"> { @EnableConvEngine(stream = true) @EnableConvEngineAsyncAuditDispatch @EnableConvEngineStompBrokerRelay @SpringBootApplication public class MyApplication { public static void main(String[] args) { SpringApplication.run(MyApplication.class, args); } } } </CodeBlockToggle> ## New 1.0.8+ runtime controls explained 1. Async audit dispatch: - Moves transport fan-out off request thread when enabled. - Configure with convengine.audit.dispatch.* or @EnableConvEngineAsyncAuditDispatch . 2. Backpressure policy: - Queue capacity + rejection policy control behavior under burst. - CALLER_RUNS is safest default; DROP_* favors latency; ABORT is strict. 3. Stage-level audit controls: - level , include-stages , exclude-stages , and rate-limit reduce noisy audit traffic. 4. Deferred bulk persistence: - convengine.audit.persistence.mode=DEFERRED_BULK buffers events and writes batch inserts. - Flushes on terminal step/error (configurable), plus request-end safety flush. 5. STOMP broker mode: - SIMPLE (default): in-memory broker. - RELAY : external STOMP broker (RabbitMQ/other relay supporting STOMP). ## RabbitMQ relay example <CodeBlockToggle title=\\"application-rabbitmq-relay.yml\\" language=\\"yaml\\"> { convengine: transport: stomp: enabled: true endpoint: /ws-convengine app-destination-prefix: /app topic-prefix: /topic audit-destination-base: /topic/convengine/audit broker: mode: RELAY relay-destination-prefixes: /topic,/queue relay-host: localhost relay-port: 61613 client-login: guest client-passcode: guest system-login: guest system-passcode: guest virtual-host: / system-heartbeat-send-interval-ms: 10000 system-heartbeat-receive-interval-ms: 10000 } </CodeBlockToggle> ## Redis example (via STOMP gateway/bridge) <Highlight type=\\"warning\\" title=\\"Redis note\\"> ConvEngine STOMP relay requires a STOMP-compatible broker endpoint. Redis alone is not a native STOMP broker; use a STOMP gateway/bridge in front of Redis. </Highlight> <CodeBlockToggle title=\\"application-redis-bridge-relay.yml\\" language=\\"yaml\\"> { convengine: transport: stomp: enabled: true broker: mode: RELAY relay-destination-prefixes: /topic,/queue relay-host: redis-stomp-bridge.local relay-port: 61613 client-login: \\"\\" client-passcode: \\"\\" system-login: \\"\\" system-passcode: \\"\\" virtual-host: \\"\\" } </CodeBlockToggle>","excerpt":"Configuration Deep Guide Table mapping in application.yml (ConvEngine + CCF Core) Use this when your physical table names differ from defaults. ConvEngine reads convengine.tables. ; CCF Core reads ccf.core.tables. . If y\u2026"},{"id":"consumer/extensions.mdx","version":"v1","title":"extensions","permalink":"/docs/v1/consumer/extensions","content":"Extension Points and Intervention Scenarios EngineStepHook intervene between any steps Real scenario: For LOG_ANALYSIS , inject additional retrieval hint before schema extraction. @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) } } :::tip Where to use this Use hooks when you need low friction runtime intervention without forking framework steps. ::: ContainerDataTransformer reshape container response Real scenario: CCF returns nested payload; you flatten to schema friendly map. } } ResponseTransformer post process final payload Real scenario: Add support team escalation footer for high severity disconnect failures. return responsePayload; } } } ContainerDataInterceptor intercept request/response around CCF Real scenario: add tenant metadata and redact a field before persistence. Rule Action Playbook ( SET_TASK , SET_JSON , GET_CONTEXT , GET_SESSION ) These actions execute inside RulesStep.execute(...) and mutate the live EngineSession . Set ce_rule.phase based on where you want the action to run: PIPELINE_RULES : normal RulesStep pass. AGENT_POST_INTENT : post intent pass inside AgentIntentResolver . SET_TASK execute consumer Java methods from rule Use this when a rule match must trigger consumer side business logic (incident raise, tracker lookup, eligibility fetch, etc). Set ce_rule.action to SET_TASK and provide bean/method mapping in action_value . Bean must be a Spring bean with the configured bean name and implement CeRuleTask . Methods are invoked with (EngineSession session, CeRule rule) . public void attachEta(EngineSession session, CeRule rule) } } Downstream prompt/response can read new context/inputParams (for example requestStatus , lastUpdated , eta_hours ). SET_JSON move JSONPath value into input params Use this to extract one value from runtime session JSON into a flat prompt var. SET_JSON writes to session.putInputParam(\\"error_code\\", value) . It does not change session.contextJson unless your subsequent task/hook updates context explicitly. GET_CONTEXT snapshot context into input params Use this when prompt templates or tasks need full context as a single variable. If action_value is blank, engine uses default key context . GET_SESSION snapshot session facts into input params Use this for advanced derived responses that need runtime flags ( schemaComplete , intentLocked , missingRequiredFields , etc). If action_value is blank, engine uses default key session . SET_TASK methods run during rule execution. Keep methods deterministic and idempotent. For side effecting calls (ticket creation, webhook dispatch), guard with strict rule conditions and add idempotency keys from conversationId . Resolvers engine/rule/type/provider/SetTaskActionResolver.java engine/rule/type/provider/SetJsonActionResolver.java engine/rule/type/provider/GetContextActionResolver.java engine/rule/type/provider/GetSessionActionResolver.java Task invocation engine/rule/task/CeRuleTaskExecutor.java Execution loop engine/steps/RulesStep.java Custom action resolver ( RuleActionResolver ) Consumer can define a brand new rule action without changing framework core. Implement RuleActionResolver and return your action name from action() . @Override public void resolve(EngineSession session, CeRule rule) } } Set ce_rule.action to your custom token (case insensitive lookup), for example ENRICH_TIER . No manual factory config is needed. RuleActionResolverFactory auto registration behavior auto discovers all Spring beans implementing RuleActionResolver and maps by action().toUpperCase() .","rawContent":"# Extension Points and Intervention Scenarios <div className=\\"ce-extensions-page\\"> ## EngineStepHook - intervene between any steps {#1-enginestephook---intervene-between-any-steps} Real scenario: For LOG_ANALYSIS , inject additional retrieval hint before schema extraction. <CodeBlockToggle title=\\"EngineStepHook example\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.hooks\\"> { @Component public class LogAnalysisHintHook implements EngineStepHook { @Override public boolean supports(EngineStep.Name stepName, EngineSession session) { return EngineStep.Name.SchemaExtractionStep == stepName && \\"LOG_ANALYSIS\\".equalsIgnoreCase(session.getIntent()); } @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) { session.putInputParam(\\"log_source_priority\\", \\"APM_FIRST\\"); } } } </CodeBlockToggle> :::tip Where to use this Use hooks when you need low-friction runtime intervention without forking framework steps. ::: ## ContainerDataTransformer - reshape container response {#2-containerdatatransformer---reshape-container-response} Real scenario: CCF returns nested payload; you flatten to schema-friendly map. <CodeBlockToggle title=\\"ContainerDataTransformer example\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.transformers\\"> { @Component @ContainerDataTransformer(intent = \\"REQUEST_TRACKER\\", state = \\"IDLE\\") public class RequestTrackerContainerTransformer implements ContainerDataTransformerHandler { @Override public Map<String, Object> transform(ContainerComponentResponse response, EngineSession session, Map<String, Object> inputParams) { Map<String, Object> out = new LinkedHashMap<>(); out.put(\\"ticket_id\\", inputParams.get(\\"ticketId\\")); out.put(\\"status\\", \\"IN_REVIEW\\"); return out; } } } </CodeBlockToggle> ## ResponseTransformer - post-process final payload {#3-responsetransformer---post-process-final-payload} Real scenario: Add support-team escalation footer for high-severity disconnect failures. <CodeBlockToggle title=\\"ResponseTransformer example\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.transformers\\"> { @Component @ResponseTransformer(intent = \\"DISCONNECT_ELECTRICITY\\", state = \\"FAILED\\") public class DisconnectFailureResponseTransformer implements ResponseTransformerHandler { @Override public OutputPayload transform(OutputPayload responsePayload, EngineSession session, Map<String, Object> inputParams) { if (responsePayload instanceof TextPayload(String text)) { return new TextPayload(text + \\"\\\\\\\\nIf this is urgent, call support at +1-800-000-0000.\\"); } return responsePayload; } } } </CodeBlockToggle> ## ContainerDataInterceptor - intercept request/response around CCF {#4-containerdatainterceptor---intercept-requestresponse-around-ccf} Real scenario: add tenant metadata and redact a field before persistence. <CodeBlockToggle title=\\"Interceptor scenario (concept)\\" language=\\"text\\"> { Before Execute: - inject tenantId/requestId - attach observability headers After Execute: - redact sensitive node from raw container payload - enrich session input params for downstream rule checks } </CodeBlockToggle> ## Rule Action Playbook ( SET_TASK , SET_JSON , GET_CONTEXT , GET_SESSION ) {#5-rule-action-playbook-set_task-set_json-get_context-get_session} These actions execute inside <MethodRef>RulesStep.execute(...)</MethodRef> and mutate the live <MethodRef>EngineSession</MethodRef>. Set <MethodRef>ce_rule.phase</MethodRef> based on where you want the action to run: - <MethodRef>PIPELINE_RULES</MethodRef>: normal <MethodRef>RulesStep</MethodRef> pass. - <MethodRef>AGENT_POST_INTENT</MethodRef>: post-intent pass inside <MethodRef>AgentIntentResolver</MethodRef>. <DbTable title=\\"Action value format (exact runtime behavior)\\" columns={[\\"Action\\", \\"action_value format\\", \\"Engine behavior\\"]} rows={[ [\\"SET_TASK\\", \\"beanName:methodName or beanName:methodA,methodB\\", \\"Invokes Spring bean methods via CeRuleTaskExecutor\\"], [\\"SET_JSON\\", \\"targetKey:jsonPath\\", \\"Extracts JSONPath from session eject and stores into inputParams[targetKey]\\"], [\\"GET_CONTEXT\\", \\"targetKey (optional)\\", \\"Stores session.contextDict() into inputParams[targetKey] (default key=context)\\"], [\\"GET_SESSION\\", \\"targetKey (optional)\\", \\"Stores session.sessionDict() into inputParams[targetKey] (default key=session)\\"], ]} /> ### SET_TASK - execute consumer Java methods from rule {#51-set_task---execute-consumer-java-methods-from-rule} Use this when a rule match must trigger consumer-side business logic (incident raise, tracker lookup, eligibility fetch, etc). <FlowStep step=\\"1\\" title=\\"Create ce_rule row\\"> Set <MethodRef>ce_rule.action</MethodRef> to <MethodRef>SET_TASK</MethodRef> and provide bean/method mapping in <MethodRef>action_value</MethodRef>. </FlowStep> <CodeBlockToggle title=\\"SET_TASK rule example (SQL)\\" language=\\"sql\\"> { INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'PIPELINE_RULES\', \'REQUEST_TRACKER\', \'ANY\', \'REGEX\', \'(?i).*track.*request.*\', \'SET_TASK\', \'requestTrackerTask:loadStatus,attachEta\', 10, true, \'Load tracker status + ETA from consumer service\'); } </CodeBlockToggle> <FlowStep step=\\"2\\" title=\\"Implement task bean\\"> Bean must be a Spring bean with the configured bean name and implement <MethodRef>CeRuleTask</MethodRef>. Methods are invoked with <MethodRef>(EngineSession session, CeRule rule)</MethodRef>. </FlowStep> <CodeBlockToggle title=\\"Consumer task bean (Java)\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.tasks\\" filePath=\\"src/main/java/com/acme/convengine/tasks/RequestTrackerTask.java\\" > { @Component(\\"requestTrackerTask\\") public class RequestTrackerTask implements CeRuleTask { public void loadStatus(EngineSession session, CeRule rule) { String requestId = String.valueOf(session.getInputParams().getOrDefault(\\"requestId\\", \\"\\")); // fetch from your DB/service session.putInputParam(\\"requestStatus\\", \\"APPROVAL_PENDING\\"); session.putInputParam(\\"lastUpdated\\", \\"2026-02-10T11:40:00Z\\"); } public void attachEta(EngineSession session, CeRule rule) { session.putInputParam(\\"eta_hours\\", 12); } } } </CodeBlockToggle> <FlowStep step=\\"3\\" title=\\"Use in response generation\\"> Downstream prompt/response can read new context/inputParams (for example requestStatus , lastUpdated , eta_hours ). </FlowStep> ### SET_JSON - move JSONPath value into input params {#52-set_json---move-jsonpath-value-into-input-params} Use this to extract one value from runtime session JSON into a flat prompt var. <CodeBlockToggle title=\\"SET_JSON rule example (SQL)\\" language=\\"sql\\"> { INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'PIPELINE_RULES\', \'LOG_ANALYSIS\', \'ANY\', \'JSON_PATH\', \'$.schemaJson.errorCode != null\', \'SET_JSON\', \'error_code:$.schemaJson.errorCode\', 20, true, \'Expose extracted errorCode as prompt var\'); } </CodeBlockToggle> <Highlight type=\\"info\\" title=\\"What exactly gets updated\\"> SET_JSON writes to <MethodRef>session.putInputParam(\\"error_code\\", value)</MethodRef>. It does not change session.contextJson unless your subsequent task/hook updates context explicitly. </Highlight> ### GET_CONTEXT - snapshot context into input params {#53-get_context---snapshot-context-into-input-params} Use this when prompt templates or tasks need full context as a single variable. <CodeBlockToggle title=\\"GET_CONTEXT rule example (SQL)\\" language=\\"sql\\"> { INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'PIPELINE_RULES\', \'REQUEST_TRACKER\', \'ANY\', \'REGEX\', \'(?i).*status.*\', \'GET_CONTEXT\', \'ctx_snapshot\', 30, true, \'Expose full context to prompt/task layer\'); } </CodeBlockToggle> If action_value is blank, engine uses default key context . ### GET_SESSION - snapshot session facts into input params {#54-get_session---snapshot-session-facts-into-input-params} Use this for advanced derived responses that need runtime flags ( schemaComplete , intentLocked , missingRequiredFields , etc). <CodeBlockToggle title=\\"GET_SESSION rule example (SQL)\\" language=\\"sql\\"> { INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'PIPELINE_RULES\', \'DISCONNECT_ELECTRICITY\', \'ANY\', \'JSON_PATH\', \'$.schemaComplete == false\', \'GET_SESSION\', \'session_snapshot\', 40, true, \'Expose full runtime session facts for follow-up prompt decisions\'); } </CodeBlockToggle> If action_value is blank, engine uses default key session . <Highlight type=\\"warning\\" title=\\"Operational guardrails\\"> SET_TASK methods run during rule execution. Keep methods deterministic and idempotent. For side-effecting calls (ticket creation, webhook dispatch), guard with strict rule conditions and add idempotency keys from <MethodRef>conversationId</MethodRef>. </Highlight> <Highlight type=\\"tip\\" title=\\"Where to trace this in code\\"> <div className=\\"ce-chip-groups\\"> <div className=\\"ce-chip-group\\"> <span className=\\"ce-chip-group-label\\">Resolvers</span> <div className=\\"ce-chip-list\\"> <span className=\\"ce-chip-item\\"><FileRef>engine/rule/type/provider/SetTaskActionResolver.java</FileRef></span> <span className=\\"ce-chip-item\\"><FileRef>engine/rule/type/provider/SetJsonActionResolver.java</FileRef></span> <span className=\\"ce-chip-item\\"><FileRef>engine/rule/type/provider/GetContextActionResolver.java</FileRef></span> <span className=\\"ce-chip-item\\"><FileRef>engine/rule/type/provider/GetSessionActionResolver.java</FileRef></span> </div> </div> <div className=\\"ce-chip-group\\"> <span className=\\"ce-chip-group-label\\">Task invocation</span> <div className=\\"ce-chip-list\\"> <span className=\\"ce-chip-item\\"><FileRef>engine/rule/task/CeRuleTaskExecutor.java</FileRef></span> </div> </div> <div className=\\"ce-chip-group\\"> <span className=\\"ce-chip-group-label\\">Execution loop</span> <div className=\\"ce-chip-list\\"> <span className=\\"ce-chip-item\\"><FileRef>engine/steps/RulesStep.java</FileRef></span> </div> </div> </div> </Highlight> ### Custom action resolver ( RuleActionResolver ) {#55-custom-action-resolver-ruleactionresolver} Consumer can define a brand-new rule action without changing framework core. <FlowStep step=\\"1\\" title=\\"Create custom resolver bean\\"> Implement <MethodRef>RuleActionResolver</MethodRef> and return your action name from <MethodRef>action()</MethodRef>. </FlowStep> <CodeBlockToggle title=\\"Custom RuleActionResolver example\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.rules\\" filePath=\\"src/main/java/com/acme/convengine/rules/EnrichCustomerTierActionResolver.java\\" > { @Component public class EnrichCustomerTierActionResolver implements RuleActionResolver { @Override public String action() { return \\"ENRICH_TIER\\"; } @Override public void resolve(EngineSession session, CeRule rule) { // action_value example: customerTier:PREMIUM String raw = rule.getActionValue() == null ? \\"\\" : rule.getActionValue(); String[] parts = raw.split(\\":\\", 2); String key = parts.length > 0 && !parts[0].isBlank() ? parts[0] : \\"customerTier\\"; String value = parts.length > 1 ? parts[1] : \\"STANDARD\\"; session.putInputParam(key, value); } } } </CodeBlockToggle> <FlowStep step=\\"2\\" title=\\"Use action in ce_rule\\"> Set <MethodRef>ce_rule.action</MethodRef> to your custom token (case-insensitive lookup), for example <MethodRef>ENRICH_TIER</MethodRef>. </FlowStep> <CodeBlockToggle title=\\"ce_rule row for custom action\\" language=\\"sql\\"> { INSERT INTO ce_rule (phase, intent_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'PIPELINE_RULES\', \'REQUEST_TRACKER\', \'REGEX\', \'(?i).*vip.*\', \'ENRICH_TIER\', \'customerTier:PREMIUM\', 5, true, \'Mark VIP tier for downstream response logic\'); } </CodeBlockToggle> <Highlight type=\\"tip\\" title=\\"Auto-registration behavior\\"> No manual factory config is needed. <DocTermPopup term=\\"Auto-registration behavior\\">RuleActionResolverFactory auto-registration behavior</DocTermPopup> auto-discovers all Spring beans implementing <MethodRef>RuleActionResolver</MethodRef> and maps by <MethodRef>action().toUpperCase()</MethodRef>. </Highlight> </div>","excerpt":"Extension Points and Intervention Scenarios EngineStepHook intervene between any steps Real scenario: For LOG_ANALYSIS , inject additional retrieval hint before schema extraction. @Override public void beforeStep(EngineS\u2026"},{"id":"consumer/index.mdx","version":"v1","title":"index","permalink":"/docs/v1/consumer","content":"Consumer Guide ConvEngine consumer integration is about wiring three things correctly: framework bootstrapping ( @EnableConvEngine ) LLM adapter ( LlmClient ) DB driven behavior ( ce_ control plane rows) 10 Minute Starter Use @EnableConvEngine on your Spring Boot entry point. Register a concrete LlmClient bean for intent/schema/derived flows. Apply DDL and seed minimum rows in ce_intent , ce_intent_classifier , ce_response , ce_prompt_template . Run a real turn and validate with /api/v1/conversation/audit/ \'} and /api/v1/conversation/audit/ \'}/trace . Dependency Core Contracts } } } } }. Answer as FAQ in 1 2 lines.\', true ); } @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) } } } } Rollout Plan Treat ce_audit as mandatory observability. Promote behavior changes only after reviewing multi turn traces for each key intent.","rawContent":"# Consumer Guide ConvEngine consumer integration is about wiring three things correctly: - framework bootstrapping ( @EnableConvEngine ) - LLM adapter ( LlmClient ) - DB-driven behavior ( ce_* control-plane rows) ## 10-Minute Starter <FlowStep step=\\"1\\" title=\\"Enable framework\\"> Use <MethodRef>@EnableConvEngine</MethodRef> on your Spring Boot entry point. </FlowStep> <FlowStep step=\\"2\\" title=\\"Provide LlmClient\\"> Register a concrete <MethodRef>LlmClient</MethodRef> bean for intent/schema/derived flows. </FlowStep> <FlowStep step=\\"3\\" title=\\"Apply ce_* schema\\"> Apply DDL and seed minimum rows in <FileRef>ce_intent</FileRef>, <FileRef>ce_intent_classifier</FileRef>, <FileRef>ce_response</FileRef>, <FileRef>ce_prompt_template</FileRef>. </FlowStep> <FlowStep step=\\"4\\" title=\\"Validate with audit trace\\"> Run a real turn and validate with <FileRef>/api/v1/conversation/audit/{\'{conversationId}\'}</FileRef> and <FileRef>/api/v1/conversation/audit/{\'{conversationId}\'}/trace</FileRef>. </FlowStep> ## Dependency <Tabs groupId=\\"consumer-dependency\\"> <TabItem value=\\"maven\\" label=\\"Maven\\" default> <CodeBlockToggle title=\\"pom.xml dependency\\" language=\\"xml\\" packagePath=\\"project build\\"> { <dependency> <groupId>com.github.salilvnair</groupId> <artifactId>convengine</artifactId> <version>1.0.15</version> </dependency> } </CodeBlockToggle> </TabItem> <TabItem value=\\"gradle\\" label=\\"Gradle\\"> <CodeBlockToggle title=\\"build.gradle.kts dependency\\" language=\\"kotlin\\" packagePath=\\"project build\\"> { implementation(\\"com.github.salilvnair:convengine:1.0.15\\") } </CodeBlockToggle> </TabItem> </Tabs> ## Core Contracts <DbTable title=\\"Consumer-side contracts\\" columns={[\\"Contract\\", \\"Why it matters\\", \\"Where it plugs in\\"]} rows={[ [\\"@EnableConvEngine\\", \\"Bootstraps engine + pipeline + transport wiring\\", \\"Spring Boot application class\\"], [\\"LlmClient\\", \\"Provides text/json generation backend\\", \\"Consumer config bean\\"], [\\"ce_* tables\\", \\"Defines behavior as data, not hardcoded Java\\", \\"Consumer database\\"], [\\"EngineStepHook\\", \\"Allows pre/post step intervention\\", \\"Consumer extension bean\\"], [\\"ResponseTransformer\\", \\"Last-mile payload normalization\\", \\"Consumer extension bean\\"], ]} /> <Tabs groupId=\\"consumer-setup\\"> <TabItem value=\\"boot\\" label=\\"Bootstrapping\\" default> <CodeBlockToggle title=\\"Spring Boot entry point\\" language=\\"java\\" packagePath=\\"com.zapper.demo\\" filePath=\\"src/main/java/com/acme/demo/DemoApplication.java\\"> { @SpringBootApplication @EnableConvEngine(stream = true) public class DemoApplication { public static void main(String[] args) { SpringApplication.run(DemoApplication.class, args); } } } </CodeBlockToggle> <CodeBlockToggle title=\\"LlmClient bean\\" language=\\"java\\" packagePath=\\"com.zapper.demo.config\\" filePath=\\"src/main/java/com/acme/demo/config/LlmConfig.java\\"> { @Configuration public class LlmConfig { @Bean public LlmClient llmClient(OpenAiClient openAiClient) { return new OpenAiLlmClient(openAiClient); } } } </CodeBlockToggle> </TabItem> <TabItem value=\\"seed\\" label=\\"Minimum Seed SQL\\"> <CodeBlockToggle title=\\"Minimum FAQ seed (consumer DB)\\" language=\\"sql\\"> { insert into ce_intent(intent_code, enabled) values (\'FAQ\', true); insert into ce_intent_classifier(intent_code, match_pattern, priority, enabled) values (\'FAQ\', \'(?i).*(office|location|address).*\', 10, true); insert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled) values (\'FAQ\', null, \'EXACT\', \'TEXT\', \'Yes. You can request relocation from the support portal.\', true); insert into ce_prompt_template(intent_code, state_code, response_type, system_prompt, user_prompt, enabled) values ( \'FAQ\', null, \'TEXT\', \'You are a support assistant. Keep answers concise and clear.\', \'User asked: {{user_input}}. Answer as FAQ in 1-2 lines.\', true ); } </CodeBlockToggle> </TabItem> <TabItem value=\\"intervene\\" label=\\"Intervention Points\\"> <CodeBlockToggle title=\\"EngineStepHook (typed step matching)\\" language=\\"java\\" packagePath=\\"com.zapper.demo.hooks\\" filePath=\\"src/main/java/com/acme/demo/hooks/SchemaHintHook.java\\"> { @Component public class SchemaHintHook implements EngineStepHook { @Override public boolean supports(EngineStep.Name stepName, EngineSession session) { return EngineStep.Name.SchemaExtractionStep == stepName && \\"DISCONNECT_ELECTRICITY\\".equalsIgnoreCase(session.getIntent()); } @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) { session.putInputParam(\\"consumer_hint\\", \\"compact\\"); } } } </CodeBlockToggle> <CodeBlockToggle title=\\"ResponseTransformer (last-mile output shaping)\\" language=\\"java\\" packagePath=\\"com.zapper.demo.transform\\" filePath=\\"src/main/java/com/acme/demo/transform/ApiResponseTransformer.java\\"> { @Component public class ApiResponseTransformer implements ResponseTransformer { @Override public EngineResult transform(EngineResult result, EngineSession session) { // Example: add consumer-side envelope metadata return result.withMeta(Map.of(\\"conversationId\\", session.getConversationId())); } } } </CodeBlockToggle> </TabItem> </Tabs> ## Rollout Plan <DbTable title=\\"Recommended rollout path\\" columns={[\\"Phase\\", \\"Scope\\", \\"Exit criteria\\"]} rows={[ [\\"Phase A\\", \\"EXACT responses + deterministic rules\\", \\"No unresolved intent collisions in audit\\"], [\\"Phase B\\", \\"Schema extraction + clarification flow\\", \\"Missing-field loop converges in <= 2 turns\\"], [\\"Phase C\\", \\"MCP + DERIVED output\\", \\"Stable tool-call traces and bounded token usage\\"], ]} /> <Highlight type=\\"warning\\" title=\\"Do not skip audit validation\\"> Treat <FileRef>ce_audit</FileRef> as mandatory observability. Promote behavior changes only after reviewing multi-turn traces for each key intent. </Highlight>","excerpt":"Consumer Guide ConvEngine consumer integration is about wiring three things correctly: framework bootstrapping ( @EnableConvEngine ) LLM adapter ( LlmClient ) DB driven behavior ( ce_ control plane rows) 10 Minute Starte\u2026"},{"id":"consumer/new-consumer-onboarding.mdx","version":"v1","title":"new consumer onboarding","permalink":"/docs/v1/consumer/new-consumer-onboarding","content":"New Consumer Onboarding This is the practical playbook for teams integrating ConvEngine for the first time. Follow this sequence to avoid the common mistakes: wrong data routing, stale intent carry over, unsafe prompt exposure, and concurrency drift. What a new consumer must decide first Step by step onboarding Enable @EnableConvEngine , provide one production grade LlmClient bean with strict timeout and retry policy. Seed minimum rows for intents, classifiers, responses, prompt templates, and required ce_config flags. Apply conservative defaults for reset behavior, sticky intent, rule phases, MCP safety, and prompt variable exposure. Validate multi turn transitions, reset continuity, missing field loops, and same conversation concurrency behavior. Move from non prod to prod only after all correctness/security/scalability gates pass. Minimum integration checklist Apply src/main/resources/sql/ddl_postgres.sql (legacy: src/main/resources/sql/ddl.sql ). Apply src/main/resources/sql/ddl_oracle.sql . Apply src/main/resources/sql/ddl_sqlite.sql . Recommended baseline config (new consumers) Do not begin with broad MCP usage, many DERIVED intents, and aggressive rule chains together. Start deterministic, then expand one capability at a time. Correctness focused test pack (required) Production readiness gates New intent rollout template (repeatable) 1. Add ce_intent and classifiers for the new intent. 2. Add response mapping ( EXACT first). 3. Add schema + prompt template only if extraction is needed. 4. Add minimal rules with explicit phase and priority. 5. Run scenario tests for this intent (normal, reset, switch, collision, concurrent). 6. Promote with rollback snapshot. Common new consumer mistakes After this page, continue with for table level setup, for all annotation usage, and for implementation roadmap.","rawContent":"# New Consumer Onboarding This is the practical playbook for teams integrating ConvEngine for the first time. Follow this sequence to avoid the common mistakes: wrong data routing, stale intent carry-over, unsafe prompt exposure, and concurrency drift. ## What a new consumer must decide first <DbTable title=\\"Day-0 decisions\\" columns={[\\"Decision\\", \\"Why it matters\\", \\"Recommended default\\"]} rows={[ [\\"Transport\\", \\"Determines runtime event delivery and operational complexity.\\", \\"Start with SSE only; enable STOMP relay later.\\"], [\\"Intent continuity\\", \\"Controls whether intent re-resolves each turn.\\", \\"Start with STICKY_INTENT=true , but add explicit switch UX.\\"], [\\"Response mode\\", \\"Defines determinism vs model flexibility.\\", \\"Start with EXACT for critical intents; add DERIVED gradually.\\"], [\\"Concurrency policy\\", \\"Prevents same-conversation race corruption.\\", \\"Serialize by conversationId at API layer from day one.\\"], [\\"Prompt exposure policy\\", \\"Controls data leakage and prompt contamination risk.\\", \\"Use allowlist of prompt vars; do not expose raw input maps.\\"], ]} /> ## Step-by-step onboarding <FlowStep step=\\"1\\" title=\\"Bootstrap framework and LLM adapter\\"> Enable <MethodRef>@EnableConvEngine</MethodRef>, provide one production-grade <MethodRef>LlmClient</MethodRef> bean with strict timeout and retry policy. </FlowStep> <FlowStep step=\\"2\\" title=\\"Create baseline control-plane data\\"> Seed minimum rows for intents, classifiers, responses, prompt templates, and required ce_config flags. </FlowStep> <FlowStep step=\\"3\\" title=\\"Lock down safety defaults\\"> Apply conservative defaults for reset behavior, sticky-intent, rule phases, MCP safety, and prompt-variable exposure. </FlowStep> <FlowStep step=\\"4\\" title=\\"Run correctness tests before UI rollout\\"> Validate multi-turn transitions, reset continuity, missing-field loops, and same-conversation concurrency behavior. </FlowStep> <FlowStep step=\\"5\\" title=\\"Promote with release gates\\"> Move from non-prod to prod only after all correctness/security/scalability gates pass. </FlowStep> ## Minimum integration checklist <DbTable title=\\"Must-have implementation tasks\\" columns={[\\"Area\\", \\"Task\\", \\"Done when\\"]} rows={[ [\\"Spring wiring\\", \\"Enable ConvEngine + define LlmClient bean.\\", \\" /message works and returns payload for seeded FAQ intent.\\"], [\\"Schema\\", \\"Apply DDL and create indexes from ConvEngine schema.\\", \\"All ce_* tables present and writable.\\"], [\\"Seed data\\", \\"Insert minimal rows for one end-to-end intent.\\", \\"One deterministic turn passes with expected intent/state.\\"], [\\"Audit usage\\", \\"Wire audit API/stream into debugging workflow.\\", \\"Every test case is verified against trace timeline.\\"], [\\"Concurrency guard\\", \\"Prevent parallel writes for same conversation.\\", \\"Load test shows no state drift under concurrent same-ID requests.\\"], [\\"Prompt hygiene\\", \\"Allowlist exposed template vars.\\", \\"No sensitive/internal keys appear in rendered prompts.\\"], ]} /> <Tabs groupId=\\"consumer-ddl-dialect\\"> <TabItem value=\\"postgres\\" label=\\"Postgres\\" default> Apply <FileRef>src/main/resources/sql/ddl_postgres.sql</FileRef> (legacy: <FileRef>src/main/resources/sql/ddl.sql</FileRef>). </TabItem> <TabItem value=\\"oracle\\" label=\\"Oracle\\"> Apply <FileRef>src/main/resources/sql/ddl_oracle.sql</FileRef>. </TabItem> <TabItem value=\\"sqlite\\" label=\\"SQLite\\"> Apply <FileRef>src/main/resources/sql/ddl_sqlite.sql</FileRef>. </TabItem> </Tabs> ## Recommended baseline config (new consumers) <CodeBlockToggle title=\\"Safe starter config (ConvEngine + CCF mappings)\\" language=\\"yaml\\"> { ccf: core: # CCF Core dynamic table mapping tables: PAGE_COMMON_QUERY: ZP_PAGE_COMMON_QUERY SECTION_INFO: ZP_SECTION_INFO CONTAINER_INFO: ZP_CONTAINER_INFO CONTAINER_FIELD_INFO: ZP_CONTAINER_FIELD_INFO CONTAINER_QUERY_INFO: ZP_CONTAINER_QUERY_INFO convengine: transport: sse: enabled: true stomp: enabled: false audit: enabled: true level: STANDARD dispatch: async-enabled: false # ConvEngine dynamic table mapping tables: AUDIT: CE_AUDIT CONTAINER_CONFIG: CE_CONTAINER_CONFIG CONVERSATION: CE_CONVERSATION INTENT: CE_INTENT INTENT_CLASSIFIER: CE_INTENT_CLASSIFIER LLM_CALL_LOG: CE_LLM_CALL_LOG MCP_DB_TOOL: CE_MCP_DB_TOOL MCP_TOOL: CE_MCP_TOOL OUTPUT_SCHEMA: CE_OUTPUT_SCHEMA PROMPT_TEMPLATE: CE_PROMPT_TEMPLATE RESPONSE: CE_RESPONSE RULE: CE_RULE } </CodeBlockToggle> <CodeBlockToggle title=\\"Safe starter config (ce_config)\\" language=\\"yaml\\"> { INSERT INTO ce_config (config_id, config_type, config_key, config_value, enabled, created_at) VALUES(12, \'IntentResolutionStep\', \'STICKY_INTENT\', \'true\', true, \'2026-02-17 10:15:54.230\'); INSERT INTO ce_config (config_id, config_type, config_key, config_value, enabled, created_at) VALUES(1, \'AgentIntentResolver\', \'MIN_CONFIDENCE\', \'0.55\', true, \'2026-02-10 10:15:54.227\'); INSERT INTO ce_config (config_id, config_type, config_key, config_value, enabled, created_at) VALUES(2, \'AgentIntentResolver\', \'COLLISION_GAP_THRESHOLD\', \'0.2\', true, \'2026-02-10 10:15:54.230\'); } </CodeBlockToggle> <Highlight type=\\"warning\\" title=\\"Do not start with max flexibility\\"> Do not begin with broad MCP usage, many DERIVED intents, and aggressive rule chains together. Start deterministic, then expand one capability at a time. </Highlight> ## Correctness-focused test pack (required) <DbTable title=\\"Pre-production test scenarios\\" columns={[\\"Scenario\\", \\"What to verify\\", \\"Failure signal\\"]} rows={[ [\\"Sticky intent shift\\", \\"New-topic user input triggers expected re-resolution/switch behavior.\\", \\"Repeated wrong-intent responses with skip stages.\\"], [\\"Reset semantics\\", \\"All reset paths clear context/intent/state consistently.\\", \\"Old fields survive after reset turn.\\"], [\\"Rule collisions\\", \\"Only intended rule wins for same turn.\\", \\"Unexpected multi-pass intent/state mutation.\\"], [\\"Schema loop\\", \\"Missing fields converge in bounded turns.\\", \\"Infinite clarification or inconsistent required field set.\\"], [\\"Concurrent same ID\\", \\"No last-write-wins drift under parallel requests.\\", \\"Contradictory final state for same conversation timeline.\\"], [\\"Model bad JSON\\", \\"Invalid model output fails safely and deterministically.\\", \\"Silent state corruption or unbounded fallback noise.\\"], ]} /> ## Production readiness gates <DbTable title=\\"Go-live gates\\" columns={[\\"Gate\\", \\"Requirement\\"]} rows={[ [\\"Data correctness\\", \\"Illegal intent/state transitions are blocked or quarantined.\\"], [\\"Security\\", \\"Prompt var allowlist and secret redaction enabled.\\"], [\\"Concurrency\\", \\"Same-conversation serialization or optimistic locking in place.\\"], [\\"Observability\\", \\"Team can reconstruct one bad turn end-to-end from trace.\\"], [\\"Scalability\\", \\"P95 stable under target QPS with production-like config volume.\\"], [\\"Rollback\\", \\"Config rollback procedure tested for bad rule/prompt deployment.\\"], ]} /> ## New intent rollout template (repeatable) 1. Add ce_intent and classifiers for the new intent. 2. Add response mapping ( EXACT first). 3. Add schema + prompt template only if extraction is needed. 4. Add minimal rules with explicit phase and priority. 5. Run scenario tests for this intent (normal, reset, switch, collision, concurrent). 6. Promote with rollback snapshot. ## Common new-consumer mistakes <DbTable title=\\"Avoid these early mistakes\\" columns={[\\"Mistake\\", \\"Impact\\", \\"Fix\\"]} rows={[ [\\"Using DERIVED everywhere from day one\\", \\"Higher variance and harder debugging.\\", \\"Use EXACT for critical flows first.\\"], [\\"No conversation-level concurrency control\\", \\"State drift and non-deterministic results.\\", \\"Serialize by conversation ID or add optimistic locking.\\"], [\\"Treating prompt vars as free-form\\", \\"Data leakage and unintended model behavior.\\", \\"Explicit prompt-var allowlist and validation.\\"], [\\"Shipping config changes without tests\\", \\"Production regressions from rule/template misconfig.\\", \\"Introduce lint + fixture tests + staged promotion.\\"], [\\"Skipping trace review\\", \\"Root cause unclear when output is wrong.\\", \\"Make trace review mandatory in QA signoff.\\"], ]} /> <Highlight type=\\"info\\" title=\\"Where to read next\\"> After this page, continue with [Configuration](/docs/v1/consumer/configuration) for table-level setup, [Annotations Reference](/docs/v1/consumer/annotations-reference) for all annotation usage, and [Improvement Backlog](/docs/v1/deep-dive/improvement-backlog) for implementation roadmap. </Highlight>","excerpt":"New Consumer Onboarding This is the practical playbook for teams integrating ConvEngine for the first time. Follow this sequence to avoid the common mistakes: wrong data routing, stale intent carry over, unsafe prompt ex\u2026"},{"id":"consumer/session-reset-and-continuity.mdx","version":"v1","title":"session reset and continuity","permalink":"/docs/v1/consumer/session-reset-and-continuity","content":"Session, Reset, and Continuity What is restored per turn From ce_conversation , session restores: intent_code state_code context_json input_params_json From context branch values, session also restores cross turn values such as clarification and intent lock metadata. Intent lock lifecycle Intent lock is used for incomplete schema collection to avoid drift. lock set when required schema fields are still missing intent resolver skip logic respects lock lock removed when schema is complete or schema path is absent Sticky intent lifecycle ( ce_config ) IntentResolutionStep.STICKY_INTENT applies during active incomplete schema collection to keep intent stable while required fields are still missing. when enabled, IntentResolutionStep skips re resolution only while incomplete schema collection is active skip emits audit stage: INTENT_RESOLVE_SKIPPED_STICKY_INTENT re resolution runs once schema collection is complete, and still runs for explicit switch/reset/force signals Force re resolution signals: reset commands: reset , restart , /reset , /restart switch phrases: switch to ... , switch intent , change intent/flow/mode input params: force_intent_resolution=true , resolve_intent=true , switch_intent=true , switch_flow=true , switch_mode=true active clarification flow Reset triggers request body reset=true input params reset , restart , conversation_reset text commands reset , restart , /reset , /restart intent based reset via ResetResolvedIntentStep ( ce_config ) Practical advice Keep reset intent names explicit and reserved ( RESET_SESSION style) Avoid mixing business intents with reset intents Audit CONVERSATION_RESET stages in pre production tests If reset logic is custom coded only in controller, multi turn state may still leak from existing conversation context. Use pipeline reset steps, not ad hoc request branching.","rawContent":"# Session, Reset, and Continuity ## What is restored per turn From ce_conversation , session restores: - intent_code - state_code - context_json - input_params_json From context branch values, session also restores cross-turn values such as clarification and intent lock metadata. ## Intent lock lifecycle Intent lock is used for incomplete schema collection to avoid drift. - lock set when required schema fields are still missing - intent resolver skip logic respects lock - lock removed when schema is complete or schema path is absent ## Sticky intent lifecycle ( ce_config ) IntentResolutionStep.STICKY_INTENT applies during active incomplete schema collection to keep intent stable while required fields are still missing. - when enabled, IntentResolutionStep skips re-resolution only while incomplete schema collection is active - skip emits audit stage: INTENT_RESOLVE_SKIPPED_STICKY_INTENT - re-resolution runs once schema collection is complete, and still runs for explicit switch/reset/force signals <CodeBlockToggle title=\\"Sticky intent config\\" language=\\"sql\\"> { INSERT INTO ce_config (config_type, config_key, config_value, enabled) VALUES (\'IntentResolutionStep\', \'STICKY_INTENT\', \'true\', true); } </CodeBlockToggle> Force re-resolution signals: - reset commands: reset , restart , /reset , /restart - switch phrases: switch to ... , switch intent , change intent/flow/mode - input params: force_intent_resolution=true , resolve_intent=true , switch_intent=true , switch_flow=true , switch_mode=true - active clarification flow ## Reset triggers - request body reset=true - input params reset , restart , conversation_reset - text commands reset , restart , /reset , /restart - intent-based reset via ResetResolvedIntentStep ( ce_config ) <CodeBlockToggle title=\\"Reset intent config\\" language=\\"sql\\"> { INSERT INTO ce_config (config_type, config_key, config_value, enabled) VALUES (\'ResetResolvedIntentStep\', \'RESET_INTENT_CODES\', \'RESET_SESSION,START_OVER\', true); } </CodeBlockToggle> ## Practical advice - Keep reset intent names explicit and reserved ( RESET_SESSION style) - Avoid mixing business intents with reset intents - Audit CONVERSATION_RESET stages in pre-production tests <Highlight type=\\"warning\\" title=\\"Common failure mode\\"> If reset logic is custom-coded only in controller, multi-turn state may still leak from existing conversation context. Use pipeline reset steps, not ad-hoc request branching. </Highlight>","excerpt":"Session, Reset, and Continuity What is restored per turn From ce_conversation , session restores: intent_code state_code context_json input_params_json From context branch values, session also restores cross turn values \u2026"},{"id":"consumer/ui-integration.mdx","version":"v1","title":"ui integration","permalink":"/docs/v1/consumer/ui-integration","content":"UI Integration This page shows end to end UI wiring with: React (Vite) in JS + TS Angular (standalone) in TS SSE now + STOMP commented for later switch POST to /api/v1/conversation/message using conversationId and message . Use EventSource on /api/v1/conversation/stream/ \'} . On each stream event, refresh /audit/ \'} or trace endpoint. React Vite (JavaScript) , body: JSON.stringify( ), }); if (!res.ok) throw new Error(\\"Backend error: \\" + res.status); return res.json(); } const res = await fetch(API_BASE + \\"/audit/\\" + conversationId); if (!res.ok) throw new Error(\\"Backend error: \\" + res.status); return res.json(); } const source = new EventSource(API_BASE + \\"/stream/\\" + conversationId); source.onopen = () = handlers.onConnected?.(); source.onerror = (error) = handlers.onError?.(error); [\\"CONNECTED\\", \\"USER_INPUT\\", \\"STEP_ENTER\\", \\"STEP_EXIT\\", \\"STEP_ERROR\\", \\"ASSISTANT_OUTPUT\\", \\"ENGINE_RETURN\\"] .forEach((stage) = catch handlers.onEvent?.( ); }); }); return }; } // STOMP scaffold (optional) // npm install @stomp/stompjs sockjs client // import from \\"@stomp/stompjs\\"; // import SockJS from \\"sockjs client\\"; // export function subscribeConversationStomp(conversationId, handlers = ) // catch // }); // }, // onStompError: (frame) = handlers.onError?.(frame), // }); // client.activate(); // return }; // } } from \\"react\\"; const [conversationId] = useState(crypto.randomUUID()); const [auditVersion, setAuditVersion] = useState(0); useEffect(() = ); // STOMP alternate: // const stream = subscribeConversationStomp(conversationId, ); return () = stream.close(); }, [conversationId]); return conversationId= auditVersion= ; } } React Vite (TypeScript) onConnected?: () = void; onEvent?: (event: StreamEvent ) = void; onError?: (event: Event) = void; onClosed?: () = void; } conversationId: string, message: string, inputParams: Record = , reset = false ) , body: JSON.stringify( ), }); if (!res.ok) throw new Error(\\"Backend error: \\" + res.status); return res.json(); } conversationId: string, handlers: StreamHandlers = ) catch handlers.onEvent?.( ); }); }); return }; } } from \\"react\\"; const [conversationId] = useState (crypto.randomUUID()); const [auditVersion, setAuditVersion] = useState (0); useEffect(() = , }); return () = stream.close(); }, [conversationId]); return auditVersion= ; } } Angular Integration (authored sample) from \'@angular/core\'; stage: string; data: T | null; raw: MessageEvent; } @Injectable( ) private readonly apiBase = \'http://localhost:8080/api/v1/conversation\'; constructor(private readonly http: HttpClient) sendMessage(payload: ): Observable fetchAudits(conversationId: string): Observable subscribeConversationSse( conversationId: string, handlers: = ) catch handlers.onEvent?.( ); }); }); return }; } // STOMP scaffold (optional) // npm i @stomp/stompjs sockjs client // connect ws://localhost:8080/ws convengine // subscribe /topic/convengine/audit/ } } from \'@angular/core\'; @Component( ) conversationId = crypto.randomUUID(); message = \'\'; messages: Array = []; typing = false; private streamCloser: | null = null; constructor(private readonly api: ConvengineApiService) ngOnInit(): void }); } send(): void ); this.message = \'\'; this.typing = true; this.api.sendMessage( ).subscribe( ); this.typing = false; }, error: () = }); } ngOnDestroy(): void } } } Agent is typing... Send } Keep one shared backend contract for conversationId , payload.type , and audit stage names. Only transport/client wrappers should differ per framework.","rawContent":"# UI Integration This page shows end-to-end UI wiring with: - React (Vite) in JS + TS - Angular (standalone) in TS - SSE now + STOMP commented for later switch <FlowStep step=\\"1\\" title=\\"Call message API\\"> POST to <FileRef>/api/v1/conversation/message</FileRef> using <MethodRef>conversationId</MethodRef> and <MethodRef>message</MethodRef>. </FlowStep> <FlowStep step=\\"2\\" title=\\"Subscribe to stream\\"> Use <MethodRef>EventSource</MethodRef> on <FileRef>/api/v1/conversation/stream/{\'{conversationId}\'}</FileRef>. </FlowStep> <FlowStep step=\\"3\\" title=\\"Refresh timeline\\"> On each stream event, refresh <FileRef>/audit/{\'{conversationId}\'}</FileRef> or trace endpoint. </FlowStep> ## React Vite (JavaScript) <CodeBlockToggle title=\\"convengine.api.js\\" language=\\"js\\" packagePath=\\"src/api\\" filePath=\\"src/api/convengine.api.js\\" > { const API_BASE = \\"http://localhost:8080/api/v1/conversation\\"; const res = await fetch(API_BASE + \\"/message\\", { method: \\"POST\\", headers: { \\"Content-Type\\": \\"application/json\\" }, body: JSON.stringify({ conversationId, message, reset, inputParams }), }); if (!res.ok) throw new Error(\\"Backend error: \\" + res.status); return res.json(); } const res = await fetch(API_BASE + \\"/audit/\\" + conversationId); if (!res.ok) throw new Error(\\"Backend error: \\" + res.status); return res.json(); } const source = new EventSource(API_BASE + \\"/stream/\\" + conversationId); source.onopen = () => handlers.onConnected?.(); source.onerror = (error) => handlers.onError?.(error); [\\"CONNECTED\\", \\"USER_INPUT\\", \\"STEP_ENTER\\", \\"STEP_EXIT\\", \\"STEP_ERROR\\", \\"ASSISTANT_OUTPUT\\", \\"ENGINE_RETURN\\"] .forEach((stage) => { source.addEventListener(stage, (event) => { let data = null; try { data = event.data ? JSON.parse(event.data) : null; } catch {} handlers.onEvent?.({ stage, data, raw: event }); }); }); return { close() { source.close(); handlers.onClosed?.(); } }; } // STOMP scaffold (optional) // npm install @stomp/stompjs sockjs-client // import { Client } from \\"@stomp/stompjs\\"; // import SockJS from \\"sockjs-client\\"; // export function subscribeConversationStomp(conversationId, handlers = {}) { // const client = new Client({ // webSocketFactory: () => new SockJS(\\"http://localhost:8080/ws-convengine\\"), // reconnectDelay: 5000, // onConnect: () => { // handlers.onConnected?.(); // client.subscribe(\\"/topic/convengine/audit/\\" + conversationId, (msg) => { // try { handlers.onEvent?.(JSON.parse(msg.body)); } // catch { handlers.onEvent?.(msg.body); } // }); // }, // onStompError: (frame) => handlers.onError?.(frame), // }); // client.activate(); // return { close() { client.deactivate(); handlers.onClosed?.(); } }; // } } </CodeBlockToggle> <CodeBlockToggle title=\\"App.jsx\\" language=\\"jsx\\" packagePath=\\"src\\" filePath=\\"src/App.jsx\\" > { import { useEffect, useState } from \\"react\\"; const [conversationId] = useState(crypto.randomUUID()); const [auditVersion, setAuditVersion] = useState(0); useEffect(() => { const stream = subscribeConversationSse(conversationId, { onConnected: () => setAuditVersion((v) => v + 1), onEvent: () => setAuditVersion((v) => v + 1), }); // STOMP alternate: // const stream = subscribeConversationStomp(conversationId, { ... }); return () => stream.close(); }, [conversationId]); return <div>conversationId={conversationId} auditVersion={auditVersion}</div>; } } </CodeBlockToggle> ## React Vite (TypeScript) <CodeBlockToggle title=\\"convengine.api.ts\\" language=\\"ts\\" packagePath=\\"src/api\\" filePath=\\"src/api/convengine.api.ts\\" > { const API_BASE = \\"http://localhost:8080/api/v1/conversation\\"; | \\"CONNECTED\\" | \\"USER_INPUT\\" | \\"STEP_ENTER\\" | \\"STEP_EXIT\\" | \\"STEP_ERROR\\" | \\"ASSISTANT_OUTPUT\\" | \\"ENGINE_RETURN\\" | \\"MESSAGE\\"; stage: SseStage; data: T | null; raw: MessageEvent; } onConnected?: () => void; onEvent?: (event: StreamEvent<T>) => void; onError?: (event: Event) => void; onClosed?: () => void; } conversationId: string, message: string, inputParams: Record<string, unknown> = {}, reset = false ) { const res = await fetch(API_BASE + \\"/message\\", { method: \\"POST\\", headers: { \\"Content-Type\\": \\"application/json\\" }, body: JSON.stringify({ conversationId, message, inputParams, reset }), }); if (!res.ok) throw new Error(\\"Backend error: \\" + res.status); return res.json(); } conversationId: string, handlers: StreamHandlers<T> = {} ) { const source = new EventSource(API_BASE + \\"/stream/\\" + conversationId); source.onopen = () => handlers.onConnected?.(); source.onerror = (event) => handlers.onError?.(event); [\\"CONNECTED\\", \\"USER_INPUT\\", \\"STEP_ENTER\\", \\"STEP_EXIT\\", \\"STEP_ERROR\\", \\"ASSISTANT_OUTPUT\\", \\"ENGINE_RETURN\\"] .forEach((stage) => { source.addEventListener(stage, (event) => { let data: T | null = null; try { data = (event as MessageEvent).data ? JSON.parse((event as MessageEvent).data) as T : null; } catch { data = null; } handlers.onEvent?.({ stage: stage as SseStage, data, raw: event as MessageEvent }); }); }); return { close() { source.close(); handlers.onClosed?.(); } }; } } </CodeBlockToggle> <CodeBlockToggle title=\\"App.tsx\\" language=\\"tsx\\" packagePath=\\"src\\" filePath=\\"src/App.tsx\\" > { import { useEffect, useState } from \\"react\\"; const [conversationId] = useState<string>(crypto.randomUUID()); const [auditVersion, setAuditVersion] = useState<number>(0); useEffect(() => { const stream = subscribeConversationSse(conversationId, { onConnected: () => setAuditVersion((v) => v + 1), onEvent: () => setAuditVersion((v) => v + 1), onError: () => {}, }); return () => stream.close(); }, [conversationId]); return <main>auditVersion={auditVersion}</main>; } } </CodeBlockToggle> ## Angular Integration (authored sample) <CodeBlockToggle title=\\"convengine-api.service.ts\\" language=\\"ts\\" packagePath=\\"src/app/core\\" filePath=\\"src/app/core/convengine-api.service.ts\\" > { import { Injectable } from \'@angular/core\'; stage: string; data: T | null; raw: MessageEvent; } @Injectable({ providedIn: \'root\' }) private readonly apiBase = \'http://localhost:8080/api/v1/conversation\'; constructor(private readonly http: HttpClient) {} sendMessage(payload: { conversationId: string; message: string; reset?: boolean; inputParams?: Record<string, unknown>; }): Observable<any> { return this.http.post(this.apiBase + \'/message\', payload); } fetchAudits(conversationId: string): Observable<any[]> { return this.http.get<any[]>(this.apiBase + \'/audit/\' + conversationId); } subscribeConversationSse( conversationId: string, handlers: { onConnected?: () => void; onEvent?: (event: ConversationEvent) => void; onError?: (event: Event) => void; onClosed?: () => void; } = {} ) { const source = new EventSource(this.apiBase + \'/stream/\' + conversationId); source.onopen = () => handlers.onConnected?.(); source.onerror = (event) => handlers.onError?.(event); [\\"CONNECTED\\", \\"USER_INPUT\\", \\"STEP_ENTER\\", \\"STEP_EXIT\\", \\"STEP_ERROR\\", \\"ASSISTANT_OUTPUT\\", \\"ENGINE_RETURN\\"] .forEach((stage) => { source.addEventListener(stage, (event) => { let data: unknown = null; try { data = (event as MessageEvent).data ? JSON.parse((event as MessageEvent).data) : null; } catch { data = null; } handlers.onEvent?.({ stage, data, raw: event as MessageEvent }); }); }); return { close: () => { source.close(); handlers.onClosed?.(); } }; } // STOMP scaffold (optional) // npm i @stomp/stompjs sockjs-client // connect ws://localhost:8080/ws-convengine // subscribe /topic/convengine/audit/{conversationId} } } </CodeBlockToggle> <CodeBlockToggle title=\\"chat.component.ts\\" language=\\"ts\\" packagePath=\\"src/app/features/chat\\" filePath=\\"src/app/features/chat/chat.component.ts\\" > { import { Component, OnDestroy, OnInit } from \'@angular/core\'; @Component({ standalone: true, selector: \'app-chat\', imports: [CommonModule, FormsModule], templateUrl: \'./chat.component.html\' }) conversationId = crypto.randomUUID(); message = \'\'; messages: Array<{ role: \'user\' | \'assistant\'; text: string }> = []; typing = false; private streamCloser: { close: () => void } | null = null; constructor(private readonly api: ConvengineApiService) {} ngOnInit(): void { this.streamCloser = this.api.subscribeConversationSse(this.conversationId, { onEvent: () => { // optionally refresh audit panel } }); } send(): void { const text = this.message.trim(); if (!text || this.typing) return; this.messages.push({ role: \'user\', text }); this.message = \'\'; this.typing = true; this.api.sendMessage({ conversationId: this.conversationId, message: text }).subscribe({ next: (res) => { const value = res?.payload?.value ?? \'\'; this.messages.push({ role: \'assistant\', text: String(value) }); this.typing = false; }, error: () => { this.typing = false; } }); } ngOnDestroy(): void { this.streamCloser?.close(); } } } </CodeBlockToggle> <CodeBlockToggle title=\\"chat.component.html\\" language=\\"html\\" packagePath=\\"src/app/features/chat\\" filePath=\\"src/app/features/chat/chat.component.html\\" > { <section class=\\"chat-shell\\"> <div class=\\"messages\\"> <div *ngFor=\\"let m of messages\\" [class.user]=\\"m.role === \'user\'\\" [class.assistant]=\\"m.role === \'assistant\'\\"> {{ m.text }} </div> <div *ngIf=\\"typing\\" class=\\"assistant typing\\">Agent is typing...</div> </div> <div class=\\"composer\\"> <input [(ngModel)]=\\"message\\" placeholder=\\"Type message\\" /> <button (click)=\\"send()\\" [disabled]=\\"typing\\">Send</button> </div> </section> } </CodeBlockToggle> <Highlight type=\\"tip\\" title=\\"React + Angular parity\\"> Keep one shared backend contract for <MethodRef>conversationId</MethodRef>, <MethodRef>payload.type</MethodRef>, and audit stage names. Only transport/client wrappers should differ per framework. </Highlight>","excerpt":"UI Integration This page shows end to end UI wiring with: React (Vite) in JS + TS Angular (standalone) in TS SSE now + STOMP commented for later switch POST to /api/v1/conversation/message using conversationId and messag\u2026"},{"id":"deep-dive/data-model.mdx","version":"v1","title":"data model","permalink":"/docs/v1/deep-dive/data-model","content":"Data Model ConvEngine is configuration driven. Behavior is defined in the following tables. Configuration Tables Runtime Tables Session API When writing Java extensions (Interceptors, Transformers), you interact with EngineSession . Common Operations Setting a Task ( SET_TASK action) Tasks are triggered through rule action resolution, not by writing arbitrary task keys in context. Configure ce_rule.action=SET_TASK and map action_value to a Spring task bean method. } } Getting Extracted Data Access data extracted by the Schema Extraction step.","rawContent":"# Data Model ConvEngine is configuration-driven. Behavior is defined in the following tables. ## Configuration Tables <DbTable title=\\"Core Tables\\" columns={[\\"Table\\", \\"Purpose\\", \\"Key Columns\\"]} rows={[ [\\"ce_intent\\", \\"Defines business intents\\", \\"intent_code, description, enabled\\"], [\\"ce_intent_classifier\\", \\"Regex patterns for intents\\", \\"match_pattern, priority\\"], [\\"ce_rule\\", \\"Logic & State Transitions\\", \\"phase, state_code, rule_type, action, match_pattern\\"], [\\"ce_response\\", \\"Output mapping\\", \\"response_type, output_format, exact_text\\"], [\\"ce_output_schema\\", \\"Data extraction definition\\", \\"json_schema, priority\\"], [\\"ce_prompt_template\\", \\"LLM Prompts\\", \\"system_prompt, user_prompt\\"], ]} /> ## Runtime Tables <DbTable title=\\"Runtime Persistence\\" columns={[\\"Table\\", \\"Purpose\\"]} rows={[ [\\"ce_conversation\\", \\"Current state of active conversations\\"], [\\"ce_audit\\", \\"Append-only log of every step execution\\"], [\\"ce_conversation_history\\", \\"Normalized user/AI turn history used for prompt history reconstruction\\"], ]} /> --- # Session API When writing Java extensions (Interceptors, Transformers), you interact with EngineSession . <CodeBlockToggle title=\\"EngineSession.java (key methods)\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.session\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/session/EngineSession.java\\" > { // State Management void setIntent(String intent); void setState(String state); // Extras/Input params used by steps, prompts and rules Map<String, Object> getInputParams(); void putInputParam(String key, Object value); // Persisted Entity CeConversation getConversation(); // Flow Control void setFinalResult(EngineResult result); // Stop pipeline immediately } </CodeBlockToggle> ## Common Operations ### Setting a Task ( SET_TASK action) Tasks are triggered through rule action resolution, not by writing arbitrary task keys in context. Configure ce_rule.action=SET_TASK and map action_value to a Spring task bean method. <CodeBlockToggle title=\\"SET_TASK rule row\\" language=\\"sql\\" packagePath=\\"consumer DB\\"> { INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'PIPELINE_RULES\', \'REQUEST_TRACKER\', \'ANY\', \'REGEX\', \'(?i).*track.*request.*\', \'SET_TASK\', \'requestTrackerTask:loadStatus\', 10, true, \'Invoke consumer task bean during rule execution\'); } </CodeBlockToggle> <CodeBlockToggle title=\\"Consumer task bean method\\" language=\\"java\\" packagePath=\\"consumer logic\\"> { @Component(\\"requestTrackerTask\\") public class RequestTrackerTask implements CeRuleTask { public void loadStatus(EngineSession session, CeRule rule) { // Populate context/input params for downstream response session.putInputParam(\\"requestStatus\\", \\"IN_REVIEW\\"); } } } </CodeBlockToggle> ### Getting Extracted Data Access data extracted by the Schema Extraction step. <CodeBlockToggle title=\\"Read extracted value\\" language=\\"java\\" packagePath=\\"consumer logic\\"> { String accountId = (String) session.getInputParams().get(\\"accountId\\"); } </CodeBlockToggle>","excerpt":"Data Model ConvEngine is configuration driven. Behavior is defined in the following tables. Configuration Tables Runtime Tables Session API When writing Java extensions (Interceptors, Transformers), you interact with Eng\u2026"},{"id":"deep-dive/developer-guide.mdx","version":"v1","title":"developer guide","permalink":"/docs/v1/deep-dive/developer-guide","content":", data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , , , , , , ]; x1: , x2: , x3: , x4: , x5: , x6: , x7: , x8: , x9: , x10: , x11: , }; Developer Guide This page is the full implementation starter for consumers integrating ConvEngine into a Spring Boot service. 1. Start a Spring Boot project } } 2. Required schema (DDL) Use the dialect specific DDL file from ConvEngine: src/main/resources/sql/ddl_postgres.sql (or legacy src/main/resources/sql/ddl.sql ) src/main/resources/sql/ddl_oracle.sql src/main/resources/sql/ddl_sqlite.sql 3. Minimal DML for FAQ scenario 4. application.yml (full consumer starter) application.yml tag reference = 1\\", \\"Default 2\\"], [\\"convengine.audit.dispatch.queue capacity\\", \\"Dispatch queue size\\", \\"integer = 1\\", \\"Default 2000\\"], [\\"convengine.audit.dispatch.rejection policy\\", \\"Backpressure behavior\\", \\"CALLER_RUNS | DROP_NEWEST | DROP_OLDEST | ABORT\\", \\"Default CALLER_RUNS\\"], [\\"convengine.audit.dispatch.keep alive seconds\\", \\"Thread keep alive\\", \\"seconds\\", \\"Default 60\\"], [\\"convengine.audit.rate limit.enabled\\", \\"Enable per window throttling\\", \\"true | false\\", \\"Default false\\"], [\\"convengine.audit.rate limit.max events\\", \\"Events allowed per window\\", \\"integer\\", \\"Default 200\\"], [\\"convengine.audit.rate limit.window ms\\", \\"Rate limit window\\", \\"milliseconds\\", \\"Default 1000\\"], [\\"convengine.audit.rate limit.per conversation\\", \\"Bucket by conversation\\", \\"true | false\\", \\"Default true\\"], [\\"convengine.audit.rate limit.per stage\\", \\"Bucket by stage\\", \\"true | false\\", \\"Default true\\"], [\\"convengine.audit.rate limit.max tracked buckets\\", \\"Bucket cardinality cap\\", \\"integer\\", \\"Default 20000\\"], [\\"convengine.audit.persistence.mode\\", \\"DB persistence mode\\", \\"IMMEDIATE | DEFERRED_BULK\\", \\"Default IMMEDIATE\\"], [\\"convengine.audit.persistence.jdbc batch size\\", \\"Batch insert chunk size\\", \\"integer\\", \\"Default 200\\"], [\\"convengine.audit.persistence.max buffered events\\", \\"Deferred buffer cap\\", \\"integer\\", \\"Default 5000\\"], [\\"convengine.audit.persistence.flush stages\\", \\"Stages forcing flush\\", \\"list of stages\\", \\"Defaults include engine failure stages\\"], [\\"convengine.audit.persistence.final step names\\", \\"Final steps that flush\\", \\"list of step names\\", \\"Default includes PipelineEndGuardStep\\"], [\\"convengine.audit.persistence.flush on stop outcome\\", \\"Flush on STOP step outcome\\", \\"true | false\\", \\"Default true\\"], ]} / If @EnableConvEngine(stream=true) is set, startup fails when both convengine.transport.sse.enabled=false and convengine.transport.stomp.enabled=false . 5. API entry and session contracts } 6. Extension examples @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) } } } } } @Component public class MyContainerTransformer implements ContainerDataTransformer } @Component public class MyResponseTransformer implements ResponseTransformer } } 7. Persistence, audit and streaming tuning Start with direct HTTP + IMMEDIATE audit. Then enable async dispatch and bounded queue. Move to DEFERRED_BULK only after validating final step flush behavior for your trace requirements.","rawContent":"{ id: \\"x1\\", position: { x: 20, y: 60 }, data: { label: \\"ConversationController.message\\" } }, { id: \\"x2\\", position: { x: 260, y: 60 }, data: { label: \\"ContainerDataInterceptor\\" } }, { id: \\"x3\\", position: { x: 500, y: 60 }, data: { label: \\"EngineSessionFactory.open\\" } }, { id: \\"x4\\", position: { x: 740, y: 60 }, data: { label: \\"EnginePipeline.execute\\" } }, { id: \\"x5\\", position: { x: 20, y: 230 }, data: { label: \\"EngineStepHook.beforeStep\\" } }, { id: \\"x6\\", position: { x: 260, y: 230 }, data: { label: \\"Step.execute\\" } }, { id: \\"x7\\", position: { x: 500, y: 230 }, data: { label: \\"EngineStepHook.afterStep/onStepError\\" } }, { id: \\"x8\\", position: { x: 740, y: 230 }, data: { label: \\"ContainerDataTransformer\\" } }, { id: \\"x9\\", position: { x: 260, y: 400 }, data: { label: \\"ResponseResolutionStep\\" } }, { id: \\"x10\\", position: { x: 500, y: 400 }, data: { label: \\"ResponseTransformer\\" } }, { id: \\"x11\\", position: { x: 740, y: 400 }, data: { label: \\"HTTP/SSE/STOMP output\\" } }, ]; { id: \\"xe1\\", source: \\"x1\\", target: \\"x2\\" }, { id: \\"xe2\\", source: \\"x2\\", target: \\"x3\\" }, { id: \\"xe3\\", source: \\"x3\\", target: \\"x4\\" }, { id: \\"xe4\\", source: \\"x4\\", target: \\"x5\\" }, { id: \\"xe5\\", source: \\"x5\\", target: \\"x6\\" }, { id: \\"xe6\\", source: \\"x6\\", target: \\"x7\\" }, { id: \\"xe7\\", source: \\"x7\\", target: \\"x8\\" }, { id: \\"xe8\\", source: \\"x8\\", target: \\"x9\\" }, { id: \\"xe9\\", source: \\"x9\\", target: \\"x10\\" }, { id: \\"xe10\\", source: \\"x10\\", target: \\"x11\\" }, ]; x1: { title: \\"API Entry\\", file: \\"api/controller/ConversationController.java\\", method: \\"message(...)\\", stage: \\"HTTP_ENTRY\\", summary: \\"Builds EngineContext and delegates to engine.\\", session: [\\"userText, conversationId, inputParams\\"], tables: [\\"none\\"] }, x2: { title: \\"Input interception\\", file: \\"engine/interceptor/ContainerDataInterceptor.java\\", method: \\"intercept(...) \\", stage: \\"INPUT_INTERCEPT\\", summary: \\"Mutate input params before session start.\\", session: [\\"inputParams can be enriched\\"], tables: [\\"none\\"] }, x3: { title: \\"Session bootstrap\\", file: \\"engine/factory/EngineSessionFactory.java\\", method: \\"open(...) \\", stage: \\"SESSION_BOOTSTRAP\\", summary: \\"Loads persisted conversation facts.\\", session: [\\"intent/state/context hydrated\\"], tables: [\\"ce_conversation (R/W bootstrap)\\"] }, x4: { title: \\"DAG execution\\", file: \\"engine/pipeline/EnginePipeline.java\\", method: \\"execute(...) \\", stage: \\"STEP_LOOP\\", summary: \\"Runs step chain with wrappers.\\", session: [\\"STEP_ENTER/EXIT tracked\\"], tables: [\\"ce_audit (W)\\"] }, x5: { title: \\"Pre-step hook\\", file: \\"engine/hook/EngineStepHook.java\\", method: \\"beforeStep(...) \\", stage: \\"STEP_ENTER\\", summary: \\"Consumer mutates session before target step.\\", session: [\\"set hints/context/params\\"], tables: [\\"none\\"] }, x6: { title: \\"Core step\\", file: \\"engine/steps/*\\", method: \\"execute(EngineSession)\\", stage: \\"STEP_CORE\\", summary: \\"Intent/state/schema/rules/response handling.\\", session: [\\"major mutations happen here\\"], tables: [\\"ce_intent, ce_rule, ce_response, ...\\"] }, x7: { title: \\"Post-step hook\\", file: \\"engine/hook/EngineStepHook.java\\", method: \\"afterStep(...) / onStepError(...) \\", stage: \\"STEP_EXIT/STEP_ERROR\\", summary: \\"Consumer gets outcome and can append diagnostics.\\", session: [\\"read and augment session\\"], tables: [\\"none\\"] }, x8: { title: \\"Container transform\\", file: \\"engine/transformer/ContainerDataTransformer.java\\", method: \\"transform(...) \\", stage: \\"CONTAINER_TRANSFORM\\", summary: \\"Transforms intermediate container payload.\\", session: [\\"container rewritten\\"], tables: [\\"none\\"] }, x9: { title: \\"Response resolve\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Selects EXACT/DERIVED mapping.\\", session: [\\"output payload generated\\"], tables: [\\"ce_response (R), ce_prompt_template (R)\\"] }, x10: { title: \\"Response transform\\", file: \\"engine/transformer/ResponseTransformer.java\\", method: \\"transform(...) \\", stage: \\"RESPONSE_TRANSFORM\\", summary: \\"Last-mile normalization/redaction.\\", session: [\\"final payload rewrite\\"], tables: [\\"none\\"] }, x11: { title: \\"Transport\\", file: \\"transport/sse/* + transport/stomp/*\\", method: \\"emit/publish\\", stage: \\"HTTP_RESPONSE or STREAM_EVENT\\", summary: \\"Returns direct response or emits stream events.\\", session: [\\"conversationId routing key\\"], tables: [\\"none\\"] }, }; # Developer Guide This page is the full implementation starter for consumers integrating ConvEngine into a Spring Boot service. <EngineDebugFlow title=\\"Consumer Extension Map\\" subtitle=\\"Click each node to inspect extension timing, file, method and expected session state.\\" nodes={extNodes} edges={extEdges} detailsById={extDetails} defaultSelectedId=\\"x5\\" /> ## 1. Start a Spring Boot project <Tabs groupId=\\"bootstrap\\"> <TabItem value=\\"maven\\" label=\\"pom.xml\\" default> <CodeBlockToggle title=\\"Maven dependency\\" language=\\"xml\\" packagePath=\\"project build\\"> { <dependency> <groupId>com.github.salilvnair</groupId> <artifactId>convengine</artifactId> <version>1.0.15</version> </dependency> } </CodeBlockToggle> </TabItem> <TabItem value=\\"gradle\\" label=\\"build.gradle.kts\\"> <CodeBlockToggle title=\\"Gradle dependency\\" language=\\"kotlin\\" packagePath=\\"project build\\"> { implementation(\\"com.github.salilvnair:convengine:1.0.15\\") } </CodeBlockToggle> </TabItem> <TabItem value=\\"app\\" label=\\"Application class\\"> <CodeBlockToggle title=\\"Enable ConvEngine\\" language=\\"java\\" packagePath=\\"com.zapper.demo\\" filePath=\\"src/main/java/com/acme/demo/DemoApplication.java\\"> { @SpringBootApplication @EnableConvEngine(stream = true) public class DemoApplication { public static void main(String[] args) { SpringApplication.run(DemoApplication.class, args); } } } </CodeBlockToggle> </TabItem> </Tabs> ## 2. Required schema (DDL) <Tabs groupId=\\"ce-ddl-dialect\\"> <TabItem value=\\"postgres\\" label=\\"Postgres\\" default> <CodeBlockToggle title=\\"Postgres DDL source\\" language=\\"sql\\" packagePath=\\"src/main/resources/sql\\"> { -- Use full script from: -- src/main/resources/sql/ddl_postgres.sql -- (legacy path still available: src/main/resources/sql/ddl.sql) } </CodeBlockToggle> </TabItem> <TabItem value=\\"oracle\\" label=\\"Oracle\\"> <CodeBlockToggle title=\\"Oracle DDL source\\" language=\\"sql\\" packagePath=\\"src/main/resources/sql\\"> { -- Use full script from: -- src/main/resources/sql/ddl_oracle.sql } </CodeBlockToggle> </TabItem> <TabItem value=\\"sqlite\\" label=\\"SQLite\\"> <CodeBlockToggle title=\\"SQLite DDL source\\" language=\\"sql\\" packagePath=\\"src/main/resources/sql\\"> { -- Use full script from: -- src/main/resources/sql/ddl_sqlite.sql } </CodeBlockToggle> </TabItem> </Tabs> <Highlight type=\\"info\\" title=\\"Source of truth\\"> Use the dialect-specific DDL file from ConvEngine: - <FileRef>src/main/resources/sql/ddl_postgres.sql</FileRef> (or legacy <FileRef>src/main/resources/sql/ddl.sql</FileRef>) - <FileRef>src/main/resources/sql/ddl_oracle.sql</FileRef> - <FileRef>src/main/resources/sql/ddl_sqlite.sql</FileRef> </Highlight> ## 3. Minimal DML for FAQ scenario <CodeBlockToggle title=\\"FAQ DML example\\" language=\\"sql\\" packagePath=\\"db/seed\\"> { insert into ce_intent(intent_code, state_code, enabled) values (\'FAQ\', null, true); insert into ce_intent_classifier(intent_code, pattern, priority, enabled) values (\'FAQ\', \'(?i).*(office|location|address).*\', 10, true); insert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled) values (\'FAQ\', null, \'EXACT\', \'TEXT\', \'Our office is at 123 Tech Park, Silicon Valley.\', true); insert into ce_config(config_key, config_value, enabled) values (\'RESET_COMMAND\', \'RESET_SESSION\', true); } </CodeBlockToggle> <DbTable title=\\"FAQ seed preview\\" columns={[\\"Table\\", \\"Key values\\"]} rows={[ [\\"ce_intent\\", \\"intent_code=FAQ\\"], [\\"ce_intent_classifier\\", \\"pattern=(?i).*(office|location|address).*\\"], [\\"ce_response\\", \\"response_type=EXACT, output_format=TEXT\\"], [\\"ce_config\\", \\"RESET_COMMAND=RESET_SESSION\\"], ]} /> ## 4. application.yml (full consumer starter) <CodeBlockToggle title=\\"application.yml\\" language=\\"yaml\\" packagePath=\\"src/main/resources\\"> { server: port: 8080 spring: datasource: url: jdbc:postgresql://localhost:5432/convengine username: convengine_user password: convengine_pwd convengine: transport: sse: enabled: true emitter-timeout-ms: 1800000 stomp: enabled: false endpoint: /ws-convengine app-destination-prefix: /app topic-prefix: /topic audit-destination-base: /topic/convengine/audit allowed-origin-pattern: \\"*\\" sock-js: true broker: mode: SIMPLE # SIMPLE | RELAY relay-destination-prefixes: [\\"/topic\\", \\"/queue\\"] relay-host: localhost relay-port: 61613 client-login: \\"\\" client-passcode: \\"\\" system-login: \\"\\" system-passcode: \\"\\" virtual-host: \\"\\" system-heartbeat-send-interval-ms: 10000 system-heartbeat-receive-interval-ms: 10000 audit: enabled: true persist-meta: true level: ALL # ALL | STANDARD | ERROR_ONLY | NONE include-stages: [] exclude-stages: [] dispatch: async-enabled: true worker-threads: 2 queue-capacity: 2000 rejection-policy: DROP_OLDEST # CALLER_RUNS | DROP_NEWEST | DROP_OLDEST | ABORT keep-alive-seconds: 60 rate-limit: enabled: false max-events: 200 window-ms: 1000 per-conversation: true per-stage: true max-tracked-buckets: 20000 persistence: mode: DEFERRED_BULK # IMMEDIATE | DEFERRED_BULK jdbc-batch-size: 200 max-buffered-events: 5000 flush-stages: [\\"ENGINE_KNOWN_FAILURE\\", \\"ENGINE_UNKNOWN_FAILURE\\"] final-step-names: [\\"PipelineEndGuardStep\\"] flush-on-stop-outcome: true } </CodeBlockToggle> ### application.yml tag reference <DbTable title=\\"server + datasource\\" className=\\"ce-config-ref-table\\" columns={[\\"Tag\\", \\"What it controls\\", \\"Expected values\\", \\"Default/notes\\"]} rows={[ [\\"server.port\\", \\"HTTP port for your app\\", \\"integer\\", \\"8080 in sample\\"], [\\"spring.datasource.url\\", \\"DB connection URL\\", \\"jdbc URL\\", \\"Must point to DB with ce_* tables\\"], [\\"spring.datasource.username\\", \\"DB username\\", \\"string\\", \\"DB user with read/write on ce_*\\"], [\\"spring.datasource.password\\", \\"DB password\\", \\"string\\", \\"Use secret manager/env var in prod\\"], ]} /> <DbTable title=\\"convengine.transport.sse\\" className=\\"ce-config-ref-table\\" columns={[\\"Tag\\", \\"What it controls\\", \\"Expected values\\", \\"Default/notes\\"]} rows={[ [\\"convengine.transport.sse.enabled\\", \\"Enable SSE endpoints/publishers\\", \\"true | false\\", \\"Default true\\"], [\\"convengine.transport.sse.emitter-timeout-ms\\", \\"SSE emitter timeout\\", \\"milliseconds\\", \\"Default 1800000 (30 min)\\"], ]} /> <DbTable title=\\"convengine.transport.stomp\\" className=\\"ce-config-ref-table\\" columns={[\\"Tag\\", \\"What it controls\\", \\"Expected values\\", \\"Default/notes\\"]} rows={[ [\\"convengine.transport.stomp.enabled\\", \\"Enable STOMP websocket transport\\", \\"true | false\\", \\"Default false\\"], [\\"convengine.transport.stomp.endpoint\\", \\"WebSocket handshake endpoint\\", \\"path\\", \\"Default /ws-convengine\\"], [\\"convengine.transport.stomp.app-destination-prefix\\", \\"Client send prefix\\", \\"path prefix\\", \\"Default /app\\"], [\\"convengine.transport.stomp.topic-prefix\\", \\"Server publish topic prefix\\", \\"path prefix\\", \\"Default /topic\\"], [\\"convengine.transport.stomp.audit-destination-base\\", \\"Audit topic base path\\", \\"path\\", \\"Default /topic/convengine/audit\\"], [\\"convengine.transport.stomp.allowed-origin-pattern\\", \\"CORS origin pattern\\", \\"origin pattern\\", \\"Default *\\"], [\\"convengine.transport.stomp.sock-js\\", \\"SockJS fallback toggle\\", \\"true | false\\", \\"Default true\\"], ]} /> <DbTable title=\\"convengine.transport.stomp.broker\\" className=\\"ce-config-ref-table\\" columns={[\\"Tag\\", \\"What it controls\\", \\"Expected values\\", \\"Default/notes\\"]} rows={[ [\\"convengine.transport.stomp.broker.mode\\", \\"Broker mode selection\\", \\"SIMPLE | RELAY\\", \\"SIMPLE uses in-memory broker\\"], [\\"convengine.transport.stomp.broker.relay-destination-prefixes\\", \\"Relay destinations to enable\\", \\"list of prefixes\\", \\"Default [/topic, /queue]\\"], [\\"convengine.transport.stomp.broker.relay-host\\", \\"Relay broker host\\", \\"hostname\\", \\"Used when mode=RELAY\\"], [\\"convengine.transport.stomp.broker.relay-port\\", \\"Relay broker port\\", \\"integer\\", \\"Default 61613\\"], [\\"convengine.transport.stomp.broker.client-login\\", \\"Client login to relay\\", \\"string\\", \\"Optional\\"], [\\"convengine.transport.stomp.broker.client-passcode\\", \\"Client passcode to relay\\", \\"string\\", \\"Optional\\"], [\\"convengine.transport.stomp.broker.system-login\\", \\"System login to relay\\", \\"string\\", \\"Optional\\"], [\\"convengine.transport.stomp.broker.system-passcode\\", \\"System passcode to relay\\", \\"string\\", \\"Optional\\"], [\\"convengine.transport.stomp.broker.virtual-host\\", \\"Relay vhost\\", \\"string\\", \\"Optional\\"], [\\"convengine.transport.stomp.broker.system-heartbeat-send-interval-ms\\", \\"Outbound heartbeat\\", \\"milliseconds\\", \\"Default 10000\\"], [\\"convengine.transport.stomp.broker.system-heartbeat-receive-interval-ms\\", \\"Inbound heartbeat\\", \\"milliseconds\\", \\"Default 10000\\"], ]} /> <DbTable title=\\"convengine.audit (root)\\" className=\\"ce-config-ref-table\\" columns={[\\"Tag\\", \\"What it controls\\", \\"Expected values\\", \\"Default/notes\\"]} rows={[ [\\"convengine.audit.enabled\\", \\"Master audit enable switch\\", \\"true | false\\", \\"Default true\\"], [\\"convengine.audit.persist-meta\\", \\"Persist _meta into ce_audit.payload_json \\", \\"true | false\\", \\"Default true\\"], [\\"convengine.audit.level\\", \\"Audit verbosity\\", \\"ALL | STANDARD | ERROR_ONLY | NONE\\", \\"STANDARD suppresses STEP_ENTER/STEP_EXIT\\"], [\\"convengine.audit.include-stages\\", \\"Allowlist stages\\", \\"list of stage patterns\\", \\"Empty = no allowlist filter\\"], [\\"convengine.audit.exclude-stages\\", \\"Blocklist stages\\", \\"list of stage patterns\\", \\"Applied after include filter\\"], ]} /> <DbTable title=\\"convengine.audit.dispatch + rate-limit + persistence\\" className=\\"ce-config-ref-table\\" columns={[\\"Tag\\", \\"What it controls\\", \\"Expected values\\", \\"Default/notes\\"]} rows={[ [\\"convengine.audit.dispatch.async-enabled\\", \\"Async listener dispatch\\", \\"true | false\\", \\"Default false unless enabled\\"], [\\"convengine.audit.dispatch.worker-threads\\", \\"Async worker count\\", \\"integer >= 1\\", \\"Default 2\\"], [\\"convengine.audit.dispatch.queue-capacity\\", \\"Dispatch queue size\\", \\"integer >= 1\\", \\"Default 2000\\"], [\\"convengine.audit.dispatch.rejection-policy\\", \\"Backpressure behavior\\", \\"CALLER_RUNS | DROP_NEWEST | DROP_OLDEST | ABORT\\", \\"Default CALLER_RUNS\\"], [\\"convengine.audit.dispatch.keep-alive-seconds\\", \\"Thread keep-alive\\", \\"seconds\\", \\"Default 60\\"], [\\"convengine.audit.rate-limit.enabled\\", \\"Enable per-window throttling\\", \\"true | false\\", \\"Default false\\"], [\\"convengine.audit.rate-limit.max-events\\", \\"Events allowed per window\\", \\"integer\\", \\"Default 200\\"], [\\"convengine.audit.rate-limit.window-ms\\", \\"Rate-limit window\\", \\"milliseconds\\", \\"Default 1000\\"], [\\"convengine.audit.rate-limit.per-conversation\\", \\"Bucket by conversation\\", \\"true | false\\", \\"Default true\\"], [\\"convengine.audit.rate-limit.per-stage\\", \\"Bucket by stage\\", \\"true | false\\", \\"Default true\\"], [\\"convengine.audit.rate-limit.max-tracked-buckets\\", \\"Bucket cardinality cap\\", \\"integer\\", \\"Default 20000\\"], [\\"convengine.audit.persistence.mode\\", \\"DB persistence mode\\", \\"IMMEDIATE | DEFERRED_BULK\\", \\"Default IMMEDIATE\\"], [\\"convengine.audit.persistence.jdbc-batch-size\\", \\"Batch insert chunk size\\", \\"integer\\", \\"Default 200\\"], [\\"convengine.audit.persistence.max-buffered-events\\", \\"Deferred buffer cap\\", \\"integer\\", \\"Default 5000\\"], [\\"convengine.audit.persistence.flush-stages\\", \\"Stages forcing flush\\", \\"list of stages\\", \\"Defaults include engine failure stages\\"], [\\"convengine.audit.persistence.final-step-names\\", \\"Final steps that flush\\", \\"list of step names\\", \\"Default includes PipelineEndGuardStep\\"], [\\"convengine.audit.persistence.flush-on-stop-outcome\\", \\"Flush on STOP step outcome\\", \\"true | false\\", \\"Default true\\"], ]} /> <Highlight type=\\"warning\\" title=\\"Streaming startup rule\\"> If <MethodRef>@EnableConvEngine(stream=true)</MethodRef> is set, startup fails when both <MethodRef>convengine.transport.sse.enabled=false</MethodRef> and <MethodRef>convengine.transport.stomp.enabled=false</MethodRef>. </Highlight> ## 5. API entry and session contracts <Tabs groupId=\\"api-session\\"> <TabItem value=\\"api\\" label=\\"API Entry Point\\" default> <CodeBlockToggle title=\\"ConversationController.message\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.api.controller\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/api/controller/ConversationController.java\\"> { @PostMapping(\\"/message\\") public ConversationResponse message(@RequestBody ConversationRequest request) { EngineContext engineContext = EngineContext .builder() .conversationId(request.getConversationId()) .userText(request.getMessage()) .inputParams(request.getInputParams()) .build(); EngineResult result = engine.process(engineContext); return mapToResponse(result); } } </CodeBlockToggle> </TabItem> <TabItem value=\\"session\\" label=\\"Session API\\"> <CodeBlockToggle title=\\"EngineSession.java (key methods)\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.session\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/session/EngineSession.java\\"> { // state management void setIntent(String intent); void setState(String state); // extras/input params Map<String, Object> getInputParams(); void putInputParam(String key, Object value); // persisted conversation row CeConversation getConversation(); // stop pipeline with final result void setFinalResult(EngineResult result); } </CodeBlockToggle> </TabItem> </Tabs> ## 6. Extension examples <Tabs groupId=\\"extensions\\"> <TabItem value=\\"hooks\\" label=\\"EngineStepHook\\" default> <CodeBlockToggle title=\\"Step hook with enum-safe matching\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.hooks\\"> { @Component public class SchemaHintHook implements EngineStepHook { @Override public boolean supports(EngineStep.Name stepName, EngineSession session) { return EngineStep.Name.SchemaExtractionStep == stepName; } @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) { session.putInputParam(\\"consumer_hint\\", \\"compact\\"); } } } </CodeBlockToggle> </TabItem> <TabItem value=\\"task\\" label=\\"SET_TASK Action\\"> <CodeBlockToggle title=\\"SET_TASK via ce_rule\\" language=\\"sql\\" packagePath=\\"consumer DB\\"> { INSERT INTO ce_rule (phase, intent_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'PIPELINE_RULES\', \'REQUEST_TRACKER\', \'REGEX\', \'(?i).*track.*request.*\', \'SET_TASK\', \'requestTrackerTask:loadStatus\', 10, true, \'Invoke consumer task bean\'); } </CodeBlockToggle> <CodeBlockToggle title=\\"Consumer task bean\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.tasks\\"> { @Component(\\"requestTrackerTask\\") public class RequestTrackerTask implements CeRuleTask { public void loadStatus(EngineSession session, CeRule rule) { session.putInputParam(\\"requestStatus\\", \\"IN_REVIEW\\"); } } } </CodeBlockToggle> </TabItem> <TabItem value=\\"schema-json\\" label=\\"Getting Extracted Data\\"> <CodeBlockToggle title=\\"Read schema extracted values\\" language=\\"java\\" packagePath=\\"consumer logic\\"> { String accountId = (String) session.getInputParams().get(\\"accountId\\"); } </CodeBlockToggle> </TabItem> <TabItem value=\\"transformers\\" label=\\"Interceptors / Transformers\\"> <CodeBlockToggle title=\\"Interception chain\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.ext\\"> { @Component public class MyInterceptor implements ContainerDataInterceptor { @Override public Map<String, Object> intercept(Map<String, Object> inputParams) { inputParams.putIfAbsent(\\"channel\\", \\"web\\"); return inputParams; } } @Component public class MyContainerTransformer implements ContainerDataTransformer { @Override public Object transform(Object data, EngineSession session) { return data; } } @Component public class MyResponseTransformer implements ResponseTransformer { @Override public OutputPayload transform(OutputPayload payload, EngineSession session) { return payload; } } } </CodeBlockToggle> </TabItem> </Tabs> ## 7. Persistence, audit and streaming tuning <Highlight type=\\"tip\\" title=\\"Production sequence\\"> Start with direct <MethodRef>HTTP</MethodRef> + <MethodRef>IMMEDIATE</MethodRef> audit. Then enable async dispatch and bounded queue. Move to <MethodRef>DEFERRED_BULK</MethodRef> only after validating final-step flush behavior for your trace requirements. </Highlight> <DbTable title=\\"High-impact runtime knobs\\" columns={[\\"Area\\", \\"Config\\", \\"Effect\\"]} rows={[ [\\"Audit dispatch\\", \\"convengine.audit.dispatch.*\\", \\"Decouples request latency from listener work\\"], [\\"Queue/backpressure\\", \\"convengine.audit.dispatch.queue-capacity + rejection-policy\\", \\"Bounds memory and defines overflow behavior\\"], [\\"Audit persistence mode\\", \\"convengine.audit.persistence.mode\\", \\"IMMEDIATE or DEFERRED_BULK (JDBC batch flush)\\"], [\\"Stage filtering\\", \\"convengine.audit.level + include-stages/exclude-stages\\", \\"Controls emitted/saved stages\\"], [\\"Broker relay\\", \\"convengine.transport.stomp.broker.mode=RELAY\\", \\"Optional external broker for STOMP scaling\\"], [\\"Stream hard requirement\\", \\"@EnableConvEngine(stream=true)\\", \\"Fails startup if both SSE and STOMP are disabled\\"], ]} />","excerpt":", data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , , , , , , ]; x1: , x2: , x3: , x4: , x5: , x6: , x7: , x8: , x9: , x10: , x11: , }; De\u2026"},{"id":"deep-dive/examples.mdx","version":"v1","title":"examples","permalink":"/docs/v1/deep-dive/examples","content":", data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , , ]; faq_api: , faq_engine: , faq_pipeline: , faq_intent: , faq_rules: , faq_response: , faq_persist: , }; , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , , , ]; d_intent: , d_schema: , d_lock: , d_ask: , d_turn2: , d_merge: , d_rules: , d_done: , }; , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , ]; l_api: , l_intent: , l_schema: , l_rules: , l_resp: , l_persist: , }; , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , ]; t_api: , t_intent: , t_rules: , t_task: , t_resp: , t_done: , }; , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , ]; r_api: , r_load: , r_reset: , r_audit: , r_resp: , r_done: , }; Real world Examples (Debug Trace) Canonical Runtime Step Set 1 LoadOrCreateConversationStep 2 ResetConversationStep 3 PersistConversationBootstrapStep 4 AuditUserInputStep 5 PolicyEnforcementStep 6 IntentResolutionStep 7 ResetResolvedIntentStep 8 FallbackIntentStateStep 9 AddContainerDataStep 10 McpToolStep 11 SchemaExtractionStep 12 AutoAdvanceStep 13 RulesStep 14 ResponseResolutionStep 15 PersistConversationStep 16 PipelineEndGuardStep These examples zoom into relevant branches; conditional/system steps from the canonical set are omitted in each graph unless they materially affect that scenario. Each example has three tabs: Conversation : chat + execution flow DML Entries : starter rows for ce_intent , ce_prompt_template , ce_output_schema , ce_response Audit Trail : stage by stage ce_audit view Example 1: FAQ Can I move my connection within Zapper? Yes, you can request relocation from the support portal. }\', true); insert into ce_output_schema(intent_code, state_code, schema_json, enabled) values (\'FAQ\', null, \' }}\', true); insert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled) values (\'FAQ\', \'IDLE\', \'EXACT\', \'TEXT\', \'Yes, you can request relocation from the support portal.\', true); } , \\"responseType\\": \\"EXACT\\", \\"outputFormat\\": \\"TEXT\\" } } Example 2: DISCONNECT_ELECTRICITY Disconnect electricity for account 10004567. Please share disconnect date and reason. Date is 2026 03 31, reason moving out. Done, request submitted. }\', true); insert into ce_output_schema(intent_code, state_code, schema_json, enabled) values (\'DISCONNECT_ELECTRICITY\', \'COLLECT_REQUIRED\', \' ,\\"disconnectDate\\": ,\\"reason\\": },\\"required\\":[\\"accountId\\",\\"disconnectDate\\",\\"reason\\"]}\', true); insert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled) values (\'DISCONNECT_ELECTRICITY\', \'COLLECT_REQUIRED\', \'DERIVED\', \'TEXT\', null, true); } , \\"missingFields\\": [\\"disconnectDate\\", \\"reason\\"], \\"locked\\": true } } Example 3: LOG_ANALYSIS Analyze this stack trace and tell root cause. Likely connection pool exhaustion; tune pool and reduce long transactions. ,\\"component\\": ,\\"severity\\": }}\', true); insert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled) values (\'LOG_ANALYSIS\', \'ANALYZE\', \'DERIVED\', \'TEXT\', null, true); } Example 4: REQUEST_TRACKER Track request REQ 99123 REQ 99123 is APPROVAL_PENDING since 2026 02 10. }}\', true); insert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled) values (\'REQUEST_TRACKER\', \'LOOKUP\', \'DERIVED\', \'TEXT\', null, true); } Example 5: RESET_SESSION RESET_SESSION Session reset complete. Starting fresh. }\', true); insert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled) values (\'RESET_SESSION\', \'IDLE\', \'EXACT\', \'TEXT\', \'Session reset complete. Starting fresh.\', true); } For extraction customization hook EngineStep.Name.SchemaExtractionStep . For final output normalization use ResponseTransformer .","rawContent":"{ id: \\"faq_api\\", position: { x: 20, y: 50 }, data: { label: \\"ConversationController.message\\" } }, { id: \\"faq_engine\\", position: { x: 280, y: 50 }, data: { label: \\"DefaultConversationalEngine.process\\" } }, { id: \\"faq_pipeline\\", position: { x: 540, y: 50 }, data: { label: \\"EnginePipeline.execute\\" } }, { id: \\"faq_intent\\", position: { x: 20, y: 220 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"faq_rules\\", position: { x: 280, y: 220 }, data: { label: \\"RulesStep\\" } }, { id: \\"faq_response\\", position: { x: 540, y: 220 }, data: { label: \\"ResponseResolutionStep\\" } }, { id: \\"faq_persist\\", position: { x: 800, y: 220 }, data: { label: \\"PersistConversationStep\\" } }, ]; { id: \\"faq_e1\\", source: \\"faq_api\\", target: \\"faq_engine\\" }, { id: \\"faq_e2\\", source: \\"faq_engine\\", target: \\"faq_pipeline\\" }, { id: \\"faq_e3\\", source: \\"faq_pipeline\\", target: \\"faq_intent\\" }, { id: \\"faq_e4\\", source: \\"faq_intent\\", target: \\"faq_rules\\" }, { id: \\"faq_e5\\", source: \\"faq_rules\\", target: \\"faq_response\\" }, { id: \\"faq_e6\\", source: \\"faq_response\\", target: \\"faq_persist\\" }, ]; faq_api: { title: \\"API entry\\", file: \\"api/controller/ConversationController.java\\", method: \\"message(...)\\", stage: \\"HTTP_ENTRY\\", summary: \\"Builds EngineContext and calls engine.process.\\", session: [\\"userText set\\", \\"inputParams normalized\\"], tables: [\\"none\\"] }, faq_engine: { title: \\"Engine entry\\", file: \\"engine/provider/DefaultConversationalEngine.java\\", method: \\"process(...)\\", stage: \\"ENGINE_ENTRY\\", summary: \\"Opens session and executes pipeline.\\", session: [\\"session hydrated\\"], tables: [\\"ce_conversation (R)\\"] }, faq_pipeline: { title: \\"Step loop\\", file: \\"engine/pipeline/EnginePipeline.java\\", method: \\"execute(...)\\", stage: \\"STEP_ENTER/STEP_EXIT\\", summary: \\"Runs all steps in DAG order.\\", session: [\\"timing + audits emitted\\"], tables: [\\"ce_audit (W)\\"] }, faq_intent: { title: \\"Intent resolve\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(...)\\", stage: \\"INTENT_RESOLVED\\", summary: \\"Classifier picks FAQ.\\", session: [\\"intent=FAQ\\"], tables: [\\"ce_intent_classifier (R)\\", \\"ce_intent (R)\\"] }, faq_rules: { title: \\"Rules pass\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(...)\\", stage: \\"RULE_NO_MATCH\\", summary: \\"No matching action.\\", session: [\\"state unchanged\\"], tables: [\\"ce_rule (R)\\"] }, faq_response: { title: \\"Response resolve\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...)\\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Returns EXACT response.\\", session: [\\"payload type TEXT\\"], tables: [\\"ce_response (R)\\"] }, faq_persist: { title: \\"Persist\\", file: \\"engine/steps/PersistConversationStep.java\\", method: \\"execute(...)\\", stage: \\"CONVERSATION_PERSIST\\", summary: \\"Writes latest state/result.\\", session: [\\"conversation synced\\"], tables: [\\"ce_conversation (W)\\"] }, }; { id: \\"d_intent\\", position: { x: 20, y: 60 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"d_schema\\", position: { x: 280, y: 60 }, data: { label: \\"SchemaExtractionStep\\" } }, { id: \\"d_lock\\", position: { x: 540, y: 60 }, data: { label: \\"Intent lock (incomplete schema)\\" } }, { id: \\"d_ask\\", position: { x: 800, y: 60 }, data: { label: \\"Follow-up response\\" } }, { id: \\"d_turn2\\", position: { x: 20, y: 220 }, data: { label: \\"Next turn resume\\" } }, { id: \\"d_merge\\", position: { x: 280, y: 220 }, data: { label: \\"Context merge + complete\\" } }, { id: \\"d_rules\\", position: { x: 540, y: 220 }, data: { label: \\"RulesStep (SET_STATE/SET_TASK)\\" } }, { id: \\"d_done\\", position: { x: 800, y: 220 }, data: { label: \\"Final response + persist\\" } }, ]; { id: \\"d1\\", source: \\"d_intent\\", target: \\"d_schema\\" }, { id: \\"d2\\", source: \\"d_schema\\", target: \\"d_lock\\" }, { id: \\"d3\\", source: \\"d_lock\\", target: \\"d_ask\\" }, { id: \\"d4\\", source: \\"d_ask\\", target: \\"d_turn2\\" }, { id: \\"d5\\", source: \\"d_turn2\\", target: \\"d_merge\\" }, { id: \\"d6\\", source: \\"d_merge\\", target: \\"d_rules\\" }, { id: \\"d7\\", source: \\"d_rules\\", target: \\"d_done\\" }, ]; d_intent: { title: \\"Intent\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(...)\\", stage: \\"INTENT_RESOLVED\\", summary: \\"Resolves DISCONNECT_ELECTRICITY.\\", session: [\\"intent fixed for flow\\"], tables: [\\"ce_intent (R)\\"] }, d_schema: { title: \\"Extract schema\\", file: \\"engine/steps/SchemaExtractionStep.java\\", method: \\"execute(...)\\", stage: \\"SCHEMA_EVALUATED\\", summary: \\"Gets accountId, missing required fields remain.\\", session: [\\"contextJson partial\\", \\"missing fields tracked\\"], tables: [\\"ce_output_schema (R)\\", \\"ce_prompt_template (R)\\"] }, d_lock: { title: \\"Lock\\", file: \\"engine/steps/SchemaExtractionStep.java\\", method: \\"lockIntentWhenIncomplete(...)\\", stage: \\"SCHEMA_INCOMPLETE\\", summary: \\"Prevents reclassification next turn.\\", session: [\\"intent locked\\"], tables: [\\"ce_audit (W)\\"] }, d_ask: { title: \\"Follow-up\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...)\\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Asks user only missing fields.\\", session: [\\"followups prepared\\"], tables: [\\"ce_response (R)\\"] }, d_turn2: { title: \\"Resume\\", file: \\"engine/steps/LoadOrCreateConversationStep.java\\", method: \\"execute(...)\\", stage: \\"SESSION_REHYDRATE\\", summary: \\"Loads same conversationId state.\\", session: [\\"prior context loaded\\"], tables: [\\"ce_conversation (R)\\"] }, d_merge: { title: \\"Complete\\", file: \\"engine/steps/SchemaExtractionStep.java\\", method: \\"mergeExtractedWithContext(...)\\", stage: \\"SCHEMA_COMPLETE\\", summary: \\"Merges new values and unlocks intent.\\", session: [\\"contextJson complete\\"], tables: [\\"ce_output_schema (R)\\"] }, d_rules: { title: \\"Actions\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(...)\\", stage: \\"RULE_MATCH\\", summary: \\"Moves state and task.\\", session: [\\"state updated\\", \\"task set\\"], tables: [\\"ce_rule (R)\\"] }, d_done: { title: \\"Done\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...)\\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Final confirmation.\\", session: [\\"payload final\\"], tables: [\\"ce_response (R)\\", \\"ce_conversation (W)\\"] }, }; { id: \\"l_api\\", position: { x: 20, y: 60 }, data: { label: \\"API entry\\" } }, { id: \\"l_intent\\", position: { x: 280, y: 60 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"l_schema\\", position: { x: 540, y: 60 }, data: { label: \\"SchemaExtractionStep\\" } }, { id: \\"l_rules\\", position: { x: 800, y: 60 }, data: { label: \\"RulesStep (GET_SCHEMA_JSON)\\" } }, { id: \\"l_resp\\", position: { x: 280, y: 220 }, data: { label: \\"ResponseResolutionStep (DERIVED)\\" } }, { id: \\"l_persist\\", position: { x: 540, y: 220 }, data: { label: \\"PersistConversationStep\\" } }, ]; { id: \\"l1\\", source: \\"l_api\\", target: \\"l_intent\\" }, { id: \\"l2\\", source: \\"l_intent\\", target: \\"l_schema\\" }, { id: \\"l3\\", source: \\"l_schema\\", target: \\"l_rules\\" }, { id: \\"l4\\", source: \\"l_rules\\", target: \\"l_resp\\" }, { id: \\"l5\\", source: \\"l_resp\\", target: \\"l_persist\\" }, ]; l_api: { title: \\"API\\", file: \\"api/controller/ConversationController.java\\", method: \\"message(...)\\", stage: \\"HTTP_ENTRY\\", summary: \\"Start turn.\\", session: [\\"incoming log text\\"], tables: [\\"none\\"] }, l_intent: { title: \\"Intent\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(...)\\", stage: \\"INTENT_RESOLVED\\", summary: \\"LOG_ANALYSIS selected.\\", session: [\\"intent=LOG_ANALYSIS\\"], tables: [\\"ce_intent (R)\\"] }, l_schema: { title: \\"Structured extraction\\", file: \\"engine/steps/SchemaExtractionStep.java\\", method: \\"execute(...)\\", stage: \\"SCHEMA_EVALUATED\\", summary: \\"Extracts errorCode/component/severity from text.\\", session: [\\"schemaJson built\\"], tables: [\\"ce_output_schema (R)\\"] }, l_rules: { title: \\"Schema-aware rule\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(...)\\", stage: \\"RULE_MATCH\\", summary: \\"Reads extracted schema via GET_SCHEMA_JSON.\\", session: [\\"state maybe ESCALATE\\"], tables: [\\"ce_rule (R)\\"] }, l_resp: { title: \\"Derived answer\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...)\\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Prompt template creates root-cause summary.\\", session: [\\"derived payload\\"], tables: [\\"ce_response (R)\\", \\"ce_prompt_template (R)\\"] }, l_persist: { title: \\"Persist\\", file: \\"engine/steps/PersistConversationStep.java\\", method: \\"execute(...)\\", stage: \\"CONVERSATION_PERSIST\\", summary: \\"Stores turn output.\\", session: [\\"state saved\\"], tables: [\\"ce_conversation (W)\\"] }, }; { id: \\"t_api\\", position: { x: 20, y: 60 }, data: { label: \\"API entry\\" } }, { id: \\"t_intent\\", position: { x: 260, y: 60 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"t_rules\\", position: { x: 500, y: 60 }, data: { label: \\"RulesStep (SET_TASK)\\" } }, { id: \\"t_task\\", position: { x: 740, y: 60 }, data: { label: \\"Consumer service call\\" } }, { id: \\"t_resp\\", position: { x: 260, y: 220 }, data: { label: \\"ResponseResolutionStep\\" } }, { id: \\"t_done\\", position: { x: 500, y: 220 }, data: { label: \\"Persist + output\\" } }, ]; { id: \\"t1\\", source: \\"t_api\\", target: \\"t_intent\\" }, { id: \\"t2\\", source: \\"t_intent\\", target: \\"t_rules\\" }, { id: \\"t3\\", source: \\"t_rules\\", target: \\"t_task\\" }, { id: \\"t4\\", source: \\"t_task\\", target: \\"t_resp\\" }, { id: \\"t5\\", source: \\"t_resp\\", target: \\"t_done\\" }, ]; t_api: { title: \\"API\\", file: \\"api/controller/ConversationController.java\\", method: \\"message(...)\\", stage: \\"HTTP_ENTRY\\", summary: \\"Request starts.\\", session: [\\"request id detected\\"], tables: [\\"none\\"] }, t_intent: { title: \\"Intent\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(...)\\", stage: \\"INTENT_RESOLVED\\", summary: \\"REQUEST_TRACKER resolved.\\", session: [\\"intent set\\"], tables: [\\"ce_intent (R)\\"] }, t_rules: { title: \\"Task assignment\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(...)\\", stage: \\"RULE_MATCH\\", summary: \\"SET_TASK marks downstream work.\\", session: [\\"task=TRACK_REQUEST_STATUS\\"], tables: [\\"ce_rule (R)\\"] }, t_task: { title: \\"Consumer callback\\", file: \\"consumer hook/service\\", method: \\"afterStep(...) or service call\\", stage: \\"TASK_EXECUTION\\", summary: \\"Consumer fetches tracker state from own system and injects context.\\", session: [\\"context.status/context.lastUpdated set\\"], tables: [\\"consumer DB/API\\"] }, t_resp: { title: \\"Final response\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...)\\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Builds tracker response from context.\\", session: [\\"payload text/json\\"], tables: [\\"ce_response (R)\\"] }, t_done: { title: \\"Persist\\", file: \\"engine/steps/PersistConversationStep.java\\", method: \\"execute(...)\\", stage: \\"CONVERSATION_PERSIST\\", summary: \\"Persists turn.\\", session: [\\"conversation updated\\"], tables: [\\"ce_conversation (W)\\"] }, }; { id: \\"r_api\\", position: { x: 20, y: 60 }, data: { label: \\"API entry\\" } }, { id: \\"r_load\\", position: { x: 260, y: 60 }, data: { label: \\"LoadOrCreateConversationStep\\" } }, { id: \\"r_reset\\", position: { x: 500, y: 60 }, data: { label: \\"ResetConversationStep\\" } }, { id: \\"r_audit\\", position: { x: 740, y: 60 }, data: { label: \\"CONVERSATION_RESET audit\\" } }, { id: \\"r_resp\\", position: { x: 260, y: 220 }, data: { label: \\"ResponseResolutionStep\\" } }, { id: \\"r_done\\", position: { x: 500, y: 220 }, data: { label: \\"PersistConversationStep\\" } }, ]; { id: \\"r1\\", source: \\"r_api\\", target: \\"r_load\\" }, { id: \\"r2\\", source: \\"r_load\\", target: \\"r_reset\\" }, { id: \\"r3\\", source: \\"r_reset\\", target: \\"r_audit\\" }, { id: \\"r4\\", source: \\"r_audit\\", target: \\"r_resp\\" }, { id: \\"r5\\", source: \\"r_resp\\", target: \\"r_done\\" }, ]; r_api: { title: \\"API\\", file: \\"api/controller/ConversationController.java\\", method: \\"message(...)\\", stage: \\"HTTP_ENTRY\\", summary: \\"Receives reset command.\\", session: [\\"message contains reset token\\"], tables: [\\"none\\"] }, r_load: { title: \\"Load\\", file: \\"engine/steps/LoadOrCreateConversationStep.java\\", method: \\"execute(...)\\", stage: \\"SESSION_REHYDRATE\\", summary: \\"Loads existing session state.\\", session: [\\"existing intent/state/context loaded\\"], tables: [\\"ce_conversation (R)\\"] }, r_reset: { title: \\"Reset\\", file: \\"engine/steps/ResetConversationStep.java\\", method: \\"execute(...)\\", stage: \\"CONVERSATION_RESET\\", summary: \\"Clears intent/state/context by configured reset command.\\", session: [\\"intent/state/context wiped\\"], tables: [\\"ce_config (R)\\", \\"ce_conversation (W)\\"] }, r_audit: { title: \\"Audit\\", file: \\"audit/DbAuditService.java\\", method: \\"audit(...)\\", stage: \\"CONVERSATION_RESET\\", summary: \\"Writes reset trace.\\", session: [\\"meta includes conversationId\\"], tables: [\\"ce_audit (W)\\"] }, r_resp: { title: \\"Reset response\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...)\\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Returns fresh-start message.\\", session: [\\"final payload\\"], tables: [\\"ce_response (R)\\"] }, r_done: { title: \\"Persist\\", file: \\"engine/steps/PersistConversationStep.java\\", method: \\"execute(...)\\", stage: \\"CONVERSATION_PERSIST\\", summary: \\"Saves empty baseline state.\\", session: [\\"new baseline saved\\"], tables: [\\"ce_conversation (W)\\"] }, }; # Real-world Examples (Debug Trace) ## Canonical Runtime Step Set <div className=\\"ce-step-badge-list\\" role=\\"list\\" aria-label=\\"Canonical runtime step set\\"> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">1</span><span className=\\"ce-step-badge-label\\">LoadOrCreateConversationStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">2</span><span className=\\"ce-step-badge-label\\">ResetConversationStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">3</span><span className=\\"ce-step-badge-label\\">PersistConversationBootstrapStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">4</span><span className=\\"ce-step-badge-label\\">AuditUserInputStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">5</span><span className=\\"ce-step-badge-label\\">PolicyEnforcementStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">6</span><span className=\\"ce-step-badge-label\\">IntentResolutionStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">7</span><span className=\\"ce-step-badge-label\\">ResetResolvedIntentStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">8</span><span className=\\"ce-step-badge-label\\">FallbackIntentStateStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">9</span><span className=\\"ce-step-badge-label\\">AddContainerDataStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">10</span><span className=\\"ce-step-badge-label\\">McpToolStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">11</span><span className=\\"ce-step-badge-label\\">SchemaExtractionStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">12</span><span className=\\"ce-step-badge-label\\">AutoAdvanceStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">13</span><span className=\\"ce-step-badge-label\\">RulesStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">14</span><span className=\\"ce-step-badge-label\\">ResponseResolutionStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">15</span><span className=\\"ce-step-badge-label\\">PersistConversationStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">16</span><span className=\\"ce-step-badge-label\\">PipelineEndGuardStep</span></div> </div> These examples zoom into relevant branches; conditional/system steps from the canonical set are omitted in each graph unless they materially affect that scenario. Each example has three tabs: - Conversation : chat + execution flow - DML Entries : starter rows for ce_intent , ce_prompt_template , ce_output_schema , ce_response - Audit Trail : stage-by-stage ce_audit view ## Example 1: FAQ <Tabs groupId=\\"ex-faq-tabs\\"> <TabItem value=\\"conversation\\" label=\\"Conversation\\" default> <Conversation title=\\"FAQ\\"> <User info={[\\"FAQ question turn.\\", \\"Expected QUESTION dialogue act.\\"]}>Can I move my connection within Zapper?</User> <Assistant tables={[\\"ce_intent\\", \\"ce_response\\"]} info={[\\"FAQ intent path selected.\\", \\"Exact/derived FAQ response emitted.\\"]}>Yes, you can request relocation from the support portal.</Assistant> </Conversation> <EngineDebugFlow title=\\"FAQ flow\\" subtitle=\\"Classifier-first deterministic path\\" nodes={faqNodes} edges={faqEdges} detailsById={faqDetails} defaultSelectedId=\\"faq_intent\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <CodeBlockToggle title=\\"FAQ scenario DML\\" language=\\"sql\\"> { insert into ce_intent(intent_code, enabled) values (\'FAQ\', true); insert into ce_prompt_template(intent_code, state_code, response_type, system_prompt, user_prompt, enabled) values (\'FAQ\', null, \'TEXT\', \'You are a support assistant.\', \'Answer FAQ clearly in one paragraph from user text: {{user_input}}\', true); insert into ce_output_schema(intent_code, state_code, schema_json, enabled) values (\'FAQ\', null, \'{\\"type\\":\\"object\\",\\"properties\\":{\\"question\\":{\\"type\\":\\"string\\"}}}\', true); insert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled) values (\'FAQ\', \'IDLE\', \'EXACT\', \'TEXT\', \'Yes, you can request relocation from the support portal.\', true); } </CodeBlockToggle> <DbTable title=\\"FAQ config rows preview\\" columns={[\\"Table\\", \\"Key values\\"]} rows={[ [\\"ce_intent\\", \\"intent_code=FAQ\\"], [\\"ce_prompt_template\\", \\"intent_code=FAQ, state_code=null, response_type=TEXT\\"], [\\"ce_output_schema\\", \\"intent_code=FAQ\\"], [\\"ce_response\\", \\"response_type=EXACT, output_format=TEXT\\"], ]} /> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"FAQ ce_audit trail\\" columns={[\\"Stage\\", \\"What happened\\"]} rows={[ [\\"USER_INPUT\\", \\"Incoming user message stored\\"], [\\"STEP_ENTER (IntentResolutionStep)\\", \\"Intent step starts\\"], [\\"INTENT_RESOLVED\\", \\"Classifier matched FAQ\\"], [\\"RULE_NO_MATCH\\", \\"No rule action\\"], [\\"ASSISTANT_OUTPUT\\", \\"Exact FAQ response selected\\"], [\\"STEP_EXIT (PersistConversationStep)\\", \\"Conversation persisted\\"], ]} /> <CodeBlockToggle title=\\"FAQ audit payload sample\\" language=\\"json\\"> { { \\"_meta\\": { \\"stage\\": \\"ASSISTANT_OUTPUT\\", \\"conversationId\\": \\"conv-faq-001\\", \\"intent\\": \\"FAQ\\", \\"state\\": \\"IDLE\\" }, \\"responseType\\": \\"EXACT\\", \\"outputFormat\\": \\"TEXT\\" } } </CodeBlockToggle> </TabItem> </Tabs> ## Example 2: DISCONNECT_ELECTRICITY <Tabs groupId=\\"ex-disconnect-tabs\\"> <TabItem value=\\"conversation\\" label=\\"Conversation\\" default> <Conversation title=\\"DISCONNECT_ELECTRICITY\\"> <User info={[\\"Disconnect intent request.\\", \\"Requires schema field collection.\\"]}>Disconnect electricity for account 10004567.</User> <Assistant tables={[\\"ce_output_schema\\", \\"ce_prompt_template\\"]} info={[\\"Schema incomplete branch.\\", \\"Assistant asks for missing fields.\\"]}>Please share disconnect date and reason.</Assistant> <User info={[\\"Provides required fields.\\", \\"Schema should complete and unlock next step.\\"]}>Date is 2026-03-31, reason moving out.</User> <Assistant tables={[\\"ce_rule\\", \\"ce_response\\"]} info={[\\"State transition applied.\\", \\"Final completion response returned.\\"]}>Done, request submitted.</Assistant> </Conversation> <EngineDebugFlow title=\\"Disconnect flow\\" subtitle=\\"Multi-turn schema completion and intent lock/unlock\\" nodes={disconnectNodes} edges={disconnectEdges} detailsById={disconnectDetails} defaultSelectedId=\\"d_schema\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <CodeBlockToggle title=\\"DISCONNECT_ELECTRICITY scenario DML\\" language=\\"sql\\"> { insert into ce_intent(intent_code, enabled) values (\'DISCONNECT_ELECTRICITY\', true); insert into ce_prompt_template(intent_code, state_code, response_type, system_prompt, user_prompt, enabled) values (\'DISCONNECT_ELECTRICITY\', \'COLLECT_REQUIRED\', \'TEXT\', \'Collect missing disconnect fields.\', \'If required fields are missing, ask only for missing values. User: {{user_input}}\', true); insert into ce_output_schema(intent_code, state_code, schema_json, enabled) values (\'DISCONNECT_ELECTRICITY\', \'COLLECT_REQUIRED\', \'{\\"type\\":\\"object\\",\\"properties\\":{\\"accountId\\":{\\"type\\":\\"string\\"},\\"disconnectDate\\":{\\"type\\":\\"string\\"},\\"reason\\":{\\"type\\":\\"string\\"}},\\"required\\":[\\"accountId\\",\\"disconnectDate\\",\\"reason\\"]}\', true); insert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled) values (\'DISCONNECT_ELECTRICITY\', \'COLLECT_REQUIRED\', \'DERIVED\', \'TEXT\', null, true); } </CodeBlockToggle> <DbTable title=\\"DISCONNECT_ELECTRICITY config rows preview\\" columns={[\\"Table\\", \\"Key values\\"]} rows={[ [\\"ce_intent\\", \\"intent_code=DISCONNECT_ELECTRICITY\\"], [\\"ce_prompt_template\\", \\"intent_code=DISCONNECT_ELECTRICITY, state_code=COLLECT_REQUIRED\\"], [\\"ce_output_schema\\", \\"required=accountId,disconnectDate,reason\\"], [\\"ce_response\\", \\"response_type=DERIVED\\"], ]} /> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"DISCONNECT_ELECTRICITY ce_audit trail\\" columns={[\\"Stage\\", \\"What happened\\"]} rows={[ [\\"INTENT_RESOLVED\\", \\"Intent set to DISCONNECT_ELECTRICITY\\"], [\\"SCHEMA_EVALUATED\\", \\"accountId extracted, fields missing\\"], [\\"SCHEMA_INCOMPLETE\\", \\"Intent lock enabled\\"], [\\"ASSISTANT_OUTPUT\\", \\"Follow-up question asked\\"], [\\"SCHEMA_COMPLETE\\", \\"All required fields merged\\"], [\\"RULE_MATCH\\", \\"SET_STATE/SET_TASK applied\\"], [\\"ASSISTANT_OUTPUT\\", \\"Final confirmation response\\"], ]} /> <CodeBlockToggle title=\\"Schema incomplete audit payload sample\\" language=\\"json\\"> { { \\"_meta\\": { \\"stage\\": \\"SCHEMA_INCOMPLETE\\", \\"conversationId\\": \\"conv-disconnect-001\\", \\"intent\\": \\"DISCONNECT_ELECTRICITY\\" }, \\"missingFields\\": [\\"disconnectDate\\", \\"reason\\"], \\"locked\\": true } } </CodeBlockToggle> </TabItem> </Tabs> ## Example 3: LOG_ANALYSIS <Tabs groupId=\\"ex-log-tabs\\"> <TabItem value=\\"conversation\\" label=\\"Conversation\\" default> <Conversation title=\\"LOG_ANALYSIS\\"> <User info={[\\"Root-cause analysis request.\\", \\"Intent maps to LOG_ANALYSIS.\\"]}>Analyze this stack trace and tell root cause.</User> <Assistant tables={[\\"ce_prompt_template\\", \\"ce_response\\"]} info={[\\"Derived analysis response.\\", \\"Assistant suggests likely cause and remediation.\\"]}>Likely connection pool exhaustion; tune pool and reduce long transactions.</Assistant> </Conversation> <EngineDebugFlow title=\\"Log analysis flow\\" subtitle=\\"Schema extraction + GET_SCHEMA_JSON rule + derived response\\" nodes={logNodes} edges={logEdges} detailsById={logDetails} defaultSelectedId=\\"l_schema\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <CodeBlockToggle title=\\"LOG_ANALYSIS scenario DML\\" language=\\"sql\\"> { insert into ce_intent(intent_code, enabled) values (\'LOG_ANALYSIS\', true); insert into ce_prompt_template(intent_code, state_code, response_type, system_prompt, user_prompt, enabled) values (\'LOG_ANALYSIS\', \'ANALYZE\', \'TEXT\', \'Generate root-cause analysis from extracted fields.\', \'Use extracted severity/component/errorCode and explain cause + fix in bullets.\', true); insert into ce_output_schema(intent_code, state_code, schema_json, enabled) values (\'LOG_ANALYSIS\', \'ANALYZE\', \'{\\"type\\":\\"object\\",\\"properties\\":{\\"errorCode\\":{\\"type\\":\\"string\\"},\\"component\\":{\\"type\\":\\"string\\"},\\"severity\\":{\\"type\\":\\"string\\"}}}\', true); insert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled) values (\'LOG_ANALYSIS\', \'ANALYZE\', \'DERIVED\', \'TEXT\', null, true); } </CodeBlockToggle> <DbTable title=\\"LOG_ANALYSIS config rows preview\\" columns={[\\"Table\\", \\"Key values\\"]} rows={[ [\\"ce_intent\\", \\"intent_code=LOG_ANALYSIS\\"], [\\"ce_prompt_template\\", \\"intent_code=LOG_ANALYSIS, state_code=ANALYZE\\"], [\\"ce_output_schema\\", \\"properties=errorCode,component,severity\\"], [\\"ce_response\\", \\"response_type=DERIVED\\"], ]} /> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"LOG_ANALYSIS ce_audit trail\\" columns={[\\"Stage\\", \\"What happened\\"]} rows={[ [\\"INTENT_RESOLVED\\", \\"Intent set to LOG_ANALYSIS\\"], [\\"SCHEMA_EVALUATED\\", \\"errorCode/component/severity extracted\\"], [\\"RULE_MATCH\\", \\"GET_SCHEMA_JSON branch triggered\\"], [\\"ASSISTANT_OUTPUT\\", \\"Derived explanation generated\\"], [\\"CONVERSATION_PERSIST\\", \\"Final payload persisted\\"], ]} /> </TabItem> </Tabs> ## Example 4: REQUEST_TRACKER <Tabs groupId=\\"ex-tracker-tabs\\"> <TabItem value=\\"conversation\\" label=\\"Conversation\\" default> <Conversation title=\\"REQUEST_TRACKER\\"> <User info={[\\"Tracker request with request ID.\\", \\"Task/rule pipeline expected.\\"]}>Track request REQ-99123</User> <Assistant tables={[\\"ce_rule\\", \\"ce_response\\"]} info={[\\"Tracker state fetched.\\", \\"Status rendered to user.\\"]}>REQ-99123 is APPROVAL_PENDING since 2026-02-10.</Assistant> </Conversation> <EngineDebugFlow title=\\"Tracker flow\\" subtitle=\\"SET_TASK driven consumer integration path\\" nodes={trackerNodes} edges={trackerEdges} detailsById={trackerDetails} defaultSelectedId=\\"t_rules\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <CodeBlockToggle title=\\"REQUEST_TRACKER scenario DML\\" language=\\"sql\\"> { insert into ce_intent(intent_code, enabled) values (\'REQUEST_TRACKER\', true); insert into ce_prompt_template(intent_code, state_code, response_type, system_prompt, user_prompt, enabled) values (\'REQUEST_TRACKER\', \'LOOKUP\', \'TEXT\', \'Render request tracker status from context.\', \'Respond with requestId, status and lastUpdated.\', true); insert into ce_output_schema(intent_code, state_code, schema_json, enabled) values (\'REQUEST_TRACKER\', \'LOOKUP\', \'{\\"type\\":\\"object\\",\\"properties\\":{\\"requestId\\":{\\"type\\":\\"string\\"}}}\', true); insert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled) values (\'REQUEST_TRACKER\', \'LOOKUP\', \'DERIVED\', \'TEXT\', null, true); } </CodeBlockToggle> <DbTable title=\\"REQUEST_TRACKER config rows preview\\" columns={[\\"Table\\", \\"Key values\\"]} rows={[ [\\"ce_intent\\", \\"intent_code=REQUEST_TRACKER\\"], [\\"ce_prompt_template\\", \\"intent_code=REQUEST_TRACKER, state_code=LOOKUP\\"], [\\"ce_output_schema\\", \\"property=requestId\\"], [\\"ce_response\\", \\"response_type=DERIVED\\"], ]} /> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"REQUEST_TRACKER ce_audit trail\\" columns={[\\"Stage\\", \\"What happened\\"]} rows={[ [\\"INTENT_RESOLVED\\", \\"Intent set to REQUEST_TRACKER\\"], [\\"RULE_MATCH\\", \\"SET_TASK=TRACK_REQUEST_STATUS\\"], [\\"TASK_EXECUTION\\", \\"Consumer service injected context\\"], [\\"ASSISTANT_OUTPUT\\", \\"Tracker response built\\"], [\\"CONVERSATION_PERSIST\\", \\"Payload and state persisted\\"], ]} /> </TabItem> </Tabs> ## Example 5: RESET_SESSION <Tabs groupId=\\"ex-reset-tabs\\"> <TabItem value=\\"conversation\\" label=\\"Conversation\\" default> <Conversation title=\\"RESET_SESSION\\"> <User info={[\\"Explicit reset command.\\", \\"ResetConversationStep should trigger.\\"]}>RESET_SESSION</User> <Assistant tables={[\\"ce_config\\", \\"ce_conversation\\"]} info={[\\"Session context cleared.\\", \\"Assistant confirms reset completion.\\"]}>Session reset complete. Starting fresh.</Assistant> </Conversation> <EngineDebugFlow title=\\"Reset flow\\" subtitle=\\"Config-driven reset command through ResetConversationStep\\" nodes={resetNodes} edges={resetEdges} detailsById={resetDetails} defaultSelectedId=\\"r_reset\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <CodeBlockToggle title=\\"RESET_SESSION scenario DML\\" language=\\"sql\\"> { insert into ce_intent(intent_code, enabled) values (\'RESET_SESSION\', true); insert into ce_prompt_template(intent_code, state_code, response_type, system_prompt, user_prompt, enabled) values (\'RESET_SESSION\', \'IDLE\', \'TEXT\', \'Confirm reset and ask next request.\', \'User issued reset. Confirm reset and ask how to help next.\', true); insert into ce_output_schema(intent_code, state_code, schema_json, enabled) values (\'RESET_SESSION\', \'IDLE\', \'{\\"type\\":\\"object\\",\\"properties\\":{}}\', true); insert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled) values (\'RESET_SESSION\', \'IDLE\', \'EXACT\', \'TEXT\', \'Session reset complete. Starting fresh.\', true); } </CodeBlockToggle> <DbTable title=\\"RESET_SESSION config rows preview\\" columns={[\\"Table\\", \\"Key values\\"]} rows={[ [\\"ce_intent\\", \\"intent_code=RESET_SESSION\\"], [\\"ce_prompt_template\\", \\"intent_code=RESET_SESSION, state_code=IDLE\\"], [\\"ce_output_schema\\", \\"empty schema object\\"], [\\"ce_response\\", \\"response_type=EXACT\\"], ]} /> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"RESET_SESSION ce_audit trail\\" columns={[\\"Stage\\", \\"What happened\\"]} rows={[ [\\"SESSION_REHYDRATE\\", \\"Existing conversation loaded\\"], [\\"CONVERSATION_RESET\\", \\"Intent/state/context wiped\\"], [\\"STEP_EXIT (ResetConversationStep)\\", \\"Reset step completed\\"], [\\"ASSISTANT_OUTPUT\\", \\"Reset confirmation emitted\\"], [\\"CONVERSATION_PERSIST\\", \\"Baseline state saved\\"], ]} /> </TabItem> </Tabs> <Highlight type=\\"tip\\" title=\\"Intervention points\\"> For extraction customization hook <MethodRef>EngineStep.Name.SchemaExtractionStep</MethodRef>. For final output normalization use <MethodRef>ResponseTransformer</MethodRef>. </Highlight>","excerpt":", data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , , ]; faq_api: , faq_engine: , faq_pipeline: , faq_intent: , faq_rules: , faq_response: , faq_persist: , }; , data: }, , data: }, ,\u2026"},{"id":"deep-dive/failure-gotchas.mdx","version":"v1","title":"failure gotchas","permalink":"/docs/v1/deep-dive/failure-gotchas","content":"Data Correctness Gotchas This page documents where ConvEngine can produce incorrect, stale, or misleading output without necessarily crashing. It also lists framework constraints and a concrete roadmap to make the system safer, easier to operate, and more scalable. High risk improper data scenarios Additional correctness traps Framework limitations (current behavior) Improvement roadmap Phase 1: Correctness hardening (highest priority) Phase 2: Convenience and developer experience Phase 3: Scalability and throughput Confirmed from repository code: state overrides from JSON output, sticky intent skip behavior, rule pass mutation loops, context merge semantics, broad prompt var exposure, no optimistic lock field on conversation entity, and findAll() hot path scans. Inferred (consumer dependent): ingress concurrency controls, infra level ordering guarantees, and custom LlmClient timeout/retry strategy.","rawContent":"# Data Correctness Gotchas This page documents where ConvEngine can produce **incorrect, stale, or misleading output** without necessarily crashing. It also lists framework constraints and a concrete roadmap to make the system safer, easier to operate, and more scalable. ## High-risk improper data scenarios <DbTable title=\\"Top correctness failure modes\\" columns={[ \\"Gotcha\\", \\"Trigger\\", \\"Bad output pattern\\", \\"Fast detection\\", \\"Practical mitigation\\" ]} rows={[ [ \\"LLM JSON overrides engine intent/state\\", \\"Response JSON includes intent or state ; resolver applies those fields directly.\\", \\"Flow silently jumps to wrong state/intent on next turn.\\", \\"Compare pre/post state around RESOLVE_RESPONSE_LLM_OUTPUT and final persisted conversation row.\\", \\"Allowlist transitions, reject unknown states, and gate model-driven state changes behind validator hooks.\\" ], [ \\"Sticky intent routes new question to old flow\\", \\" STICKY_INTENT=true + active incomplete schema collection + no explicit switch/reset signal.\\", \\"User asks new intent but gets response from previous intent templates/rules.\\", \\"Frequent INTENT_RESOLVE_SKIPPED_STICKY_INTENT on semantically new user text.\\", \\"Force re-resolve on low confidence turns, topic-shift heuristics, and explicit UI switch-intent controls.\\" ], [ \\"Rule chain side effects create wrong final state\\", \\"Multiple matching rules mutate intent/state across passes.\\", \\"Technically valid response, semantically wrong transition path.\\", \\"Inspect ordered RULE_MATCH / RULE_NO_MATCH events by pass and phase.\\", \\"Constrain rule ownership, cap cross-intent actions, and add collision regression tests for rule priority.\\" ], [ \\"Context merge preserves stale fields\\", \\"Schema extraction merges partial JSON into existing context and does not clear incompatible prior fields.\\", \\"Old values leak into later prompts and responses.\\", \\"Diff context pre/post schema extraction and check unchanged keys across intent/state changes.\\", \\"Add per-intent field reset policy and explicit stale-key eviction on transition boundaries.\\" ], [ \\"Concurrent writes race on same conversation\\", \\"Parallel requests share same conversationId with no optimistic version check.\\", \\"Last-write-wins overwrites can produce drifted context/intent/state.\\", \\"Look for overlapping timestamps and contradictory stage order for one conversation.\\", \\"Serialize by conversation key at API boundary or add optimistic locking ( @Version ).\\" ] ]} /> ## Additional correctness traps <DbTable title=\\"Less obvious but important\\" columns={[\\"Area\\", \\"What happens\\", \\"Why it matters\\", \\"Recommended guardrail\\"]} rows={[ [ \\"Prompt variable exposure\\", \\"All inputParams are exposed as prompt vars ( promptTemplateVars path).\\", \\"Unexpected/sensitive params can influence model behavior or leak into prompts.\\", \\"Move to explicit allowlist of exposable keys and redact secret-like fields.\\" ], [ \\"LLM invocation ThreadLocal lifecycle\\", \\" LlmInvocationContext.set(...) is used in several flows without matching clear in same path.\\", \\"Pooled-thread reuse can cause wrong attribution/context bleed in custom LlmClient logging.\\", \\"Wrap set/clear in try/finally in every LLM call site.\\" ], [ \\"Silent exception swallowing\\", \\"Several context/container merge failures are ignored to keep pipeline running.\\", \\"Turn completes with partial enrichment, giving plausible but incorrect output.\\", \\"Emit warning stages with structured reason and defaulted fields when fallback path is taken.\\" ], [ \\"History reconstruction quality\\", \\"Conversation history is reconstructed from audit stages (not canonical turn table).\\", \\"Missing or filtered audit events can distort LLM context history.\\", \\"Persist normalized user/assistant turn table and use that as primary history source.\\" ], [ \\"MCP tool safety assumptions\\", \\" safe_mode exists on DB tool config but execution path does not enforce separate safe-mode logic.\\", \\"Risk of over-trusting tool configuration for sensitive data queries.\\", \\"Enforce explicit read-only policy, SQL allowlist checks, and per-tool security policy validation.\\" ] ]} /> ## Framework limitations (current behavior) <DbTable title=\\"Design constraints to plan around\\" columns={[\\"Limitation\\", \\"Current behavior\\", \\"Consumer impact\\", \\"Better direction\\"]} rows={[ [ \\"No full-turn ACID boundary\\", \\"Turn state is updated across multiple independent saves/steps.\\", \\"Partial turn artifacts can persist after mid-pipeline failures.\\", \\"Introduce transactional turn boundary or compensating state machine.\\" ], [ \\"No built-in optimistic concurrency for conversation row\\", \\" ce_conversation entity has no versioned conflict detection.\\", \\"Racing requests overwrite each other nondeterministically.\\", \\"Add version column + conflict retry/merge strategy.\\" ], [ \\"Heavy dynamic config with mixed refresh model\\", \\"Some configs are read at startup; others queried per turn from DB.\\", \\"Operational behavior can be hard to reason about after config updates.\\", \\"Document refresh semantics per config and add explicit reload controls.\\" ], [ \\"In-memory scan selection paths\\", \\" findAll().stream() used in response/template/schema selection in hot path.\\", \\"Larger config tables increase latency and raise variability.\\", \\"Replace with indexed targeted queries + bounded caches.\\" ], [ \\"Single-process assumptions for ordering\\", \\"Conversation ordering and mutation safety are mostly local-process concerns.\\", \\"Horizontal scale can amplify race and ordering ambiguity.\\", \\"Adopt distributed per-conversation lock/queue semantics.\\" ] ]} /> ## Improvement roadmap ### Phase 1: Correctness hardening (highest priority) <DbTable title=\\"Immediate improvements\\" columns={[\\"Change\\", \\"Value\\", \\"Effort\\", \\"Notes\\"]} rows={[ [ \\"Add response state-transition validator\\", \\"Prevents invalid model-driven intent/state jumps.\\", \\"Low-Medium\\", \\"Apply before PersistConversationStep ; reject or quarantine invalid transitions.\\" ], [ \\"Add optimistic locking on ce_conversation \\", \\"Eliminates silent last-write-wins corruption.\\", \\"Medium\\", \\"Introduce version field + retry policy for conflict cases.\\" ], [ \\"Guarantee LlmInvocationContext.clear() \\", \\"Prevents cross-request attribution bleed.\\", \\"Low\\", \\"Wrap all LLM call sites with try/finally .\\" ], [ \\"Prompt-var allowlist + redaction\\", \\"Reduces prompt contamination and secret leakage risk.\\", \\"Low-Medium\\", \\"Replace current expose-all behavior with explicit allowlist.\\" ], [ \\"Emit structured fallback warnings\\", \\"Makes silent degradations diagnosable.\\", \\"Low\\", \\"When a catch-ignore path is hit, emit a dedicated stage with cause metadata.\\" ] ]} /> ### Phase 2: Convenience and developer experience <DbTable title=\\"Make ConvEngine easier to run\\" columns={[\\"Enhancement\\", \\"Why it helps\\", \\"Suggested shape\\"]} rows={[ [ \\"Config lint + dry-run validator\\", \\"Catches broken rules/templates before production impact.\\", \\"CLI/admin endpoint validating response mappings, rule loops, unresolved template vars, and MCP tool safety.\\" ], [ \\"State transition map visualization\\", \\"Helps teams reason about intent/state flows and side effects.\\", \\"Generate graph from rules + responses + schema transitions with dead-end and collision markers.\\" ], [ \\"Deterministic replay mode\\", \\"Simplifies debugging wrong-output incidents.\\", \\"Replay one conversation against snapshot config and compare expected vs actual transitions.\\" ], [ \\"Scenario test harness\\", \\"Moves quality from ad-hoc manual checks to repeatable tests.\\", \\"YAML/JSON test fixtures for input turn sequences, expected intent/state, payload assertions.\\" ] ]} /> ### Phase 3: Scalability and throughput <DbTable title=\\"Scale safely\\" columns={[\\"Scalability upgrade\\", \\"Benefit\\", \\"Implementation direction\\"]} rows={[ [ \\"Targeted repository queries\\", \\"Cuts CPU and DB transfer overhead in hot path.\\", \\"Replace findAll().stream() with indexed query methods for intent/state/priority.\\" ], [ \\"Hot config cache with version invalidation\\", \\"Stabilizes latency under high QPS.\\", \\"Cache rules/templates/schemas per intent-state; invalidate on config change event.\\" ], [ \\"Per-conversation serialized execution\\", \\"Removes race conditions while scaling horizontally.\\", \\"Route by conversation key to queue/partition; process one active turn per key.\\" ], [ \\"Async/parallelizable non-critical enrichments\\", \\"Reduces end-to-end response time.\\", \\"Move optional container/MCP enrichments off critical path with explicit timeout budget.\\" ], [ \\"Canonical turn store\\", \\"Improves history quality and replay reliability.\\", \\"Persist normalized user/assistant turns instead of reconstructing from audit stream.\\" ] ]} /> <Highlight type=\\"info\\" title=\\"Confirmed vs inferred\\"> Confirmed from repository code: state overrides from JSON output, sticky-intent skip behavior, rule pass mutation loops, context merge semantics, broad prompt-var exposure, no optimistic lock field on conversation entity, and findAll() hot-path scans. Inferred (consumer-dependent): ingress concurrency controls, infra-level ordering guarantees, and custom LlmClient timeout/retry strategy. </Highlight>","excerpt":"Data Correctness Gotchas This page documents where ConvEngine can produce incorrect, stale, or misleading output without necessarily crashing. It also lists framework constraints and a concrete roadmap to make the system\u2026"},{"id":"deep-dive/file-map.mdx","version":"v1","title":"file map","permalink":"/docs/v1/deep-dive/file-map","content":"File Map (by responsibility)","rawContent":"# File Map (by responsibility) <DbTable title=\\"API\\" columns={[\\"Class\\", \\"Path\\", \\"Responsibility\\"]} rows={[ [\\"ConversationController\\", \\"api/controller/ConversationController.java\\", \\"Main request/audit endpoints\\"], [\\"ExperimentalController\\", \\"api/controller/ExperimentalController.java\\", \\"Experimental SQL generation endpoint\\"], [\\"ConversationRequest/Response\\", \\"api/dto/*\\", \\"REST contracts\\"], ]} /> <DbTable title=\\"Engine Core\\" columns={[\\"Class\\", \\"Path\\", \\"Responsibility\\"]} rows={[ [\\"DefaultConversationalEngine\\", \\"engine/provider/DefaultConversationalEngine.java\\", \\"Entry point to pipeline\\"], [\\"EnginePipelineFactory\\", \\"engine/factory/EnginePipelineFactory.java\\", \\"Step DAG ordering + wrappers\\"], [\\"EnginePipeline\\", \\"engine/pipeline/EnginePipeline.java\\", \\"Step loop execution\\"], [\\"EngineSession\\", \\"engine/session/EngineSession.java\\", \\"Mutable turn state\\"], ]} /> <DbTable title=\\"Intent + Schema\\" columns={[\\"Class\\", \\"Path\\", \\"Responsibility\\"]} rows={[ [\\"CompositeIntentResolver\\", \\"intent/CompositeIntentResolver.java\\", \\"Classifier + agent arbitration\\"], [\\"AgentIntentResolver\\", \\"intent/AgentIntentResolver.java\\", \\"LLM-based intent scoring\\"], [\\"SchemaExtractionStep\\", \\"engine/steps/SchemaExtractionStep.java\\", \\"Structured extraction + lock handling\\"], ]} /> <DbTable title=\\"Rules + Response\\" columns={[\\"Class\\", \\"Path\\", \\"Responsibility\\"]} rows={[ [\\"RulesStep\\", \\"engine/steps/RulesStep.java\\", \\"Rule passes + action dispatch\\"], [\\"ResponseResolutionStep\\", \\"engine/steps/ResponseResolutionStep.java\\", \\"ce_response selection + payload build\\"], [\\"TextOutputFormatResolver\\", \\"engine/response/format/provider/TextOutputFormatResolver.java\\", \\"Derived text generation\\"], [\\"JsonOutputFormatResolver\\", \\"engine/response/format/provider/JsonOutputFormatResolver.java\\", \\"Derived json generation\\"], ]} /> <DbTable title=\\"MCP + Audit\\" columns={[\\"Class\\", \\"Path\\", \\"Responsibility\\"]} rows={[ [\\"McpToolStep\\", \\"engine/steps/McpToolStep.java\\", \\"Planner-tool loop\\"], [\\"McpPlanner\\", \\"engine/mcp/McpPlanner.java\\", \\"LLM decision CALL_TOOL/ANSWER\\"], [\\"DbAuditService\\", \\"audit/DbAuditService.java\\", \\"Audit persistence + metadata\\"], [\\"AuditTraceService\\", \\"audit/AuditTraceService.java\\", \\"Step timeline projection\\"], ]} />","excerpt":"File Map (by responsibility)"},{"id":"deep-dive/improvement-backlog.mdx","version":"v1","title":"improvement backlog","permalink":"/docs/v1/deep-dive/improvement-backlog","content":"Improvement Backlog This page turns the correctness and scalability recommendations into implementation ready work items. Use it as the execution plan after reading Data Correctness Gotchas . Phase 1: Correctness critical tickets Phase 2: Operability and convenience tickets Phase 3: Scalability tickets 90% in steady state without stale config incidents.\\", \\"M L\\" ], [ \\"CE 012: Per conversation execution serialization\\", \\"Concurrent turns create races as scale increases.\\", \\"Route requests by conversation key to single active worker/partition.\\", \\"No race induced state drift in concurrency stress tests.\\", \\"L\\" ], [ \\"CE 013: Canonical turn store\\", \\"History reconstructed from audit can be incomplete/noisy.\\", \\"Persist normalized user/assistant turns and switch history provider to it.\\", \\"History quality checks pass even when audit levels change.\\", \\"M L\\" ], [ \\"CE 014: Bounded enrichment budgets\\", \\"Optional enrichments can inflate synchronous latency.\\", \\"Apply strict timeout budget for container/MCP enrichments and degrade gracefully.\\", \\"SLO maintained under downstream slowdown with deterministic fallback behavior.\\", \\"M\\" ] ]} / Recommended rollout order 1. CE 003 and CE 001 first (cheap/high impact correctness guards). 2. CE 002 before any high concurrency scale work. 3. CE 004 and CE 005 before prompt/template expansion. 4. CE 006 + CE 008 to stop regressions while refactoring. 5. CE 010 and CE 011 to stabilize throughput. 6. CE 012 for horizontal scale and race elimination. 7. CE 013 and CE 014 for long term quality and latency control. Done criteria for the program Treat each ticket as a tracked ADR backed change. For every ticket: define owner, rollout guardrails, migration/rollback plan, and evidence artifact (test report or benchmark).","rawContent":"# Improvement Backlog This page turns the correctness and scalability recommendations into implementation-ready work items. Use it as the execution plan after reading Data Correctness Gotchas . ## Phase 1: Correctness-critical tickets <DbTable title=\\"P0/P1 backlog\\" columns={[\\"Ticket\\", \\"Problem\\", \\"Implementation\\", \\"Acceptance criteria\\", \\"Effort\\"]} rows={[ [ \\"CE-001: State transition guard\\", \\"Model output can force invalid intent/state jumps.\\", \\"Add transition validator before final persistence; block or quarantine disallowed transitions.\\", \\"Invalid transitions never persist; blocked transitions produce explicit error stage and fallback response.\\", \\"M\\" ], [ \\"CE-002: Conversation optimistic locking\\", \\"Concurrent same-conversation writes produce last-write-wins corruption.\\", \\"Add version column and optimistic lock handling on conversation updates.\\", \\"Conflicting parallel updates produce deterministic conflict behavior (retry or fail with known code).\\", \\"M\\" ], [ \\"CE-003: LLM context lifecycle safety\\", \\"ThreadLocal LLM context can leak across pooled threads if not cleared.\\", \\"Wrap every LlmInvocationContext.set(...) in try/finally + clear() .\\", \\"No stale context observed under stress test with mixed conversation IDs.\\", \\"S\\" ], [ \\"CE-004: Prompt variable allowlist\\", \\"All input params are currently exposable to prompt rendering.\\", \\"Introduce allowlist + redaction for sensitive/unexpected keys.\\", \\"Only approved prompt keys appear in rendered prompt payloads.\\", \\"M\\" ], [ \\"CE-005: Stale context eviction rules\\", \\"Partial schema merges can keep incompatible old fields.\\", \\"Add per-intent/state field-retention policy and evict on transitions.\\", \\"Transition tests show old incompatible fields are removed deterministically.\\", \\"M\\" ] ]} /> ## Phase 2: Operability and convenience tickets <DbTable title=\\"Developer and operator UX\\" columns={[\\"Ticket\\", \\"Problem\\", \\"Implementation\\", \\"Acceptance criteria\\", \\"Effort\\"]} rows={[ [ \\"CE-006: Config lint and dry-run\\", \\"Broken rules/prompts are discovered too late.\\", \\"Add validator command/endpoint for response mapping coverage, unresolved vars, rule loops, MCP safety checks.\\", \\"Invalid config sets fail lint in CI and are blocked from promotion.\\", \\"M\\" ], [ \\"CE-007: Deterministic replay tool\\", \\"Wrong-output incidents are hard to reproduce.\\", \\"Replay conversation turns against frozen config snapshot and compare expected vs actual transitions.\\", \\"At least one production incident can be replayed locally with identical state progression.\\", \\"M-L\\" ], [ \\"CE-008: Scenario test harness\\", \\"Manual QA misses edge-path regressions.\\", \\"Add fixture-driven conversation tests (turn sequence + expected intent/state/output assertions).\\", \\"Regression suite catches known sticky-intent, rule-collision, and reset-flow bugs.\\", \\"M\\" ], [ \\"CE-009: Transition map generator\\", \\"State machine behavior is opaque to integrators.\\", \\"Generate graph from rules/responses/schema transitions with dead-end warnings.\\", \\"Docs include generated transition map and dead-end detection report.\\", \\"S-M\\" ] ]} /> ## Phase 3: Scalability tickets <DbTable title=\\"Throughput and horizontal scale\\" columns={[\\"Ticket\\", \\"Problem\\", \\"Implementation\\", \\"Acceptance criteria\\", \\"Effort\\"]} rows={[ [ \\"CE-010: Hot-path query refactor\\", \\" findAll().stream() in request path degrades with config size.\\", \\"Replace with indexed query methods for response/template/schema selection.\\", \\"P95 latency remains stable when control-plane rows scale 10x.\\", \\"M\\" ], [ \\"CE-011: Config cache with version invalidation\\", \\"Repeated config reads increase latency variability.\\", \\"Add cache per intent/state with invalidation on config mutation.\\", \\"Cache hit ratio > 90% in steady state without stale-config incidents.\\", \\"M-L\\" ], [ \\"CE-012: Per-conversation execution serialization\\", \\"Concurrent turns create races as scale increases.\\", \\"Route requests by conversation key to single active worker/partition.\\", \\"No race-induced state drift in concurrency stress tests.\\", \\"L\\" ], [ \\"CE-013: Canonical turn store\\", \\"History reconstructed from audit can be incomplete/noisy.\\", \\"Persist normalized user/assistant turns and switch history provider to it.\\", \\"History quality checks pass even when audit levels change.\\", \\"M-L\\" ], [ \\"CE-014: Bounded enrichment budgets\\", \\"Optional enrichments can inflate synchronous latency.\\", \\"Apply strict timeout budget for container/MCP enrichments and degrade gracefully.\\", \\"SLO maintained under downstream slowdown with deterministic fallback behavior.\\", \\"M\\" ] ]} /> ## Recommended rollout order 1. CE-003 and CE-001 first (cheap/high impact correctness guards). 2. CE-002 before any high-concurrency scale work. 3. CE-004 and CE-005 before prompt/template expansion. 4. CE-006 + CE-008 to stop regressions while refactoring. 5. CE-010 and CE-011 to stabilize throughput. 6. CE-012 for horizontal scale and race elimination. 7. CE-013 and CE-014 for long-term quality and latency control. ## Done criteria for the program <DbTable title=\\"Exit gates\\" columns={[\\"Gate\\", \\"Target\\"]} rows={[ [\\"Correctness\\", \\"No illegal transition persistence in test suite + canary runtime.\\"], [\\"Concurrency\\", \\"No race-induced state drift under parallel same-conversation load tests.\\"], [\\"Security\\", \\"Prompt exposure allowlist and MCP safety policy enforcement enabled by default.\\"], [\\"Scalability\\", \\"Stable p95/p99 under 10x config growth and peak expected QPS.\\"], [\\"Operability\\", \\"Config lint, replay, and scenario tests integrated into release workflow.\\"] ]} /> <Highlight type=\\"success\\" title=\\"How to use this backlog\\"> Treat each ticket as a tracked ADR-backed change. For every ticket: define owner, rollout guardrails, migration/rollback plan, and evidence artifact (test report or benchmark). </Highlight>","excerpt":"Improvement Backlog This page turns the correctness and scalability recommendations into implementation ready work items. Use it as the execution plan after reading Data Correctness Gotchas . Phase 1: Correctness critica\u2026"},{"id":"deep-dive/index.mdx","version":"v1","title":"index","permalink":"/docs/v1/deep-dive","content":"Overview This is the file level wiki for how request control actually moves through ConvEngine. Read this section when you need to debug why a turn changed state unexpectedly a template variable was unresolved MCP produced wrong tool call intent switched during schema collection response mapping selection looks wrong Recommended read order 1. 2. 3. 4. 5. 6. 7. 8. Keep one real conversationId open in /audit/ while reading this section. Follow each stage and compare with the file level explanation.","rawContent":"# Overview This is the file-level wiki for how request control actually moves through ConvEngine. ## Read this section when - you need to debug why a turn changed state unexpectedly - a template variable was unresolved - MCP produced wrong tool call - intent switched during schema collection - response mapping selection looks wrong ## Recommended read order 1. [File Map](/docs/v1/deep-dive/file-map) 2. [Request Lifecycle](/docs/v1/deep-dive/request-lifecycle) 3. [Pipeline Steps](/docs/v1/deep-dive/pipeline-steps) 4. [Intent & Schema](/docs/v1/deep-dive/intent-and-schema) 5. [Rules & Responses](/docs/v1/deep-dive/rules-responses) 6. [MCP & Audit](/docs/v1/deep-dive/mcp-audit) 7. [Data Correctness Gotchas](/docs/v1/deep-dive/failure-gotchas) 8. [Improvement Backlog](/docs/v1/deep-dive/improvement-backlog) <Highlight type=\\"info\\" title=\\"How to use this section\\"> Keep one real conversationId open in /audit/{id} while reading this section. Follow each stage and compare with the file-level explanation. </Highlight>","excerpt":"Overview This is the file level wiki for how request control actually moves through ConvEngine. Read this section when you need to debug why a turn changed state unexpectedly a template variable was unresolved MCP produc\u2026"},{"id":"deep-dive/intent-and-schema.mdx","version":"v1","title":"intent and schema","permalink":"/docs/v1/deep-dive/intent-and-schema","content":"Intent Resolution and Schema Collection Intent resolution sources 1. Deterministic classifier rules ( ce_intent_classifier ) 2. Agent scoring path ( AgentIntentResolver ) using ce_config prompts 3. Composite arbitration in CompositeIntentResolver ce_config keys that shape intent behavior ce_prompt_template for schema extraction SchemaExtractionStep resolves template by: response_type = SCHEMA_JSON intent_code state_code (or fallback) } Context: } Schema: } Conversation History: } } Intent lock behavior When schema is incomplete: session.intentLocked = true IntentResolutionStep skips re resolving to prevent intent drift lock reason is persisted in context ( intent_lock.reason ) When schema becomes complete: lock is released if STICKY_INTENT=true , resolver can skip and retain existing intent/state only while schema collection remains incomplete explicit switch/reset/force signals still allow re resolution Without lock behavior, multi turn collection flows can jump to a new intent after partial input and break deterministic progression.","rawContent":"# Intent Resolution and Schema Collection ## Intent resolution sources 1. Deterministic classifier rules ( ce_intent_classifier ) 2. Agent scoring path ( AgentIntentResolver ) using ce_config prompts 3. Composite arbitration in CompositeIntentResolver ## ce_config keys that shape intent behavior <DbTable title=\\"AgentIntentResolver keys\\" columns={[\\"config_key\\", \\"Purpose\\", \\"Example\\"]} rows={[ [\\"MIN_CONFIDENCE\\", \\"Minimum confidence to accept agent intent\\", \\"0.55\\"], [\\"COLLISION_GAP_THRESHOLD\\", \\"Top-score gap threshold for collision\\", \\"0.10\\"], [\\"SYSTEM_PROMPT\\", \\"System behavior contract\\", \\"JSON-only intent scoring rules\\"], [\\"USER_PROMPT\\", \\"User template with context/history/allowed intents\\", \\"{{context}}, {{allowed_intents}}, {{user_input}}\\"], ]} /> <DbTable title=\\"IntentResolutionStep keys\\" columns={[\\"config_key\\", \\"Purpose\\", \\"Example\\"]} rows={[ [\\"STICKY_INTENT\\", \\"Keep intent/state stable only during active incomplete schema collection\\", \\"true\\"], ]} /> ## ce_prompt_template for schema extraction SchemaExtractionStep resolves template by: - response_type = SCHEMA_JSON - intent_code - state_code (or fallback) <CodeBlockToggle title=\\"Schema extraction prompt pattern\\" language=\\"text\\" defaultOpen={false} > { System prompt: Extract only valid JSON that conforms to schema. No extra keys. No prose. User prompt: User Input: {{user_input}} Context: {{context}} Schema: {{schema}} Conversation History: {{conversation_history}} } </CodeBlockToggle> ## Intent lock behavior When schema is incomplete: - session.intentLocked = true - IntentResolutionStep skips re-resolving to prevent intent drift - lock reason is persisted in context ( intent_lock.reason ) When schema becomes complete: - lock is released - if STICKY_INTENT=true , resolver can skip and retain existing intent/state only while schema collection remains incomplete - explicit switch/reset/force signals still allow re-resolution <Highlight type=\\"success\\" title=\\"Why this matters\\"> Without lock behavior, multi-turn collection flows can jump to a new intent after partial input and break deterministic progression. </Highlight>","excerpt":"Intent Resolution and Schema Collection Intent resolution sources 1. Deterministic classifier rules ( ce_intent_classifier ) 2. Agent scoring path ( AgentIntentResolver ) using ce_config prompts 3. Composite arbitration \u2026"},{"id":"deep-dive/lifecycle.mdx","version":"v1","title":"lifecycle","permalink":"/docs/v1/deep-dive/lifecycle","content":"Request Lifecycle This page is the quick lifecycle view. For the full interactive debug tree, open /docs/deep dive/request lifecycle . 1. API Entry Point The journey begins when a client sends a POST request to /api/v1/conversation/message . } 2. Engine Processing } 3. The Pipeline (Step by Step) PolicyEnforcementStep , ResetResolvedIntentStep , FallbackIntentStateStep , AddContainerDataStep , and McpToolStep are route conditional and run only when config/session conditions match. Every step above emits an audit event. Use /audit/ /trace and then open /docs/deep dive/request lifecycle for the full interactive step tree and method level trace.","rawContent":"# Request Lifecycle This page is the quick lifecycle view. For the full interactive debug tree, open <FileRef>/docs/deep-dive/request-lifecycle</FileRef>. ## 1. API Entry Point The journey begins when a client sends a POST request to /api/v1/conversation/message . <CodeBlockToggle title=\\"ConversationController.message\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.api.controller\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/api/controller/ConversationController.java\\" > { @PostMapping(\\"/message\\") public ConversationResponse message(@RequestBody ConversationRequest request) { EngineContext engineContext = EngineContext.builder() .conversationId(request.getConversationId()) .userText(request.getMessage()) .inputParams(request.getInputParams()) .build(); EngineResult result = engine.process(engineContext); return mapToResponse(result); } } </CodeBlockToggle> ## 2. Engine Processing <CodeBlockToggle title=\\"DefaultConversationalEngine.process\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.provider\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/provider/DefaultConversationalEngine.java\\" > { @Override public EngineResult process(EngineContext engineContext) { EngineSession session = sessionFactory.open(engineContext); session.setConversationHistory(historyProvider.lastTurns(session.getConversationId(), 10)); EnginePipeline pipeline = pipelineFactory.create(); return pipeline.execute(session); } } </CodeBlockToggle> ## 3. The Pipeline (Step-by-Step) <PipelineStepList ariaLabel=\\"Pipeline step-by-step\\" /> <Highlight type=\\"info\\" title=\\"Core path vs conditional steps\\"> PolicyEnforcementStep , ResetResolvedIntentStep , FallbackIntentStateStep , AddContainerDataStep , and McpToolStep are route-conditional and run only when config/session conditions match. </Highlight> <Highlight type=\\"success\\" title=\\"Audit Trail\\"> Every step above emits an audit event. Use /audit/{id}/trace and then open <FileRef>/docs/deep-dive/request-lifecycle</FileRef> for the full interactive step tree and method-level trace. </Highlight>","excerpt":"Request Lifecycle This page is the quick lifecycle view. For the full interactive debug tree, open /docs/deep dive/request lifecycle . 1. API Entry Point The journey begins when a client sends a POST request to /api/v1/c\u2026"},{"id":"deep-dive/mcp-audit.mdx","version":"v1","title":"mcp audit","permalink":"/docs/v1/deep-dive/mcp-audit","content":"MCP and Audit Internals MCP flow McpToolStep does: 1. skip on pending clarification 2. list enabled tools 3. clear stale context_json.mcp branch 4. planner loop ( CALL_TOOL or ANSWER ) 5. DB tool execution via McpDbExecutor 6. store observations and final answer in context MCP related tables Audit stream model DbAuditService writes normalized payload with _meta block, then: applies AuditStageControl (level/include/exclude/rate controls) dispatches listeners through AuditEventDispatcher (sync by default, async optional) Transport outputs: SSE stream ( /api/v1/conversation/stream/ ) optional STOMP topic ( /topic/convengine/audit/ ) STOMP broker mode: simple in memory (default) or relay (RabbitMQ/other STOMP relay) Trace API GET /api/v1/conversation/audit/ /trace Returns: step timeline ordered stage list source class/file metadata When output is wrong, compare raw audit stages with trace step boundaries. This isolates whether issue came from resolver logic, rule mutation, MCP plan, or response mapping.","rawContent":"# MCP and Audit Internals ## MCP flow McpToolStep does: 1. skip on pending clarification 2. list enabled tools 3. clear stale context_json.mcp branch 4. planner loop ( CALL_TOOL or ANSWER ) 5. DB tool execution via McpDbExecutor 6. store observations and final answer in context ## MCP-related tables <DbTable title=\\"MCP table usage\\" columns={[\\"Table\\", \\"Role\\", \\"Key fields\\"]} rows={[ [\\"ce_mcp_tool\\", \\"Tool registry\\", \\"tool_code, tool_group, intent_code, state_code, enabled\\"], [\\"ce_mcp_db_tool\\", \\"DB tool SQL template config\\", \\"sql_template, param_schema, max_rows, safe_mode\\"], [\\"ce_config\\", \\"Planner prompts\\", \\"McpPlanner.SYSTEM_PROMPT, McpPlanner.USER_PROMPT\\"], ]} /> ## Audit stream model DbAuditService writes normalized payload with _meta block, then: - applies AuditStageControl (level/include/exclude/rate controls) - dispatches listeners through AuditEventDispatcher (sync by default, async optional) Transport outputs: - SSE stream ( /api/v1/conversation/stream/{conversationId} ) - optional STOMP topic ( /topic/convengine/audit/{conversationId} ) - STOMP broker mode: simple in-memory (default) or relay (RabbitMQ/other STOMP relay) ## Trace API GET /api/v1/conversation/audit/{conversationId}/trace Returns: - step timeline - ordered stage list - source class/file metadata <CodeBlockToggle title=\\"SSE subscribe example\\" language=\\"bash\\"> { curl -N http://localhost:8080/api/v1/conversation/stream/9bf7540a-b129-4685-a120-730e8a0cb94b } </CodeBlockToggle> <Highlight type=\\"success\\" title=\\"Debug strategy\\"> When output is wrong, compare raw audit stages with trace step boundaries. This isolates whether issue came from resolver logic, rule mutation, MCP plan, or response mapping. </Highlight>","excerpt":"MCP and Audit Internals MCP flow McpToolStep does: 1. skip on pending clarification 2. list enabled tools 3. clear stale context_json.mcp branch 4. planner loop ( CALL_TOOL or ANSWER ) 5. DB tool execution via McpDbExecu\u2026"},{"id":"deep-dive/pipeline-steps.mdx","version":"v1","title":"pipeline steps","permalink":"/docs/v1/deep-dive/pipeline-steps","content":"Pipeline Steps (what each step does) :::tip Hook where you need precision Before schema extraction: normalize inputs After rules: inspect intent/state transition correctness Before response resolution: inject display hints ::: Prefer transitions in ce_rule unless absolutely framework level behavior is required. This keeps domain behavior data driven and testable via audit traces.","rawContent":"# Pipeline Steps (what each step does) <DbTable title=\\"Step responsibilities\\" columns={[\\"Step\\", \\"Primary responsibility\\", \\"Main session mutations\\", \\"Config/table dependencies\\"]} rows={[ [\\"LoadOrCreateConversationStep\\", \\"Fetch or bootstrap conversation row\\", \\"conversation, intent/state/context sync\\", \\"ce_conversation\\"], [\\"ResetConversationStep\\", \\"Early explicit reset\\", \\"intent/state/context/input params reset\\", \\"input flags, command text\\"], [\\"PersistConversationBootstrapStep\\", \\"Ensure conversation row persisted\\", \\"none/metadata\\", \\"ce_conversation\\"], [\\"AuditUserInputStep\\", \\"Persist user input audit\\", \\"none\\", \\"ce_audit\\"], [\\"PolicyEnforcementStep\\", \\"Policy block and stop\\", \\"payload + stop result on block\\", \\"ce_policy\\"], [\\"IntentResolutionStep\\", \\"Resolve intent with classifier+agent\\", \\"intent/state/clarification fields\\", \\"ce_intent, ce_intent_classifier, ce_config\\"], [\\"ResetResolvedIntentStep\\", \\"Reset on configured reset intent\\", \\"full reset\\", \\"ce_config RESET_INTENT_CODES\\"], [\\"FallbackIntentStateStep\\", \\"Fill missing intent/state defaults\\", \\"intent/state\\", \\"none\\"], [\\"AddContainerDataStep\\", \\"Fetch and attach container data\\", \\"containerData/context merge\\", \\"ce_container_config\\"], [\\"McpToolStep\\", \\"MCP planner/tool loop\\", \\"context_json.mcp.*\\", \\"ce_mcp_tool, ce_mcp_db_tool, ce_config\\"], [\\"SchemaExtractionStep\\", \\"Schema-driven extraction and lock handling\\", \\"schema facts/context/lock\\", \\"ce_output_schema, ce_prompt_template\\"], [\\"AutoAdvanceStep\\", \\"Compute schema status facts\\", \\"schemaComplete/hasAny\\", \\"resolved schema + context\\"], [\\"RulesStep\\", \\"Match and apply transitions/actions\\", \\"intent/state/input params\\", \\"ce_rule\\"], [\\"ResponseResolutionStep\\", \\"Resolve and generate output payload\\", \\"payload/last assistant json\\", \\"ce_response, ce_prompt_template\\"], [\\"PersistConversationStep\\", \\"Persist final conversation and result\\", \\"finalResult\\", \\"ce_conversation\\"], [\\"PipelineEndGuardStep\\", \\"Timing audit + terminal guard\\", \\"timings\\", \\"ce_audit\\"], ]} /> :::tip Hook where you need precision - Before schema extraction: normalize inputs - After rules: inspect intent/state transition correctness - Before response resolution: inject display hints ::: <Highlight type=\\"warning\\" title=\\"Don\u2019t hardcode transitions in steps\\"> Prefer transitions in ce_rule unless absolutely framework-level behavior is required. This keeps domain behavior data-driven and testable via audit traces. </Highlight>","excerpt":"Pipeline Steps (what each step does) :::tip Hook where you need precision Before schema extraction: normalize inputs After rules: inspect intent/state transition correctness Before response resolution: inject display hin\u2026"},{"id":"deep-dive/request-lifecycle.mdx","version":"v1","title":"request lifecycle","permalink":"/docs/v1/deep-dive/request-lifecycle","content":", data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , , , , , , , , , , ]; api: , engine: , session: , pipeline: , s1: , s2: , s3: , s4: , s5: , s6: , s7: , s8: , s9: , s10: , out: , }; Request Lifecycle (IDE Debug Mode) This page is the runtime control flow view for one turn. Think of it as stepping through breakpoints from API entry to final persistence. Canonical step inventory (latest) The visual flow highlights the common deterministic runtime path. Conditional/system steps from the list above still execute when their prerequisites are met. Engine\\" default // orderByDag uses @MustRunAfter, @MustRunBefore, @RequiresConversationPersisted // wrapWithTiming adds STEP_ENTER / STEP_EXIT / STEP_ERROR audits + hook callbacks } } return session.getFinalResult(); } default void beforeStep(EngineStep.Name stepName, EngineSession session) default void afterStep(EngineStep.Name stepName, EngineSession session, StepResult result) default void onStepError(EngineStep.Name stepName, EngineSession session, Throwable error) } } @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) } } Table Touch Matrix Start at IntentResolutionStep , then click SchemaExtractionStep and RulesStep in the tree. That path explains most multi turn behavior differences.","rawContent":"{ id: \\"api\\", position: { x: 20, y: 40 }, data: { label: \\"API: ConversationController.message\\" } }, { id: \\"engine\\", position: { x: 300, y: 40 }, data: { label: \\"DefaultConversationalEngine.process\\" } }, { id: \\"session\\", position: { x: 580, y: 40 }, data: { label: \\"EngineSessionFactory.open\\" } }, { id: \\"pipeline\\", position: { x: 860, y: 40 }, data: { label: \\"EnginePipelineFactory.create\\" } }, { id: \\"s1\\", position: { x: 20, y: 190 }, data: { label: \\"LoadOrCreateConversationStep\\" } }, { id: \\"s2\\", position: { x: 260, y: 190 }, data: { label: \\"ResetConversationStep\\" } }, { id: \\"s3\\", position: { x: 500, y: 190 }, data: { label: \\"AuditUserInputStep\\" } }, { id: \\"s4\\", position: { x: 740, y: 190 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"s5\\", position: { x: 980, y: 190 }, data: { label: \\"SchemaExtractionStep\\" } }, { id: \\"s6\\", position: { x: 20, y: 340 }, data: { label: \\"AutoAdvanceStep\\" } }, { id: \\"s7\\", position: { x: 260, y: 340 }, data: { label: \\"RulesStep\\" } }, { id: \\"s8\\", position: { x: 500, y: 340 }, data: { label: \\"ResponseResolutionStep\\" } }, { id: \\"s9\\", position: { x: 740, y: 340 }, data: { label: \\"PersistConversationStep\\" } }, { id: \\"s10\\", position: { x: 980, y: 340 }, data: { label: \\"PipelineEndGuardStep\\" } }, { id: \\"out\\", position: { x: 500, y: 500 }, data: { label: \\"EngineResult -> HTTP Response\\" } }, ]; { id: \\"e1\\", source: \\"api\\", target: \\"engine\\" }, { id: \\"e2\\", source: \\"engine\\", target: \\"session\\" }, { id: \\"e3\\", source: \\"session\\", target: \\"pipeline\\" }, { id: \\"e4\\", source: \\"pipeline\\", target: \\"s1\\" }, { id: \\"e5\\", source: \\"s1\\", target: \\"s2\\" }, { id: \\"e6\\", source: \\"s2\\", target: \\"s3\\" }, { id: \\"e7\\", source: \\"s3\\", target: \\"s4\\" }, { id: \\"e8\\", source: \\"s4\\", target: \\"s5\\" }, { id: \\"e9\\", source: \\"s5\\", target: \\"s6\\" }, { id: \\"e10\\", source: \\"s6\\", target: \\"s7\\" }, { id: \\"e11\\", source: \\"s7\\", target: \\"s8\\" }, { id: \\"e12\\", source: \\"s8\\", target: \\"s9\\" }, { id: \\"e13\\", source: \\"s9\\", target: \\"s10\\" }, { id: \\"e14\\", source: \\"s10\\", target: \\"out\\" }, ]; api: { title: \\"ConversationController.message\\", file: \\"api/controller/ConversationController.java\\", method: \\"message(...)\\", stage: \\"HTTP_ENTRY\\", summary: \\"Reads request body, normalizes inputParams, injects reset flag when needed, builds EngineContext and delegates to engine.process.\\", session: [\\"conversationId maybe provided or generated\\", \\"userText from request.message\\", \\"inputParams merged\\"], tables: [\\"none\\"], }, engine: { title: \\"DefaultConversationalEngine.process\\", file: \\"engine/provider/DefaultConversationalEngine.java\\", method: \\"process(EngineContext)\\", stage: \\"ENGINE_ENTRY\\", summary: \\"Opens EngineSession, loads conversation history provider data, executes pipeline, returns EngineResult.\\", session: [\\"session created\\", \\"conversationHistory injected\\"], tables: [\\"ce_audit (indirect via steps)\\", \\"ce_conversation (indirect via steps)\\"], }, session: { title: \\"EngineSessionFactory.open\\", file: \\"engine/factory/EngineSessionFactory.java\\", method: \\"open(EngineContext)\\", stage: \\"SESSION_BOOTSTRAP\\", summary: \\"Ensures conversation bootstrap row exists, attaches it into session, syncs state/intent/context/input params.\\", session: [\\"conversation object attached\\", \\"intent/state/context synced from DB\\"], tables: [\\"ce_conversation (R/W bootstrap)\\"], }, pipeline: { title: \\"EnginePipelineFactory.create\\", file: \\"engine/factory/EnginePipelineFactory.java\\", method: \\"orderByDag(...) + wrapWithTiming(...)\\", stage: \\"PIPELINE_BUILD\\", summary: \\"Resolves step DAG by annotations, wraps each step in timing/audit/hook-aware wrapper.\\", session: [\\"none (topology build)\\"], tables: [\\"none\\"], }, s1: { title: \\"LoadOrCreateConversationStep.execute\\", file: \\"engine/steps/LoadOrCreateConversationStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Loads/syncs conversation row into session and keeps runtime state consistent.\\", session: [\\"conversation synchronized\\", \\"state available for next steps\\"], tables: [\\"ce_conversation (R/W)\\"], }, s2: { title: \\"ResetConversationStep.execute\\", file: \\"engine/steps/ResetConversationStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Checks reset controls ( reset , restart , conversation_reset , command text). If triggered, wipes conversation runtime state.\\", session: [\\"intent/state/context reset conditionally\\", \\"input controls filtered\\"], tables: [\\"ce_conversation (W)\\", \\"ce_audit (CONVERSATION_RESET)\\"], }, s3: { title: \\"AuditUserInputStep.execute\\", file: \\"engine/steps/AuditUserInputStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Writes compact user input audit record with session meta intent/state.\\", session: [\\"user input captured\\"], tables: [\\"ce_audit (W)\\"], }, s4: { title: \\"IntentResolutionStep.execute\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Resolves intent using classifier + agent flow, with schema lock checks and collision handling.\\", session: [\\"intent maybe changed\\", \\"state may become INTENT_COLLISION\\"], tables: [\\"ce_intent (R)\\", \\"ce_intent_classifier (R)\\", \\"ce_config (R)\\", \\"ce_audit (W)\\"], }, s5: { title: \\"SchemaExtractionStep.execute\\", file: \\"engine/steps/SchemaExtractionStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Finds schema by intent/state, renders prompt template, calls LLM JSON extraction, merges context, computes missing fields, locks/unlocks intent.\\", session: [\\"contextJson merged\\", \\"schemaComplete/schemaHasAnyValue flags\\", \\"missing fields/options\\"], tables: [\\"ce_output_schema (R)\\", \\"ce_prompt_template (R)\\", \\"ce_audit (W)\\", \\"ce_config (R optional)\\"], }, s6: { title: \\"AutoAdvanceStep.execute\\", file: \\"engine/steps/AutoAdvanceStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Applies deterministic state changes from schema facts before rules run.\\", session: [\\"state may auto-transition\\"], tables: [\\"ce_audit (W)\\"], }, s7: { title: \\"RulesStep.execute\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Runs enabled rules in priority order with multi-pass cascading when intent/state changes.\\", session: [\\"intent/state/context/inputParams may mutate via actions\\"], tables: [\\"ce_rule (R)\\", \\"ce_audit (W)\\"], }, s8: { title: \\"ResponseResolutionStep.execute\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Selects response mapping, executes EXACT/DERIVED strategy, resolves templates for derived output, applies transformers, audits output.\\", session: [\\"payload set\\", \\"finalResult staged\\"], tables: [\\"ce_response (R)\\", \\"ce_prompt_template (R)\\", \\"ce_audit (W)\\"], }, s9: { title: \\"PersistConversationStep.execute\\", file: \\"engine/steps/PersistConversationStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Persists final conversation state and last assistant payload to durable row.\\", session: [\\"conversation row synchronized with runtime\\"], tables: [\\"ce_conversation (W)\\", \\"ce_audit (W optional)\\"], }, s10: { title: \\"PipelineEndGuardStep.execute\\", file: \\"engine/steps/PipelineEndGuardStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Final guard/timing stage, emits pipeline timing audit and closes execution envelope.\\", session: [\\"step timings finalized\\"], tables: [\\"ce_audit (W)\\"], }, out: { title: \\"EngineResult return\\", file: \\"api/controller/ConversationController.java\\", method: \\"message(...) return\\", stage: \\"HTTP_RESPONSE\\", summary: \\"Controller maps EngineResult to API response payload type (TEXT/JSON) and returns to client.\\", session: [\\"final result exposed\\"], tables: [\\"none\\"], }, }; # Request Lifecycle (IDE Debug Mode) This page is the runtime control-flow view for one turn. Think of it as stepping through breakpoints from API entry to final persistence. ## Canonical step inventory (latest) <PipelineStepList ariaLabel=\\"Canonical step inventory\\" /> <Highlight type=\\"tip\\" title=\\"Graph below is the common path\\"> The visual flow highlights the common deterministic runtime path. Conditional/system steps from the list above still execute when their prerequisites are met. </Highlight> <EngineDebugFlow title=\\"Request Turn Execution Graph\\" subtitle=\\"Click any node in tree or graph to inspect method-level detail, session snapshots, and table touch points.\\" nodes={lifecycleNodes} edges={lifecycleEdges} detailsById={lifecycleDetails} defaultSelectedId=\\"s4\\" /> <Tabs groupId=\\"lifecycle-code\\"> <TabItem value=\\"entry\\" label=\\"Controller -> Engine\\" default> <CodeBlockToggle title=\\"ConversationController.message\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.api.controller\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/api/controller/ConversationController.java\\" > { EngineContext engineContext = EngineContext.builder() .conversationId(conversationId.toString()) .userText(request.getMessage()) .inputParams(inputParams) .build(); EngineResult result = engine.process(engineContext); } </CodeBlockToggle> <CodeBlockToggle title=\\"DefaultConversationalEngine.process\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.provider\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/provider/DefaultConversationalEngine.java\\" > { EngineSession session = sessionFactory.open(engineContext); session.setConversationHistory(historyProvider.lastTurns(session.getConversationId(), 10)); EnginePipeline pipeline = pipelineFactory.create(); return pipeline.execute(session); } </CodeBlockToggle> </TabItem> <TabItem value=\\"pipeline\\" label=\\"DAG + Step Wrapper\\"> <CodeBlockToggle title=\\"EnginePipelineFactory.orderByDag + wrapWithTiming\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.factory\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/factory/EnginePipelineFactory.java\\" > { @PostConstruct public void init() { List<EngineStep> ordered = orderByDag(discoveredSteps); this.pipeline = new EnginePipeline(wrapWithTiming(ordered)); } // orderByDag uses @MustRunAfter, @MustRunBefore, @RequiresConversationPersisted // wrapWithTiming adds STEP_ENTER / STEP_EXIT / STEP_ERROR audits + hook callbacks } </CodeBlockToggle> <CodeBlockToggle title=\\"EnginePipeline.execute\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.pipeline\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/pipeline/EnginePipeline.java\\" > { for (EngineStep step : steps) { StepResult r = step.execute(session); if (r instanceof StepResult.Stop(EngineResult result)) { return result; } } return session.getFinalResult(); } </CodeBlockToggle> </TabItem> <TabItem value=\\"hooks\\" label=\\"Step Hook Interception\\"> <CodeBlockToggle title=\\"EngineStepHook typed step matching\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.hook\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/hook/EngineStepHook.java\\" > { public interface EngineStepHook { default boolean supports(EngineStep.Name stepName, EngineSession session) { return true; } default void beforeStep(EngineStep.Name stepName, EngineSession session) {} default void afterStep(EngineStep.Name stepName, EngineSession session, StepResult result) {} default void onStepError(EngineStep.Name stepName, EngineSession session, Throwable error) {} } } </CodeBlockToggle> <CodeBlockToggle title=\\"Consumer hook example\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.hooks\\" > { @Component public class MyHook implements EngineStepHook { @Override public boolean supports(EngineStep.Name stepName, EngineSession session) { return EngineStep.Name.SchemaExtractionStep == stepName; } @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) { session.putInputParam(\\"consumer_hint\\", \\"compact\\"); } } } </CodeBlockToggle> </TabItem> </Tabs> ## Table Touch Matrix <DbTable title=\\"Per-turn table access\\" columns={[\\"Table\\", \\"Read Path\\", \\"Write Path\\"]} rows={[ [\\"ce_conversation\\", \\"LoadOrCreateConversationStep\\", \\"PersistConversationStep / reset steps\\"], [\\"ce_intent\\", \\"IntentResolutionStep\\", \\"-\\"], [\\"ce_intent_classifier\\", \\"IntentResolutionStep\\", \\"-\\"], [\\"ce_output_schema\\", \\"SchemaExtractionStep\\", \\"-\\"], [\\"ce_prompt_template\\", \\"SchemaExtractionStep / ResponseResolutionStep\\", \\"-\\"], [\\"ce_rule\\", \\"RulesStep\\", \\"-\\"], [\\"ce_response\\", \\"ResponseResolutionStep\\", \\"-\\"], [\\"ce_config\\", \\"intent/reset/mcp/sql-agent config lookup\\", \\"-\\"], [\\"ce_audit\\", \\"-\\", \\"all stage audits via DbAuditService\\"], ]} /> <Highlight type=\\"info\\" title=\\"How to read this page\\"> Start at IntentResolutionStep , then click SchemaExtractionStep and RulesStep in the tree. That path explains most multi-turn behavior differences. </Highlight>","excerpt":", data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , , , , , , , , , , ]; api: , engine: , sess\u2026"},{"id":"deep-dive/rules-responses.mdx","version":"v1","title":"rules responses","permalink":"/docs/v1/deep-dive/rules-responses","content":"Rules and Response Resolution Rule types currently implemented Rule actions in detail Response selection algorithm 1. Find enabled ce_response candidates matching intent/state 2. Score by exact state/intent ANY/null fallback priority 3. Choose top candidate 4. Resolve by response type EXACT vs DERIVED EXACT : deterministic payload ( exact_text ) DERIVED : template rendered + LLM generated output :::tip Intervention points Use ResponseTransformer after response resolution to apply consumer specific post processing. Use hook on RulesStep to inspect rule cascades in production debugging. ::: Do not insert unimplemented rule types/actions in DB. Keep ce_rule values aligned with installed resolver classes.","rawContent":"# Rules and Response Resolution ## Rule types currently implemented <DbTable title=\\"Rule type resolver coverage\\" columns={[\\"rule_type\\", \\"Resolver\\", \\"When to use\\"]} rows={[ [\\"EXACT\\", \\"ExactRuleTypeResolver\\", \\"Exact text-driven trigger\\"], [\\"REGEX\\", \\"RegexRuleTypeResolver\\", \\"Pattern-driven trigger\\"], [\\"JSON_PATH\\", \\"JsonPathRuleTypeResolver\\", \\"Condition over session/context/payload facts\\"], ]} /> ## Rule actions in detail <DbTable title=\\"Action behavior\\" columns={[\\"action\\", \\"What it changes\\", \\"Typical real-world use\\"]} rows={[ [\\"SET_STATE\\", \\"session.state\\", \\"Move flow to AWAITING_ACCOUNT_ID\\"], [\\"SET_INTENT\\", \\"session.intent\\", \\"Reclassify after deterministic signal\\"], [\\"SET_JSON\\", \\"input param from JSON path extract\\", \\"Pull ticketId/correlationId from context\\"], [\\"GET_CONTEXT\\", \\"input param snapshot of context\\", \\"Use context in downstream prompts/tasks\\"], [\\"GET_SESSION\\", \\"input param snapshot of session facts\\", \\"Expose runtime flags to prompts\\"], [\\"GET_SCHEMA_JSON\\", \\"input param schema-only field subset\\", \\"Use only extracted form fields\\"], [\\"SET_TASK\\", \\"executes custom task bean methods\\", \\"Raise incident, call internal orchestrator\\"] ]} /> ## Response selection algorithm 1. Find enabled ce_response candidates matching intent/state 2. Score by exact state/intent > ANY/null fallback > priority 3. Choose top candidate 4. Resolve by response type ## EXACT vs DERIVED - EXACT : deterministic payload ( exact_text ) - DERIVED : template-rendered + LLM-generated output <CodeBlockToggle title=\\"Derived response path (concept)\\" language=\\"text\\"> { ce_response(response_type=DERIVED, output_format=TEXT) -> template from ce_prompt_template(response_type=TEXT) -> render variables -> llm.generateText(...) -> optional ResponseTransformer -> persisted assistant output } </CodeBlockToggle> :::tip Intervention points - Use ResponseTransformer after response resolution to apply consumer-specific post-processing. - Use hook on RulesStep to inspect rule cascades in production debugging. ::: <Highlight type=\\"warning\\" title=\\"Enum drift warning\\"> Do not insert unimplemented rule types/actions in DB. Keep ce_rule values aligned with installed resolver classes. </Highlight>","excerpt":"Rules and Response Resolution Rule types currently implemented Rule actions in detail Response selection algorithm 1. Find enabled ce_response candidates matching intent/state 2. Score by exact state/intent ANY/null fall\u2026"},{"id":"examples.mdx","version":"v1","title":"examples","permalink":"/docs/v1/examples","content":", data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , ]; faq_api: , faq_engine: , faq_intent: , faq_rules: , faq_resp: , faq_persist: , }; , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , ]; d_intent: , d_schema: , d_followup: , d_turn2: , d_rules: , d_done: , }; , data: }, , data: }, , data: }, , data: }, ]; , , , ]; l_intent: , l_schema: , l_rules: , l_resp: , }; , data: }, , data: }, , data: }, , data: }, ]; , , , ]; t_intent: , t_schema: , t_rules: , t_resp: , }; Examples (ReactFlow + DML + Audit) This page is the practical E2E companion to deep dive. Each example shows: conversation UX runtime flow graph DML seed rows expected audit stages Canonical Runtime Step Set Step loop invokes each execute(session) . If a step returns Stop , response returns immediately; otherwise loop continues. 1 LoadOrCreateConversationStep 2 ResetConversationStep 3 PersistConversationBootstrapStep 4 AuditUserInputStep 5 PolicyEnforcementStep 6 IntentResolutionStep 7 ResetResolvedIntentStep 8 FallbackIntentStateStep 9 AddContainerDataStep 10 McpToolStep 11 SchemaExtractionStep 12 AutoAdvanceStep 13 RulesStep 14 ResponseResolutionStep 15 PersistConversationStep 16 PipelineEndGuardStep Open full step traversal with snippets EngineContext engineContext = EngineContext.builder() .conversationId(conversationId.toString()) .userText(request.getMessage()) .inputParams(inputParams) .build(); EngineResult result = engine.process(engineContext); return mapToResponse(result); } } } } if (session.getFinalResult() == null) return session.getFinalResult(); } } } IntentResolutionTrace trace = resolver.resolveWithTrace(session.getUserText(), session.contextDict()); session.setIntent(trace.getIntent()); session.setState(trace.getState()); audit.audit(\\"INTENT_RESOLVED\\", session.getConversationId(), Map.of( \\"intent\\", trace.getIntent(), \\"confidence\\", trace.getConfidence(), \\"source\\", trace.getSource() )); return new StepResult.Continue(); } } CeOutputSchema schema = schemaOpt.get(); String prompt = promptRenderer.renderSchemaPrompt(session, schema); String extractedJson = llmClient.generateJson(prompt, schema.getSchemaJson(), session.getContextJsonOrEmpty()); session.mergeContextJson(extractedJson); MissingFieldResult missing = missingFieldEvaluator.evaluate(schema.getSchemaJson(), session.contextDict()); session.setMissingFields(missing.names()); session.setSchemaLocked(!missing.isComplete()); audit.audit(\\"SCHEMA_EVALUATED\\", session.getConversationId(), Map.of(\\"missing\\", missing.names())); return new StepResult.Continue(); } } RuleOutcome outcome = actionExecutor.apply(rule, session); changed = changed || outcome.mutatedIntentOrState(); audit.audit(\\"RULE_MATCH\\", session.getConversationId(), Map.of(\\"ruleId\\", rule.getId(), \\"action\\", rule.getAction())); } } while (changed && pass } } FAQ Can I move my connection within Zapper? Yes. You can request relocation from the support portal. DISCONNECT_ELECTRICITY Disconnect electricity for account 10004567. Please share disconnect date and reason. Date is 2026 03 31, reason moving out. Done. Request submitted. follow up complete finalize\\" nodes= edges= detailsById= defaultSelectedId=\\"d_schema\\" / ,\\"disconnectDate\\": ,\\"reason\\": },\\"required\\":[\\"accountId\\",\\"disconnectDate\\",\\"reason\\"]}\', true); insert into ce_prompt_template(intent_code, state_code, response_type, system_prompt, user_prompt, enabled) values (\'DISCONNECT_ELECTRICITY\', \'COLLECT_REQUIRED\', \'TEXT\', \'Collect missing disconnect fields.\', \'Ask only for missing disconnect fields from: }\', true); insert into ce_response(intent_code, state_code, response_type, output_format, enabled) values (\'DISCONNECT_ELECTRICITY\', \'COLLECT_REQUIRED\', \'DERIVED\', \'TEXT\', true); } LOG_ANALYSIS Analyze timeout logs and tell root cause. Root cause is DB connection pool saturation from 11:02 to 11:07 UTC. REQUEST_TRACKER Track request REQ 778102. REQ 778102 is IN_REVIEW and assigned to Queue 3. For each example run, inspect both /api/v1/conversation/audit/ \'} and /api/v1/conversation/audit/ \'}/trace .","rawContent":"{ id: \\"faq_api\\", position: { x: 20, y: 60 }, data: { label: \\"ConversationController.message\\" } }, { id: \\"faq_engine\\", position: { x: 290, y: 60 }, data: { label: \\"DefaultConversationalEngine.process\\" } }, { id: \\"faq_intent\\", position: { x: 560, y: 60 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"faq_rules\\", position: { x: 830, y: 60 }, data: { label: \\"RulesStep\\" } }, { id: \\"faq_resp\\", position: { x: 290, y: 220 }, data: { label: \\"ResponseResolutionStep\\" } }, { id: \\"faq_persist\\", position: { x: 560, y: 220 }, data: { label: \\"PersistConversationStep\\" } }, ]; { id: \\"faq_e1\\", source: \\"faq_api\\", target: \\"faq_engine\\" }, { id: \\"faq_e2\\", source: \\"faq_engine\\", target: \\"faq_intent\\" }, { id: \\"faq_e3\\", source: \\"faq_intent\\", target: \\"faq_rules\\" }, { id: \\"faq_e4\\", source: \\"faq_rules\\", target: \\"faq_resp\\" }, { id: \\"faq_e5\\", source: \\"faq_resp\\", target: \\"faq_persist\\" }, ]; faq_api: { title: \\"API entry\\", file: \\"api/controller/ConversationController.java\\", method: \\"message(...) \\", stage: \\"HTTP_ENTRY\\", summary: \\"Builds EngineContext and delegates to engine.\\", session: [\\"message + params normalized\\"], tables: [\\"none\\"] }, faq_engine: { title: \\"Engine processing\\", file: \\"engine/provider/DefaultConversationalEngine.java\\", method: \\"process(...) \\", stage: \\"ENGINE_ENTRY\\", summary: \\"Opens session and executes pipeline.\\", session: [\\"conversation history attached\\"], tables: [\\"ce_conversation (R)\\"] }, faq_intent: { title: \\"Intent resolution\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"INTENT_RESOLVED\\", summary: \\"Classifier/agent resolve FAQ.\\", session: [\\"intent=FAQ\\"], tables: [\\"ce_intent, ce_intent_classifier\\"] }, faq_rules: { title: \\"Rules evaluation\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(...) \\", stage: \\"RULE_NO_MATCH\\", summary: \\"No transition, state remains.\\", session: [\\"state unchanged\\"], tables: [\\"ce_rule\\"] }, faq_resp: { title: \\"Response resolution\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Selects EXACT/TEXT response row.\\", session: [\\"payload ready\\"], tables: [\\"ce_response\\"] }, faq_persist: { title: \\"Persist\\", file: \\"engine/steps/PersistConversationStep.java\\", method: \\"execute(...) \\", stage: \\"CONVERSATION_PERSIST\\", summary: \\"Persists final session snapshot.\\", session: [\\"context + payload stored\\"], tables: [\\"ce_conversation (W)\\"] }, }; { id: \\"d_intent\\", position: { x: 20, y: 60 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"d_schema\\", position: { x: 300, y: 60 }, data: { label: \\"SchemaExtractionStep\\" } }, { id: \\"d_followup\\", position: { x: 580, y: 60 }, data: { label: \\"Follow-up response\\" } }, { id: \\"d_turn2\\", position: { x: 860, y: 60 }, data: { label: \\"Turn 2 resume\\" } }, { id: \\"d_rules\\", position: { x: 300, y: 220 }, data: { label: \\"RulesStep\\" } }, { id: \\"d_done\\", position: { x: 580, y: 220 }, data: { label: \\"Response + Persist\\" } }, ]; { id: \\"d_e1\\", source: \\"d_intent\\", target: \\"d_schema\\" }, { id: \\"d_e2\\", source: \\"d_schema\\", target: \\"d_followup\\" }, { id: \\"d_e3\\", source: \\"d_followup\\", target: \\"d_turn2\\" }, { id: \\"d_e4\\", source: \\"d_turn2\\", target: \\"d_rules\\" }, { id: \\"d_e5\\", source: \\"d_rules\\", target: \\"d_done\\" }, ]; d_intent: { title: \\"Intent\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"INTENT_RESOLVED\\", summary: \\"Resolves DISCONNECT_ELECTRICITY.\\", session: [\\"intent fixed\\"], tables: [\\"ce_intent\\"] }, d_schema: { title: \\"Schema extraction\\", file: \\"engine/steps/SchemaExtractionStep.java\\", method: \\"execute(...) \\", stage: \\"SCHEMA_INCOMPLETE\\", summary: \\"Missing fields are detected and intent is locked.\\", session: [\\"missingFields tracked\\"], tables: [\\"ce_output_schema, ce_prompt_template\\"] }, d_followup: { title: \\"Clarification\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Returns follow-up for missing fields.\\", session: [\\"follow-up payload\\"], tables: [\\"ce_response\\"] }, d_turn2: { title: \\"Session continuity\\", file: \\"engine/steps/LoadOrCreateConversationStep.java\\", method: \\"execute(...) \\", stage: \\"SESSION_REHYDRATE\\", summary: \\"Restores same conversation context.\\", session: [\\"existing context loaded\\"], tables: [\\"ce_conversation\\"] }, d_rules: { title: \\"Transition\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(...) \\", stage: \\"RULE_MATCH\\", summary: \\"Applies state transition once schema complete.\\", session: [\\"state moved\\"], tables: [\\"ce_rule\\"] }, d_done: { title: \\"Finalization\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"CONVERSATION_PERSIST\\", summary: \\"Sends final message and persists.\\", session: [\\"final payload\\"], tables: [\\"ce_response, ce_conversation\\"] }, }; { id: \\"l_intent\\", position: { x: 20, y: 60 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"l_schema\\", position: { x: 300, y: 60 }, data: { label: \\"SchemaExtractionStep\\" } }, { id: \\"l_rules\\", position: { x: 580, y: 60 }, data: { label: \\"RulesStep (GET_SCHEMA_JSON)\\" } }, { id: \\"l_resp\\", position: { x: 860, y: 60 }, data: { label: \\"ResponseResolutionStep (DERIVED)\\" } }, ]; { id: \\"l_e1\\", source: \\"l_intent\\", target: \\"l_schema\\" }, { id: \\"l_e2\\", source: \\"l_schema\\", target: \\"l_rules\\" }, { id: \\"l_e3\\", source: \\"l_rules\\", target: \\"l_resp\\" }, ]; l_intent: { title: \\"Intent\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"INTENT_RESOLVED\\", summary: \\"LOG_ANALYSIS selected.\\", session: [\\"intent=LOG_ANALYSIS\\"], tables: [\\"ce_intent\\"] }, l_schema: { title: \\"Extracted facts\\", file: \\"engine/steps/SchemaExtractionStep.java\\", method: \\"execute(...) \\", stage: \\"SCHEMA_EVALUATED\\", summary: \\"Extracts structured fields from logs.\\", session: [\\"schemaJson prepared\\"], tables: [\\"ce_output_schema\\"] }, l_rules: { title: \\"Rule action\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(...) \\", stage: \\"RULE_MATCH\\", summary: \\"GET_SCHEMA_JSON action reads extracted values.\\", session: [\\"rule context enriched\\"], tables: [\\"ce_rule\\"] }, l_resp: { title: \\"Derived answer\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Prompt template creates RCA summary.\\", session: [\\"derived response\\"], tables: [\\"ce_prompt_template, ce_response\\"] }, }; { id: \\"t_intent\\", position: { x: 20, y: 60 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"t_schema\\", position: { x: 300, y: 60 }, data: { label: \\"SchemaExtractionStep\\" } }, { id: \\"t_rules\\", position: { x: 580, y: 60 }, data: { label: \\"RulesStep (SET_TASK)\\" } }, { id: \\"t_resp\\", position: { x: 860, y: 60 }, data: { label: \\"ResponseResolutionStep\\" } }, ]; { id: \\"t_e1\\", source: \\"t_intent\\", target: \\"t_schema\\" }, { id: \\"t_e2\\", source: \\"t_schema\\", target: \\"t_rules\\" }, { id: \\"t_e3\\", source: \\"t_rules\\", target: \\"t_resp\\" }, ]; t_intent: { title: \\"Intent\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"INTENT_RESOLVED\\", summary: \\"REQUEST_TRACKER selected.\\", session: [\\"intent=REQUEST_TRACKER\\"], tables: [\\"ce_intent\\"] }, t_schema: { title: \\"Extraction\\", file: \\"engine/steps/SchemaExtractionStep.java\\", method: \\"execute(...) \\", stage: \\"SCHEMA_EVALUATED\\", summary: \\"Extracts requestId.\\", session: [\\"requestId available\\"], tables: [\\"ce_output_schema\\"] }, t_rules: { title: \\"Task assignment\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(...) \\", stage: \\"RULE_MATCH\\", summary: \\"SET_TASK marks consumer work.\\", session: [\\"task set\\"], tables: [\\"ce_rule\\"] }, t_resp: { title: \\"Output\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Builds final status message.\\", session: [\\"payload finalized\\"], tables: [\\"ce_response\\"] }, }; # Examples (ReactFlow + DML + Audit) This page is the practical E2E companion to deep dive. Each example shows: - conversation UX - runtime flow graph - DML seed rows - expected audit stages ## Canonical Runtime Step Set <Highlight type=\\"info\\" title=\\"Step loop behavior\\"> Step loop invokes each <MethodRef>execute(session)</MethodRef>. If a step returns <MethodRef>Stop</MethodRef>, response returns immediately; otherwise loop continues. </Highlight> <div className=\\"ce-step-badge-list\\" role=\\"list\\" aria-label=\\"Canonical runtime step set\\"> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">1</span><span className=\\"ce-step-badge-label\\">LoadOrCreateConversationStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">2</span><span className=\\"ce-step-badge-label\\">ResetConversationStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">3</span><span className=\\"ce-step-badge-label\\">PersistConversationBootstrapStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">4</span><span className=\\"ce-step-badge-label\\">AuditUserInputStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">5</span><span className=\\"ce-step-badge-label\\">PolicyEnforcementStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">6</span><span className=\\"ce-step-badge-label\\">IntentResolutionStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">7</span><span className=\\"ce-step-badge-label\\">ResetResolvedIntentStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">8</span><span className=\\"ce-step-badge-label\\">FallbackIntentStateStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">9</span><span className=\\"ce-step-badge-label\\">AddContainerDataStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">10</span><span className=\\"ce-step-badge-label\\">McpToolStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">11</span><span className=\\"ce-step-badge-label\\">SchemaExtractionStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">12</span><span className=\\"ce-step-badge-label\\">AutoAdvanceStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">13</span><span className=\\"ce-step-badge-label\\">RulesStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">14</span><span className=\\"ce-step-badge-label\\">ResponseResolutionStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">15</span><span className=\\"ce-step-badge-label\\">PersistConversationStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">16</span><span className=\\"ce-step-badge-label\\">PipelineEndGuardStep</span></div> </div> <details className=\\"ce-trace-details\\"> <summary>Open full step traversal with snippets</summary> <CodeBlockToggle title=\\"ConversationController.message\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/api/controller/ConversationController.java\\"> { @PostMapping(\\"/message\\") public ConversationResponse message(@RequestBody ConversationRequest request) { UUID conversationId = request.getConversationId() != null ? request.getConversationId() : UUID.randomUUID(); Map<String, Object> inputParams = new LinkedHashMap<>(); if (request.getInputParams() != null) { inputParams.putAll(request.getInputParams()); } EngineContext engineContext = EngineContext.builder() .conversationId(conversationId.toString()) .userText(request.getMessage()) .inputParams(inputParams) .build(); EngineResult result = engine.process(engineContext); return mapToResponse(result); } } </CodeBlockToggle> <CodeBlockToggle title=\\"DefaultConversationalEngine.process\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/provider/DefaultConversationalEngine.java\\"> { @Override public EngineResult process(EngineContext engineContext) { EngineSession session = sessionFactory.open(engineContext); session.setConversationHistory(historyProvider.lastTurns(session.getConversationId(), 10)); EnginePipeline pipeline = pipelineFactory.create(); return pipeline.execute(session); } } </CodeBlockToggle> <CodeBlockToggle title=\\"EnginePipeline.execute\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/pipeline/EnginePipeline.java\\"> { public EngineResult execute(EngineSession session) { for (EngineStep step : steps) { StepResult result = step.execute(session); if (result instanceof StepResult.Stop(EngineResult finalResult)) { return finalResult; } } if (session.getFinalResult() == null) { throw new ConversationEngineException(ConversationEngineErrorCode.PIPELINE_NO_FINAL_RESULT); } return session.getFinalResult(); } } </CodeBlockToggle> <CodeBlockToggle title=\\"LoadOrCreateConversationStep.execute\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/LoadOrCreateConversationStep.java\\"> { public StepResult execute(EngineSession session) { CeConversation persisted = conversationRepo.findByConversationId(session.getConversationId()) .orElseGet(() -> conversationRepo.save(createConversation(session.getConversationId()))); session.setConversation(persisted); session.setIntent(persisted.getIntentCode()); session.setState(persisted.getStateCode()); session.mergeContextJson(persisted.getContextJson()); return new StepResult.Continue(); } } </CodeBlockToggle> <CodeBlockToggle title=\\"IntentResolutionStep.execute\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/IntentResolutionStep.java\\"> { public StepResult execute(EngineSession session) { if (session.isSchemaLocked() && session.hasIntent()) { audit.audit(\\"INTENT_SKIP_LOCKED\\", session.getConversationId(), Map.of(\\"intent\\", session.getIntent())); return new StepResult.Continue(); } IntentResolutionTrace trace = resolver.resolveWithTrace(session.getUserText(), session.contextDict()); session.setIntent(trace.getIntent()); session.setState(trace.getState()); audit.audit(\\"INTENT_RESOLVED\\", session.getConversationId(), Map.of( \\"intent\\", trace.getIntent(), \\"confidence\\", trace.getConfidence(), \\"source\\", trace.getSource() )); return new StepResult.Continue(); } } </CodeBlockToggle> <CodeBlockToggle title=\\"SchemaExtractionStep.execute\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/SchemaExtractionStep.java\\"> { public StepResult execute(EngineSession session) { Optional<CeOutputSchema> schemaOpt = outputSchemaRepo.findEnabled(session.getIntent(), session.getState()); if (schemaOpt.isEmpty()) { return new StepResult.Continue(); } CeOutputSchema schema = schemaOpt.get(); String prompt = promptRenderer.renderSchemaPrompt(session, schema); String extractedJson = llmClient.generateJson(prompt, schema.getSchemaJson(), session.getContextJsonOrEmpty()); session.mergeContextJson(extractedJson); MissingFieldResult missing = missingFieldEvaluator.evaluate(schema.getSchemaJson(), session.contextDict()); session.setMissingFields(missing.names()); session.setSchemaLocked(!missing.isComplete()); audit.audit(\\"SCHEMA_EVALUATED\\", session.getConversationId(), Map.of(\\"missing\\", missing.names())); return new StepResult.Continue(); } } </CodeBlockToggle> <CodeBlockToggle title=\\"RulesStep.execute\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/RulesStep.java\\"> { public StepResult execute(EngineSession session) { int pass = 0; boolean changed; do { changed = false; pass++; for (CeRule rule : ruleRepo.findEnabled(session.getIntent(), session.getState())) { if (!ruleMatcher.matches(rule, session)) { continue; } RuleOutcome outcome = actionExecutor.apply(rule, session); changed = changed || outcome.mutatedIntentOrState(); audit.audit(\\"RULE_MATCH\\", session.getConversationId(), Map.of(\\"ruleId\\", rule.getId(), \\"action\\", rule.getAction())); } } while (changed && pass < 4); return new StepResult.Continue(); } } </CodeBlockToggle> <CodeBlockToggle title=\\"ResponseResolutionStep.execute\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/ResponseResolutionStep.java\\"> { public StepResult execute(EngineSession session) { CeResponse row = responseRepo.resolve(session.getIntent(), session.getState()) .orElseThrow(() -> new ConversationEngineException(RESPONSE_NOT_FOUND)); EngineResult result = \\"EXACT\\".equalsIgnoreCase(row.getResponseType()) ? exactResolver.resolve(row, session) : derivedResolver.resolve(row, session); session.setFinalResult(result); audit.audit(\\"ASSISTANT_OUTPUT\\", session.getConversationId(), Map.of( \\"responseType\\", row.getResponseType(), \\"outputFormat\\", row.getOutputFormat() )); return new StepResult.Continue(); } } </CodeBlockToggle> <CodeBlockToggle title=\\"PersistConversationStep.execute\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/PersistConversationStep.java\\"> { public StepResult execute(EngineSession session) { CeConversation c = session.getConversation(); c.setIntentCode(session.getIntent()); c.setStateCode(session.getState()); c.setContextJson(session.getContextJsonOrEmpty()); c.setLastAssistantJson(session.getFinalResultJson()); conversationRepo.save(c); return new StepResult.Continue(); } } </CodeBlockToggle> </details> ## FAQ <Tabs groupId=\\"example-faq\\"> <TabItem value=\\"conversation\\" label=\\"Conversation + Flow\\" default> <Conversation title=\\"FAQ\\"> <User info={[\\"FAQ request.\\", \\"Classifier should map to FAQ intent.\\"]}>Can I move my connection within Zapper?</User> <Assistant tables={[\\"ce_intent\\", \\"ce_response\\"]} info={[\\"Exact FAQ response returned.\\", \\"No pending action required.\\"]}>Yes. You can request relocation from the support portal.</Assistant> </Conversation> <EngineDebugFlow title=\\"FAQ runtime flow\\" subtitle=\\"Classifier-first deterministic path\\" nodes={faqNodes} edges={faqEdges} detailsById={faqDetails} defaultSelectedId=\\"faq_intent\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <CodeBlockToggle title=\\"FAQ seed SQL\\" language=\\"sql\\"> { insert into ce_intent(intent_code, state_code, enabled) values (\'FAQ\', null, true); insert into ce_intent_classifier(intent_code, match_pattern, priority, enabled) values (\'FAQ\', \'(?i).*(office|location|address).*\', 10, true); insert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled) values (\'FAQ\', null, \'EXACT\', \'TEXT\', \'Yes. You can request relocation from the support portal.\', true); insert into ce_config(component, config_key, config_value, enabled) values (\'ResetConversationStep\', \'RESET_COMMAND\', \'RESET_SESSION\', true); } </CodeBlockToggle> <DbTable title=\\"FAQ seed preview\\" columns={[\\"Table\\", \\"Key values\\"]} rows={[ [\\"ce_intent\\", \\"intent_code=FAQ\\"], [\\"ce_intent_classifier\\", \\"pattern=(?i).*(office|location|address).*\\"] , [\\"ce_response\\", \\"response_type=EXACT, output_format=TEXT\\"], [\\"ce_config\\", \\"RESET_COMMAND=RESET_SESSION\\"], ]} /> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"FAQ expected ce_audit trail\\" columns={[\\"Stage\\", \\"Meaning\\"]} rows={[ [\\"USER_INPUT\\", \\"Incoming user message captured\\"], [\\"INTENT_RESOLVED\\", \\"FAQ selected\\"], [\\"RULE_NO_MATCH\\", \\"No transition rule needed\\"], [\\"ASSISTANT_OUTPUT\\", \\"EXACT response emitted\\"], [\\"CONVERSATION_PERSIST\\", \\"Session snapshot saved\\"], ]} /> </TabItem> </Tabs> ## DISCONNECT_ELECTRICITY <Tabs groupId=\\"example-disconnect\\"> <TabItem value=\\"conversation\\" label=\\"Conversation + Flow\\" default> <Conversation title=\\"DISCONNECT_ELECTRICITY\\"> <User info={[\\"Disconnect request with partial fields.\\", \\"Follow-up expected for missing values.\\"]}>Disconnect electricity for account 10004567.</User> <Assistant tables={[\\"ce_output_schema\\", \\"ce_response\\"]} info={[\\"Schema incomplete.\\", \\"Assistant requests missing fields.\\"]}>Please share disconnect date and reason.</Assistant> <User info={[\\"Provides disconnectDate and reason.\\", \\"Schema expected to complete.\\"]}>Date is 2026-03-31, reason moving out.</User> <Assistant tables={[\\"ce_rule\\", \\"ce_response\\"]} info={[\\"Rules advance flow.\\", \\"Final submission response generated.\\"]}>Done. Request submitted.</Assistant> </Conversation> <EngineDebugFlow title=\\"Disconnect flow\\" subtitle=\\"Incomplete schema -> follow-up -> complete -> finalize\\" nodes={disconnectNodes} edges={disconnectEdges} detailsById={disconnectDetails} defaultSelectedId=\\"d_schema\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <CodeBlockToggle title=\\"DISCONNECT_ELECTRICITY seed SQL\\" language=\\"sql\\"> { insert into ce_intent(intent_code, enabled) values (\'DISCONNECT_ELECTRICITY\', true); insert into ce_output_schema(intent_code, schema_json, enabled) values (\'DISCONNECT_ELECTRICITY\', \'{\\"type\\":\\"object\\",\\"properties\\":{\\"accountId\\":{\\"type\\":\\"string\\"},\\"disconnectDate\\":{\\"type\\":\\"string\\"},\\"reason\\":{\\"type\\":\\"string\\"}},\\"required\\":[\\"accountId\\",\\"disconnectDate\\",\\"reason\\"]}\', true); insert into ce_prompt_template(intent_code, state_code, response_type, system_prompt, user_prompt, enabled) values (\'DISCONNECT_ELECTRICITY\', \'COLLECT_REQUIRED\', \'TEXT\', \'Collect missing disconnect fields.\', \'Ask only for missing disconnect fields from: {{user_input}}\', true); insert into ce_response(intent_code, state_code, response_type, output_format, enabled) values (\'DISCONNECT_ELECTRICITY\', \'COLLECT_REQUIRED\', \'DERIVED\', \'TEXT\', true); } </CodeBlockToggle> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"DISCONNECT_ELECTRICITY expected ce_audit trail\\" columns={[\\"Stage\\", \\"Meaning\\"]} rows={[ [\\"INTENT_RESOLVED\\", \\"Intent selected\\"], [\\"SCHEMA_INCOMPLETE\\", \\"Missing fields detected\\"], [\\"ASSISTANT_OUTPUT\\", \\"Follow-up asked\\"], [\\"SCHEMA_COMPLETE\\", \\"All required fields present\\"], [\\"RULE_MATCH\\", \\"State transition executed\\"], [\\"CONVERSATION_PERSIST\\", \\"Final state stored\\"], ]} /> </TabItem> </Tabs> ## LOG_ANALYSIS <Tabs groupId=\\"example-log\\"> <TabItem value=\\"conversation\\" label=\\"Conversation + Flow\\" default> <Conversation title=\\"LOG_ANALYSIS\\"> <User info={[\\"Analysis request.\\", \\"Intent should resolve to LOG_ANALYSIS.\\"]}>Analyze timeout logs and tell root cause.</User> <Assistant tables={[\\"ce_prompt_template\\", \\"ce_response\\"]} info={[\\"Derived response generated from analysis context.\\", \\"Outputs probable root cause window.\\"]}>Root cause is DB connection pool saturation from 11:02 to 11:07 UTC.</Assistant> </Conversation> <EngineDebugFlow title=\\"Log analysis flow\\" subtitle=\\"GET_SCHEMA_JSON rule and DERIVED output\\" nodes={logNodes} edges={logEdges} detailsById={logDetails} defaultSelectedId=\\"l_rules\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <DbTable title=\\"LOG_ANALYSIS seed preview\\" columns={[\\"Table\\", \\"Key values\\"]} rows={[ [\\"ce_intent\\", \\"intent_code=LOG_ANALYSIS\\"], [\\"ce_output_schema\\", \\"fields=errorCode,component,severity\\"], [\\"ce_rule\\", \\"action=GET_SCHEMA_JSON\\"], [\\"ce_response\\", \\"response_type=DERIVED\\"], ]} /> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"LOG_ANALYSIS expected ce_audit trail\\" columns={[\\"Stage\\", \\"Meaning\\"]} rows={[ [\\"INTENT_RESOLVED\\", \\"LOG_ANALYSIS selected\\"], [\\"SCHEMA_EVALUATED\\", \\"Structured facts extracted\\"], [\\"RULE_MATCH\\", \\"GET_SCHEMA_JSON evaluated\\"], [\\"ASSISTANT_OUTPUT\\", \\"Derived explanation produced\\"], ]} /> </TabItem> </Tabs> ## REQUEST_TRACKER <Tabs groupId=\\"example-tracker\\"> <TabItem value=\\"conversation\\" label=\\"Conversation + Flow\\" default> <Conversation title=\\"REQUEST_TRACKER\\"> <User info={[\\"Tracking request with requestId.\\", \\"Task/rule lookup path expected.\\"]}>Track request REQ-778102.</User> <Assistant tables={[\\"ce_rule\\", \\"ce_response\\"]} info={[\\"Tracker task resolved.\\", \\"Status response returned from derived flow.\\"]}>REQ-778102 is IN_REVIEW and assigned to Queue-3.</Assistant> </Conversation> <EngineDebugFlow title=\\"Tracker flow\\" subtitle=\\"SET_TASK driven state path\\" nodes={trackerNodes} edges={trackerEdges} detailsById={trackerDetails} defaultSelectedId=\\"t_rules\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <DbTable title=\\"REQUEST_TRACKER seed preview\\" columns={[\\"Table\\", \\"Key values\\"]} rows={[ [\\"ce_intent\\", \\"intent_code=REQUEST_TRACKER\\"], [\\"ce_output_schema\\", \\"field=requestId\\"], [\\"ce_rule\\", \\"action=SET_TASK\\"], [\\"ce_response\\", \\"response_type=DERIVED\\"], ]} /> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"REQUEST_TRACKER expected ce_audit trail\\" columns={[\\"Stage\\", \\"Meaning\\"]} rows={[ [\\"INTENT_RESOLVED\\", \\"REQUEST_TRACKER selected\\"], [\\"RULE_MATCH\\", \\"SET_TASK applied\\"], [\\"ASSISTANT_OUTPUT\\", \\"Status response emitted\\"], [\\"CONVERSATION_PERSIST\\", \\"Turn persisted\\"], ]} /> </TabItem> </Tabs> <Highlight type=\\"tip\\" title=\\"Fast validation\\"> For each example run, inspect both <FileRef>/api/v1/conversation/audit/{\'{conversationId}\'}</FileRef> and <FileRef>/api/v1/conversation/audit/{\'{conversationId}\'}/trace</FileRef>. </Highlight>","excerpt":", data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , ]; faq_api: , faq_engine: , faq_intent: , faq_rules: , faq_resp: , faq_persist: , }; , data: }, , data: }, , data: }, , data: }, , data: }, ,\u2026"},{"id":"local-development.mdx","version":"v1","title":"local development","permalink":"/docs/v1/local-development","content":"Local Development Prerequisites Java 21 Spring compatible host app PostgreSQL + ConvEngine ce_ schema LlmClient implementation bean Minimal integration } } Required runtime beans from consumer side LlmClient datasource + JPA config any custom hooks/transformers you need Recommended local test loop 1. Send one turn to /message 2. Read /audit/ \'} 3. Read /audit/ \'}/trace 4. Tune DB rows and rerun same conversation id Transport toggles Keep SSE enabled initially. Use STOMP only when your client architecture needs bidirectional websocket semantics. Optional feature annotations } } With @EnableConvEngine(stream = true) (default), startup fails if both SSE and STOMP are disabled. With @EnableConvEngine(stream = false) , transport flags are ignored and only REST flow is active.","rawContent":"# Local Development ## Prerequisites - Java 21 - Spring-compatible host app - PostgreSQL + ConvEngine <FileRef>ce_*</FileRef> schema - <MethodRef>LlmClient</MethodRef> implementation bean ## Minimal integration <CodeBlockToggle title=\\"Enable ConvEngine\\" language=\\"java\\" packagePath=\\"your.app\\" > { @EnableConvEngine @SpringBootApplication public class MyApplication { public static void main(String[] args) { SpringApplication.run(MyApplication.class, args); } } } </CodeBlockToggle> ## Required runtime beans from consumer side - <MethodRef>LlmClient</MethodRef> - datasource + JPA config - any custom hooks/transformers you need ## Recommended local test loop 1. Send one turn to <FileRef>/message</FileRef> 2. Read <FileRef>/audit/{\'{conversationId}\'}</FileRef> 3. Read <FileRef>/audit/{\'{conversationId}\'}/trace</FileRef> 4. Tune DB rows and rerun same conversation id ## Transport toggles <CodeBlockToggle title=\\"application.yml\\" language=\\"yaml\\"> { server: port: 8080 spring: datasource: url: jdbc:postgresql://localhost:5432/convengine username: convengine_user password: convengine_pwd convengine: transport: sse: enabled: true or false emitter-timeout-ms: 1800000 stomp: enabled: true or false endpoint: /ws-convengine app-destination-prefix: /app topic-prefix: /topic audit-destination-base: /topic/convengine/audit allowed-origin-pattern: \\"*\\" sock-js: true broker: mode: SIMPLE relay-destination-prefixes: /topic,/queue relay-host: localhost relay-port: 61613 client-login: \\"\\" client-passcode: \\"\\" system-login: \\"\\" system-passcode: \\"\\" virtual-host: \\"\\" system-heartbeat-send-interval-ms: 10000 system-heartbeat-receive-interval-ms: 10000 audit: enabled: true level: ALL include-stages: [] exclude-stages: [] persistence: mode: IMMEDIATE jdbc-batch-size: 200 max-buffered-events: 5000 flush-stages: ENGINE_KNOWN_FAILURE,ENGINE_UNKNOWN_FAILURE final-step-names: PipelineEndGuardStep flush-on-stop-outcome: true dispatch: async-enabled: false worker-threads: 2 queue-capacity: 2000 rejection-policy: CALLER_RUNS keep-alive-seconds: 60 rate-limit: enabled: false max-events: 200 window-ms: 1000 per-conversation: true per-stage: true max-tracked-buckets: 20000 experimental: enabled: false } </CodeBlockToggle> <Highlight type=\\"warning\\" title=\\"When enabling STOMP\\"> Keep SSE enabled initially. Use STOMP only when your client architecture needs bidirectional websocket semantics. </Highlight> ## Optional feature annotations <CodeBlockToggle title=\\"Enable optional performance features\\" language=\\"java\\"> { @EnableConvEngine(stream = true) @EnableConvEngineAsyncAuditDispatch @EnableConvEngineStompBrokerRelay @SpringBootApplication public class MyApplication { public static void main(String[] args) { SpringApplication.run(MyApplication.class, args); } } } </CodeBlockToggle> <Highlight type=\\"info\\" title=\\"Stream flag behavior\\"> With <MethodRef>@EnableConvEngine(stream = true)</MethodRef> (default), startup fails if both SSE and STOMP are disabled. With <MethodRef>@EnableConvEngine(stream = false)</MethodRef>, transport flags are ignored and only REST flow is active. </Highlight>","excerpt":"Local Development Prerequisites Java 21 Spring compatible host app PostgreSQL + ConvEngine ce_ schema LlmClient implementation bean Minimal integration } } Required runtime beans from consumer side LlmClient datasource +\u2026"},{"id":"overview.mdx","version":"v1","title":"overview","permalink":"/docs/v1/overview","content":"ConvEngine v1 docs: v1 is retained for baseline reference. For advanced features and current recommendations, switch to v2 from the version selector. ConvEngine Overview (v1) ConvEngine is a deterministic, DB configured conversation engine. It is built for workflow grade systems where behavior must be auditable and configurable through data. Refer to v2 docs for: dialogue act and interaction policy v2 pending action lifecycle/disambiguation/guardrail tool orchestration and post tool rule phase state graph validate mode memory and replay/eval additions","rawContent":"<div className=\\"ce-v1-notice\\"> <strong>ConvEngine v1 docs:</strong> v1 is retained for baseline reference. For advanced features and current recommendations, switch to v2 from the version selector. </div> # ConvEngine Overview (v1) ConvEngine is a deterministic, DB-configured conversation engine. It is built for workflow-grade systems where behavior must be auditable and configurable through data. Refer to v2 docs for: - dialogue act and interaction policy v2 - pending action lifecycle/disambiguation/guardrail - tool orchestration and post-tool rule phase - state graph validate mode - memory and replay/eval additions","excerpt":"ConvEngine v1 docs: v1 is retained for baseline reference. For advanced features and current recommendations, switch to v2 from the version selector. ConvEngine Overview (v1) ConvEngine is a deterministic, DB configured \u2026"},{"id":"version-history.mdx","version":"v1","title":"version history","permalink":"/docs/v1/version-history","content":"Version History Current published artifact in pom.xml is 1.0.15 . Artifact Version Bumps ( pom.xml ) 1.0.15\\", \\"Schema resolver provider refactor + centralized audit/payload/input param keys\\"], [\\"2026 02 19\\", \\"working tree\\", \\"1.0.13 1.0.14\\", \\"Added ce_rule.state_code rule scoping support\\"], [\\"2026 02 19\\", \\"working tree\\", \\"1.0.12 1.0.13\\", \\"Audit persistence strategy split + sync conversation history table\\"], [\\"2026 02 19\\", \\"working tree\\", \\"1.0.11 1.0.12\\", \\"Audit metadata enrichment ( inputParams vs userInputParams )\\"], [\\"2026 02 18\\", \\"working tree\\", \\"1.0.10 1.0.11\\", \\"Cross database persistence hardening + sticky intent refinement\\"], [\\"2026 02 17\\", \\"working tree\\", \\"1.0.9 1.0.10\\", \\"Rule phase model + sticky intent continuity + stream validator hardening\\"], [\\"2026 02 16\\", \\"695ef79\\", \\"1.0.8 1.0.9\\", \\"Experimental SQL generation zip export + SQL by table response model\\"], [\\"2026 02 14\\", \\"a2daeec\\", \\"1.0.7 1.0.8\\", \\"Audit listener model + SSE/STOMP transport + reset flow\\"], [\\"2026 02 13\\", \\"05f9077\\", \\"1.0.6 1.0.7\\", \\"Schema handling + agent resolver controls\\"], [\\"2026 02 13\\", \\"working tree\\", \\"1.0.5 1.0.6\\", \\"Internal release cut (no separate public note)\\"], [\\"2026 02 12\\", \\"6f6033d\\", \\"1.0.4 1.0.5\\", \\"inputParamsJson and better session continuity\\"], [\\"2026 02 12\\", \\"48aae75\\", \\"1.0.3 1.0.4\\", \\"RulesStep integration into intent flow + audit improvements\\"], [\\"2026 02 12\\", \\"976c8f8\\", \\"1.0.2 1.0.3\\", \\"Response/session improvements + container/schema refinements\\"], [\\"2026 02 08\\", \\"d8faa28\\", \\"1.0.1 1.0.2\\", \\"JSON/session action resolver improvements\\"], [\\"2026 01 28\\", \\"cb38cc8\\", \\"1.0.0 1.0.1\\", \\"Release bump + core dependency refresh\\"], [\\"2026 01 04\\", \\"1ff9681\\", \\" 1.0.0\\", \\"Base code: core entities and interfaces\\"], ]} / Release Notes By Version 1.0.15 (Current in pom.xml ) What changed: Refactored SchemaExtractionStep into orchestration only flow and moved schema heavy calculation into provider contract. Added provider computation model: ConvEngineSchemaComputation ConvEngineSchemaResolver compute(...) ConvEngineSchemaResolver sanitizeExtractedJson(...) ConvEngineSchemaResolver mergeContextJson(...) DefaultConvEngineSchemaResolver now owns sanitize/merge/completeness/missing fields/missing options behavior. Clean provider override model for consumers: consumers can register their own ConvEngineSchemaResolver bean selection honors higher precedence via Spring @Order . Centralized runtime input param keys into ConvEngineInputParamKey . Centralized fixed audit stages into ConvEngineAuditStage . Added dynamic audit stage helper for resolved intent source: ConvEngineAuditStage.intentResolvedBy(...) Centralized payload map keys into ConvEnginePayloadKey . 1.0.14 What changed: Added optional ce_rule.state_code to scope rule execution by state. Runtime matching contract: NULL applies to all states ANY applies to all states exact value applies only when session state matches (case insensitive) 1.0.13 What changed: Split audit DB persistence into strategy classes ( IMMEDIATE and DEFERRED_BULK ) selected by factory at runtime. Kept ce_conversation_history persistence synchronous on every eligible stage to keep prompt } deterministic. Allowed ce_audit to run deferred bulk while preserving conversation history availability. Added _meta persistence toggle via convengine.audit.persist meta . Removed framework bundled default application.yaml ; consumer now owns convengine. config. 1.0.12 What changed: Added audit metadata enrichment for every stage: _meta.inputParams : runtime/session mutated parameter view _meta.userInputParams : API origin parameter snapshot Added controller ingress deep copy isolation for userInputParams so nested request objects are immutable from later runtime mutations. Extracted deep copy logic into a reusable engine helper: com.github.salilvnair.convengine.engine.helper.InputParamsHelper 1.0.11 What changed: Added cross database persistence hardening across SQLite, Postgres, and Oracle: JSON column binding now uses Hibernate JSON JDBC typing for jsonb paths audit persistence now uses dialect aware JSON/timestamp JDBC binding Added SQLite legacy runtime normalization at startup: normalizes epoch timestamp text rows into parse safe datetime text normalizes legacy BLOB conversation_id rows into canonical UUID text Refined sticky intent semantics: sticky skip now applies only during active incomplete schema collection outside schema collection, intent can re resolve for semantically new turns 1.0.10 What changed: Added ce_rule.phase execution model: PIPELINE_RULES AGENT_POST_INTENT Added runtime rule phase filtering so: RulesStep executes only PIPELINE_RULES AgentIntentResolver post intent pass executes only AGENT_POST_INTENT Added session/input metadata for rule source awareness: postIntentRule , post_intent_rule rule_phase rule_execution_source , rule_execution_origin Added post intent rule invocation after accepted agent intent. Added sticky intent continuity controls: IntentResolutionStep.STICKY_INTENT ( ce_config , default true ) skip intent re resolution when intent/state are already resolved added audit stage INTENT_RESOLVE_SKIPPED_STICKY_INTENT explicit reset/switch/force signals still allow re resolution Updated prompt variable exposure: prompt extra now receives all inputParams keys includes runtime/system derived keys set via session.putInputParam(...) Hardened stream startup validation and condition timing behavior to avoid false positive startup failures. Updated SQL generation docs/prompts to include ce_rule.phase contract. 1.0.9 Commit: 695ef79 What changed: Enhanced experimental SQL generation API output for consumer import workflows. Added SQL by table response structure to make generated output easier to inspect and apply incrementally. Added zip packaging support with per table SQL files plus combined seed.sql . Updated docs and SQL generation guidance for clarity and alignment with current runtime model. 1.0.8 Commits: a2daeec core release bump and transport/audit foundation 57a2faa async audit dispatch + deferred flush controls (post bump enhancements on same line) c5c665f typed step API via EngineStep.Name 0c2c557 rule action rename to GET_SCHEMA_JSON What changed in detail: Added streaming transport stack: SSE and STOMP/WebSocket support consumer configurable stream mode Added audit event plumbing: AuditEventListener extension point stage broadcast path for streaming UIs Added advanced audit controls: async dispatch workers queue/backpressure policy deferred bulk persistence + flush triggers Strengthened step extension API: string based step matching replaced by typed EngineStep.Name safer EngineStepHook contracts ( supports/beforeStep/afterStep/onStepError ) Renamed schema action contract: GET_SCHEMA_EXTRACTED_DATA GET_SCHEMA_JSON aligned resolver/session access semantics 1.0.7 Commit: 05f9077 What changed: Schema extraction and intent resolution refinements additional agent resolver controls/flags better handling of schema aware intent decisions 1.0.5 Commit: 6f6033d What changed: Session continuity improvements with inputParamsJson stronger propagation of input parameters across turns better task action resolution in rules/action path 1.0.4 Commit: 48aae75 What changed: Intent pipeline refactor to integrate RulesStep cleanly improved rule driven transition behavior richer audit emission around intent/rule flow 1.0.3 Line Commits: e302374 , 976c8f8 (and non linear branch point via d8faa28 ) What changed: Intent/state handling updates response transformation improvements container data handling and schema path upgrades new JSON/session action resolvers and structured auditing 1.0.1 / 1.0.0 Foundation Commits: cb38cc8 , 7e778cc , 1ff9681 What changed: Initial publish line and project metadata hardening dependency/property cleanup in pom.xml foundational entities/interfaces and deterministic engine baseline Current State Snapshot","rawContent":"# Version History <Highlight type=\\"info\\" title=\\"Important note on sequence\\"> Current published artifact in pom.xml is <MethodRef>1.0.15</MethodRef>. </Highlight> ## Artifact Version Bumps ( pom.xml ) <DbTable title=\\"Version bump trail from Git\\" columns={[\\"Date\\", \\"Commit\\", \\"pom.xml change\\", \\"Headline\\"]} rows={[ [\\"2026-02-19\\", \\"c820cf6\\", \\"1.0.14 -> 1.0.15\\", \\"Schema resolver provider refactor + centralized audit/payload/input-param keys\\"], [\\"2026-02-19\\", \\"working-tree\\", \\"1.0.13 -> 1.0.14\\", \\"Added ce_rule.state_code rule scoping support\\"], [\\"2026-02-19\\", \\"working-tree\\", \\"1.0.12 -> 1.0.13\\", \\"Audit persistence strategy split + sync conversation history table\\"], [\\"2026-02-19\\", \\"working-tree\\", \\"1.0.11 -> 1.0.12\\", \\"Audit metadata enrichment ( inputParams vs userInputParams )\\"], [\\"2026-02-18\\", \\"working-tree\\", \\"1.0.10 -> 1.0.11\\", \\"Cross-database persistence hardening + sticky intent refinement\\"], [\\"2026-02-17\\", \\"working-tree\\", \\"1.0.9 -> 1.0.10\\", \\"Rule phase model + sticky intent continuity + stream validator hardening\\"], [\\"2026-02-16\\", \\"695ef79\\", \\"1.0.8 -> 1.0.9\\", \\"Experimental SQL generation zip export + SQL-by-table response model\\"], [\\"2026-02-14\\", \\"a2daeec\\", \\"1.0.7 -> 1.0.8\\", \\"Audit listener model + SSE/STOMP transport + reset flow\\"], [\\"2026-02-13\\", \\"05f9077\\", \\"1.0.6 -> 1.0.7\\", \\"Schema handling + agent resolver controls\\"], [\\"2026-02-13\\", \\"working-tree\\", \\"1.0.5 -> 1.0.6\\", \\"Internal release cut (no separate public note)\\"], [\\"2026-02-12\\", \\"6f6033d\\", \\"1.0.4 -> 1.0.5\\", \\"inputParamsJson and better session continuity\\"], [\\"2026-02-12\\", \\"48aae75\\", \\"1.0.3 -> 1.0.4\\", \\"RulesStep integration into intent flow + audit improvements\\"], [\\"2026-02-12\\", \\"976c8f8\\", \\"1.0.2 -> 1.0.3\\", \\"Response/session improvements + container/schema refinements\\"], [\\"2026-02-08\\", \\"d8faa28\\", \\"1.0.1 -> 1.0.2\\", \\"JSON/session action resolver improvements\\"], [\\"2026-01-28\\", \\"cb38cc8\\", \\"1.0.0 -> 1.0.1\\", \\"Release bump + core dependency refresh\\"], [\\"2026-01-04\\", \\"1ff9681\\", \\"-> 1.0.0\\", \\"Base code: core entities and interfaces\\"], ]} /> ## Release Notes By Version ### 1.0.15 (Current in pom.xml ) What changed: - Refactored SchemaExtractionStep into orchestration-only flow and moved schema-heavy calculation into provider contract. - Added provider computation model: - ConvEngineSchemaComputation - ConvEngineSchemaResolver#compute(...) - ConvEngineSchemaResolver#sanitizeExtractedJson(...) - ConvEngineSchemaResolver#mergeContextJson(...) - DefaultConvEngineSchemaResolver now owns sanitize/merge/completeness/missing-fields/missing-options behavior. - Clean provider override model for consumers: - consumers can register their own ConvEngineSchemaResolver bean - selection honors higher precedence via Spring @Order . - Centralized runtime input-param keys into ConvEngineInputParamKey . - Centralized fixed audit stages into ConvEngineAuditStage . - Added dynamic audit-stage helper for resolved-intent source: - ConvEngineAuditStage.intentResolvedBy(...) - Centralized payload map keys into ConvEnginePayloadKey . ### 1.0.14 What changed: - Added optional ce_rule.state_code to scope rule execution by state. - Runtime matching contract: - NULL -> applies to all states - ANY -> applies to all states - exact value -> applies only when session state matches (case-insensitive) ### 1.0.13 What changed: - Split audit DB persistence into strategy classes ( IMMEDIATE and DEFERRED_BULK ) selected by factory at runtime. - Kept ce_conversation_history persistence synchronous on every eligible stage to keep prompt {{conversation_history}} deterministic. - Allowed ce_audit to run deferred-bulk while preserving conversation history availability. - Added _meta persistence toggle via convengine.audit.persist-meta . - Removed framework-bundled default application.yaml ; consumer now owns convengine.* config. ### 1.0.12 What changed: - Added audit metadata enrichment for every stage: - _meta.inputParams : runtime/session-mutated parameter view - _meta.userInputParams : API-origin parameter snapshot - Added controller-ingress deep-copy isolation for userInputParams so nested request objects are immutable from later runtime mutations. - Extracted deep-copy logic into a reusable engine helper: - com.github.salilvnair.convengine.engine.helper.InputParamsHelper ### 1.0.11 What changed: - Added cross-database persistence hardening across SQLite, Postgres, and Oracle: - JSON column binding now uses Hibernate JSON JDBC typing for jsonb paths - audit persistence now uses dialect-aware JSON/timestamp JDBC binding - Added SQLite legacy runtime normalization at startup: - normalizes epoch timestamp text rows into parse-safe datetime text - normalizes legacy BLOB conversation_id rows into canonical UUID text - Refined sticky intent semantics: - sticky skip now applies only during active incomplete-schema collection - outside schema collection, intent can re-resolve for semantically new turns ### 1.0.10 What changed: - Added ce_rule.phase execution model: - PIPELINE_RULES - AGENT_POST_INTENT - Added runtime rule-phase filtering so: - RulesStep executes only PIPELINE_RULES - AgentIntentResolver post-intent pass executes only AGENT_POST_INTENT - Added session/input metadata for rule-source awareness: - postIntentRule , post_intent_rule - rule_phase - rule_execution_source , rule_execution_origin - Added post-intent rule invocation after accepted agent intent. - Added sticky intent continuity controls: - IntentResolutionStep.STICKY_INTENT ( ce_config , default true ) - skip intent re-resolution when intent/state are already resolved - added audit stage INTENT_RESOLVE_SKIPPED_STICKY_INTENT - explicit reset/switch/force signals still allow re-resolution - Updated prompt variable exposure: - prompt extra now receives all inputParams keys - includes runtime/system-derived keys set via session.putInputParam(...) - Hardened stream startup validation and condition timing behavior to avoid false-positive startup failures. - Updated SQL generation docs/prompts to include ce_rule.phase contract. ### 1.0.9 Commit: 695ef79 What changed: - Enhanced experimental SQL generation API output for consumer import workflows. - Added SQL-by-table response structure to make generated output easier to inspect and apply incrementally. - Added zip packaging support with per-table SQL files plus combined seed.sql . - Updated docs and SQL generation guidance for clarity and alignment with current runtime model. ### 1.0.8 Commits: - a2daeec core release bump and transport/audit foundation - 57a2faa async audit dispatch + deferred flush controls (post-bump enhancements on same line) - c5c665f typed step API via <MethodRef>EngineStep.Name</MethodRef> - 0c2c557 rule action rename to <MethodRef>GET_SCHEMA_JSON</MethodRef> What changed in detail: - Added streaming transport stack: - SSE and STOMP/WebSocket support - consumer-configurable stream mode - Added audit event plumbing: - AuditEventListener extension point - stage broadcast path for streaming UIs - Added advanced audit controls: - async dispatch workers - queue/backpressure policy - deferred bulk persistence + flush triggers - Strengthened step extension API: - string-based step matching replaced by typed <MethodRef>EngineStep.Name</MethodRef> - safer EngineStepHook contracts ( supports/beforeStep/afterStep/onStepError ) - Renamed schema action contract: - GET_SCHEMA_EXTRACTED_DATA -> GET_SCHEMA_JSON - aligned resolver/session access semantics ### 1.0.7 Commit: 05f9077 What changed: - Schema extraction and intent resolution refinements - additional agent resolver controls/flags - better handling of schema-aware intent decisions ### 1.0.5 Commit: 6f6033d What changed: - Session continuity improvements with inputParamsJson - stronger propagation of input parameters across turns - better task action resolution in rules/action path ### 1.0.4 Commit: 48aae75 What changed: - Intent pipeline refactor to integrate <MethodRef>RulesStep</MethodRef> cleanly - improved rule-driven transition behavior - richer audit emission around intent/rule flow ### 1.0.3 Line Commits: e302374 , 976c8f8 (and non-linear branch point via d8faa28 ) What changed: - Intent/state handling updates - response transformation improvements - container data handling and schema path upgrades - new JSON/session action resolvers and structured auditing ### 1.0.1 / 1.0.0 Foundation Commits: cb38cc8 , 7e778cc , 1ff9681 What changed: - Initial publish line and project metadata hardening - dependency/property cleanup in pom.xml - foundational entities/interfaces and deterministic engine baseline ## Current State Snapshot <DbTable title=\\"Current library status\\" columns={[\\"Signal\\", \\"Value\\"]} rows={[ [\\"Artifact version ( pom.xml )\\", \\"1.0.15\\"], [\\"Engine extension style\\", \\"Typed step hooks via EngineStep.Name\\"], [\\"Streaming\\", \\"REST + SSE + STOMP/WebSocket\\"], [\\"Audit model\\", \\"Immediate or deferred bulk persistence with async dispatch options\\"], [\\"Schema rule action\\", \\"GET_SCHEMA_JSON\\"], [\\"Rule phase contract\\", \\"PIPELINE_RULES + AGENT_POST_INTENT\\"], ]} />","excerpt":"Version History Current published artifact in pom.xml is 1.0.15 . Artifact Version Bumps ( pom.xml ) 1.0.15\\", \\"Schema resolver provider refactor + centralized audit/payload/input param keys\\"], [\\"2026 02 19\\", \\"working tre\u2026"}]')},545(e,t,n){"use strict";n.d(t,{mg:()=>Z,vd:()=>W});var o=n(6540),a=n(5556),i=n.n(a),s=n(115),r=n.n(s),l=n(311),c=n.n(l),u=n(2833),d=n.n(u);function p(){return p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},p.apply(this,arguments)}function m(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,g(e,t)}function g(e,t){return g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},g(e,t)}function f(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)t.indexOf(n=i[o])>=0||(a[n]=e[n]);return a}var h={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title",FRAGMENT:"Symbol(react.fragment)"},v={rel:["amphtml","canonical","alternate"]},y={type:["application/ld+json"]},b={charset:"",name:["robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]},E=Object.keys(h).map(function(e){return h[e]}),S={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},T=Object.keys(S).reduce(function(e,t){return e[S[t]]=t,e},{}),_=function(e,t){for(var n=e.length-1;n>=0;n-=1){var o=e[n];if(Object.prototype.hasOwnProperty.call(o,t))return o[t]}return null},C=function(e){var t=_(e,h.TITLE),n=_(e,"titleTemplate");if(Array.isArray(t)&&(t=t.join("")),n&&t)return n.replace(/%s/g,function(){return t});var o=_(e,"defaultTitle");return t||o||void 0},I=function(e){return _(e,"onChangeClientState")||function(){}},R=function(e,t){return t.filter(function(t){return void 0!==t[e]}).map(function(t){return t[e]}).reduce(function(e,t){return p({},e,t)},{})},A=function(e,t){return t.filter(function(e){return void 0!==e[h.BASE]}).map(function(e){return e[h.BASE]}).reverse().reduce(function(t,n){if(!t.length)for(var o=Object.keys(n),a=0;a<o.length;a+=1){var i=o[a].toLowerCase();if(-1!==e.indexOf(i)&&n[i])return t.concat(n)}return t},[])},N=function(e,t,n){var o={};return n.filter(function(t){return!!Array.isArray(t[e])||(void 0!==t[e]&&console&&"function"==typeof console.warn&&console.warn("Helmet: "+e+' should be of type "Array". Instead found type "'+typeof t[e]+'"'),!1)}).map(function(t){return t[e]}).reverse().reduce(function(e,n){var a={};n.filter(function(e){for(var n,i=Object.keys(e),s=0;s<i.length;s+=1){var r=i[s],l=r.toLowerCase();-1===t.indexOf(l)||"rel"===n&&"canonical"===e[n].toLowerCase()||"rel"===l&&"stylesheet"===e[l].toLowerCase()||(n=l),-1===t.indexOf(r)||"innerHTML"!==r&&"cssText"!==r&&"itemprop"!==r||(n=r)}if(!n||!e[n])return!1;var c=e[n].toLowerCase();return o[n]||(o[n]={}),a[n]||(a[n]={}),!o[n][c]&&(a[n][c]=!0,!0)}).reverse().forEach(function(t){return e.push(t)});for(var i=Object.keys(a),s=0;s<i.length;s+=1){var r=i[s],l=p({},o[r],a[r]);o[r]=l}return e},[]).reverse()},x=function(e,t){if(Array.isArray(e)&&e.length)for(var n=0;n<e.length;n+=1)if(e[n][t])return!0;return!1},w=function(e){return Array.isArray(e)?e.join(""):e},P=function(e,t){return Array.isArray(e)?e.reduce(function(e,n){return function(e,t){for(var n=Object.keys(e),o=0;o<n.length;o+=1)if(t[n[o]]&&t[n[o]].includes(e[n[o]]))return!0;return!1}(n,t)?e.priority.push(n):e.default.push(n),e},{priority:[],default:[]}):{default:e}},k=function(e,t){var n;return p({},e,((n={})[t]=void 0,n))},O=[h.NOSCRIPT,h.SCRIPT,h.STYLE],L=function(e,t){return void 0===t&&(t=!0),!1===t?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},D=function(e){return Object.keys(e).reduce(function(t,n){var o=void 0!==e[n]?n+'="'+e[n]+'"':""+n;return t?t+" "+o:o},"")},M=function(e,t){return void 0===t&&(t={}),Object.keys(e).reduce(function(t,n){return t[S[n]||n]=e[n],t},t)},U=function(e,t){return t.map(function(t,n){var a,i=((a={key:n})["data-rh"]=!0,a);return Object.keys(t).forEach(function(e){var n=S[e]||e;"innerHTML"===n||"cssText"===n?i.dangerouslySetInnerHTML={__html:t.innerHTML||t.cssText}:i[n]=t[e]}),o.createElement(e,i)})},F=function(e,t,n){switch(e){case h.TITLE:return{toComponent:function(){return n=t.titleAttributes,(a={key:e=t.title})["data-rh"]=!0,i=M(n,a),[o.createElement(h.TITLE,i,e)];var e,n,a,i},toString:function(){return function(e,t,n,o){var a=D(n),i=w(t);return a?"<"+e+' data-rh="true" '+a+">"+L(i,o)+"</"+e+">":"<"+e+' data-rh="true">'+L(i,o)+"</"+e+">"}(e,t.title,t.titleAttributes,n)}};case"bodyAttributes":case"htmlAttributes":return{toComponent:function(){return M(t)},toString:function(){return D(t)}};default:return{toComponent:function(){return U(e,t)},toString:function(){return function(e,t,n){return t.reduce(function(t,o){var a=Object.keys(o).filter(function(e){return!("innerHTML"===e||"cssText"===e)}).reduce(function(e,t){var a=void 0===o[t]?t:t+'="'+L(o[t],n)+'"';return e?e+" "+a:a},""),i=o.innerHTML||o.cssText||"",s=-1===O.indexOf(e);return t+"<"+e+' data-rh="true" '+a+(s?"/>":">"+i+"</"+e+">")},"")}(e,t,n)}}}},j=function(e){var t=e.baseTag,n=e.bodyAttributes,o=e.encode,a=e.htmlAttributes,i=e.noscriptTags,s=e.styleTags,r=e.title,l=void 0===r?"":r,c=e.titleAttributes,u=e.linkTags,d=e.metaTags,p=e.scriptTags,m={toComponent:function(){},toString:function(){return""}};if(e.prioritizeSeoTags){var g=function(e){var t=e.linkTags,n=e.scriptTags,o=e.encode,a=P(e.metaTags,b),i=P(t,v),s=P(n,y);return{priorityMethods:{toComponent:function(){return[].concat(U(h.META,a.priority),U(h.LINK,i.priority),U(h.SCRIPT,s.priority))},toString:function(){return F(h.META,a.priority,o)+" "+F(h.LINK,i.priority,o)+" "+F(h.SCRIPT,s.priority,o)}},metaTags:a.default,linkTags:i.default,scriptTags:s.default}}(e);m=g.priorityMethods,u=g.linkTags,d=g.metaTags,p=g.scriptTags}return{priority:m,base:F(h.BASE,t,o),bodyAttributes:F("bodyAttributes",n,o),htmlAttributes:F("htmlAttributes",a,o),link:F(h.LINK,u,o),meta:F(h.META,d,o),noscript:F(h.NOSCRIPT,i,o),script:F(h.SCRIPT,p,o),style:F(h.STYLE,s,o),title:F(h.TITLE,{title:l,titleAttributes:c},o)}},B=[],q=function(e,t){var n=this;void 0===t&&(t="undefined"!=typeof document),this.instances=[],this.value={setHelmet:function(e){n.context.helmet=e},helmetInstances:{get:function(){return n.canUseDOM?B:n.instances},add:function(e){(n.canUseDOM?B:n.instances).push(e)},remove:function(e){var t=(n.canUseDOM?B:n.instances).indexOf(e);(n.canUseDOM?B:n.instances).splice(t,1)}}},this.context=e,this.canUseDOM=t,t||(e.helmet=j({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))},G=o.createContext({}),H=i().shape({setHelmet:i().func,helmetInstances:i().shape({get:i().func,add:i().func,remove:i().func})}),z="undefined"!=typeof document,W=function(e){function t(n){var o;return(o=e.call(this,n)||this).helmetData=new q(o.props.context,t.canUseDOM),o}return m(t,e),t.prototype.render=function(){return o.createElement(G.Provider,{value:this.helmetData.value},this.props.children)},t}(o.Component);W.canUseDOM=z,W.propTypes={context:i().shape({helmet:i().shape()}),children:i().node.isRequired},W.defaultProps={context:{}},W.displayName="HelmetProvider";var K=function(e,t){var n,o=document.head||document.querySelector(h.HEAD),a=o.querySelectorAll(e+"[data-rh]"),i=[].slice.call(a),s=[];return t&&t.length&&t.forEach(function(t){var o=document.createElement(e);for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&("innerHTML"===a?o.innerHTML=t.innerHTML:"cssText"===a?o.styleSheet?o.styleSheet.cssText=t.cssText:o.appendChild(document.createTextNode(t.cssText)):o.setAttribute(a,void 0===t[a]?"":t[a]));o.setAttribute("data-rh","true"),i.some(function(e,t){return n=t,o.isEqualNode(e)})?i.splice(n,1):s.push(o)}),i.forEach(function(e){return e.parentNode.removeChild(e)}),s.forEach(function(e){return o.appendChild(e)}),{oldTags:i,newTags:s}},V=function(e,t){var n=document.getElementsByTagName(e)[0];if(n){for(var o=n.getAttribute("data-rh"),a=o?o.split(","):[],i=[].concat(a),s=Object.keys(t),r=0;r<s.length;r+=1){var l=s[r],c=t[l]||"";n.getAttribute(l)!==c&&n.setAttribute(l,c),-1===a.indexOf(l)&&a.push(l);var u=i.indexOf(l);-1!==u&&i.splice(u,1)}for(var d=i.length-1;d>=0;d-=1)n.removeAttribute(i[d]);a.length===i.length?n.removeAttribute("data-rh"):n.getAttribute("data-rh")!==s.join(",")&&n.setAttribute("data-rh",s.join(","))}},$=function(e,t){var n=e.baseTag,o=e.htmlAttributes,a=e.linkTags,i=e.metaTags,s=e.noscriptTags,r=e.onChangeClientState,l=e.scriptTags,c=e.styleTags,u=e.title,d=e.titleAttributes;V(h.BODY,e.bodyAttributes),V(h.HTML,o),function(e,t){void 0!==e&&document.title!==e&&(document.title=w(e)),V(h.TITLE,t)}(u,d);var p={baseTag:K(h.BASE,n),linkTags:K(h.LINK,a),metaTags:K(h.META,i),noscriptTags:K(h.NOSCRIPT,s),scriptTags:K(h.SCRIPT,l),styleTags:K(h.STYLE,c)},m={},g={};Object.keys(p).forEach(function(e){var t=p[e],n=t.newTags,o=t.oldTags;n.length&&(m[e]=n),o.length&&(g[e]=p[e].oldTags)}),t&&t(),r(e,m,g)},Y=null,J=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(t=e.call.apply(e,[this].concat(o))||this).rendered=!1,t}m(t,e);var n=t.prototype;return n.shouldComponentUpdate=function(e){return!d()(e,this.props)},n.componentDidUpdate=function(){this.emitChange()},n.componentWillUnmount=function(){this.props.context.helmetInstances.remove(this),this.emitChange()},n.emitChange=function(){var e,t,n=this.props.context,o=n.setHelmet,a=null,i=(e=n.helmetInstances.get().map(function(e){var t=p({},e.props);return delete t.context,t}),{baseTag:A(["href"],e),bodyAttributes:R("bodyAttributes",e),defer:_(e,"defer"),encode:_(e,"encodeSpecialCharacters"),htmlAttributes:R("htmlAttributes",e),linkTags:N(h.LINK,["rel","href"],e),metaTags:N(h.META,["name","charset","http-equiv","property","itemprop"],e),noscriptTags:N(h.NOSCRIPT,["innerHTML"],e),onChangeClientState:I(e),scriptTags:N(h.SCRIPT,["src","innerHTML"],e),styleTags:N(h.STYLE,["cssText"],e),title:C(e),titleAttributes:R("titleAttributes",e),prioritizeSeoTags:x(e,"prioritizeSeoTags")});W.canUseDOM?(t=i,Y&&cancelAnimationFrame(Y),t.defer?Y=requestAnimationFrame(function(){$(t,function(){Y=null})}):($(t),Y=null)):j&&(a=j(i)),o(a)},n.init=function(){this.rendered||(this.rendered=!0,this.props.context.helmetInstances.add(this),this.emitChange())},n.render=function(){return this.init(),null},t}(o.Component);J.propTypes={context:H.isRequired},J.displayName="HelmetDispatcher";var X=["children"],Q=["children"],Z=function(e){function t(){return e.apply(this,arguments)||this}m(t,e);var n=t.prototype;return n.shouldComponentUpdate=function(e){return!r()(k(this.props,"helmetData"),k(e,"helmetData"))},n.mapNestedChildrenToProps=function(e,t){if(!t)return null;switch(e.type){case h.SCRIPT:case h.NOSCRIPT:return{innerHTML:t};case h.STYLE:return{cssText:t};default:throw new Error("<"+e.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")}},n.flattenArrayTypeChildren=function(e){var t,n=e.child,o=e.arrayTypeChildren;return p({},o,((t={})[n.type]=[].concat(o[n.type]||[],[p({},e.newChildProps,this.mapNestedChildrenToProps(n,e.nestedChildren))]),t))},n.mapObjectTypeChildren=function(e){var t,n,o=e.child,a=e.newProps,i=e.newChildProps,s=e.nestedChildren;switch(o.type){case h.TITLE:return p({},a,((t={})[o.type]=s,t.titleAttributes=p({},i),t));case h.BODY:return p({},a,{bodyAttributes:p({},i)});case h.HTML:return p({},a,{htmlAttributes:p({},i)});default:return p({},a,((n={})[o.type]=p({},i),n))}},n.mapArrayTypeChildrenToProps=function(e,t){var n=p({},t);return Object.keys(e).forEach(function(t){var o;n=p({},n,((o={})[t]=e[t],o))}),n},n.warnOnInvalidChildren=function(e,t){return c()(E.some(function(t){return e.type===t}),"function"==typeof e.type?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":"Only elements types "+E.join(", ")+" are allowed. Helmet does not support rendering <"+e.type+"> elements. Refer to our API for more information."),c()(!t||"string"==typeof t||Array.isArray(t)&&!t.some(function(e){return"string"!=typeof e}),"Helmet expects a string as a child of <"+e.type+">. Did you forget to wrap your children in braces? ( <"+e.type+">{``}</"+e.type+"> ) Refer to our API for more information."),!0},n.mapChildrenToProps=function(e,t){var n=this,a={};return o.Children.forEach(e,function(e){if(e&&e.props){var o=e.props,i=o.children,s=f(o,X),r=Object.keys(s).reduce(function(e,t){return e[T[t]||t]=s[t],e},{}),l=e.type;switch("symbol"==typeof l?l=l.toString():n.warnOnInvalidChildren(e,i),l){case h.FRAGMENT:t=n.mapChildrenToProps(i,t);break;case h.LINK:case h.META:case h.NOSCRIPT:case h.SCRIPT:case h.STYLE:a=n.flattenArrayTypeChildren({child:e,arrayTypeChildren:a,newChildProps:r,nestedChildren:i});break;default:t=n.mapObjectTypeChildren({child:e,newProps:t,newChildProps:r,nestedChildren:i})}}}),this.mapArrayTypeChildrenToProps(a,t)},n.render=function(){var e=this.props,t=e.children,n=f(e,Q),a=p({},n),i=n.helmetData;return t&&(a=this.mapChildrenToProps(t,a)),!i||i instanceof q||(i=new q(i.context,i.instances)),i?o.createElement(J,p({},a,{context:i.value,helmetData:void 0})):o.createElement(G.Consumer,null,function(e){return o.createElement(J,p({},a,{context:e}))})},t}(o.Component);Z.propTypes={base:i().object,bodyAttributes:i().object,children:i().oneOfType([i().arrayOf(i().node),i().node]),defaultTitle:i().string,defer:i().bool,encodeSpecialCharacters:i().bool,htmlAttributes:i().object,link:i().arrayOf(i().object),meta:i().arrayOf(i().object),noscript:i().arrayOf(i().object),onChangeClientState:i().func,script:i().arrayOf(i().object),style:i().arrayOf(i().object),title:i().string,titleAttributes:i().object,titleTemplate:i().string,prioritizeSeoTags:i().bool,helmetData:i().object},Z.defaultProps={defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1},Z.displayName="Helmet"},609(e,t,n){"use strict";n.d(t,{V:()=>l,t:()=>c});var o=n(6540),a=n(9532),i=n(4848);const s=Symbol("EmptyContext"),r=o.createContext(s);function l({children:e,name:t,items:n}){const a=(0,o.useMemo)(()=>t&&n?{name:t,items:n}:null,[t,n]);return(0,i.jsx)(r.Provider,{value:a,children:e})}function c(){const e=(0,o.useContext)(r);if(e===s)throw new a.dV("DocsSidebarProvider");return e}},679(e,t,n){"use strict";n.d(t,{Wf:()=>u,Dv:()=>d});var o=n(6540);const a=JSON.parse('{"N":"localStorage","M":""}'),i=a.N;function s({key:e,oldValue:t,newValue:n,storage:o}){if(t===n)return;const a=document.createEvent("StorageEvent");a.initStorageEvent("storage",!1,!1,e,t,n,window.location.href,o),window.dispatchEvent(a)}function r(e=i){if("undefined"==typeof window)throw new Error("Browser storage is not available on Node.js/Docusaurus SSR process.");if("none"===e)return null;try{return window[e]}catch(n){return t=n,l||(console.warn("Docusaurus browser storage is not available.\nPossible reasons: running Docusaurus in an iframe, in an incognito browser session, or using too strict browser privacy settings.",t),l=!0),null}var t}let l=!1;const c={get:()=>null,set:()=>{},del:()=>{},listen:()=>()=>{}};function u(e,t){const n=`${e}${a.M}`;if("undefined"==typeof window)return function(e){function t(){throw new Error(`Illegal storage API usage for storage key "${e}".\nDocusaurus storage APIs are not supposed to be called on the server-rendering process.\nPlease only call storage APIs in effects and event handlers.`)}return{get:t,set:t,del:t,listen:t}}(n);const o=r(t?.persistence);return null===o?c:{get:()=>{try{return o.getItem(n)}catch(e){return console.error(`Docusaurus storage error, can't get key=${n}`,e),null}},set:e=>{try{const t=o.getItem(n);o.setItem(n,e),s({key:n,oldValue:t,newValue:e,storage:o})}catch(t){console.error(`Docusaurus storage error, can't set ${n}=${e}`,t)}},del:()=>{try{const e=o.getItem(n);o.removeItem(n),s({key:n,oldValue:e,newValue:null,storage:o})}catch(e){console.error(`Docusaurus storage error, can't delete key=${n}`,e)}},listen:e=>{try{const t=t=>{t.storageArea===o&&t.key===n&&e(t)};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)}catch(t){return console.error(`Docusaurus storage error, can't listen for changes of key=${n}`,t),()=>{}}}}}function d(e,t){const[n]=(0,o.useState)(()=>null===e?c:u(e,t)),a=(0,o.useCallback)(e=>"undefined"==typeof window?()=>{}:n.listen(e),[n]);return[(0,o.useSyncExternalStore)(a,()=>n.get(),()=>null),n]}},961(e,t,n){"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(6221)},1043(e,t,n){"use strict";n.r(t)},1107(e,t,n){"use strict";n.d(t,{A:()=>c});n(6540);var o=n(4164),a=n(1312),i=n(3535),s=n(8774),r=n(3427),l=n(4848);function c({as:e,id:t,...n}){const c=(0,r.A)(),u=(0,i.v)(t);if("h1"===e||!t)return(0,l.jsx)(e,{...n,id:void 0});c.collectAnchor(t);const d=(0,a.T)({id:"theme.common.headingLinkTitle",message:"Direct link to {heading}",description:"Title for link to heading"},{heading:"string"==typeof n.children?n.children:t});return(0,l.jsxs)(e,{...n,className:(0,o.A)("anchor",u,n.className),id:t,children:[n.children,(0,l.jsx)(s.A,{className:"hash-link",to:`#${t}`,"aria-label":d,title:d,translate:"no",children:"\u200b"})]})}},1122(e,t,n){"use strict";n.d(t,{A:()=>u});var o=n(6540),a=n(4164),i=n(2303),s=n(5293);const r={themedComponent:"themedComponent_mlkZ","themedComponent--light":"themedComponent--light_NVdE","themedComponent--dark":"themedComponent--dark_xIcU"};var l=n(4848);function c({className:e,children:t}){const n=(0,i.A)(),{colorMode:c}=(0,s.G)();return(0,l.jsx)(l.Fragment,{children:(n?"dark"===c?["dark"]:["light"]:["light","dark"]).map(n=>{const i=t({theme:n,className:(0,a.A)(e,r.themedComponent,r[`themedComponent--${n}`])});return(0,l.jsx)(o.Fragment,{children:i},n)})})}function u(e){const{sources:t,className:n,alt:o,...a}=e;return(0,l.jsx)(c,{className:n,children:({theme:e,className:n})=>(0,l.jsx)("img",{src:t[e],alt:o,className:n,...a})})}},1247(e,t,n){"use strict";var o=n(9982),a=n(6540),i=n(961);function s(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function l(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function c(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function d(e){if(l(e)!==e)throw Error(s(188))}function p(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=p(e)))return t;e=e.sibling}return null}var m=Object.assign,g=Symbol.for("react.element"),f=Symbol.for("react.transitional.element"),h=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),S=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),R=Symbol.for("react.lazy");Symbol.for("react.scope");var A=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var N=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var x=Symbol.iterator;function w(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=x&&e[x]||e["@@iterator"])?e:null}var P=Symbol.for("react.client.reference");function k(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===P?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case v:return"Fragment";case b:return"Profiler";case y:return"StrictMode";case _:return"Suspense";case C:return"SuspenseList";case A:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case h:return"Portal";case S:return e.displayName||"Context";case E:return(e._context.displayName||"Context")+".Consumer";case T:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case I:return null!==(t=e.displayName||null)?t:k(e.type)||"Memo";case R:t=e._payload,e=e._init;try{return k(e(t))}catch(n){}}return null}var O=Array.isArray,L=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,D=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M={pending:!1,data:null,method:null,action:null},U=[],F=-1;function j(e){return{current:e}}function B(e){0>F||(e.current=U[F],U[F]=null,F--)}function q(e,t){F++,U[F]=e.current,e.current=t}var G,H,z=j(null),W=j(null),K=j(null),V=j(null);function $(e,t){switch(q(K,t),q(W,e),q(z,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?vd(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=yd(t=vd(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}B(z),q(z,e)}function Y(){B(z),B(W),B(K)}function J(e){null!==e.memoizedState&&q(V,e);var t=z.current,n=yd(t,e.type);t!==n&&(q(W,e),q(z,n))}function X(e){W.current===e&&(B(z),B(W)),V.current===e&&(B(V),up._currentValue=M)}function Q(e){if(void 0===G)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);G=t&&t[1]||"",H=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+G+e+H}var Z=!1;function ee(e,t){if(!e||Z)return"";Z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(a){var o=a}Reflect.construct(e,[],n)}else{try{n.call()}catch(i){o=i}e.call(n.prototype)}}else{try{throw Error()}catch(s){o=s}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(r){if(r&&o&&"string"==typeof r.stack)return[r.stack,o.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var a=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");a&&a.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var i=o.DetermineComponentFrameRoot(),s=i[0],r=i[1];if(s&&r){var l=s.split("\n"),c=r.split("\n");for(a=o=0;o<l.length&&!l[o].includes("DetermineComponentFrameRoot");)o++;for(;a<c.length&&!c[a].includes("DetermineComponentFrameRoot");)a++;if(o===l.length||a===c.length)for(o=l.length-1,a=c.length-1;1<=o&&0<=a&&l[o]!==c[a];)a--;for(;1<=o&&0<=a;o--,a--)if(l[o]!==c[a]){if(1!==o||1!==a)do{if(o--,0>--a||l[o]!==c[a]){var u="\n"+l[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=a);break}}}finally{Z=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?Q(n):""}function te(e,t){switch(e.tag){case 26:case 27:case 5:return Q(e.type);case 16:return Q("Lazy");case 13:return e.child!==t&&null!==t?Q("Suspense Fallback"):Q("Suspense");case 19:return Q("SuspenseList");case 0:case 15:return ee(e.type,!1);case 11:return ee(e.type.render,!1);case 1:return ee(e.type,!0);case 31:return Q("Activity");default:return""}}function ne(e){try{var t="",n=null;do{t+=te(e,n),n=e,e=e.return}while(e);return t}catch(o){return"\nError generating stack: "+o.message+"\n"+o.stack}}var oe=Object.prototype.hasOwnProperty,ae=o.unstable_scheduleCallback,ie=o.unstable_cancelCallback,se=o.unstable_shouldYield,re=o.unstable_requestPaint,le=o.unstable_now,ce=o.unstable_getCurrentPriorityLevel,ue=o.unstable_ImmediatePriority,de=o.unstable_UserBlockingPriority,pe=o.unstable_NormalPriority,me=o.unstable_LowPriority,ge=o.unstable_IdlePriority,fe=o.log,he=o.unstable_setDisableYieldValue,ve=null,ye=null;function be(e){if("function"==typeof fe&&he(e),ye&&"function"==typeof ye.setStrictMode)try{ye.setStrictMode(ve,e)}catch(t){}}var Ee=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(Se(e)/Te|0)|0},Se=Math.log,Te=Math.LN2;var _e=256,Ce=262144,Ie=4194304;function Re(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ae(e,t,n){var o=e.pendingLanes;if(0===o)return 0;var a=0,i=e.suspendedLanes,s=e.pingedLanes;e=e.warmLanes;var r=134217727&o;return 0!==r?0!==(o=r&~i)?a=Re(o):0!==(s&=r)?a=Re(s):n||0!==(n=r&~e)&&(a=Re(n)):0!==(r=o&~i)?a=Re(r):0!==s?a=Re(s):n||0!==(n=o&~e)&&(a=Re(n)),0===a?0:0!==t&&t!==a&&0===(t&i)&&((i=a&-a)>=(n=t&-t)||32===i&&4194048&n)?t:a}function Ne(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function xe(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function we(){var e=Ie;return!(62914560&(Ie<<=1))&&(Ie=4194304),e}function Pe(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ke(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Oe(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var o=31-Ee(t);e.entangledLanes|=t,e.entanglements[o]=1073741824|e.entanglements[o]|261930&n}function Le(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var o=31-Ee(n),a=1<<o;a&t|e[o]&t&&(e[o]|=t),n&=~a}}function De(e,t){var n=t&-t;return 0!==((n=42&n?1:Me(n))&(e.suspendedLanes|t))?0:n}function Me(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Ue(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function Fe(){var e=D.p;return 0!==e?e:void 0===(e=window.event)?32:Rp(e.type)}function je(e,t){var n=D.p;try{return D.p=e,t()}finally{D.p=n}}var Be=Math.random().toString(36).slice(2),qe="__reactFiber$"+Be,Ge="__reactProps$"+Be,He="__reactContainer$"+Be,ze="__reactEvents$"+Be,We="__reactListeners$"+Be,Ke="__reactHandles$"+Be,Ve="__reactResources$"+Be,$e="__reactMarker$"+Be;function Ye(e){delete e[qe],delete e[Ge],delete e[ze],delete e[We],delete e[Ke]}function Je(e){var t=e[qe];if(t)return t;for(var n=e.parentNode;n;){if(t=n[He]||n[qe]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Md(e);null!==e;){if(n=e[qe])return n;e=Md(e)}return t}n=(e=n).parentNode}return null}function Xe(e){if(e=e[qe]||e[He]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function Qe(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(s(33))}function Ze(e){var t=e[Ve];return t||(t=e[Ve]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function et(e){e[$e]=!0}var tt=new Set,nt={};function ot(e,t){at(e,t),at(e+"Capture",t)}function at(e,t){for(nt[e]=t,e=0;e<t.length;e++)tt.add(t[e])}var it=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),st={},rt={};function lt(e,t,n){if(a=t,oe.call(rt,a)||!oe.call(st,a)&&(it.test(a)?rt[a]=!0:(st[a]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var o=t.toLowerCase().slice(0,5);if("data-"!==o&&"aria-"!==o)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var a}function ct(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function ut(e,t,n,o){if(null===o)e.removeAttribute(n);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+o)}}function dt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function pt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function mt(e){if(!e._valueTracker){var t=pt(e)?"checked":"value";e._valueTracker=function(e,t,n){var o=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&void 0!==o&&"function"==typeof o.get&&"function"==typeof o.set){var a=o.get,i=o.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){n=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:o.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function gt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),o="";return e&&(o=pt(e)?e.checked?"true":"false":e.value),(e=o)!==n&&(t.setValue(e),!0)}function ft(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var ht=/[\n"\\]/g;function vt(e){return e.replace(ht,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function yt(e,t,n,o,a,i,s,r){e.name="",null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s?e.type=s:e.removeAttribute("type"),null!=t?"number"===s?(0===t&&""===e.value||e.value!=t)&&(e.value=""+dt(t)):e.value!==""+dt(t)&&(e.value=""+dt(t)):"submit"!==s&&"reset"!==s||e.removeAttribute("value"),null!=t?Et(e,s,dt(t)):null!=n?Et(e,s,dt(n)):null!=o&&e.removeAttribute("value"),null==a&&null!=i&&(e.defaultChecked=!!i),null!=a&&(e.checked=a&&"function"!=typeof a&&"symbol"!=typeof a),null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&"boolean"!=typeof r?e.name=""+dt(r):e.removeAttribute("name")}function bt(e,t,n,o,a,i,s,r){if(null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&"boolean"!=typeof i&&(e.type=i),null!=t||null!=n){if(("submit"===i||"reset"===i)&&null==t)return void mt(e);n=null!=n?""+dt(n):"",t=null!=t?""+dt(t):n,r||t===e.value||(e.value=t),e.defaultValue=t}o="function"!=typeof(o=null!=o?o:a)&&"symbol"!=typeof o&&!!o,e.checked=r?e.checked:!!o,e.defaultChecked=!!o,null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s&&(e.name=s),mt(e)}function Et(e,t,n){"number"===t&&ft(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function St(e,t,n,o){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&o&&(e[n].defaultSelected=!0)}else{for(n=""+dt(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(o&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function Tt(e,t,n){null==t||((t=""+dt(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+dt(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function _t(e,t,n,o){if(null==t){if(null!=o){if(null!=n)throw Error(s(92));if(O(o)){if(1<o.length)throw Error(s(93));o=o[0]}n=o}null==n&&(n=""),t=n}n=dt(t),e.defaultValue=n,(o=e.textContent)===n&&""!==o&&null!==o&&(e.value=o),mt(e)}function Ct(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var It=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Rt(e,t,n){var o=0===t.indexOf("--");null==n||"boolean"==typeof n||""===n?o?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":o?e.setProperty(t,n):"number"!=typeof n||0===n||It.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function At(e,t,n){if(null!=t&&"object"!=typeof t)throw Error(s(62));if(e=e.style,null!=n){for(var o in n)!n.hasOwnProperty(o)||null!=t&&t.hasOwnProperty(o)||(0===o.indexOf("--")?e.setProperty(o,""):"float"===o?e.cssFloat="":e[o]="");for(var a in t)o=t[a],t.hasOwnProperty(a)&&n[a]!==o&&Rt(e,a,o)}else for(var i in t)t.hasOwnProperty(i)&&Rt(e,i,t[i])}function Nt(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),wt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Pt(e){return wt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function kt(){}var Ot=null;function Lt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Dt=null,Mt=null;function Ut(e){var t=Xe(e);if(t&&(e=t.stateNode)){var n=e[Ge]||null;e:switch(e=t.stateNode,t.type){case"input":if(yt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+vt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var o=n[t];if(o!==e&&o.form===e.form){var a=o[Ge]||null;if(!a)throw Error(s(90));yt(o,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name)}}for(t=0;t<n.length;t++)(o=n[t]).form===e.form&&gt(o)}break e;case"textarea":Tt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&St(e,!!n.multiple,t,!1)}}}var Ft=!1;function jt(e,t,n){if(Ft)return e(t,n);Ft=!0;try{return e(t)}finally{if(Ft=!1,(null!==Dt||null!==Mt)&&(Zc(),Dt&&(t=Dt,e=Mt,Mt=Dt=null,Ut(t),e)))for(t=0;t<e.length;t++)Ut(e[t])}}function Bt(e,t){var n=e.stateNode;if(null===n)return null;var o=n[Ge]||null;if(null===o)return null;n=o[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(o=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!o;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(s(231,t,typeof n));return n}var qt=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),Gt=!1;if(qt)try{var Ht={};Object.defineProperty(Ht,"passive",{get:function(){Gt=!0}}),window.addEventListener("test",Ht,Ht),window.removeEventListener("test",Ht,Ht)}catch(Xp){Gt=!1}var zt=null,Wt=null,Kt=null;function Vt(){if(Kt)return Kt;var e,t,n=Wt,o=n.length,a="value"in zt?zt.value:zt.textContent,i=a.length;for(e=0;e<o&&n[e]===a[e];e++);var s=o-e;for(t=1;t<=s&&n[o-t]===a[i-t];t++);return Kt=a.slice(e,1<t?1-t:void 0)}function $t(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Yt(){return!0}function Jt(){return!1}function Xt(e){function t(t,n,o,a,i){for(var s in this._reactName=t,this._targetInst=o,this.type=n,this.nativeEvent=a,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(a):a[s]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?Yt:Jt,this.isPropagationStopped=Jt,this}return m(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Yt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Yt)},persist:function(){},isPersistent:Yt}),t}var Qt,Zt,en,tn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nn=Xt(tn),on=m({},tn,{view:0,detail:0}),an=Xt(on),sn=m({},on,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==en&&(en&&"mousemove"===e.type?(Qt=e.screenX-en.screenX,Zt=e.screenY-en.screenY):Zt=Qt=0,en=e),Qt)},movementY:function(e){return"movementY"in e?e.movementY:Zt}}),rn=Xt(sn),ln=Xt(m({},sn,{dataTransfer:0})),cn=Xt(m({},on,{relatedTarget:0})),un=Xt(m({},tn,{animationName:0,elapsedTime:0,pseudoElement:0})),dn=Xt(m({},tn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),pn=Xt(m({},tn,{data:0})),mn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=fn[e])&&!!t[e]}function vn(){return hn}var yn=Xt(m({},on,{key:function(e){if(e.key){var t=mn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=$t(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?gn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vn,charCode:function(e){return"keypress"===e.type?$t(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?$t(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),bn=Xt(m({},sn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),En=Xt(m({},on,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vn})),Sn=Xt(m({},tn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Tn=Xt(m({},sn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),_n=Xt(m({},tn,{newState:0,oldState:0})),Cn=[9,13,27,32],In=qt&&"CompositionEvent"in window,Rn=null;qt&&"documentMode"in document&&(Rn=document.documentMode);var An=qt&&"TextEvent"in window&&!Rn,Nn=qt&&(!In||Rn&&8<Rn&&11>=Rn),xn=String.fromCharCode(32),wn=!1;function Pn(e,t){switch(e){case"keyup":return-1!==Cn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function kn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var On=!1;var Ln={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Ln[e.type]:"textarea"===t}function Mn(e,t,n,o){Dt?Mt?Mt.push(o):Mt=[o]:Dt=o,0<(t=od(t,"onChange")).length&&(n=new nn("onChange","change",null,n,o),e.push({event:n,listeners:t}))}var Un=null,Fn=null;function jn(e){Yu(e,0)}function Bn(e){if(gt(Qe(e)))return e}function qn(e,t){if("change"===e)return t}var Gn=!1;if(qt){var Hn;if(qt){var zn="oninput"in document;if(!zn){var Wn=document.createElement("div");Wn.setAttribute("oninput","return;"),zn="function"==typeof Wn.oninput}Hn=zn}else Hn=!1;Gn=Hn&&(!document.documentMode||9<document.documentMode)}function Kn(){Un&&(Un.detachEvent("onpropertychange",Vn),Fn=Un=null)}function Vn(e){if("value"===e.propertyName&&Bn(Fn)){var t=[];Mn(t,Fn,e,Lt(e)),jt(jn,t)}}function $n(e,t,n){"focusin"===e?(Kn(),Fn=n,(Un=t).attachEvent("onpropertychange",Vn)):"focusout"===e&&Kn()}function Yn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Bn(Fn)}function Jn(e,t){if("click"===e)return Bn(t)}function Xn(e,t){if("input"===e||"change"===e)return Bn(t)}var Qn="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function Zn(e,t){if(Qn(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(o=0;o<n.length;o++){var a=n[o];if(!oe.call(t,a)||!Qn(e[a],t[a]))return!1}return!0}function eo(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function to(e,t){var n,o=eo(e);for(e=0;o;){if(3===o.nodeType){if(n=e+o.textContent.length,e<=t&&n>=t)return{node:o,offset:t-e};e=n}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=eo(o)}}function no(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?no(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function oo(e){for(var t=ft((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(o){n=!1}if(!n)break;t=ft((e=t.contentWindow).document)}return t}function ao(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var io=qt&&"documentMode"in document&&11>=document.documentMode,so=null,ro=null,lo=null,co=!1;function uo(e,t,n){var o=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;co||null==so||so!==ft(o)||("selectionStart"in(o=so)&&ao(o)?o={start:o.selectionStart,end:o.selectionEnd}:o={anchorNode:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset},lo&&Zn(lo,o)||(lo=o,0<(o=od(ro,"onSelect")).length&&(t=new nn("onSelect","select",null,t,n),e.push({event:t,listeners:o}),t.target=so)))}function po(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var mo={animationend:po("Animation","AnimationEnd"),animationiteration:po("Animation","AnimationIteration"),animationstart:po("Animation","AnimationStart"),transitionrun:po("Transition","TransitionRun"),transitionstart:po("Transition","TransitionStart"),transitioncancel:po("Transition","TransitionCancel"),transitionend:po("Transition","TransitionEnd")},go={},fo={};function ho(e){if(go[e])return go[e];if(!mo[e])return e;var t,n=mo[e];for(t in n)if(n.hasOwnProperty(t)&&t in fo)return go[e]=n[t];return e}qt&&(fo=document.createElement("div").style,"AnimationEvent"in window||(delete mo.animationend.animation,delete mo.animationiteration.animation,delete mo.animationstart.animation),"TransitionEvent"in window||delete mo.transitionend.transition);var vo=ho("animationend"),yo=ho("animationiteration"),bo=ho("animationstart"),Eo=ho("transitionrun"),So=ho("transitionstart"),To=ho("transitioncancel"),_o=ho("transitionend"),Co=new Map,Io="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ro(e,t){Co.set(e,t),ot(t,[e])}Io.push("scrollEnd");var Ao="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},No=[],xo=0,wo=0;function Po(){for(var e=xo,t=wo=xo=0;t<e;){var n=No[t];No[t++]=null;var o=No[t];No[t++]=null;var a=No[t];No[t++]=null;var i=No[t];if(No[t++]=null,null!==o&&null!==a){var s=o.pending;null===s?a.next=a:(a.next=s.next,s.next=a),o.pending=a}0!==i&&Do(n,a,i)}}function ko(e,t,n,o){No[xo++]=e,No[xo++]=t,No[xo++]=n,No[xo++]=o,wo|=o,e.lanes|=o,null!==(e=e.alternate)&&(e.lanes|=o)}function Oo(e,t,n,o){return ko(e,t,n,o),Mo(e)}function Lo(e,t){return ko(e,null,null,t),Mo(e)}function Do(e,t,n){e.lanes|=n;var o=e.alternate;null!==o&&(o.lanes|=n);for(var a=!1,i=e.return;null!==i;)i.childLanes|=n,null!==(o=i.alternate)&&(o.childLanes|=n),22===i.tag&&(null===(e=i.stateNode)||1&e._visibility||(a=!0)),e=i,i=i.return;return 3===e.tag?(i=e.stateNode,a&&null!==t&&(a=31-Ee(n),null===(o=(e=i.hiddenUpdates)[a])?e[a]=[t]:o.push(t),t.lane=536870912|n),i):null}function Mo(e){if(50<zc)throw zc=0,Wc=null,Error(s(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Uo={};function Fo(e,t,n,o){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jo(e,t,n,o){return new Fo(e,t,n,o)}function Bo(e){return!(!(e=e.prototype)||!e.isReactComponent)}function qo(e,t){var n=e.alternate;return null===n?((n=jo(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Go(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Ho(e,t,n,o,a,i){var r=0;if(o=e,"function"==typeof e)Bo(e)&&(r=1);else if("string"==typeof e)r=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,n,z.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case A:return(e=jo(31,n,t,a)).elementType=A,e.lanes=i,e;case v:return zo(n.children,a,i,t);case y:r=8,a|=24;break;case b:return(e=jo(12,n,t,2|a)).elementType=b,e.lanes=i,e;case _:return(e=jo(13,n,t,a)).elementType=_,e.lanes=i,e;case C:return(e=jo(19,n,t,a)).elementType=C,e.lanes=i,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case S:r=10;break e;case E:r=9;break e;case T:r=11;break e;case I:r=14;break e;case R:r=16,o=null;break e}r=29,n=Error(s(130,null===e?"null":typeof e,"")),o=null}return(t=jo(r,n,t,a)).elementType=e,t.type=o,t.lanes=i,t}function zo(e,t,n,o){return(e=jo(7,e,o,t)).lanes=n,e}function Wo(e,t,n){return(e=jo(6,e,null,t)).lanes=n,e}function Ko(e){var t=jo(18,null,null,0);return t.stateNode=e,t}function Vo(e,t,n){return(t=jo(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var $o=new WeakMap;function Yo(e,t){if("object"==typeof e&&null!==e){var n=$o.get(e);return void 0!==n?n:(t={value:e,source:t,stack:ne(t)},$o.set(e,t),t)}return{value:e,source:t,stack:ne(t)}}var Jo=[],Xo=0,Qo=null,Zo=0,ea=[],ta=0,na=null,oa=1,aa="";function ia(e,t){Jo[Xo++]=Zo,Jo[Xo++]=Qo,Qo=e,Zo=t}function sa(e,t,n){ea[ta++]=oa,ea[ta++]=aa,ea[ta++]=na,na=e;var o=oa;e=aa;var a=32-Ee(o)-1;o&=~(1<<a),n+=1;var i=32-Ee(t)+a;if(30<i){var s=a-a%5;i=(o&(1<<s)-1).toString(32),o>>=s,a-=s,oa=1<<32-Ee(t)+a|n<<a|o,aa=i+e}else oa=1<<i|n<<a|o,aa=e}function ra(e){null!==e.return&&(ia(e,1),sa(e,1,0))}function la(e){for(;e===Qo;)Qo=Jo[--Xo],Jo[Xo]=null,Zo=Jo[--Xo],Jo[Xo]=null;for(;e===na;)na=ea[--ta],ea[ta]=null,aa=ea[--ta],ea[ta]=null,oa=ea[--ta],ea[ta]=null}function ca(e,t){ea[ta++]=oa,ea[ta++]=aa,ea[ta++]=na,oa=t.id,aa=t.overflow,na=e}var ua=null,da=null,pa=!1,ma=null,ga=!1,fa=Error(s(519));function ha(e){throw Ta(Yo(Error(s(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),fa}function va(e){var t=e.stateNode,n=e.type,o=e.memoizedProps;switch(t[qe]=e,t[Ge]=o,n){case"dialog":Ju("cancel",t),Ju("close",t);break;case"iframe":case"object":case"embed":Ju("load",t);break;case"video":case"audio":for(n=0;n<Vu.length;n++)Ju(Vu[n],t);break;case"source":Ju("error",t);break;case"img":case"image":case"link":Ju("error",t),Ju("load",t);break;case"details":Ju("toggle",t);break;case"input":Ju("invalid",t),bt(t,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0);break;case"select":Ju("invalid",t);break;case"textarea":Ju("invalid",t),_t(t,o.value,o.defaultValue,o.children)}"string"!=typeof(n=o.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===o.suppressHydrationWarning||cd(t.textContent,n)?(null!=o.popover&&(Ju("beforetoggle",t),Ju("toggle",t)),null!=o.onScroll&&Ju("scroll",t),null!=o.onScrollEnd&&Ju("scrollend",t),null!=o.onClick&&(t.onclick=kt),t=!0):t=!1,t||ha(e,!0)}function ya(e){for(ua=e.return;ua;)switch(ua.tag){case 5:case 31:case 13:return void(ga=!1);case 27:case 3:return void(ga=!0);default:ua=ua.return}}function ba(e){if(e!==ua)return!1;if(!pa)return ya(e),pa=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||bd(e.type,e.memoizedProps)),t=!t),t&&da&&ha(e),ya(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));da=Dd(e)}else if(31===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));da=Dd(e)}else 27===n?(n=da,Rd(e.type)?(e=Ld,Ld=null,da=e):da=n):da=ua?Od(e.stateNode.nextSibling):null;return!0}function Ea(){da=ua=null,pa=!1}function Sa(){var e=ma;return null!==e&&(null===wc?wc=e:wc.push.apply(wc,e),ma=null),e}function Ta(e){null===ma?ma=[e]:ma.push(e)}var _a=j(null),Ca=null,Ia=null;function Ra(e,t,n){q(_a,t._currentValue),t._currentValue=n}function Aa(e){e._currentValue=_a.current,B(_a)}function Na(e,t,n){for(;null!==e;){var o=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==o&&(o.childLanes|=t)):null!==o&&(o.childLanes&t)!==t&&(o.childLanes|=t),e===n)break;e=e.return}}function xa(e,t,n,o){var a=e.child;for(null!==a&&(a.return=e);null!==a;){var i=a.dependencies;if(null!==i){var r=a.child;i=i.firstContext;e:for(;null!==i;){var l=i;i=a;for(var c=0;c<t.length;c++)if(l.context===t[c]){i.lanes|=n,null!==(l=i.alternate)&&(l.lanes|=n),Na(i.return,n,e),o||(r=null);break e}i=l.next}}else if(18===a.tag){if(null===(r=a.return))throw Error(s(341));r.lanes|=n,null!==(i=r.alternate)&&(i.lanes|=n),Na(r,n,e),r=null}else r=a.child;if(null!==r)r.return=a;else for(r=a;null!==r;){if(r===e){r=null;break}if(null!==(a=r.sibling)){a.return=r.return,r=a;break}r=r.return}a=r}}function wa(e,t,n,o){e=null;for(var a=t,i=!1;null!==a;){if(!i)if(524288&a.flags)i=!0;else if(262144&a.flags)break;if(10===a.tag){var r=a.alternate;if(null===r)throw Error(s(387));if(null!==(r=r.memoizedProps)){var l=a.type;Qn(a.pendingProps.value,r.value)||(null!==e?e.push(l):e=[l])}}else if(a===V.current){if(null===(r=a.alternate))throw Error(s(387));r.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(null!==e?e.push(up):e=[up])}a=a.return}null!==e&&xa(t,e,n,o),t.flags|=262144}function Pa(e){for(e=e.firstContext;null!==e;){if(!Qn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ka(e){Ca=e,Ia=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Oa(e){return Da(Ca,e)}function La(e,t){return null===Ca&&ka(e),Da(e,t)}function Da(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===Ia){if(null===e)throw Error(s(308));Ia=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Ia=Ia.next=t;return n}var Ma="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Ua=o.unstable_scheduleCallback,Fa=o.unstable_NormalPriority,ja={$$typeof:S,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ba(){return{controller:new Ma,data:new Map,refCount:0}}function qa(e){e.refCount--,0===e.refCount&&Ua(Fa,function(){e.controller.abort()})}var Ga=null,Ha=0,za=0,Wa=null;function Ka(){if(0===--Ha&&null!==Ga){null!==Wa&&(Wa.status="fulfilled");var e=Ga;Ga=null,za=0,Wa=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Va=L.S;L.S=function(e,t){Oc=le(),"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===Ga){var n=Ga=[];Ha=0,za=Gu(),Wa={status:"pending",value:void 0,then:function(e){n.push(e)}}}Ha++,t.then(Ka,Ka)}(0,t),null!==Va&&Va(e,t)};var $a=j(null);function Ya(){var e=$a.current;return null!==e?e:gc.pooledCache}function Ja(e,t){q($a,null===t?$a.current:t.pool)}function Xa(){var e=Ya();return null===e?null:{parent:ja._currentValue,pool:e}}var Qa=Error(s(460)),Za=Error(s(474)),ei=Error(s(542)),ti={then:function(){}};function ni(e){return"fulfilled"===(e=e.status)||"rejected"===e}function oi(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(kt,kt),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw ri(e=t.reason),e;default:if("string"==typeof t.status)t.then(kt,kt);else{if(null!==(e=gc)&&100<e.shellSuspendCounter)throw Error(s(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw ri(e=t.reason),e}throw ii=t,Qa}}function ai(e){try{return(0,e._init)(e._payload)}catch(t){if(null!==t&&"object"==typeof t&&"function"==typeof t.then)throw ii=t,Qa;throw t}}var ii=null;function si(){if(null===ii)throw Error(s(459));var e=ii;return ii=null,e}function ri(e){if(e===Qa||e===ei)throw Error(s(483))}var li=null,ci=0;function ui(e){var t=ci;return ci+=1,null===li&&(li=[]),oi(li,e,t)}function di(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function pi(e,t){if(t.$$typeof===g)throw Error(s(525));throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function mi(e){function t(t,n){if(e){var o=t.deletions;null===o?(t.deletions=[n],t.flags|=16):o.push(n)}}function n(n,o){if(!e)return null;for(;null!==o;)t(n,o),o=o.sibling;return null}function o(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function a(e,t){return(e=qo(e,t)).index=0,e.sibling=null,e}function i(t,n,o){return t.index=o,e?null!==(o=t.alternate)?(o=o.index)<n?(t.flags|=67108866,n):o:(t.flags|=67108866,n):(t.flags|=1048576,n)}function r(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,o){return null===t||6!==t.tag?((t=Wo(n,e.mode,o)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,o){var i=n.type;return i===v?d(e,t,n.props.children,o,n.key):null!==t&&(t.elementType===i||"object"==typeof i&&null!==i&&i.$$typeof===R&&ai(i)===t.type)?(di(t=a(t,n.props),n),t.return=e,t):(di(t=Ho(n.type,n.key,n.props,null,e.mode,o),n),t.return=e,t)}function u(e,t,n,o){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Vo(n,e.mode,o)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function d(e,t,n,o,i){return null===t||7!==t.tag?((t=zo(n,e.mode,o,i)).return=e,t):((t=a(t,n)).return=e,t)}function p(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Wo(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case f:return di(n=Ho(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case h:return(t=Vo(t,e.mode,n)).return=e,t;case R:return p(e,t=ai(t),n)}if(O(t)||w(t))return(t=zo(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return p(e,ui(t),n);if(t.$$typeof===S)return p(e,La(e,t),n);pi(e,t)}return null}function m(e,t,n,o){var a=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==a?null:l(e,t,""+n,o);if("object"==typeof n&&null!==n){switch(n.$$typeof){case f:return n.key===a?c(e,t,n,o):null;case h:return n.key===a?u(e,t,n,o):null;case R:return m(e,t,n=ai(n),o)}if(O(n)||w(n))return null!==a?null:d(e,t,n,o,null);if("function"==typeof n.then)return m(e,t,ui(n),o);if(n.$$typeof===S)return m(e,t,La(e,n),o);pi(e,n)}return null}function g(e,t,n,o,a){if("string"==typeof o&&""!==o||"number"==typeof o||"bigint"==typeof o)return l(t,e=e.get(n)||null,""+o,a);if("object"==typeof o&&null!==o){switch(o.$$typeof){case f:return c(t,e=e.get(null===o.key?n:o.key)||null,o,a);case h:return u(t,e=e.get(null===o.key?n:o.key)||null,o,a);case R:return g(e,t,n,o=ai(o),a)}if(O(o)||w(o))return d(t,e=e.get(n)||null,o,a,null);if("function"==typeof o.then)return g(e,t,n,ui(o),a);if(o.$$typeof===S)return g(e,t,n,La(t,o),a);pi(t,o)}return null}function y(l,c,u,d){if("object"==typeof u&&null!==u&&u.type===v&&null===u.key&&(u=u.props.children),"object"==typeof u&&null!==u){switch(u.$$typeof){case f:e:{for(var b=u.key;null!==c;){if(c.key===b){if((b=u.type)===v){if(7===c.tag){n(l,c.sibling),(d=a(c,u.props.children)).return=l,l=d;break e}}else if(c.elementType===b||"object"==typeof b&&null!==b&&b.$$typeof===R&&ai(b)===c.type){n(l,c.sibling),di(d=a(c,u.props),u),d.return=l,l=d;break e}n(l,c);break}t(l,c),c=c.sibling}u.type===v?((d=zo(u.props.children,l.mode,d,u.key)).return=l,l=d):(di(d=Ho(u.type,u.key,u.props,null,l.mode,d),u),d.return=l,l=d)}return r(l);case h:e:{for(b=u.key;null!==c;){if(c.key===b){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(d=a(c,u.children||[])).return=l,l=d;break e}n(l,c);break}t(l,c),c=c.sibling}(d=Vo(u,l.mode,d)).return=l,l=d}return r(l);case R:return y(l,c,u=ai(u),d)}if(O(u))return function(a,s,r,l){for(var c=null,u=null,d=s,f=s=0,h=null;null!==d&&f<r.length;f++){d.index>f?(h=d,d=null):h=d.sibling;var v=m(a,d,r[f],l);if(null===v){null===d&&(d=h);break}e&&d&&null===v.alternate&&t(a,d),s=i(v,s,f),null===u?c=v:u.sibling=v,u=v,d=h}if(f===r.length)return n(a,d),pa&&ia(a,f),c;if(null===d){for(;f<r.length;f++)null!==(d=p(a,r[f],l))&&(s=i(d,s,f),null===u?c=d:u.sibling=d,u=d);return pa&&ia(a,f),c}for(d=o(d);f<r.length;f++)null!==(h=g(d,a,f,r[f],l))&&(e&&null!==h.alternate&&d.delete(null===h.key?f:h.key),s=i(h,s,f),null===u?c=h:u.sibling=h,u=h);return e&&d.forEach(function(e){return t(a,e)}),pa&&ia(a,f),c}(l,c,u,d);if(w(u)){if("function"!=typeof(b=w(u)))throw Error(s(150));return function(a,r,l,c){if(null==l)throw Error(s(151));for(var u=null,d=null,f=r,h=r=0,v=null,y=l.next();null!==f&&!y.done;h++,y=l.next()){f.index>h?(v=f,f=null):v=f.sibling;var b=m(a,f,y.value,c);if(null===b){null===f&&(f=v);break}e&&f&&null===b.alternate&&t(a,f),r=i(b,r,h),null===d?u=b:d.sibling=b,d=b,f=v}if(y.done)return n(a,f),pa&&ia(a,h),u;if(null===f){for(;!y.done;h++,y=l.next())null!==(y=p(a,y.value,c))&&(r=i(y,r,h),null===d?u=y:d.sibling=y,d=y);return pa&&ia(a,h),u}for(f=o(f);!y.done;h++,y=l.next())null!==(y=g(f,a,h,y.value,c))&&(e&&null!==y.alternate&&f.delete(null===y.key?h:y.key),r=i(y,r,h),null===d?u=y:d.sibling=y,d=y);return e&&f.forEach(function(e){return t(a,e)}),pa&&ia(a,h),u}(l,c,u=b.call(u),d)}if("function"==typeof u.then)return y(l,c,ui(u),d);if(u.$$typeof===S)return y(l,c,La(l,u),d);pi(l,u)}return"string"==typeof u&&""!==u||"number"==typeof u||"bigint"==typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(d=a(c,u)).return=l,l=d):(n(l,c),(d=Wo(u,l.mode,d)).return=l,l=d),r(l)):n(l,c)}return function(e,t,n,o){try{ci=0;var a=y(e,t,n,o);return li=null,a}catch(s){if(s===Qa||s===ei)throw s;var i=jo(29,s,null,e.mode);return i.lanes=o,i.return=e,i}}}var gi=mi(!0),fi=mi(!1),hi=!1;function vi(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function yi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function bi(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ei(e,t,n){var o=e.updateQueue;if(null===o)return null;if(o=o.shared,2&mc){var a=o.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),o.pending=t,t=Mo(e),Do(e,null,n),t}return ko(e,o,t,n),Mo(e)}function Si(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&n)){var o=t.lanes;n|=o&=e.pendingLanes,t.lanes=n,Le(e,n)}}function Ti(e,t){var n=e.updateQueue,o=e.alternate;if(null!==o&&n===(o=o.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var s={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===i?a=i=s:i=i.next=s,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:o.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:o.shared,callbacks:o.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var _i=!1;function Ci(){if(_i){if(null!==Wa)throw Wa}}function Ii(e,t,n,o){_i=!1;var a=e.updateQueue;hi=!1;var i=a.firstBaseUpdate,s=a.lastBaseUpdate,r=a.shared.pending;if(null!==r){a.shared.pending=null;var l=r,c=l.next;l.next=null,null===s?i=c:s.next=c,s=l;var u=e.alternate;null!==u&&((r=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===r?u.firstBaseUpdate=c:r.next=c,u.lastBaseUpdate=l))}if(null!==i){var d=a.baseState;for(s=0,u=c=l=null,r=i;;){var p=-536870913&r.lane,g=p!==r.lane;if(g?(hc&p)===p:(o&p)===p){0!==p&&p===za&&(_i=!0),null!==u&&(u=u.next={lane:0,tag:r.tag,payload:r.payload,callback:null,next:null});e:{var f=e,h=r;p=t;var v=n;switch(h.tag){case 1:if("function"==typeof(f=h.payload)){d=f.call(v,d,p);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(p="function"==typeof(f=h.payload)?f.call(v,d,p):f))break e;d=m({},d,p);break e;case 2:hi=!0}}null!==(p=r.callback)&&(e.flags|=64,g&&(e.flags|=8192),null===(g=a.callbacks)?a.callbacks=[p]:g.push(p))}else g={lane:p,tag:r.tag,payload:r.payload,callback:r.callback,next:null},null===u?(c=u=g,l=d):u=u.next=g,s|=p;if(null===(r=r.next)){if(null===(r=a.shared.pending))break;r=(g=r).next,g.next=null,a.lastBaseUpdate=g,a.shared.pending=null}}null===u&&(l=d),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=u,null===i&&(a.shared.lanes=0),Cc|=s,e.lanes=s,e.memoizedState=d}}function Ri(e,t){if("function"!=typeof e)throw Error(s(191,e));e.call(t)}function Ai(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)Ri(n[e],t)}var Ni=j(null),xi=j(0);function wi(e,t){q(xi,e=Tc),q(Ni,t),Tc=e|t.baseLanes}function Pi(){q(xi,Tc),q(Ni,Ni.current)}function ki(){Tc=xi.current,B(Ni),B(xi)}var Oi=j(null),Li=null;function Di(e){var t=e.alternate;q(Bi,1&Bi.current),q(Oi,e),null===Li&&(null===t||null!==Ni.current||null!==t.memoizedState)&&(Li=e)}function Mi(e){q(Bi,Bi.current),q(Oi,e),null===Li&&(Li=e)}function Ui(e){22===e.tag?(q(Bi,Bi.current),q(Oi,e),null===Li&&(Li=e)):Fi()}function Fi(){q(Bi,Bi.current),q(Oi,Oi.current)}function ji(e){B(Oi),Li===e&&(Li=null),B(Bi)}var Bi=j(0);function qi(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Pd(n)||kd(n)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(128&t.flags)return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Gi=0,Hi=null,zi=null,Wi=null,Ki=!1,Vi=!1,$i=!1,Yi=0,Ji=0,Xi=null,Qi=0;function Zi(){throw Error(s(321))}function es(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Qn(e[n],t[n]))return!1;return!0}function ts(e,t,n,o,a,i){return Gi=i,Hi=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,L.H=null===e||null===e.memoizedState?hr:vr,$i=!1,i=n(o,a),$i=!1,Vi&&(i=os(t,n,o,a)),ns(e),i}function ns(e){L.H=fr;var t=null!==zi&&null!==zi.next;if(Gi=0,Wi=zi=Hi=null,Ki=!1,Ji=0,Xi=null,t)throw Error(s(300));null===e||Or||null!==(e=e.dependencies)&&Pa(e)&&(Or=!0)}function os(e,t,n,o){Hi=e;var a=0;do{if(Vi&&(Xi=null),Ji=0,Vi=!1,25<=a)throw Error(s(301));if(a+=1,Wi=zi=null,null!=e.updateQueue){var i=e.updateQueue;i.lastEffect=null,i.events=null,i.stores=null,null!=i.memoCache&&(i.memoCache.index=0)}L.H=yr,i=t(n,o)}while(Vi);return i}function as(){var e=L.H,t=e.useState()[0];return t="function"==typeof t.then?us(t):t,e=e.useState()[0],(null!==zi?zi.memoizedState:null)!==e&&(Hi.flags|=1024),t}function is(){var e=0!==Yi;return Yi=0,e}function ss(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function rs(e){if(Ki){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Ki=!1}Gi=0,Wi=zi=Hi=null,Vi=!1,Ji=Yi=0,Xi=null}function ls(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Wi?Hi.memoizedState=Wi=e:Wi=Wi.next=e,Wi}function cs(){if(null===zi){var e=Hi.alternate;e=null!==e?e.memoizedState:null}else e=zi.next;var t=null===Wi?Hi.memoizedState:Wi.next;if(null!==t)Wi=t,zi=e;else{if(null===e){if(null===Hi.alternate)throw Error(s(467));throw Error(s(310))}e={memoizedState:(zi=e).memoizedState,baseState:zi.baseState,baseQueue:zi.baseQueue,queue:zi.queue,next:null},null===Wi?Hi.memoizedState=Wi=e:Wi=Wi.next=e}return Wi}function us(e){var t=Ji;return Ji+=1,null===Xi&&(Xi=[]),e=oi(Xi,e,t),t=Hi,null===(null===Wi?t.memoizedState:Wi.next)&&(t=t.alternate,L.H=null===t||null===t.memoizedState?hr:vr),e}function ds(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return us(e);if(e.$$typeof===S)return Oa(e)}throw Error(s(438,String(e)))}function ps(e){var t=null,n=Hi.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var o=Hi.alternate;null!==o&&(null!==(o=o.updateQueue)&&(null!=(o=o.memoCache)&&(t={data:o.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},Hi.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),o=0;o<e;o++)n[o]=N;return t.index++,n}function ms(e,t){return"function"==typeof t?t(e):t}function gs(e){return fs(cs(),zi,e)}function fs(e,t,n){var o=e.queue;if(null===o)throw Error(s(311));o.lastRenderedReducer=n;var a=e.baseQueue,i=o.pending;if(null!==i){if(null!==a){var r=a.next;a.next=i.next,i.next=r}t.baseQueue=a=i,o.pending=null}if(i=e.baseState,null===a)e.memoizedState=i;else{var l=r=null,c=null,u=t=a.next,d=!1;do{var p=-536870913&u.lane;if(p!==u.lane?(hc&p)===p:(Gi&p)===p){var m=u.revertLane;if(0===m)null!==c&&(c=c.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),p===za&&(d=!0);else{if((Gi&m)===m){u=u.next,m===za&&(d=!0);continue}p={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=p,r=i):c=c.next=p,Hi.lanes|=m,Cc|=m}p=u.action,$i&&n(i,p),i=u.hasEagerState?u.eagerState:n(i,p)}else m={lane:p,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=m,r=i):c=c.next=m,Hi.lanes|=p,Cc|=p;u=u.next}while(null!==u&&u!==t);if(null===c?r=i:c.next=l,!Qn(i,e.memoizedState)&&(Or=!0,d&&null!==(n=Wa)))throw n;e.memoizedState=i,e.baseState=r,e.baseQueue=c,o.lastRenderedState=i}return null===a&&(o.lanes=0),[e.memoizedState,o.dispatch]}function hs(e){var t=cs(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var o=n.dispatch,a=n.pending,i=t.memoizedState;if(null!==a){n.pending=null;var r=a=a.next;do{i=e(i,r.action),r=r.next}while(r!==a);Qn(i,t.memoizedState)||(Or=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,o]}function vs(e,t,n){var o=Hi,a=cs(),i=pa;if(i){if(void 0===n)throw Error(s(407));n=n()}else n=t();var r=!Qn((zi||a).memoizedState,n);if(r&&(a.memoizedState=n,Or=!0),a=a.queue,Gs(Es.bind(null,o,a,e),[e]),a.getSnapshot!==t||r||null!==Wi&&1&Wi.memoizedState.tag){if(o.flags|=2048,Us(9,{destroy:void 0},bs.bind(null,o,a,n,t),null),null===gc)throw Error(s(349));i||127&Gi||ys(o,t,n)}return n}function ys(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Hi.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Hi.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function bs(e,t,n,o){t.value=n,t.getSnapshot=o,Ss(t)&&Ts(e)}function Es(e,t,n){return n(function(){Ss(t)&&Ts(e)})}function Ss(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Qn(e,n)}catch(o){return!0}}function Ts(e){var t=Lo(e,2);null!==t&&$c(t,e,2)}function _s(e){var t=ls();if("function"==typeof e){var n=e;if(e=n(),$i){be(!0);try{n()}finally{be(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ms,lastRenderedState:e},t}function Cs(e,t,n,o){return e.baseState=n,fs(e,zi,"function"==typeof o?o:ms)}function Is(e,t,n,o,a){if(pr(e))throw Error(s(485));if(null!==(e=t.action)){var i={payload:a,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){i.listeners.push(e)}};null!==L.T?n(!0):i.isTransition=!1,o(i),null===(n=t.pending)?(i.next=t.pending=i,Rs(t,i)):(i.next=n.next,t.pending=n.next=i)}}function Rs(e,t){var n=t.action,o=t.payload,a=e.state;if(t.isTransition){var i=L.T,s={};L.T=s;try{var r=n(a,o),l=L.S;null!==l&&l(s,r),As(e,t,r)}catch(c){xs(e,t,c)}finally{null!==i&&null!==s.types&&(i.types=s.types),L.T=i}}else try{As(e,t,i=n(a,o))}catch(u){xs(e,t,u)}}function As(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){Ns(e,t,n)},function(n){return xs(e,t,n)}):Ns(e,t,n)}function Ns(e,t,n){t.status="fulfilled",t.value=n,ws(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,Rs(e,n)))}function xs(e,t,n){var o=e.pending;if(e.pending=null,null!==o){o=o.next;do{t.status="rejected",t.reason=n,ws(t),t=t.next}while(t!==o)}e.action=null}function ws(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Ps(e,t){return t}function ks(e,t){if(pa){var n=gc.formState;if(null!==n){e:{var o=Hi;if(pa){if(da){t:{for(var a=da,i=ga;8!==a.nodeType;){if(!i){a=null;break t}if(null===(a=Od(a.nextSibling))){a=null;break t}}a="F!"===(i=a.data)||"F"===i?a:null}if(a){da=Od(a.nextSibling),o="F!"===a.data;break e}}ha(o)}o=!1}o&&(t=n[0])}}return(n=ls()).memoizedState=n.baseState=t,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ps,lastRenderedState:t},n.queue=o,n=cr.bind(null,Hi,o),o.dispatch=n,o=_s(!1),i=dr.bind(null,Hi,!1,o.queue),a={state:t,dispatch:null,action:e,pending:null},(o=ls()).queue=a,n=Is.bind(null,Hi,a,i,n),a.dispatch=n,o.memoizedState=e,[t,n,!1]}function Os(e){return Ls(cs(),zi,e)}function Ls(e,t,n){if(t=fs(e,t,Ps)[0],e=gs(ms)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var o=us(t)}catch(s){if(s===Qa)throw ei;throw s}else o=t;var a=(t=cs()).queue,i=a.dispatch;return n!==t.memoizedState&&(Hi.flags|=2048,Us(9,{destroy:void 0},Ds.bind(null,a,n),null)),[o,i,e]}function Ds(e,t){e.action=t}function Ms(e){var t=cs(),n=zi;if(null!==n)return Ls(t,n,e);cs(),t=t.memoizedState;var o=(n=cs()).queue.dispatch;return n.memoizedState=e,[t,o,!1]}function Us(e,t,n,o){return e={tag:e,create:n,deps:o,inst:t,next:null},null===(t=Hi.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Hi.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(o=n.next,n.next=e,e.next=o,t.lastEffect=e),e}function Fs(){return cs().memoizedState}function js(e,t,n,o){var a=ls();Hi.flags|=e,a.memoizedState=Us(1|t,{destroy:void 0},n,void 0===o?null:o)}function Bs(e,t,n,o){var a=cs();o=void 0===o?null:o;var i=a.memoizedState.inst;null!==zi&&null!==o&&es(o,zi.memoizedState.deps)?a.memoizedState=Us(t,i,n,o):(Hi.flags|=e,a.memoizedState=Us(1|t,i,n,o))}function qs(e,t){js(8390656,8,e,t)}function Gs(e,t){Bs(2048,8,e,t)}function Hs(e){var t=cs().memoizedState;return function(e){Hi.flags|=4;var t=Hi.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},Hi.updateQueue=t,t.events=[e];else{var n=t.events;null===n?t.events=[e]:n.push(e)}}({ref:t,nextImpl:e}),function(){if(2&mc)throw Error(s(440));return t.impl.apply(void 0,arguments)}}function zs(e,t){return Bs(4,2,e,t)}function Ws(e,t){return Bs(4,4,e,t)}function Ks(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function Vs(e,t,n){n=null!=n?n.concat([e]):null,Bs(4,4,Ks.bind(null,t,e),n)}function $s(){}function Ys(e,t){var n=cs();t=void 0===t?null:t;var o=n.memoizedState;return null!==t&&es(t,o[1])?o[0]:(n.memoizedState=[e,t],e)}function Js(e,t){var n=cs();t=void 0===t?null:t;var o=n.memoizedState;if(null!==t&&es(t,o[1]))return o[0];if(o=e(),$i){be(!0);try{e()}finally{be(!1)}}return n.memoizedState=[o,t],o}function Xs(e,t,n){return void 0===n||1073741824&Gi&&!(261930&hc)?e.memoizedState=t:(e.memoizedState=n,e=Vc(),Hi.lanes|=e,Cc|=e,n)}function Qs(e,t,n,o){return Qn(n,t)?n:null!==Ni.current?(e=Xs(e,n,o),Qn(e,t)||(Or=!0),e):42&Gi&&(!(1073741824&Gi)||261930&hc)?(e=Vc(),Hi.lanes|=e,Cc|=e,t):(Or=!0,e.memoizedState=n)}function Zs(e,t,n,o,a){var i=D.p;D.p=0!==i&&8>i?i:8;var s,r,l,c=L.T,u={};L.T=u,dr(e,!1,t,n);try{var d=a(),p=L.S;if(null!==p&&p(u,d),null!==d&&"object"==typeof d&&"function"==typeof d.then)ur(e,t,(s=o,r=[],l={status:"pending",value:null,reason:null,then:function(e){r.push(e)}},d.then(function(){l.status="fulfilled",l.value=s;for(var e=0;e<r.length;e++)(0,r[e])(s)},function(e){for(l.status="rejected",l.reason=e,e=0;e<r.length;e++)(0,r[e])(void 0)}),l),Kc());else ur(e,t,o,Kc())}catch(m){ur(e,t,{then:function(){},status:"rejected",reason:m},Kc())}finally{D.p=i,null!==c&&null!==u.types&&(c.types=u.types),L.T=c}}function er(){}function tr(e,t,n,o){if(5!==e.tag)throw Error(s(476));var a=nr(e).queue;Zs(e,a,t,M,null===n?er:function(){return or(e),n(o)})}function nr(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:M,baseState:M,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ms,lastRenderedState:M},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ms,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function or(e){var t=nr(e);null===t.next&&(t=e.alternate.memoizedState),ur(e,t.next.queue,{},Kc())}function ar(){return Oa(up)}function ir(){return cs().memoizedState}function sr(){return cs().memoizedState}function rr(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Kc(),o=Ei(t,e=bi(n),n);return null!==o&&($c(o,t,n),Si(o,t,n)),t={cache:Ba()},void(e.payload=t)}t=t.return}}function lr(e,t,n){var o=Kc();n={lane:o,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},pr(e)?mr(t,n):null!==(n=Oo(e,t,n,o))&&($c(n,e,o),gr(n,t,o))}function cr(e,t,n){ur(e,t,n,Kc())}function ur(e,t,n,o){var a={lane:o,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(pr(e))mr(t,a);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var s=t.lastRenderedState,r=i(s,n);if(a.hasEagerState=!0,a.eagerState=r,Qn(r,s))return ko(e,t,a,0),null===gc&&Po(),!1}catch(l){}if(null!==(n=Oo(e,t,a,o)))return $c(n,e,o),gr(n,t,o),!0}return!1}function dr(e,t,n,o){if(o={lane:2,revertLane:Gu(),gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},pr(e)){if(t)throw Error(s(479))}else null!==(t=Oo(e,n,o,2))&&$c(t,e,2)}function pr(e){var t=e.alternate;return e===Hi||null!==t&&t===Hi}function mr(e,t){Vi=Ki=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function gr(e,t,n){if(4194048&n){var o=t.lanes;n|=o&=e.pendingLanes,t.lanes=n,Le(e,n)}}var fr={readContext:Oa,use:ds,useCallback:Zi,useContext:Zi,useEffect:Zi,useImperativeHandle:Zi,useLayoutEffect:Zi,useInsertionEffect:Zi,useMemo:Zi,useReducer:Zi,useRef:Zi,useState:Zi,useDebugValue:Zi,useDeferredValue:Zi,useTransition:Zi,useSyncExternalStore:Zi,useId:Zi,useHostTransitionStatus:Zi,useFormState:Zi,useActionState:Zi,useOptimistic:Zi,useMemoCache:Zi,useCacheRefresh:Zi};fr.useEffectEvent=Zi;var hr={readContext:Oa,use:ds,useCallback:function(e,t){return ls().memoizedState=[e,void 0===t?null:t],e},useContext:Oa,useEffect:qs,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,js(4194308,4,Ks.bind(null,t,e),n)},useLayoutEffect:function(e,t){return js(4194308,4,e,t)},useInsertionEffect:function(e,t){js(4,2,e,t)},useMemo:function(e,t){var n=ls();t=void 0===t?null:t;var o=e();if($i){be(!0);try{e()}finally{be(!1)}}return n.memoizedState=[o,t],o},useReducer:function(e,t,n){var o=ls();if(void 0!==n){var a=n(t);if($i){be(!0);try{n(t)}finally{be(!1)}}}else a=t;return o.memoizedState=o.baseState=a,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:a},o.queue=e,e=e.dispatch=lr.bind(null,Hi,e),[o.memoizedState,e]},useRef:function(e){return e={current:e},ls().memoizedState=e},useState:function(e){var t=(e=_s(e)).queue,n=cr.bind(null,Hi,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:$s,useDeferredValue:function(e,t){return Xs(ls(),e,t)},useTransition:function(){var e=_s(!1);return e=Zs.bind(null,Hi,e.queue,!0,!1),ls().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var o=Hi,a=ls();if(pa){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===gc)throw Error(s(349));127&hc||ys(o,t,n)}a.memoizedState=n;var i={value:n,getSnapshot:t};return a.queue=i,qs(Es.bind(null,o,i,e),[e]),o.flags|=2048,Us(9,{destroy:void 0},bs.bind(null,o,i,n,t),null),n},useId:function(){var e=ls(),t=gc.identifierPrefix;if(pa){var n=aa;t="_"+t+"R_"+(n=(oa&~(1<<32-Ee(oa)-1)).toString(32)+n),0<(n=Yi++)&&(t+="H"+n.toString(32)),t+="_"}else t="_"+t+"r_"+(n=Qi++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:ar,useFormState:ks,useActionState:ks,useOptimistic:function(e){var t=ls();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=dr.bind(null,Hi,!0,n),n.dispatch=t,[e,t]},useMemoCache:ps,useCacheRefresh:function(){return ls().memoizedState=rr.bind(null,Hi)},useEffectEvent:function(e){var t=ls(),n={impl:e};return t.memoizedState=n,function(){if(2&mc)throw Error(s(440));return n.impl.apply(void 0,arguments)}}},vr={readContext:Oa,use:ds,useCallback:Ys,useContext:Oa,useEffect:Gs,useImperativeHandle:Vs,useInsertionEffect:zs,useLayoutEffect:Ws,useMemo:Js,useReducer:gs,useRef:Fs,useState:function(){return gs(ms)},useDebugValue:$s,useDeferredValue:function(e,t){return Qs(cs(),zi.memoizedState,e,t)},useTransition:function(){var e=gs(ms)[0],t=cs().memoizedState;return["boolean"==typeof e?e:us(e),t]},useSyncExternalStore:vs,useId:ir,useHostTransitionStatus:ar,useFormState:Os,useActionState:Os,useOptimistic:function(e,t){return Cs(cs(),0,e,t)},useMemoCache:ps,useCacheRefresh:sr};vr.useEffectEvent=Hs;var yr={readContext:Oa,use:ds,useCallback:Ys,useContext:Oa,useEffect:Gs,useImperativeHandle:Vs,useInsertionEffect:zs,useLayoutEffect:Ws,useMemo:Js,useReducer:hs,useRef:Fs,useState:function(){return hs(ms)},useDebugValue:$s,useDeferredValue:function(e,t){var n=cs();return null===zi?Xs(n,e,t):Qs(n,zi.memoizedState,e,t)},useTransition:function(){var e=hs(ms)[0],t=cs().memoizedState;return["boolean"==typeof e?e:us(e),t]},useSyncExternalStore:vs,useId:ir,useHostTransitionStatus:ar,useFormState:Ms,useActionState:Ms,useOptimistic:function(e,t){var n=cs();return null!==zi?Cs(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:ps,useCacheRefresh:sr};function br(e,t,n,o){n=null==(n=n(o,t=e.memoizedState))?t:m({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}yr.useEffectEvent=Hs;var Er={enqueueSetState:function(e,t,n){e=e._reactInternals;var o=Kc(),a=bi(o);a.payload=t,null!=n&&(a.callback=n),null!==(t=Ei(e,a,o))&&($c(t,e,o),Si(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var o=Kc(),a=bi(o);a.tag=1,a.payload=t,null!=n&&(a.callback=n),null!==(t=Ei(e,a,o))&&($c(t,e,o),Si(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Kc(),o=bi(n);o.tag=2,null!=t&&(o.callback=t),null!==(t=Ei(e,o,n))&&($c(t,e,n),Si(t,e,n))}};function Sr(e,t,n,o,a,i,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(o,i,s):!t.prototype||!t.prototype.isPureReactComponent||(!Zn(n,o)||!Zn(a,i))}function Tr(e,t,n,o){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,o),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,o),t.state!==e&&Er.enqueueReplaceState(t,t.state,null)}function _r(e,t){var n=t;if("ref"in t)for(var o in n={},t)"ref"!==o&&(n[o]=t[o]);if(e=e.defaultProps)for(var a in n===t&&(n=m({},n)),e)void 0===n[a]&&(n[a]=e[a]);return n}function Cr(e){Ao(e)}function Ir(e){console.error(e)}function Rr(e){Ao(e)}function Ar(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Nr(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(o){setTimeout(function(){throw o})}}function xr(e,t,n){return(n=bi(n)).tag=3,n.payload={element:null},n.callback=function(){Ar(e,t)},n}function wr(e){return(e=bi(e)).tag=3,e}function Pr(e,t,n,o){var a=n.type.getDerivedStateFromError;if("function"==typeof a){var i=o.value;e.payload=function(){return a(i)},e.callback=function(){Nr(t,n,o)}}var s=n.stateNode;null!==s&&"function"==typeof s.componentDidCatch&&(e.callback=function(){Nr(t,n,o),"function"!=typeof a&&(null===Mc?Mc=new Set([this]):Mc.add(this));var e=o.stack;this.componentDidCatch(o.value,{componentStack:null!==e?e:""})})}var kr=Error(s(461)),Or=!1;function Lr(e,t,n,o){t.child=null===e?fi(t,null,n,o):gi(t,e.child,n,o)}function Dr(e,t,n,o,a){n=n.render;var i=t.ref;if("ref"in o){var s={};for(var r in o)"ref"!==r&&(s[r]=o[r])}else s=o;return ka(t),o=ts(e,t,n,s,i,a),r=is(),null===e||Or?(pa&&r&&ra(t),t.flags|=1,Lr(e,t,o,a),t.child):(ss(e,t,a),al(e,t,a))}function Mr(e,t,n,o,a){if(null===e){var i=n.type;return"function"!=typeof i||Bo(i)||void 0!==i.defaultProps||null!==n.compare?((e=Ho(n.type,null,o,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Ur(e,t,i,o,a))}if(i=e.child,!il(e,a)){var s=i.memoizedProps;if((n=null!==(n=n.compare)?n:Zn)(s,o)&&e.ref===t.ref)return al(e,t,a)}return t.flags|=1,(e=qo(i,o)).ref=t.ref,e.return=t,t.child=e}function Ur(e,t,n,o,a){if(null!==e){var i=e.memoizedProps;if(Zn(i,o)&&e.ref===t.ref){if(Or=!1,t.pendingProps=o=i,!il(e,a))return t.lanes=e.lanes,al(e,t,a);131072&e.flags&&(Or=!0)}}return zr(e,t,n,o,a)}function Fr(e,t,n,o){var a=o.children,i=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===o.mode){if(128&t.flags){if(i=null!==i?i.baseLanes|n:n,null!==e){for(o=t.child=e.child,a=0;null!==o;)a=a|o.lanes|o.childLanes,o=o.sibling;o=a&~i}else o=0,t.child=null;return Br(e,t,i,n,o)}if(!(536870912&n))return o=t.lanes=536870912,Br(e,t,null!==i?i.baseLanes|n:n,n,o);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Ja(0,null!==i?i.cachePool:null),null!==i?wi(t,i):Pi(),Ui(t)}else null!==i?(Ja(0,i.cachePool),wi(t,i),Fi(),t.memoizedState=null):(null!==e&&Ja(0,null),Pi(),Fi());return Lr(e,t,a,n),t.child}function jr(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Br(e,t,n,o,a){var i=Ya();return i=null===i?null:{parent:ja._currentValue,pool:i},t.memoizedState={baseLanes:n,cachePool:i},null!==e&&Ja(0,null),Pi(),Ui(t),null!==e&&wa(e,t,o,!0),t.childLanes=a,null}function qr(e,t){return(t=Zr({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function Gr(e,t,n){return gi(t,e.child,null,n),(e=qr(t,t.pendingProps)).flags|=2,ji(t),t.memoizedState=null,e}function Hr(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(s(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function zr(e,t,n,o,a){return ka(t),n=ts(e,t,n,o,void 0,a),o=is(),null===e||Or?(pa&&o&&ra(t),t.flags|=1,Lr(e,t,n,a),t.child):(ss(e,t,a),al(e,t,a))}function Wr(e,t,n,o,a,i){return ka(t),t.updateQueue=null,n=os(t,o,n,a),ns(e),o=is(),null===e||Or?(pa&&o&&ra(t),t.flags|=1,Lr(e,t,n,i),t.child):(ss(e,t,i),al(e,t,i))}function Kr(e,t,n,o,a){if(ka(t),null===t.stateNode){var i=Uo,s=n.contextType;"object"==typeof s&&null!==s&&(i=Oa(s)),i=new n(o,i),t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,i.updater=Er,t.stateNode=i,i._reactInternals=t,(i=t.stateNode).props=o,i.state=t.memoizedState,i.refs={},vi(t),s=n.contextType,i.context="object"==typeof s&&null!==s?Oa(s):Uo,i.state=t.memoizedState,"function"==typeof(s=n.getDerivedStateFromProps)&&(br(t,n,s,o),i.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(s=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),s!==i.state&&Er.enqueueReplaceState(i,i.state,null),Ii(t,o,i,a),Ci(),i.state=t.memoizedState),"function"==typeof i.componentDidMount&&(t.flags|=4194308),o=!0}else if(null===e){i=t.stateNode;var r=t.memoizedProps,l=_r(n,r);i.props=l;var c=i.context,u=n.contextType;s=Uo,"object"==typeof u&&null!==u&&(s=Oa(u));var d=n.getDerivedStateFromProps;u="function"==typeof d||"function"==typeof i.getSnapshotBeforeUpdate,r=t.pendingProps!==r,u||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(r||c!==s)&&Tr(t,i,o,s),hi=!1;var p=t.memoizedState;i.state=p,Ii(t,o,i,a),Ci(),c=t.memoizedState,r||p!==c||hi?("function"==typeof d&&(br(t,n,d,o),c=t.memoizedState),(l=hi||Sr(t,n,l,o,p,c,s))?(u||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||("function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"==typeof i.componentDidMount&&(t.flags|=4194308)):("function"==typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=o,t.memoizedState=c),i.props=o,i.state=c,i.context=s,o=l):("function"==typeof i.componentDidMount&&(t.flags|=4194308),o=!1)}else{i=t.stateNode,yi(e,t),u=_r(n,s=t.memoizedProps),i.props=u,d=t.pendingProps,p=i.context,c=n.contextType,l=Uo,"object"==typeof c&&null!==c&&(l=Oa(c)),(c="function"==typeof(r=n.getDerivedStateFromProps)||"function"==typeof i.getSnapshotBeforeUpdate)||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(s!==d||p!==l)&&Tr(t,i,o,l),hi=!1,p=t.memoizedState,i.state=p,Ii(t,o,i,a),Ci();var m=t.memoizedState;s!==d||p!==m||hi||null!==e&&null!==e.dependencies&&Pa(e.dependencies)?("function"==typeof r&&(br(t,n,r,o),m=t.memoizedState),(u=hi||Sr(t,n,u,o,p,m,l)||null!==e&&null!==e.dependencies&&Pa(e.dependencies))?(c||"function"!=typeof i.UNSAFE_componentWillUpdate&&"function"!=typeof i.componentWillUpdate||("function"==typeof i.componentWillUpdate&&i.componentWillUpdate(o,m,l),"function"==typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(o,m,l)),"function"==typeof i.componentDidUpdate&&(t.flags|=4),"function"==typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof i.componentDidUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=o,t.memoizedState=m),i.props=o,i.state=m,i.context=l,o=u):("function"!=typeof i.componentDidUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),o=!1)}return i=o,Hr(e,t),o=!!(128&t.flags),i||o?(i=t.stateNode,n=o&&"function"!=typeof n.getDerivedStateFromError?null:i.render(),t.flags|=1,null!==e&&o?(t.child=gi(t,e.child,null,a),t.child=gi(t,null,n,a)):Lr(e,t,n,a),t.memoizedState=i.state,e=t.child):e=al(e,t,a),e}function Vr(e,t,n,o){return Ea(),t.flags|=256,Lr(e,t,n,o),t.child}var $r={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Yr(e){return{baseLanes:e,cachePool:Xa()}}function Jr(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=Ac),e}function Xr(e,t,n){var o,a=t.pendingProps,i=!1,r=!!(128&t.flags);if((o=r)||(o=(null===e||null!==e.memoizedState)&&!!(2&Bi.current)),o&&(i=!0,t.flags&=-129),o=!!(32&t.flags),t.flags&=-33,null===e){if(pa){if(i?Di(t):Fi(),(e=da)?null!==(e=null!==(e=wd(e,ga))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==na?{id:oa,overflow:aa}:null,retryLane:536870912,hydrationErrors:null},(n=Ko(e)).return=t,t.child=n,ua=t,da=null):e=null,null===e)throw ha(t);return kd(e)?t.lanes=32:t.lanes=536870912,null}var l=a.children;return a=a.fallback,i?(Fi(),l=Zr({mode:"hidden",children:l},i=t.mode),a=zo(a,i,n,null),l.return=t,a.return=t,l.sibling=a,t.child=l,(a=t.child).memoizedState=Yr(n),a.childLanes=Jr(e,o,n),t.memoizedState=$r,jr(null,a)):(Di(t),Qr(t,l))}var c=e.memoizedState;if(null!==c&&null!==(l=c.dehydrated)){if(r)256&t.flags?(Di(t),t.flags&=-257,t=el(e,t,n)):null!==t.memoizedState?(Fi(),t.child=e.child,t.flags|=128,t=null):(Fi(),l=a.fallback,i=t.mode,a=Zr({mode:"visible",children:a.children},i),(l=zo(l,i,n,null)).flags|=2,a.return=t,l.return=t,a.sibling=l,t.child=a,gi(t,e.child,null,n),(a=t.child).memoizedState=Yr(n),a.childLanes=Jr(e,o,n),t.memoizedState=$r,t=jr(null,a));else if(Di(t),kd(l)){if(o=l.nextSibling&&l.nextSibling.dataset)var u=o.dgst;o=u,(a=Error(s(419))).stack="",a.digest=o,Ta({value:a,source:null,stack:null}),t=el(e,t,n)}else if(Or||wa(e,t,n,!1),o=0!==(n&e.childLanes),Or||o){if(null!==(o=gc)&&(0!==(a=De(o,n))&&a!==c.retryLane))throw c.retryLane=a,Lo(e,a),$c(o,e,a),kr;Pd(l)||su(),t=el(e,t,n)}else Pd(l)?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,da=Od(l.nextSibling),ua=t,pa=!0,ma=null,ga=!1,null!==e&&ca(t,e),(t=Qr(t,a.children)).flags|=4096);return t}return i?(Fi(),l=a.fallback,i=t.mode,u=(c=e.child).sibling,(a=qo(c,{mode:"hidden",children:a.children})).subtreeFlags=65011712&c.subtreeFlags,null!==u?l=qo(u,l):(l=zo(l,i,n,null)).flags|=2,l.return=t,a.return=t,a.sibling=l,t.child=a,jr(null,a),a=t.child,null===(l=e.child.memoizedState)?l=Yr(n):(null!==(i=l.cachePool)?(c=ja._currentValue,i=i.parent!==c?{parent:c,pool:c}:i):i=Xa(),l={baseLanes:l.baseLanes|n,cachePool:i}),a.memoizedState=l,a.childLanes=Jr(e,o,n),t.memoizedState=$r,jr(e.child,a)):(Di(t),e=(n=e.child).sibling,(n=qo(n,{mode:"visible",children:a.children})).return=t,n.sibling=null,null!==e&&(null===(o=t.deletions)?(t.deletions=[e],t.flags|=16):o.push(e)),t.child=n,t.memoizedState=null,n)}function Qr(e,t){return(t=Zr({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Zr(e,t){return(e=jo(22,e,null,t)).lanes=0,e}function el(e,t,n){return gi(t,e.child,null,n),(e=Qr(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function tl(e,t,n){e.lanes|=t;var o=e.alternate;null!==o&&(o.lanes|=t),Na(e.return,t,n)}function nl(e,t,n,o,a,i){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:o,tail:n,tailMode:a,treeForkCount:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=o,s.tail=n,s.tailMode=a,s.treeForkCount=i)}function ol(e,t,n){var o=t.pendingProps,a=o.revealOrder,i=o.tail;o=o.children;var s=Bi.current,r=!!(2&s);if(r?(s=1&s|2,t.flags|=128):s&=1,q(Bi,s),Lr(e,t,o,n),o=pa?Zo:0,!r&&null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&tl(e,n,t);else if(19===e.tag)tl(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===qi(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),nl(t,!1,a,n,i,o);break;case"backwards":case"unstable_legacy-backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===qi(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}nl(t,!0,n,null,i,o);break;case"together":nl(t,!1,null,null,void 0,o);break;default:t.memoizedState=null}return t.child}function al(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Cc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(wa(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=qo(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=qo(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function il(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Pa(e))}function sl(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Or=!0;else{if(!(il(e,n)||128&t.flags))return Or=!1,function(e,t,n){switch(t.tag){case 3:$(t,t.stateNode.containerInfo),Ra(0,ja,e.memoizedState.cache),Ea();break;case 27:case 5:J(t);break;case 4:$(t,t.stateNode.containerInfo);break;case 10:Ra(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,Mi(t),null;break;case 13:var o=t.memoizedState;if(null!==o)return null!==o.dehydrated?(Di(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Xr(e,t,n):(Di(t),null!==(e=al(e,t,n))?e.sibling:null);Di(t);break;case 19:var a=!!(128&e.flags);if((o=0!==(n&t.childLanes))||(wa(e,t,n,!1),o=0!==(n&t.childLanes)),a){if(o)return ol(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),q(Bi,Bi.current),o)break;return null;case 22:return t.lanes=0,Fr(e,t,n,t.pendingProps);case 24:Ra(0,ja,e.memoizedState.cache)}return al(e,t,n)}(e,t,n);Or=!!(131072&e.flags)}else Or=!1,pa&&1048576&t.flags&&sa(t,Zo,t.index);switch(t.lanes=0,t.tag){case 16:e:{var o=t.pendingProps;if(e=ai(t.elementType),t.type=e,"function"!=typeof e){if(null!=e){var a=e.$$typeof;if(a===T){t.tag=11,t=Dr(null,t,e,o,n);break e}if(a===I){t.tag=14,t=Mr(null,t,e,o,n);break e}}throw t=k(e)||e,Error(s(306,t,""))}Bo(e)?(o=_r(e,o),t.tag=1,t=Kr(null,t,e,o,n)):(t.tag=0,t=zr(null,t,e,o,n))}return t;case 0:return zr(e,t,t.type,t.pendingProps,n);case 1:return Kr(e,t,o=t.type,a=_r(o,t.pendingProps),n);case 3:e:{if($(t,t.stateNode.containerInfo),null===e)throw Error(s(387));o=t.pendingProps;var i=t.memoizedState;a=i.element,yi(e,t),Ii(t,o,null,n);var r=t.memoizedState;if(o=r.cache,Ra(0,ja,o),o!==i.cache&&xa(t,[ja],n,!0),Ci(),o=r.element,i.isDehydrated){if(i={element:o,isDehydrated:!1,cache:r.cache},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Vr(e,t,o,n);break e}if(o!==a){Ta(a=Yo(Error(s(424)),t)),t=Vr(e,t,o,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(da=Od(e.firstChild),ua=t,pa=!0,ma=null,ga=!0,n=fi(t,null,o,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Ea(),o===a){t=al(e,t,n);break e}Lr(e,t,o,n)}t=t.child}return t;case 26:return Hr(e,t),null===e?(n=Wd(t.type,null,t.pendingProps,null))?t.memoizedState=n:pa||(n=t.type,e=t.pendingProps,(o=hd(K.current).createElement(n))[qe]=t,o[Ge]=e,pd(o,n,e),et(o),t.stateNode=o):t.memoizedState=Wd(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return J(t),null===e&&pa&&(o=t.stateNode=Ud(t.type,t.pendingProps,K.current),ua=t,ga=!0,a=da,Rd(t.type)?(Ld=a,da=Od(o.firstChild)):da=a),Lr(e,t,t.pendingProps.children,n),Hr(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&pa&&((a=o=da)&&(null!==(o=function(e,t,n,o){for(;1===e.nodeType;){var a=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!o&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(o){if(!e[$e])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(i=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(i!==a.rel||e.getAttribute("href")!==(null==a.href||""===a.href?null:a.href)||e.getAttribute("crossorigin")!==(null==a.crossOrigin?null:a.crossOrigin)||e.getAttribute("title")!==(null==a.title?null:a.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((i=e.getAttribute("src"))!==(null==a.src?null:a.src)||e.getAttribute("type")!==(null==a.type?null:a.type)||e.getAttribute("crossorigin")!==(null==a.crossOrigin?null:a.crossOrigin))&&i&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var i=null==a.name?null:""+a.name;if("hidden"===a.type&&e.getAttribute("name")===i)return e}if(null===(e=Od(e.nextSibling)))break}return null}(o,t.type,t.pendingProps,ga))?(t.stateNode=o,ua=t,da=Od(o.firstChild),ga=!1,a=!0):a=!1),a||ha(t)),J(t),a=t.type,i=t.pendingProps,r=null!==e?e.memoizedProps:null,o=i.children,bd(a,i)?o=null:null!==r&&bd(a,r)&&(t.flags|=32),null!==t.memoizedState&&(a=ts(e,t,as,null,null,n),up._currentValue=a),Hr(e,t),Lr(e,t,o,n),t.child;case 6:return null===e&&pa&&((e=n=da)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=Od(e.nextSibling)))return null}return e}(n,t.pendingProps,ga))?(t.stateNode=n,ua=t,da=null,e=!0):e=!1),e||ha(t)),null;case 13:return Xr(e,t,n);case 4:return $(t,t.stateNode.containerInfo),o=t.pendingProps,null===e?t.child=gi(t,null,o,n):Lr(e,t,o,n),t.child;case 11:return Dr(e,t,t.type,t.pendingProps,n);case 7:return Lr(e,t,t.pendingProps,n),t.child;case 8:case 12:return Lr(e,t,t.pendingProps.children,n),t.child;case 10:return o=t.pendingProps,Ra(0,t.type,o.value),Lr(e,t,o.children,n),t.child;case 9:return a=t.type._context,o=t.pendingProps.children,ka(t),o=o(a=Oa(a)),t.flags|=1,Lr(e,t,o,n),t.child;case 14:return Mr(e,t,t.type,t.pendingProps,n);case 15:return Ur(e,t,t.type,t.pendingProps,n);case 19:return ol(e,t,n);case 31:return function(e,t,n){var o=t.pendingProps,a=!!(128&t.flags);if(t.flags&=-129,null===e){if(pa){if("hidden"===o.mode)return e=qr(t,o),t.lanes=536870912,jr(null,e);if(Mi(t),(e=da)?null!==(e=null!==(e=wd(e,ga))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==na?{id:oa,overflow:aa}:null,retryLane:536870912,hydrationErrors:null},(n=Ko(e)).return=t,t.child=n,ua=t,da=null):e=null,null===e)throw ha(t);return t.lanes=536870912,null}return qr(t,o)}var i=e.memoizedState;if(null!==i){var r=i.dehydrated;if(Mi(t),a)if(256&t.flags)t.flags&=-257,t=Gr(e,t,n);else{if(null===t.memoizedState)throw Error(s(558));t.child=e.child,t.flags|=128,t=null}else if(Or||wa(e,t,n,!1),a=0!==(n&e.childLanes),Or||a){if(null!==(o=gc)&&0!==(r=De(o,n))&&r!==i.retryLane)throw i.retryLane=r,Lo(e,r),$c(o,e,r),kr;su(),t=Gr(e,t,n)}else e=i.treeContext,da=Od(r.nextSibling),ua=t,pa=!0,ma=null,ga=!1,null!==e&&ca(t,e),(t=qr(t,o)).flags|=4096;return t}return(e=qo(e.child,{mode:o.mode,children:o.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,n);case 22:return Fr(e,t,n,t.pendingProps);case 24:return ka(t),o=Oa(ja),null===e?(null===(a=Ya())&&(a=gc,i=Ba(),a.pooledCache=i,i.refCount++,null!==i&&(a.pooledCacheLanes|=n),a=i),t.memoizedState={parent:o,cache:a},vi(t),Ra(0,ja,a)):(0!==(e.lanes&n)&&(yi(e,t),Ii(t,null,null,n),Ci()),a=e.memoizedState,i=t.memoizedState,a.parent!==o?(a={parent:o,cache:o},t.memoizedState=a,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=a),Ra(0,ja,o)):(o=i.cache,Ra(0,ja,o),o!==a.cache&&xa(t,[ja],n,!0))),Lr(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(s(156,t.tag))}function rl(e){e.flags|=4}function ll(e,t,n,o,a){if((t=!!(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&a)===a)if(e.stateNode.complete)e.flags|=8192;else{if(!ou())throw ii=ti,Za;e.flags|=8192}}else e.flags&=-16777217}function cl(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!ap(t)){if(!ou())throw ii=ti,Za;e.flags|=8192}}function ul(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?we():536870912,e.lanes|=t,Nc|=t)}function dl(e,t){if(!pa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var o=null;null!==n;)null!==n.alternate&&(o=n),n=n.sibling;null===o?t||null===e.tail?e.tail=null:e.tail.sibling=null:o.sibling=null}}function pl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,o=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,o|=65011712&a.subtreeFlags,o|=65011712&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,o|=a.subtreeFlags,o|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=o,e.childLanes=n,t}function ml(e,t,n){var o=t.pendingProps;switch(la(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return pl(t),null;case 3:return n=t.stateNode,o=null,null!==e&&(o=e.memoizedState.cache),t.memoizedState.cache!==o&&(t.flags|=2048),Aa(ja),Y(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ba(t)?rl(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,Sa())),pl(t),null;case 26:var a=t.type,i=t.memoizedState;return null===e?(rl(t),null!==i?(pl(t),cl(t,i)):(pl(t),ll(t,a,0,0,n))):i?i!==e.memoizedState?(rl(t),pl(t),cl(t,i)):(pl(t),t.flags&=-16777217):((e=e.memoizedProps)!==o&&rl(t),pl(t),ll(t,a,0,0,n)),null;case 27:if(X(t),n=K.current,a=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==o&&rl(t);else{if(!o){if(null===t.stateNode)throw Error(s(166));return pl(t),null}e=z.current,ba(t)?va(t):(e=Ud(a,o,n),t.stateNode=e,rl(t))}return pl(t),null;case 5:if(X(t),a=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==o&&rl(t);else{if(!o){if(null===t.stateNode)throw Error(s(166));return pl(t),null}if(i=z.current,ba(t))va(t);else{var r=hd(K.current);switch(i){case 1:i=r.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:i=r.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":i=r.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":i=r.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":(i=r.createElement("div")).innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i="string"==typeof o.is?r.createElement("select",{is:o.is}):r.createElement("select"),o.multiple?i.multiple=!0:o.size&&(i.size=o.size);break;default:i="string"==typeof o.is?r.createElement(a,{is:o.is}):r.createElement(a)}}i[qe]=t,i[Ge]=o;e:for(r=t.child;null!==r;){if(5===r.tag||6===r.tag)i.appendChild(r.stateNode);else if(4!==r.tag&&27!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;null===r.sibling;){if(null===r.return||r.return===t)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}t.stateNode=i;e:switch(pd(i,a,o),a){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&rl(t)}}return pl(t),ll(t,t.type,null===e||e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==o&&rl(t);else{if("string"!=typeof o&&null===t.stateNode)throw Error(s(166));if(e=K.current,ba(t)){if(e=t.stateNode,n=t.memoizedProps,o=null,null!==(a=ua))switch(a.tag){case 27:case 5:o=a.memoizedProps}e[qe]=t,(e=!!(e.nodeValue===n||null!==o&&!0===o.suppressHydrationWarning||cd(e.nodeValue,n)))||ha(t,!0)}else(e=hd(e).createTextNode(o))[qe]=t,t.stateNode=e}return pl(t),null;case 31:if(n=t.memoizedState,null===e||null!==e.memoizedState){if(o=ba(t),null!==n){if(null===e){if(!o)throw Error(s(318));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(s(557));e[qe]=t}else Ea(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;pl(t),e=!1}else n=Sa(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return 256&t.flags?(ji(t),t):(ji(t),null);if(128&t.flags)throw Error(s(558))}return pl(t),null;case 13:if(o=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(a=ba(t),null!==o&&null!==o.dehydrated){if(null===e){if(!a)throw Error(s(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(s(317));a[qe]=t}else Ea(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;pl(t),a=!1}else a=Sa(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=a),a=!0;if(!a)return 256&t.flags?(ji(t),t):(ji(t),null)}return ji(t),128&t.flags?(t.lanes=n,t):(n=null!==o,e=null!==e&&null!==e.memoizedState,n&&(a=null,null!==(o=t.child).alternate&&null!==o.alternate.memoizedState&&null!==o.alternate.memoizedState.cachePool&&(a=o.alternate.memoizedState.cachePool.pool),i=null,null!==o.memoizedState&&null!==o.memoizedState.cachePool&&(i=o.memoizedState.cachePool.pool),i!==a&&(o.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),ul(t,t.updateQueue),pl(t),null);case 4:return Y(),null===e&&Zu(t.stateNode.containerInfo),pl(t),null;case 10:return Aa(t.type),pl(t),null;case 19:if(B(Bi),null===(o=t.memoizedState))return pl(t),null;if(a=!!(128&t.flags),null===(i=o.rendering))if(a)dl(o,!1);else{if(0!==_c||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(i=qi(e))){for(t.flags|=128,dl(o,!1),e=i.updateQueue,t.updateQueue=e,ul(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Go(n,e),n=n.sibling;return q(Bi,1&Bi.current|2),pa&&ia(t,o.treeForkCount),t.child}e=e.sibling}null!==o.tail&&le()>Lc&&(t.flags|=128,a=!0,dl(o,!1),t.lanes=4194304)}else{if(!a)if(null!==(e=qi(i))){if(t.flags|=128,a=!0,e=e.updateQueue,t.updateQueue=e,ul(t,e),dl(o,!0),null===o.tail&&"hidden"===o.tailMode&&!i.alternate&&!pa)return pl(t),null}else 2*le()-o.renderingStartTime>Lc&&536870912!==n&&(t.flags|=128,a=!0,dl(o,!1),t.lanes=4194304);o.isBackwards?(i.sibling=t.child,t.child=i):(null!==(e=o.last)?e.sibling=i:t.child=i,o.last=i)}return null!==o.tail?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=le(),e.sibling=null,n=Bi.current,q(Bi,a?1&n|2:1&n),pa&&ia(t,o.treeForkCount),e):(pl(t),null);case 22:case 23:return ji(t),ki(),o=null!==t.memoizedState,null!==e?null!==e.memoizedState!==o&&(t.flags|=8192):o&&(t.flags|=8192),o?!!(536870912&n)&&!(128&t.flags)&&(pl(t),6&t.subtreeFlags&&(t.flags|=8192)):pl(t),null!==(n=t.updateQueue)&&ul(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),o=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(o=t.memoizedState.cachePool.pool),o!==n&&(t.flags|=2048),null!==e&&B($a),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Aa(ja),pl(t),null;case 25:case 30:return null}throw Error(s(156,t.tag))}function gl(e,t){switch(la(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Aa(ja),Y(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return X(t),null;case 31:if(null!==t.memoizedState){if(ji(t),null===t.alternate)throw Error(s(340));Ea()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(ji(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));Ea()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return B(Bi),null;case 4:return Y(),null;case 10:return Aa(t.type),null;case 22:case 23:return ji(t),ki(),null!==e&&B($a),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return Aa(ja),null;default:return null}}function fl(e,t){switch(la(t),t.tag){case 3:Aa(ja),Y();break;case 26:case 27:case 5:X(t);break;case 4:Y();break;case 31:null!==t.memoizedState&&ji(t);break;case 13:ji(t);break;case 19:B(Bi);break;case 10:Aa(t.type);break;case 22:case 23:ji(t),ki(),null!==e&&B($a);break;case 24:Aa(ja)}}function hl(e,t){try{var n=t.updateQueue,o=null!==n?n.lastEffect:null;if(null!==o){var a=o.next;n=a;do{if((n.tag&e)===e){o=void 0;var i=n.create,s=n.inst;o=i(),s.destroy=o}n=n.next}while(n!==a)}}catch(r){_u(t,t.return,r)}}function vl(e,t,n){try{var o=t.updateQueue,a=null!==o?o.lastEffect:null;if(null!==a){var i=a.next;o=i;do{if((o.tag&e)===e){var s=o.inst,r=s.destroy;if(void 0!==r){s.destroy=void 0,a=t;var l=n,c=r;try{c()}catch(u){_u(a,l,u)}}}o=o.next}while(o!==i)}}catch(u){_u(t,t.return,u)}}function yl(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Ai(t,n)}catch(o){_u(e,e.return,o)}}}function bl(e,t,n){n.props=_r(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(o){_u(e,t,o)}}function El(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var o=e.stateNode;break;default:o=e.stateNode}"function"==typeof n?e.refCleanup=n(o):n.current=o}}catch(a){_u(e,t,a)}}function Sl(e,t){var n=e.ref,o=e.refCleanup;if(null!==n)if("function"==typeof o)try{o()}catch(a){_u(e,t,a)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(i){_u(e,t,i)}else n.current=null}function Tl(e){var t=e.type,n=e.memoizedProps,o=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&o.focus();break e;case"img":n.src?o.src=n.src:n.srcSet&&(o.srcset=n.srcSet)}}catch(a){_u(e,e.return,a)}}function _l(e,t,n){try{var o=e.stateNode;!function(e,t,n,o){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var a=null,i=null,r=null,l=null,c=null,u=null,d=null;for(g in n){var p=n[g];if(n.hasOwnProperty(g)&&null!=p)switch(g){case"checked":case"value":break;case"defaultValue":c=p;default:o.hasOwnProperty(g)||ud(e,t,g,null,o,p)}}for(var m in o){var g=o[m];if(p=n[m],o.hasOwnProperty(m)&&(null!=g||null!=p))switch(m){case"type":i=g;break;case"name":a=g;break;case"checked":u=g;break;case"defaultChecked":d=g;break;case"value":r=g;break;case"defaultValue":l=g;break;case"children":case"dangerouslySetInnerHTML":if(null!=g)throw Error(s(137,t));break;default:g!==p&&ud(e,t,m,g,o,p)}}return void yt(e,r,l,c,u,d,i,a);case"select":for(i in g=r=l=m=null,n)if(c=n[i],n.hasOwnProperty(i)&&null!=c)switch(i){case"value":break;case"multiple":g=c;default:o.hasOwnProperty(i)||ud(e,t,i,null,o,c)}for(a in o)if(i=o[a],c=n[a],o.hasOwnProperty(a)&&(null!=i||null!=c))switch(a){case"value":m=i;break;case"defaultValue":l=i;break;case"multiple":r=i;default:i!==c&&ud(e,t,a,i,o,c)}return t=l,n=r,o=g,void(null!=m?St(e,!!n,m,!1):!!o!=!!n&&(null!=t?St(e,!!n,t,!0):St(e,!!n,n?[]:"",!1)));case"textarea":for(l in g=m=null,n)if(a=n[l],n.hasOwnProperty(l)&&null!=a&&!o.hasOwnProperty(l))switch(l){case"value":case"children":break;default:ud(e,t,l,null,o,a)}for(r in o)if(a=o[r],i=n[r],o.hasOwnProperty(r)&&(null!=a||null!=i))switch(r){case"value":m=a;break;case"defaultValue":g=a;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=a)throw Error(s(91));break;default:a!==i&&ud(e,t,r,a,o,i)}return void Tt(e,m,g);case"option":for(var f in n)if(m=n[f],n.hasOwnProperty(f)&&null!=m&&!o.hasOwnProperty(f))if("selected"===f)e.selected=!1;else ud(e,t,f,null,o,m);for(c in o)if(m=o[c],g=n[c],o.hasOwnProperty(c)&&m!==g&&(null!=m||null!=g))if("selected"===c)e.selected=m&&"function"!=typeof m&&"symbol"!=typeof m;else ud(e,t,c,m,o,g);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var h in n)m=n[h],n.hasOwnProperty(h)&&null!=m&&!o.hasOwnProperty(h)&&ud(e,t,h,null,o,m);for(u in o)if(m=o[u],g=n[u],o.hasOwnProperty(u)&&m!==g&&(null!=m||null!=g))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=m)throw Error(s(137,t));break;default:ud(e,t,u,m,o,g)}return;default:if(Nt(t)){for(var v in n)m=n[v],n.hasOwnProperty(v)&&void 0!==m&&!o.hasOwnProperty(v)&&dd(e,t,v,void 0,o,m);for(d in o)m=o[d],g=n[d],!o.hasOwnProperty(d)||m===g||void 0===m&&void 0===g||dd(e,t,d,m,o,g);return}}for(var y in n)m=n[y],n.hasOwnProperty(y)&&null!=m&&!o.hasOwnProperty(y)&&ud(e,t,y,null,o,m);for(p in o)m=o[p],g=n[p],!o.hasOwnProperty(p)||m===g||null==m&&null==g||ud(e,t,p,m,o,g)}(o,e.type,n,t),o[Ge]=t}catch(a){_u(e,e.return,a)}}function Cl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&Rd(e.type)||4===e.tag}function Il(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Cl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&Rd(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Rl(e,t,n){var o=e.tag;if(5===o||6===o)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=kt));else if(4!==o&&(27===o&&Rd(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(Rl(e,t,n),e=e.sibling;null!==e;)Rl(e,t,n),e=e.sibling}function Al(e,t,n){var o=e.tag;if(5===o||6===o)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==o&&(27===o&&Rd(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(Al(e,t,n),e=e.sibling;null!==e;)Al(e,t,n),e=e.sibling}function Nl(e){var t=e.stateNode,n=e.memoizedProps;try{for(var o=e.type,a=t.attributes;a.length;)t.removeAttributeNode(a[0]);pd(t,o,n),t[qe]=e,t[Ge]=n}catch(i){_u(e,e.return,i)}}var xl=!1,wl=!1,Pl=!1,kl="function"==typeof WeakSet?WeakSet:Set,Ol=null;function Ll(e,t,n){var o=n.flags;switch(n.tag){case 0:case 11:case 15:$l(e,n),4&o&&hl(5,n);break;case 1:if($l(e,n),4&o)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(s){_u(n,n.return,s)}else{var a=_r(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(a,t,e.__reactInternalSnapshotBeforeUpdate)}catch(r){_u(n,n.return,r)}}64&o&&yl(n),512&o&&El(n,n.return);break;case 3:if($l(e,n),64&o&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{Ai(e,t)}catch(s){_u(n,n.return,s)}}break;case 27:null===t&&4&o&&Nl(n);case 26:case 5:$l(e,n),null===t&&4&o&&Tl(n),512&o&&El(n,n.return);break;case 12:$l(e,n);break;case 31:$l(e,n),4&o&&Bl(e,n);break;case 13:$l(e,n),4&o&&ql(e,n),64&o&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$~"===e.data)e._reactRetry=t;else if("$?"!==e.data||"loading"!==n.readyState)t();else{var o=function(){t(),n.removeEventListener("DOMContentLoaded",o)};n.addEventListener("DOMContentLoaded",o),e._reactRetry=o}}(e,n=Au.bind(null,n))));break;case 22:if(!(o=null!==n.memoizedState||xl)){t=null!==t&&null!==t.memoizedState||wl,a=xl;var i=wl;xl=o,(wl=t)&&!i?Jl(e,n,!!(8772&n.subtreeFlags)):$l(e,n),xl=a,wl=i}break;case 30:break;default:$l(e,n)}}function Dl(e){var t=e.alternate;null!==t&&(e.alternate=null,Dl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Ye(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ml=null,Ul=!1;function Fl(e,t,n){for(n=n.child;null!==n;)jl(e,t,n),n=n.sibling}function jl(e,t,n){if(ye&&"function"==typeof ye.onCommitFiberUnmount)try{ye.onCommitFiberUnmount(ve,n)}catch(i){}switch(n.tag){case 26:wl||Sl(n,t),Fl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:wl||Sl(n,t);var o=Ml,a=Ul;Rd(n.type)&&(Ml=n.stateNode,Ul=!1),Fl(e,t,n),Fd(n.stateNode),Ml=o,Ul=a;break;case 5:wl||Sl(n,t);case 6:if(o=Ml,a=Ul,Ml=null,Fl(e,t,n),Ul=a,null!==(Ml=o))if(Ul)try{(9===Ml.nodeType?Ml.body:"HTML"===Ml.nodeName?Ml.ownerDocument.body:Ml).removeChild(n.stateNode)}catch(s){_u(n,t,s)}else try{Ml.removeChild(n.stateNode)}catch(s){_u(n,t,s)}break;case 18:null!==Ml&&(Ul?(Ad(9===(e=Ml).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),zp(e)):Ad(Ml,n.stateNode));break;case 4:o=Ml,a=Ul,Ml=n.stateNode.containerInfo,Ul=!0,Fl(e,t,n),Ml=o,Ul=a;break;case 0:case 11:case 14:case 15:vl(2,n,t),wl||vl(4,n,t),Fl(e,t,n);break;case 1:wl||(Sl(n,t),"function"==typeof(o=n.stateNode).componentWillUnmount&&bl(n,t,o)),Fl(e,t,n);break;case 21:Fl(e,t,n);break;case 22:wl=(o=wl)||null!==n.memoizedState,Fl(e,t,n),wl=o;break;default:Fl(e,t,n)}}function Bl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&null!==(e=e.memoizedState))){e=e.dehydrated;try{zp(e)}catch(n){_u(t,t.return,n)}}}function ql(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{zp(e)}catch(n){_u(t,t.return,n)}}function Gl(e,t){var n=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new kl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new kl),t;default:throw Error(s(435,e.tag))}}(e);t.forEach(function(t){if(!n.has(t)){n.add(t);var o=Nu.bind(null,e,t);t.then(o,o)}})}function Hl(e,t){var n=t.deletions;if(null!==n)for(var o=0;o<n.length;o++){var a=n[o],i=e,r=t,l=r;e:for(;null!==l;){switch(l.tag){case 27:if(Rd(l.type)){Ml=l.stateNode,Ul=!1;break e}break;case 5:Ml=l.stateNode,Ul=!1;break e;case 3:case 4:Ml=l.stateNode.containerInfo,Ul=!0;break e}l=l.return}if(null===Ml)throw Error(s(160));jl(i,r,a),Ml=null,Ul=!1,null!==(i=a.alternate)&&(i.return=null),a.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)Wl(t,e),t=t.sibling}var zl=null;function Wl(e,t){var n=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Hl(t,e),Kl(e),4&o&&(vl(3,e,e.return),hl(3,e),vl(5,e,e.return));break;case 1:Hl(t,e),Kl(e),512&o&&(wl||null===n||Sl(n,n.return)),64&o&&xl&&(null!==(e=e.updateQueue)&&(null!==(o=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?o:n.concat(o))));break;case 26:var a=zl;if(Hl(t,e),Kl(e),512&o&&(wl||null===n||Sl(n,n.return)),4&o){var i=null!==n?n.memoizedState:null;if(o=e.memoizedState,null===n)if(null===o)if(null===e.stateNode){e:{o=e.type,n=e.memoizedProps,a=a.ownerDocument||a;t:switch(o){case"title":(!(i=a.getElementsByTagName("title")[0])||i[$e]||i[qe]||"http://www.w3.org/2000/svg"===i.namespaceURI||i.hasAttribute("itemprop"))&&(i=a.createElement(o),a.head.insertBefore(i,a.querySelector("head > title"))),pd(i,o,n),i[qe]=e,et(i),o=i;break e;case"link":var r=np("link","href",a).get(o+(n.href||""));if(r)for(var l=0;l<r.length;l++)if((i=r[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&i.getAttribute("rel")===(null==n.rel?null:n.rel)&&i.getAttribute("title")===(null==n.title?null:n.title)&&i.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){r.splice(l,1);break t}pd(i=a.createElement(o),o,n),a.head.appendChild(i);break;case"meta":if(r=np("meta","content",a).get(o+(n.content||"")))for(l=0;l<r.length;l++)if((i=r[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&i.getAttribute("name")===(null==n.name?null:n.name)&&i.getAttribute("property")===(null==n.property?null:n.property)&&i.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&i.getAttribute("charset")===(null==n.charSet?null:n.charSet)){r.splice(l,1);break t}pd(i=a.createElement(o),o,n),a.head.appendChild(i);break;default:throw Error(s(468,o))}i[qe]=e,et(i),o=i}e.stateNode=o}else op(a,e.type,e.stateNode);else e.stateNode=Xd(a,o,e.memoizedProps);else i!==o?(null===i?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):i.count--,null===o?op(a,e.type,e.stateNode):Xd(a,o,e.memoizedProps)):null===o&&null!==e.stateNode&&_l(e,e.memoizedProps,n.memoizedProps)}break;case 27:Hl(t,e),Kl(e),512&o&&(wl||null===n||Sl(n,n.return)),null!==n&&4&o&&_l(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Hl(t,e),Kl(e),512&o&&(wl||null===n||Sl(n,n.return)),32&e.flags){a=e.stateNode;try{Ct(a,"")}catch(f){_u(e,e.return,f)}}4&o&&null!=e.stateNode&&_l(e,a=e.memoizedProps,null!==n?n.memoizedProps:a),1024&o&&(Pl=!0);break;case 6:if(Hl(t,e),Kl(e),4&o){if(null===e.stateNode)throw Error(s(162));o=e.memoizedProps,n=e.stateNode;try{n.nodeValue=o}catch(f){_u(e,e.return,f)}}break;case 3:if(tp=null,a=zl,zl=qd(t.containerInfo),Hl(t,e),zl=a,Kl(e),4&o&&null!==n&&n.memoizedState.isDehydrated)try{zp(t.containerInfo)}catch(f){_u(e,e.return,f)}Pl&&(Pl=!1,Vl(e));break;case 4:o=zl,zl=qd(e.stateNode.containerInfo),Hl(t,e),Kl(e),zl=o;break;case 12:default:Hl(t,e),Kl(e);break;case 31:case 19:Hl(t,e),Kl(e),4&o&&(null!==(o=e.updateQueue)&&(e.updateQueue=null,Gl(e,o)));break;case 13:Hl(t,e),Kl(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(kc=le()),4&o&&(null!==(o=e.updateQueue)&&(e.updateQueue=null,Gl(e,o)));break;case 22:a=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,u=xl,d=wl;if(xl=u||a,wl=d||c,Hl(t,e),wl=d,xl=u,Kl(e),8192&o)e:for(t=e.stateNode,t._visibility=a?-2&t._visibility:1|t._visibility,a&&(null===n||c||xl||wl||Yl(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(i=c.stateNode,a)"function"==typeof(r=i.style).setProperty?r.setProperty("display","none","important"):r.display="none";else{l=c.stateNode;var p=c.memoizedProps.style,m=null!=p&&p.hasOwnProperty("display")?p.display:null;l.style.display=null==m||"boolean"==typeof m?"":(""+m).trim()}}catch(f){_u(c,c.return,f)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=a?"":c.memoizedProps}catch(f){_u(c,c.return,f)}}}else if(18===t.tag){if(null===n){c=t;try{var g=c.stateNode;a?Nd(g,!0):Nd(c.stateNode,!1)}catch(f){_u(c,c.return,f)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&o&&(null!==(o=e.updateQueue)&&(null!==(n=o.retryQueue)&&(o.retryQueue=null,Gl(e,n))));case 30:case 21:}}function Kl(e){var t=e.flags;if(2&t){try{for(var n,o=e.return;null!==o;){if(Cl(o)){n=o;break}o=o.return}if(null==n)throw Error(s(160));switch(n.tag){case 27:var a=n.stateNode;Al(e,Il(e),a);break;case 5:var i=n.stateNode;32&n.flags&&(Ct(i,""),n.flags&=-33),Al(e,Il(e),i);break;case 3:case 4:var r=n.stateNode.containerInfo;Rl(e,Il(e),r);break;default:throw Error(s(161))}}catch(l){_u(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Vl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Vl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function $l(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Ll(e,t.alternate,t),t=t.sibling}function Yl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:vl(4,t,t.return),Yl(t);break;case 1:Sl(t,t.return);var n=t.stateNode;"function"==typeof n.componentWillUnmount&&bl(t,t.return,n),Yl(t);break;case 27:Fd(t.stateNode);case 26:case 5:Sl(t,t.return),Yl(t);break;case 22:null===t.memoizedState&&Yl(t);break;default:Yl(t)}e=e.sibling}}function Jl(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var o=t.alternate,a=e,i=t,s=i.flags;switch(i.tag){case 0:case 11:case 15:Jl(a,i,n),hl(4,i);break;case 1:if(Jl(a,i,n),"function"==typeof(a=(o=i).stateNode).componentDidMount)try{a.componentDidMount()}catch(c){_u(o,o.return,c)}if(null!==(a=(o=i).updateQueue)){var r=o.stateNode;try{var l=a.shared.hiddenCallbacks;if(null!==l)for(a.shared.hiddenCallbacks=null,a=0;a<l.length;a++)Ri(l[a],r)}catch(c){_u(o,o.return,c)}}n&&64&s&&yl(i),El(i,i.return);break;case 27:Nl(i);case 26:case 5:Jl(a,i,n),n&&null===o&&4&s&&Tl(i),El(i,i.return);break;case 12:Jl(a,i,n);break;case 31:Jl(a,i,n),n&&4&s&&Bl(a,i);break;case 13:Jl(a,i,n),n&&4&s&&ql(a,i);break;case 22:null===i.memoizedState&&Jl(a,i,n),El(i,i.return);break;case 30:break;default:Jl(a,i,n)}t=t.sibling}}function Xl(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&qa(n))}function Ql(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&qa(e))}function Zl(e,t,n,o){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)ec(e,t,n,o),t=t.sibling}function ec(e,t,n,o){var a=t.flags;switch(t.tag){case 0:case 11:case 15:Zl(e,t,n,o),2048&a&&hl(9,t);break;case 1:case 31:case 13:default:Zl(e,t,n,o);break;case 3:Zl(e,t,n,o),2048&a&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&qa(e)));break;case 12:if(2048&a){Zl(e,t,n,o),e=t.stateNode;try{var i=t.memoizedProps,s=i.id,r=i.onPostCommit;"function"==typeof r&&r(s,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){_u(t,t.return,l)}}else Zl(e,t,n,o);break;case 23:break;case 22:i=t.stateNode,s=t.alternate,null!==t.memoizedState?2&i._visibility?Zl(e,t,n,o):nc(e,t):2&i._visibility?Zl(e,t,n,o):(i._visibility|=2,tc(e,t,n,o,!!(10256&t.subtreeFlags)||!1)),2048&a&&Xl(s,t);break;case 24:Zl(e,t,n,o),2048&a&&Ql(t.alternate,t)}}function tc(e,t,n,o,a){for(a=a&&(!!(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var i=e,s=t,r=n,l=o,c=s.flags;switch(s.tag){case 0:case 11:case 15:tc(i,s,r,l,a),hl(8,s);break;case 23:break;case 22:var u=s.stateNode;null!==s.memoizedState?2&u._visibility?tc(i,s,r,l,a):nc(i,s):(u._visibility|=2,tc(i,s,r,l,a)),a&&2048&c&&Xl(s.alternate,s);break;case 24:tc(i,s,r,l,a),a&&2048&c&&Ql(s.alternate,s);break;default:tc(i,s,r,l,a)}t=t.sibling}}function nc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,o=t,a=o.flags;switch(o.tag){case 22:nc(n,o),2048&a&&Xl(o.alternate,o);break;case 24:nc(n,o),2048&a&&Ql(o.alternate,o);break;default:nc(n,o)}t=t.sibling}}var oc=8192;function ac(e,t,n){if(e.subtreeFlags&oc)for(e=e.child;null!==e;)ic(e,t,n),e=e.sibling}function ic(e,t,n){switch(e.tag){case 26:ac(e,t,n),e.flags&oc&&null!==e.memoizedState&&function(e,t,n,o){if(!("stylesheet"!==n.type||"string"==typeof o.media&&!1===matchMedia(o.media).matches||4&n.state.loading)){if(null===n.instance){var a=Kd(o.href),i=t.querySelector(Vd(a));if(i)return null!==(t=i._p)&&"object"==typeof t&&"function"==typeof t.then&&(e.count++,e=sp.bind(e),t.then(e,e)),n.state.loading|=4,n.instance=i,void et(i);i=t.ownerDocument||t,o=$d(o),(a=jd.get(a))&&Zd(o,a),et(i=i.createElement("link"));var s=i;s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),pd(i,"link",o),n.instance=i}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&!(3&n.state.loading)&&(e.count++,n=sp.bind(e),t.addEventListener("load",n),t.addEventListener("error",n))}}(n,zl,e.memoizedState,e.memoizedProps);break;case 5:default:ac(e,t,n);break;case 3:case 4:var o=zl;zl=qd(e.stateNode.containerInfo),ac(e,t,n),zl=o;break;case 22:null===e.memoizedState&&(null!==(o=e.alternate)&&null!==o.memoizedState?(o=oc,oc=16777216,ac(e,t,n),oc=o):ac(e,t,n))}}function sc(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function rc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var o=t[n];Ol=o,uc(o,e)}sc(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)lc(e),e=e.sibling}function lc(e){switch(e.tag){case 0:case 11:case 15:rc(e),2048&e.flags&&vl(9,e,e.return);break;case 3:case 12:default:rc(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,cc(e)):rc(e)}}function cc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var o=t[n];Ol=o,uc(o,e)}sc(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:vl(8,t,t.return),cc(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,cc(t));break;default:cc(t)}e=e.sibling}}function uc(e,t){for(;null!==Ol;){var n=Ol;switch(n.tag){case 0:case 11:case 15:vl(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var o=n.memoizedState.cachePool.pool;null!=o&&o.refCount++}break;case 24:qa(n.memoizedState.cache)}if(null!==(o=n.child))o.return=n,Ol=o;else e:for(n=e;null!==Ol;){var a=(o=Ol).sibling,i=o.return;if(Dl(o),o===n){Ol=null;break e}if(null!==a){a.return=i,Ol=a;break e}Ol=i}}}var dc={getCacheForType:function(e){var t=Oa(ja),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return Oa(ja).controller.signal}},pc="function"==typeof WeakMap?WeakMap:Map,mc=0,gc=null,fc=null,hc=0,vc=0,yc=null,bc=!1,Ec=!1,Sc=!1,Tc=0,_c=0,Cc=0,Ic=0,Rc=0,Ac=0,Nc=0,xc=null,wc=null,Pc=!1,kc=0,Oc=0,Lc=1/0,Dc=null,Mc=null,Uc=0,Fc=null,jc=null,Bc=0,qc=0,Gc=null,Hc=null,zc=0,Wc=null;function Kc(){return 2&mc&&0!==hc?hc&-hc:null!==L.T?Gu():Fe()}function Vc(){if(0===Ac)if(536870912&hc&&!pa)Ac=536870912;else{var e=Ce;!(3932160&(Ce<<=1))&&(Ce=262144),Ac=e}return null!==(e=Oi.current)&&(e.flags|=32),Ac}function $c(e,t,n){(e!==gc||2!==vc&&9!==vc)&&null===e.cancelPendingCommit||(tu(e,0),Qc(e,hc,Ac,!1)),ke(e,n),2&mc&&e===gc||(e===gc&&(!(2&mc)&&(Ic|=n),4===_c&&Qc(e,hc,Ac,!1)),Du(e))}function Yc(e,t,n){if(6&mc)throw Error(s(327));for(var o=!n&&!(127&t)&&0===(t&e.expiredLanes)||Ne(e,t),a=o?function(e,t){var n=mc;mc|=2;var o=au(),a=iu();gc!==e||hc!==t?(Dc=null,Lc=le()+500,tu(e,t)):Ec=Ne(e,t);e:for(;;)try{if(0!==vc&&null!==fc){t=fc;var i=yc;t:switch(vc){case 1:vc=0,yc=null,pu(e,t,i,1);break;case 2:case 9:if(ni(i)){vc=0,yc=null,du(t);break}t=function(){2!==vc&&9!==vc||gc!==e||(vc=7),Du(e)},i.then(t,t);break e;case 3:vc=7;break e;case 4:vc=5;break e;case 7:ni(i)?(vc=0,yc=null,du(t)):(vc=0,yc=null,pu(e,t,i,7));break;case 5:var r=null;switch(fc.tag){case 26:r=fc.memoizedState;case 5:case 27:var l=fc;if(r?ap(r):l.stateNode.complete){vc=0,yc=null;var c=l.sibling;if(null!==c)fc=c;else{var u=l.return;null!==u?(fc=u,mu(u)):fc=null}break t}}vc=0,yc=null,pu(e,t,i,5);break;case 6:vc=0,yc=null,pu(e,t,i,6);break;case 8:eu(),_c=6;break e;default:throw Error(s(462))}}cu();break}catch(d){nu(e,d)}return Ia=Ca=null,L.H=o,L.A=a,mc=n,null!==fc?0:(gc=null,hc=0,Po(),_c)}(e,t):ru(e,t,!0),i=o;;){if(0===a){Ec&&!o&&Qc(e,t,0,!1);break}if(n=e.current.alternate,!i||Xc(n)){if(2===a){if(i=t,e.errorRecoveryDisabledLanes&i)var r=0;else r=0!==(r=-536870913&e.pendingLanes)?r:536870912&r?536870912:0;if(0!==r){t=r;e:{var l=e;a=xc;var c=l.current.memoizedState.isDehydrated;if(c&&(tu(l,r).flags|=256),2!==(r=ru(l,r,!1))){if(Sc&&!c){l.errorRecoveryDisabledLanes|=i,Ic|=i,a=4;break e}i=wc,wc=a,null!==i&&(null===wc?wc=i:wc.push.apply(wc,i))}a=r}if(i=!1,2!==a)continue}}if(1===a){tu(e,0),Qc(e,t,0,!0);break}e:{switch(o=e,i=a){case 0:case 1:throw Error(s(345));case 4:if((4194048&t)!==t)break;case 6:Qc(o,t,Ac,!bc);break e;case 2:wc=null;break;case 3:case 5:break;default:throw Error(s(329))}if((62914560&t)===t&&10<(a=kc+300-le())){if(Qc(o,t,Ac,!bc),0!==Ae(o,0,!0))break e;Bc=t,o.timeoutHandle=Sd(Jc.bind(null,o,n,wc,Dc,Pc,t,Ac,Ic,Nc,bc,i,"Throttled",-0,0),a)}else Jc(o,n,wc,Dc,Pc,t,Ac,Ic,Nc,bc,i,null,-0,0)}break}a=ru(e,t,!1),i=!1}Du(e)}function Jc(e,t,n,o,a,i,s,r,l,c,u,d,p,m){if(e.timeoutHandle=-1,8192&(d=t.subtreeFlags)||!(16785408&~d)){ic(t,i,d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:kt});var g=(62914560&i)===i?kc-le():(4194048&i)===i?Oc-le():0;if(null!==(g=function(e,t){return e.stylesheets&&0===e.count&&lp(e,e.stylesheets),0<e.count||0<e.imgCount?function(n){var o=setTimeout(function(){if(e.stylesheets&&lp(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&0===ip&&(ip=62500*function(){if("function"==typeof performance.getEntriesByType){for(var e=0,t=0,n=performance.getEntriesByType("resource"),o=0;o<n.length;o++){var a=n[o],i=a.transferSize,s=a.initiatorType,r=a.duration;if(i&&r&&md(s)){for(s=0,r=a.responseEnd,o+=1;o<n.length;o++){var l=n[o],c=l.startTime;if(c>r)break;var u=l.transferSize,d=l.initiatorType;u&&md(d)&&(s+=u*((l=l.responseEnd)<r?1:(r-c)/(l-c)))}if(--o,t+=8*(i+s)/(a.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"==typeof(e=navigator.connection.downlink)?e:5}());var a=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&lp(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>ip?50:800)+t);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(o),clearTimeout(a)}}:null}(d,g)))return Bc=i,e.cancelPendingCommit=g(fu.bind(null,e,t,i,n,o,a,s,r,l,u,d,null,p,m)),void Qc(e,i,s,!c)}fu(e,t,i,n,o,a,s,r,l)}function Xc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var o=0;o<n.length;o++){var a=n[o],i=a.getSnapshot;a=a.value;try{if(!Qn(i(),a))return!1}catch(s){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Qc(e,t,n,o){t&=~Rc,t&=~Ic,e.suspendedLanes|=t,e.pingedLanes&=~t,o&&(e.warmLanes|=t),o=e.expirationTimes;for(var a=t;0<a;){var i=31-Ee(a),s=1<<i;o[i]=-1,a&=~s}0!==n&&Oe(e,n,t)}function Zc(){return!!(6&mc)||(Mu(0,!1),!1)}function eu(){if(null!==fc){if(0===vc)var e=fc.return;else Ia=Ca=null,rs(e=fc),li=null,ci=0,e=fc;for(;null!==e;)fl(e.alternate,e),e=e.return;fc=null}}function tu(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,Td(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Bc=0,eu(),gc=e,fc=n=qo(e.current,null),hc=t,vc=0,yc=null,bc=!1,Ec=Ne(e,t),Sc=!1,Nc=Ac=Rc=Ic=Cc=_c=0,wc=xc=null,Pc=!1,8&t&&(t|=32&t);var o=e.entangledLanes;if(0!==o)for(e=e.entanglements,o&=t;0<o;){var a=31-Ee(o),i=1<<a;t|=e[a],o&=~i}return Tc=t,Po(),n}function nu(e,t){Hi=null,L.H=fr,t===Qa||t===ei?(t=si(),vc=3):t===Za?(t=si(),vc=4):vc=t===kr?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,yc=t,null===fc&&(_c=1,Ar(e,Yo(t,e.current)))}function ou(){var e=Oi.current;return null===e||((4194048&hc)===hc?null===Li:!!((62914560&hc)===hc||536870912&hc)&&e===Li)}function au(){var e=L.H;return L.H=fr,null===e?fr:e}function iu(){var e=L.A;return L.A=dc,e}function su(){_c=4,bc||(4194048&hc)!==hc&&null!==Oi.current||(Ec=!0),!(134217727&Cc)&&!(134217727&Ic)||null===gc||Qc(gc,hc,Ac,!1)}function ru(e,t,n){var o=mc;mc|=2;var a=au(),i=iu();gc===e&&hc===t||(Dc=null,tu(e,t)),t=!1;var s=_c;e:for(;;)try{if(0!==vc&&null!==fc){var r=fc,l=yc;switch(vc){case 8:eu(),s=6;break e;case 3:case 2:case 9:case 6:null===Oi.current&&(t=!0);var c=vc;if(vc=0,yc=null,pu(e,r,l,c),n&&Ec){s=0;break e}break;default:c=vc,vc=0,yc=null,pu(e,r,l,c)}}lu(),s=_c;break}catch(u){nu(e,u)}return t&&e.shellSuspendCounter++,Ia=Ca=null,mc=o,L.H=a,L.A=i,null===fc&&(gc=null,hc=0,Po()),s}function lu(){for(;null!==fc;)uu(fc)}function cu(){for(;null!==fc&&!se();)uu(fc)}function uu(e){var t=sl(e.alternate,e,Tc);e.memoizedProps=e.pendingProps,null===t?mu(e):fc=t}function du(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Wr(n,t,t.pendingProps,t.type,void 0,hc);break;case 11:t=Wr(n,t,t.pendingProps,t.type.render,t.ref,hc);break;case 5:rs(t);default:fl(n,t),t=sl(n,t=fc=Go(t,Tc),Tc)}e.memoizedProps=e.pendingProps,null===t?mu(e):fc=t}function pu(e,t,n,o){Ia=Ca=null,rs(t),li=null,ci=0;var a=t.return;try{if(function(e,t,n,o,a){if(n.flags|=32768,null!==o&&"object"==typeof o&&"function"==typeof o.then){if(null!==(t=n.alternate)&&wa(t,n,a,!0),null!==(n=Oi.current)){switch(n.tag){case 31:case 13:return null===Li?su():null===n.alternate&&0===_c&&(_c=3),n.flags&=-257,n.flags|=65536,n.lanes=a,o===ti?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([o]):t.add(o),Cu(e,o,a)),!1;case 22:return n.flags|=65536,o===ti?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([o])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([o]):n.add(o),Cu(e,o,a)),!1}throw Error(s(435,n.tag))}return Cu(e,o,a),su(),!1}if(pa)return null!==(t=Oi.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=a,o!==fa&&Ta(Yo(e=Error(s(422),{cause:o}),n))):(o!==fa&&Ta(Yo(t=Error(s(423),{cause:o}),n)),(e=e.current.alternate).flags|=65536,a&=-a,e.lanes|=a,o=Yo(o,n),Ti(e,a=xr(e.stateNode,o,a)),4!==_c&&(_c=2)),!1;var i=Error(s(520),{cause:o});if(i=Yo(i,n),null===xc?xc=[i]:xc.push(i),4!==_c&&(_c=2),null===t)return!0;o=Yo(o,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=a&-a,n.lanes|=e,Ti(n,e=xr(n.stateNode,o,e)),!1;case 1:if(t=n.type,i=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===i||"function"!=typeof i.componentDidCatch||null!==Mc&&Mc.has(i))))return n.flags|=65536,a&=-a,n.lanes|=a,Pr(a=wr(a),e,n,o),Ti(n,a),!1}n=n.return}while(null!==n);return!1}(e,a,t,n,hc))return _c=1,Ar(e,Yo(n,e.current)),void(fc=null)}catch(i){if(null!==a)throw fc=a,i;return _c=1,Ar(e,Yo(n,e.current)),void(fc=null)}32768&t.flags?(pa||1===o?e=!0:Ec||536870912&hc?e=!1:(bc=e=!0,(2===o||9===o||3===o||6===o)&&(null!==(o=Oi.current)&&13===o.tag&&(o.flags|=16384))),gu(t,e)):mu(t)}function mu(e){var t=e;do{if(32768&t.flags)return void gu(t,bc);e=t.return;var n=ml(t.alternate,t,Tc);if(null!==n)return void(fc=n);if(null!==(t=t.sibling))return void(fc=t);fc=t=e}while(null!==t);0===_c&&(_c=5)}function gu(e,t){do{var n=gl(e.alternate,e);if(null!==n)return n.flags&=32767,void(fc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(fc=e);fc=e=n}while(null!==e);_c=6,fc=null}function fu(e,t,n,o,a,i,r,l,c){e.cancelPendingCommit=null;do{Eu()}while(0!==Uc);if(6&mc)throw Error(s(327));if(null!==t){if(t===e.current)throw Error(s(177));if(i=t.lanes|t.childLanes,function(e,t,n,o,a,i){var s=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var r=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=s&~n;0<n;){var u=31-Ee(n),d=1<<u;r[u]=0,l[u]=-1;var p=c[u];if(null!==p)for(c[u]=null,u=0;u<p.length;u++){var m=p[u];null!==m&&(m.lane&=-536870913)}n&=~d}0!==o&&Oe(e,o,0),0!==i&&0===a&&0!==e.tag&&(e.suspendedLanes|=i&~(s&~t))}(e,n,i|=wo,r,l,c),e===gc&&(fc=gc=null,hc=0),jc=t,Fc=e,Bc=n,qc=i,Gc=a,Hc=o,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,ae(pe,function(){return Su(),null})):(e.callbackNode=null,e.callbackPriority=0),o=!!(13878&t.flags),13878&t.subtreeFlags||o){o=L.T,L.T=null,a=D.p,D.p=2,r=mc,mc|=4;try{!function(e,t){if(e=e.containerInfo,gd=bp,ao(e=oo(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var o=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(o&&0!==o.rangeCount){n=o.anchorNode;var a=o.anchorOffset,i=o.focusNode;o=o.focusOffset;try{n.nodeType,i.nodeType}catch(h){n=null;break e}var r=0,l=-1,c=-1,u=0,d=0,p=e,m=null;t:for(;;){for(var g;p!==n||0!==a&&3!==p.nodeType||(l=r+a),p!==i||0!==o&&3!==p.nodeType||(c=r+o),3===p.nodeType&&(r+=p.nodeValue.length),null!==(g=p.firstChild);)m=p,p=g;for(;;){if(p===e)break t;if(m===n&&++u===a&&(l=r),m===i&&++d===o&&(c=r),null!==(g=p.nextSibling))break;m=(p=m).parentNode}p=g}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(fd={focusedElem:e,selectionRange:n},bp=!1,Ol=t;null!==Ol;)if(e=(t=Ol).child,1028&t.subtreeFlags&&null!==e)e.return=t,Ol=e;else for(;null!==Ol;){switch(i=(t=Ol).alternate,e=t.flags,t.tag){case 0:if(4&e&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(n=0;n<e.length;n++)(a=e[n]).ref.impl=a.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&e&&null!==i){e=void 0,n=t,a=i.memoizedProps,i=i.memoizedState,o=n.stateNode;try{var f=_r(n.type,a);e=o.getSnapshotBeforeUpdate(f,i),o.__reactInternalSnapshotBeforeUpdate=e}catch(v){_u(n,n.return,v)}}break;case 3:if(1024&e)if(9===(n=(e=t.stateNode.containerInfo).nodeType))xd(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":xd(e);break;default:e.textContent=""}break;default:if(1024&e)throw Error(s(163))}if(null!==(e=t.sibling)){e.return=t.return,Ol=e;break}Ol=t.return}}(e,t)}finally{mc=r,D.p=a,L.T=o}}Uc=1,hu(),vu(),yu()}}function hu(){if(1===Uc){Uc=0;var e=Fc,t=jc,n=!!(13878&t.flags);if(13878&t.subtreeFlags||n){n=L.T,L.T=null;var o=D.p;D.p=2;var a=mc;mc|=4;try{Wl(t,e);var i=fd,s=oo(e.containerInfo),r=i.focusedElem,l=i.selectionRange;if(s!==r&&r&&r.ownerDocument&&no(r.ownerDocument.documentElement,r)){if(null!==l&&ao(r)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in r)r.selectionStart=c,r.selectionEnd=Math.min(u,r.value.length);else{var d=r.ownerDocument||document,p=d&&d.defaultView||window;if(p.getSelection){var m=p.getSelection(),g=r.textContent.length,f=Math.min(l.start,g),h=void 0===l.end?f:Math.min(l.end,g);!m.extend&&f>h&&(s=h,h=f,f=s);var v=to(r,f),y=to(r,h);if(v&&y&&(1!==m.rangeCount||m.anchorNode!==v.node||m.anchorOffset!==v.offset||m.focusNode!==y.node||m.focusOffset!==y.offset)){var b=d.createRange();b.setStart(v.node,v.offset),m.removeAllRanges(),f>h?(m.addRange(b),m.extend(y.node,y.offset)):(b.setEnd(y.node,y.offset),m.addRange(b))}}}}for(d=[],m=r;m=m.parentNode;)1===m.nodeType&&d.push({element:m,left:m.scrollLeft,top:m.scrollTop});for("function"==typeof r.focus&&r.focus(),r=0;r<d.length;r++){var E=d[r];E.element.scrollLeft=E.left,E.element.scrollTop=E.top}}bp=!!gd,fd=gd=null}finally{mc=a,D.p=o,L.T=n}}e.current=t,Uc=2}}function vu(){if(2===Uc){Uc=0;var e=Fc,t=jc,n=!!(8772&t.flags);if(8772&t.subtreeFlags||n){n=L.T,L.T=null;var o=D.p;D.p=2;var a=mc;mc|=4;try{Ll(e,t.alternate,t)}finally{mc=a,D.p=o,L.T=n}}Uc=3}}function yu(){if(4===Uc||3===Uc){Uc=0,re();var e=Fc,t=jc,n=Bc,o=Hc;10256&t.subtreeFlags||10256&t.flags?Uc=5:(Uc=0,jc=Fc=null,bu(e,e.pendingLanes));var a=e.pendingLanes;if(0===a&&(Mc=null),Ue(n),t=t.stateNode,ye&&"function"==typeof ye.onCommitFiberRoot)try{ye.onCommitFiberRoot(ve,t,void 0,!(128&~t.current.flags))}catch(l){}if(null!==o){t=L.T,a=D.p,D.p=2,L.T=null;try{for(var i=e.onRecoverableError,s=0;s<o.length;s++){var r=o[s];i(r.value,{componentStack:r.stack})}}finally{L.T=t,D.p=a}}3&Bc&&Eu(),Du(e),a=e.pendingLanes,261930&n&&42&a?e===Wc?zc++:(zc=0,Wc=e):zc=0,Mu(0,!1)}}function bu(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,qa(t)))}function Eu(){return hu(),vu(),yu(),Su()}function Su(){if(5!==Uc)return!1;var e=Fc,t=qc;qc=0;var n=Ue(Bc),o=L.T,a=D.p;try{D.p=32>n?32:n,L.T=null,n=Gc,Gc=null;var i=Fc,r=Bc;if(Uc=0,jc=Fc=null,Bc=0,6&mc)throw Error(s(331));var l=mc;if(mc|=4,lc(i.current),ec(i,i.current,r,n),mc=l,Mu(0,!1),ye&&"function"==typeof ye.onPostCommitFiberRoot)try{ye.onPostCommitFiberRoot(ve,i)}catch(c){}return!0}finally{D.p=a,L.T=o,bu(e,t)}}function Tu(e,t,n){t=Yo(n,t),null!==(e=Ei(e,t=xr(e.stateNode,t,2),2))&&(ke(e,2),Du(e))}function _u(e,t,n){if(3===e.tag)Tu(e,e,n);else for(;null!==t;){if(3===t.tag){Tu(t,e,n);break}if(1===t.tag){var o=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof o.componentDidCatch&&(null===Mc||!Mc.has(o))){e=Yo(n,e),null!==(o=Ei(t,n=wr(2),2))&&(Pr(n,o,t,e),ke(o,2),Du(o));break}}t=t.return}}function Cu(e,t,n){var o=e.pingCache;if(null===o){o=e.pingCache=new pc;var a=new Set;o.set(t,a)}else void 0===(a=o.get(t))&&(a=new Set,o.set(t,a));a.has(n)||(Sc=!0,a.add(n),e=Iu.bind(null,e,t,n),t.then(e,e))}function Iu(e,t,n){var o=e.pingCache;null!==o&&o.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,gc===e&&(hc&n)===n&&(4===_c||3===_c&&(62914560&hc)===hc&&300>le()-kc?!(2&mc)&&tu(e,0):Rc|=n,Nc===hc&&(Nc=0)),Du(e)}function Ru(e,t){0===t&&(t=we()),null!==(e=Lo(e,t))&&(ke(e,t),Du(e))}function Au(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ru(e,n)}function Nu(e,t){var n=0;switch(e.tag){case 31:case 13:var o=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:o=e.stateNode;break;case 22:o=e.stateNode._retryCache;break;default:throw Error(s(314))}null!==o&&o.delete(t),Ru(e,n)}var xu=null,wu=null,Pu=!1,ku=!1,Ou=!1,Lu=0;function Du(e){e!==wu&&null===e.next&&(null===wu?xu=wu=e:wu=wu.next=e),ku=!0,Pu||(Pu=!0,Cd(function(){6&mc?ae(ue,Uu):Fu()}))}function Mu(e,t){if(!Ou&&ku){Ou=!0;do{for(var n=!1,o=xu;null!==o;){if(!t)if(0!==e){var a=o.pendingLanes;if(0===a)var i=0;else{var s=o.suspendedLanes,r=o.pingedLanes;i=(1<<31-Ee(42|e)+1)-1,i=201326741&(i&=a&~(s&~r))?201326741&i|1:i?2|i:0}0!==i&&(n=!0,qu(o,i))}else i=hc,!(3&(i=Ae(o,o===gc?i:0,null!==o.cancelPendingCommit||-1!==o.timeoutHandle)))||Ne(o,i)||(n=!0,qu(o,i));o=o.next}}while(n);Ou=!1}}function Uu(){Fu()}function Fu(){ku=Pu=!1;var e=0;0!==Lu&&function(){var e=window.event;if(e&&"popstate"===e.type)return e!==Ed&&(Ed=e,!0);return Ed=null,!1}()&&(e=Lu);for(var t=le(),n=null,o=xu;null!==o;){var a=o.next,i=ju(o,t);0===i?(o.next=null,null===n?xu=a:n.next=a,null===a&&(wu=n)):(n=o,(0!==e||3&i)&&(ku=!0)),o=a}0!==Uc&&5!==Uc||Mu(e,!1),0!==Lu&&(Lu=0)}function ju(e,t){for(var n=e.suspendedLanes,o=e.pingedLanes,a=e.expirationTimes,i=-62914561&e.pendingLanes;0<i;){var s=31-Ee(i),r=1<<s,l=a[s];-1===l?0!==(r&n)&&0===(r&o)||(a[s]=xe(r,t)):l<=t&&(e.expiredLanes|=r),i&=~r}if(n=hc,n=Ae(e,e===(t=gc)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),o=e.callbackNode,0===n||e===t&&(2===vc||9===vc)||null!==e.cancelPendingCommit)return null!==o&&null!==o&&ie(o),e.callbackNode=null,e.callbackPriority=0;if(!(3&n)||Ne(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==o&&ie(o),Ue(n)){case 2:case 8:n=de;break;case 32:default:n=pe;break;case 268435456:n=ge}return o=Bu.bind(null,e),n=ae(n,o),e.callbackPriority=t,e.callbackNode=n,t}return null!==o&&null!==o&&ie(o),e.callbackPriority=2,e.callbackNode=null,2}function Bu(e,t){if(0!==Uc&&5!==Uc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(Eu()&&e.callbackNode!==n)return null;var o=hc;return 0===(o=Ae(e,e===gc?o:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Yc(e,o,t),ju(e,le()),null!=e.callbackNode&&e.callbackNode===n?Bu.bind(null,e):null)}function qu(e,t){if(Eu())return null;Yc(e,t,!0)}function Gu(){if(0===Lu){var e=za;0===e&&(e=_e,!(261888&(_e<<=1))&&(_e=256)),Lu=e}return Lu}function Hu(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:Pt(""+e)}function zu(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Wu=0;Wu<Io.length;Wu++){var Ku=Io[Wu];Ro(Ku.toLowerCase(),"on"+(Ku[0].toUpperCase()+Ku.slice(1)))}Ro(vo,"onAnimationEnd"),Ro(yo,"onAnimationIteration"),Ro(bo,"onAnimationStart"),Ro("dblclick","onDoubleClick"),Ro("focusin","onFocus"),Ro("focusout","onBlur"),Ro(Eo,"onTransitionRun"),Ro(So,"onTransitionStart"),Ro(To,"onTransitionCancel"),Ro(_o,"onTransitionEnd"),at("onMouseEnter",["mouseout","mouseover"]),at("onMouseLeave",["mouseout","mouseover"]),at("onPointerEnter",["pointerout","pointerover"]),at("onPointerLeave",["pointerout","pointerover"]),ot("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ot("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ot("onBeforeInput",["compositionend","keypress","textInput","paste"]),ot("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ot("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ot("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$u=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Vu));function Yu(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var o=e[n],a=o.event;o=o.listeners;e:{var i=void 0;if(t)for(var s=o.length-1;0<=s;s--){var r=o[s],l=r.instance,c=r.currentTarget;if(r=r.listener,l!==i&&a.isPropagationStopped())break e;i=r,a.currentTarget=c;try{i(a)}catch(u){Ao(u)}a.currentTarget=null,i=l}else for(s=0;s<o.length;s++){if(l=(r=o[s]).instance,c=r.currentTarget,r=r.listener,l!==i&&a.isPropagationStopped())break e;i=r,a.currentTarget=c;try{i(a)}catch(u){Ao(u)}a.currentTarget=null,i=l}}}}function Ju(e,t){var n=t[ze];void 0===n&&(n=t[ze]=new Set);var o=e+"__bubble";n.has(o)||(ed(t,e,2,!1),n.add(o))}function Xu(e,t,n){var o=0;t&&(o|=4),ed(n,e,o,t)}var Qu="_reactListening"+Math.random().toString(36).slice(2);function Zu(e){if(!e[Qu]){e[Qu]=!0,tt.forEach(function(t){"selectionchange"!==t&&($u.has(t)||Xu(t,!1,e),Xu(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Qu]||(t[Qu]=!0,Xu("selectionchange",!1,t))}}function ed(e,t,n,o){switch(Rp(t)){case 2:var a=Ep;break;case 8:a=Sp;break;default:a=Tp}n=a.bind(null,t,n,e),a=void 0,!Gt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),o?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function td(e,t,n,o,a){var i=o;if(!(1&t||2&t||null===o))e:for(;;){if(null===o)return;var s=o.tag;if(3===s||4===s){var r=o.stateNode.containerInfo;if(r===a)break;if(4===s)for(s=o.return;null!==s;){var c=s.tag;if((3===c||4===c)&&s.stateNode.containerInfo===a)return;s=s.return}for(;null!==r;){if(null===(s=Je(r)))return;if(5===(c=s.tag)||6===c||26===c||27===c){o=i=s;continue e}r=r.parentNode}}o=o.return}jt(function(){var o=i,a=Lt(n),s=[];e:{var r=Co.get(e);if(void 0!==r){var c=nn,u=e;switch(e){case"keypress":if(0===$t(n))break e;case"keydown":case"keyup":c=yn;break;case"focusin":u="focus",c=cn;break;case"focusout":u="blur",c=cn;break;case"beforeblur":case"afterblur":c=cn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=rn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=ln;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=En;break;case vo:case yo:case bo:c=un;break;case _o:c=Sn;break;case"scroll":case"scrollend":c=an;break;case"wheel":c=Tn;break;case"copy":case"cut":case"paste":c=dn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=bn;break;case"toggle":case"beforetoggle":c=_n}var d=!!(4&t),p=!d&&("scroll"===e||"scrollend"===e),m=d?null!==r?r+"Capture":null:r;d=[];for(var g,f=o;null!==f;){var h=f;if(g=h.stateNode,5!==(h=h.tag)&&26!==h&&27!==h||null===g||null===m||null!=(h=Bt(f,m))&&d.push(nd(f,h,g)),p)break;f=f.return}0<d.length&&(r=new c(r,u,null,n,a),s.push({event:r,listeners:d}))}}if(!(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(r="mouseover"===e||"pointerover"===e)||n===Ot||!(u=n.relatedTarget||n.fromElement)||!Je(u)&&!u[He])&&(c||r)&&(r=a.window===a?a:(r=a.ownerDocument)?r.defaultView||r.parentWindow:window,c?(c=o,null!==(u=(u=n.relatedTarget||n.toElement)?Je(u):null)&&(p=l(u),d=u.tag,u!==p||5!==d&&27!==d&&6!==d)&&(u=null)):(c=null,u=o),c!==u)){if(d=rn,h="onMouseLeave",m="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(d=bn,h="onPointerLeave",m="onPointerEnter",f="pointer"),p=null==c?r:Qe(c),g=null==u?r:Qe(u),(r=new d(h,f+"leave",c,n,a)).target=p,r.relatedTarget=g,h=null,Je(a)===o&&((d=new d(m,f+"enter",u,n,a)).target=g,d.relatedTarget=p,h=d),p=h,c&&u)e:{for(d=ad,f=u,g=0,h=m=c;h;h=d(h))g++;h=0;for(var v=f;v;v=d(v))h++;for(;0<g-h;)m=d(m),g--;for(;0<h-g;)f=d(f),h--;for(;g--;){if(m===f||null!==f&&m===f.alternate){d=m;break e}m=d(m),f=d(f)}d=null}else d=null;null!==c&&id(s,r,c,d,!1),null!==u&&null!==p&&id(s,p,u,d,!0)}if("select"===(c=(r=o?Qe(o):window).nodeName&&r.nodeName.toLowerCase())||"input"===c&&"file"===r.type)var y=qn;else if(Dn(r))if(Gn)y=Xn;else{y=Yn;var b=$n}else!(c=r.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==r.type&&"radio"!==r.type?o&&Nt(o.elementType)&&(y=qn):y=Jn;switch(y&&(y=y(e,o))?Mn(s,y,n,a):(b&&b(e,r,o),"focusout"===e&&o&&"number"===r.type&&null!=o.memoizedProps.value&&Et(r,"number",r.value)),b=o?Qe(o):window,e){case"focusin":(Dn(b)||"true"===b.contentEditable)&&(so=b,ro=o,lo=null);break;case"focusout":lo=ro=so=null;break;case"mousedown":co=!0;break;case"contextmenu":case"mouseup":case"dragend":co=!1,uo(s,n,a);break;case"selectionchange":if(io)break;case"keydown":case"keyup":uo(s,n,a)}var E;if(In)e:{switch(e){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else On?Pn(e,n)&&(S="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(S="onCompositionStart");S&&(Nn&&"ko"!==n.locale&&(On||"onCompositionStart"!==S?"onCompositionEnd"===S&&On&&(E=Vt()):(Wt="value"in(zt=a)?zt.value:zt.textContent,On=!0)),0<(b=od(o,S)).length&&(S=new pn(S,e,null,n,a),s.push({event:S,listeners:b}),E?S.data=E:null!==(E=kn(n))&&(S.data=E))),(E=An?function(e,t){switch(e){case"compositionend":return kn(t);case"keypress":return 32!==t.which?null:(wn=!0,xn);case"textInput":return(e=t.data)===xn&&wn?null:e;default:return null}}(e,n):function(e,t){if(On)return"compositionend"===e||!In&&Pn(e,t)?(e=Vt(),Kt=Wt=zt=null,On=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Nn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(S=od(o,"onBeforeInput")).length&&(b=new pn("onBeforeInput","beforeinput",null,n,a),s.push({event:b,listeners:S}),b.data=E)),function(e,t,n,o,a){if("submit"===t&&n&&n.stateNode===a){var i=Hu((a[Ge]||null).action),s=o.submitter;s&&null!==(t=(t=s[Ge]||null)?Hu(t.formAction):s.getAttribute("formAction"))&&(i=t,s=null);var r=new nn("action","action",null,o,a);e.push({event:r,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if(0!==Lu){var e=s?zu(a,s):new FormData(a);tr(n,{pending:!0,data:e,method:a.method,action:i},null,e)}}else"function"==typeof i&&(r.preventDefault(),e=s?zu(a,s):new FormData(a),tr(n,{pending:!0,data:e,method:a.method,action:i},i,e))},currentTarget:a}]})}}(s,e,o,n,a)}Yu(s,t)})}function nd(e,t,n){return{instance:e,listener:t,currentTarget:n}}function od(e,t){for(var n=t+"Capture",o=[];null!==e;){var a=e,i=a.stateNode;if(5!==(a=a.tag)&&26!==a&&27!==a||null===i||(null!=(a=Bt(e,n))&&o.unshift(nd(e,a,i)),null!=(a=Bt(e,t))&&o.push(nd(e,a,i))),3===e.tag)return o;e=e.return}return[]}function ad(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function id(e,t,n,o,a){for(var i=t._reactName,s=[];null!==n&&n!==o;){var r=n,l=r.alternate,c=r.stateNode;if(r=r.tag,null!==l&&l===o)break;5!==r&&26!==r&&27!==r||null===c||(l=c,a?null!=(c=Bt(n,i))&&s.unshift(nd(n,c,l)):a||null!=(c=Bt(n,i))&&s.push(nd(n,c,l))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var sd=/\r\n?/g,rd=/\u0000|\uFFFD/g;function ld(e){return("string"==typeof e?e:""+e).replace(sd,"\n").replace(rd,"")}function cd(e,t){return t=ld(t),ld(e)===t}function ud(e,t,n,o,a,i){switch(n){case"children":"string"==typeof o?"body"===t||"textarea"===t&&""===o||Ct(e,o):("number"==typeof o||"bigint"==typeof o)&&"body"!==t&&Ct(e,""+o);break;case"className":ct(e,"class",o);break;case"tabIndex":ct(e,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":ct(e,n,o);break;case"style":At(e,o,i);break;case"data":if("object"!==t){ct(e,"data",o);break}case"src":case"href":if(""===o&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==o||"function"==typeof o||"symbol"==typeof o||"boolean"==typeof o){e.removeAttribute(n);break}o=Pt(""+o),e.setAttribute(n,o);break;case"action":case"formAction":if("function"==typeof o){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof i&&("formAction"===n?("input"!==t&&ud(e,t,"name",a.name,a,null),ud(e,t,"formEncType",a.formEncType,a,null),ud(e,t,"formMethod",a.formMethod,a,null),ud(e,t,"formTarget",a.formTarget,a,null)):(ud(e,t,"encType",a.encType,a,null),ud(e,t,"method",a.method,a,null),ud(e,t,"target",a.target,a,null))),null==o||"symbol"==typeof o||"boolean"==typeof o){e.removeAttribute(n);break}o=Pt(""+o),e.setAttribute(n,o);break;case"onClick":null!=o&&(e.onclick=kt);break;case"onScroll":null!=o&&Ju("scroll",e);break;case"onScrollEnd":null!=o&&Ju("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=o){if("object"!=typeof o||!("__html"in o))throw Error(s(61));if(null!=(n=o.__html)){if(null!=a.children)throw Error(s(60));e.innerHTML=n}}break;case"multiple":e.multiple=o&&"function"!=typeof o&&"symbol"!=typeof o;break;case"muted":e.muted=o&&"function"!=typeof o&&"symbol"!=typeof o;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==o||"function"==typeof o||"boolean"==typeof o||"symbol"==typeof o){e.removeAttribute("xlink:href");break}n=Pt(""+o),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=o&&"function"!=typeof o&&"symbol"!=typeof o?e.setAttribute(n,""+o):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&"function"!=typeof o&&"symbol"!=typeof o?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===o?e.setAttribute(n,""):!1!==o&&null!=o&&"function"!=typeof o&&"symbol"!=typeof o?e.setAttribute(n,o):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&!isNaN(o)&&1<=o?e.setAttribute(n,o):e.removeAttribute(n);break;case"rowSpan":case"start":null==o||"function"==typeof o||"symbol"==typeof o||isNaN(o)?e.removeAttribute(n):e.setAttribute(n,o);break;case"popover":Ju("beforetoggle",e),Ju("toggle",e),lt(e,"popover",o);break;case"xlinkActuate":ut(e,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":ut(e,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":ut(e,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":ut(e,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":ut(e,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":ut(e,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":ut(e,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":ut(e,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":ut(e,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":lt(e,"is",o);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&lt(e,n=xt.get(n)||n,o)}}function dd(e,t,n,o,a,i){switch(n){case"style":At(e,o,i);break;case"dangerouslySetInnerHTML":if(null!=o){if("object"!=typeof o||!("__html"in o))throw Error(s(61));if(null!=(n=o.__html)){if(null!=a.children)throw Error(s(60));e.innerHTML=n}}break;case"children":"string"==typeof o?Ct(e,o):("number"==typeof o||"bigint"==typeof o)&&Ct(e,""+o);break;case"onScroll":null!=o&&Ju("scroll",e);break;case"onScrollEnd":null!=o&&Ju("scrollend",e);break;case"onClick":null!=o&&(e.onclick=kt);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:nt.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(a=n.endsWith("Capture"),t=n.slice(2,a?n.length-7:void 0),"function"==typeof(i=null!=(i=e[Ge]||null)?i[n]:null)&&e.removeEventListener(t,i,a),"function"!=typeof o)?n in e?e[n]=o:!0===o?e.setAttribute(n,""):lt(e,n,o):("function"!=typeof i&&null!==i&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,o,a)))}}function pd(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ju("error",e),Ju("load",e);var o,a=!1,i=!1;for(o in n)if(n.hasOwnProperty(o)){var r=n[o];if(null!=r)switch(o){case"src":a=!0;break;case"srcSet":i=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:ud(e,t,o,r,n,null)}}return i&&ud(e,t,"srcSet",n.srcSet,n,null),void(a&&ud(e,t,"src",n.src,n,null));case"input":Ju("invalid",e);var l=o=r=i=null,c=null,u=null;for(a in n)if(n.hasOwnProperty(a)){var d=n[a];if(null!=d)switch(a){case"name":i=d;break;case"type":r=d;break;case"checked":c=d;break;case"defaultChecked":u=d;break;case"value":o=d;break;case"defaultValue":l=d;break;case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(s(137,t));break;default:ud(e,t,a,d,n,null)}}return void bt(e,o,l,c,u,r,i,!1);case"select":for(i in Ju("invalid",e),a=r=o=null,n)if(n.hasOwnProperty(i)&&null!=(l=n[i]))switch(i){case"value":o=l;break;case"defaultValue":r=l;break;case"multiple":a=l;default:ud(e,t,i,l,n,null)}return t=o,n=r,e.multiple=!!a,void(null!=t?St(e,!!a,t,!1):null!=n&&St(e,!!a,n,!0));case"textarea":for(r in Ju("invalid",e),o=i=a=null,n)if(n.hasOwnProperty(r)&&null!=(l=n[r]))switch(r){case"value":a=l;break;case"defaultValue":i=l;break;case"children":o=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(s(91));break;default:ud(e,t,r,l,n,null)}return void _t(e,a,i,o);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(a=n[c]))if("selected"===c)e.selected=a&&"function"!=typeof a&&"symbol"!=typeof a;else ud(e,t,c,a,n,null);return;case"dialog":Ju("beforetoggle",e),Ju("toggle",e),Ju("cancel",e),Ju("close",e);break;case"iframe":case"object":Ju("load",e);break;case"video":case"audio":for(a=0;a<Vu.length;a++)Ju(Vu[a],e);break;case"image":Ju("error",e),Ju("load",e);break;case"details":Ju("toggle",e);break;case"embed":case"source":case"link":Ju("error",e),Ju("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(a=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:ud(e,t,u,a,n,null)}return;default:if(Nt(t)){for(d in n)n.hasOwnProperty(d)&&(void 0!==(a=n[d])&&dd(e,t,d,a,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(a=n[l])&&ud(e,t,l,a,n,null))}function md(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var gd=null,fd=null;function hd(e){return 9===e.nodeType?e:e.ownerDocument}function vd(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function yd(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function bd(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Ed=null;var Sd="function"==typeof setTimeout?setTimeout:void 0,Td="function"==typeof clearTimeout?clearTimeout:void 0,_d="function"==typeof Promise?Promise:void 0,Cd="function"==typeof queueMicrotask?queueMicrotask:void 0!==_d?function(e){return _d.resolve(null).then(e).catch(Id)}:Sd;function Id(e){setTimeout(function(){throw e})}function Rd(e){return"head"===e}function Ad(e,t){var n=t,o=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)||"/&"===n){if(0===o)return e.removeChild(a),void zp(t);o--}else if("$"===n||"$?"===n||"$~"===n||"$!"===n||"&"===n)o++;else if("html"===n)Fd(e.ownerDocument.documentElement);else if("head"===n){Fd(n=e.ownerDocument.head);for(var i=n.firstChild;i;){var s=i.nextSibling,r=i.nodeName;i[$e]||"SCRIPT"===r||"STYLE"===r||"LINK"===r&&"stylesheet"===i.rel.toLowerCase()||n.removeChild(i),i=s}}else"body"===n&&Fd(e.ownerDocument.body);n=a}while(n);zp(t)}function Nd(e,t){var n=e;e=0;do{var o=n.nextSibling;if(1===n.nodeType?t?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",""===n.getAttribute("style")&&n.removeAttribute("style")):3===n.nodeType&&(t?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0===e)break;e--}else"$"!==n&&"$?"!==n&&"$~"!==n&&"$!"!==n||e++;n=o}while(n)}function xd(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":xd(n),Ye(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function wd(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=Od(e.nextSibling)))return null}return e}function Pd(e){return"$?"===e.data||"$~"===e.data}function kd(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function Od(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break;if("/$"===t||"/&"===t)return null}}return e}var Ld=null;function Dd(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n||"/&"===n){if(0===t)return Od(e.nextSibling);t--}else"$"!==n&&"$!"!==n&&"$?"!==n&&"$~"!==n&&"&"!==n||t++}e=e.nextSibling}return null}function Md(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n||"$~"===n||"&"===n){if(0===t)return e;t--}else"/$"!==n&&"/&"!==n||t++}e=e.previousSibling}return null}function Ud(e,t,n){switch(t=hd(n),e){case"html":if(!(e=t.documentElement))throw Error(s(452));return e;case"head":if(!(e=t.head))throw Error(s(453));return e;case"body":if(!(e=t.body))throw Error(s(454));return e;default:throw Error(s(451))}}function Fd(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Ye(e)}var jd=new Map,Bd=new Set;function qd(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Gd=D.d;D.d={f:function(){var e=Gd.f(),t=Zc();return e||t},r:function(e){var t=Xe(e);null!==t&&5===t.tag&&"form"===t.type?or(t):Gd.r(e)},D:function(e){Gd.D(e),zd("dns-prefetch",e,null)},C:function(e,t){Gd.C(e,t),zd("preconnect",e,t)},L:function(e,t,n){Gd.L(e,t,n);var o=Hd;if(o&&e&&t){var a='link[rel="preload"][as="'+vt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(a+='[imagesrcset="'+vt(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(a+='[imagesizes="'+vt(n.imageSizes)+'"]')):a+='[href="'+vt(e)+'"]';var i=a;switch(t){case"style":i=Kd(e);break;case"script":i=Yd(e)}jd.has(i)||(e=m({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),jd.set(i,e),null!==o.querySelector(a)||"style"===t&&o.querySelector(Vd(i))||"script"===t&&o.querySelector(Jd(i))||(pd(t=o.createElement("link"),"link",e),et(t),o.head.appendChild(t)))}},m:function(e,t){Gd.m(e,t);var n=Hd;if(n&&e){var o=t&&"string"==typeof t.as?t.as:"script",a='link[rel="modulepreload"][as="'+vt(o)+'"][href="'+vt(e)+'"]',i=a;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":i=Yd(e)}if(!jd.has(i)&&(e=m({rel:"modulepreload",href:e},t),jd.set(i,e),null===n.querySelector(a))){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Jd(i)))return}pd(o=n.createElement("link"),"link",e),et(o),n.head.appendChild(o)}}},X:function(e,t){Gd.X(e,t);var n=Hd;if(n&&e){var o=Ze(n).hoistableScripts,a=Yd(e),i=o.get(a);i||((i=n.querySelector(Jd(a)))||(e=m({src:e,async:!0},t),(t=jd.get(a))&&ep(e,t),et(i=n.createElement("script")),pd(i,"link",e),n.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},o.set(a,i))}},S:function(e,t,n){Gd.S(e,t,n);var o=Hd;if(o&&e){var a=Ze(o).hoistableStyles,i=Kd(e);t=t||"default";var s=a.get(i);if(!s){var r={loading:0,preload:null};if(s=o.querySelector(Vd(i)))r.loading=5;else{e=m({rel:"stylesheet",href:e,"data-precedence":t},n),(n=jd.get(i))&&Zd(e,n);var l=s=o.createElement("link");et(l),pd(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){r.loading|=1}),l.addEventListener("error",function(){r.loading|=2}),r.loading|=4,Qd(s,t,o)}s={type:"stylesheet",instance:s,count:1,state:r},a.set(i,s)}}},M:function(e,t){Gd.M(e,t);var n=Hd;if(n&&e){var o=Ze(n).hoistableScripts,a=Yd(e),i=o.get(a);i||((i=n.querySelector(Jd(a)))||(e=m({src:e,async:!0,type:"module"},t),(t=jd.get(a))&&ep(e,t),et(i=n.createElement("script")),pd(i,"link",e),n.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},o.set(a,i))}}};var Hd="undefined"==typeof document?null:document;function zd(e,t,n){var o=Hd;if(o&&"string"==typeof t&&t){var a=vt(t);a='link[rel="'+e+'"][href="'+a+'"]',"string"==typeof n&&(a+='[crossorigin="'+n+'"]'),Bd.has(a)||(Bd.add(a),e={rel:e,crossOrigin:n,href:t},null===o.querySelector(a)&&(pd(t=o.createElement("link"),"link",e),et(t),o.head.appendChild(t)))}}function Wd(e,t,n,o){var a,i,r,l,c=(c=K.current)?qd(c):null;if(!c)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(t=Kd(n.href),(o=(n=Ze(c).hoistableStyles).get(t))||(o={type:"style",instance:null,count:0,state:null},n.set(t,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=Kd(n.href);var u=Ze(c).hoistableStyles,d=u.get(e);if(d||(c=c.ownerDocument||c,d={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,d),(u=c.querySelector(Vd(e)))&&!u._p&&(d.instance=u,d.state.loading=5),jd.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},jd.set(e,n),u||(a=c,i=e,r=n,l=d.state,a.querySelector('link[rel="preload"][as="style"]['+i+"]")?l.loading=1:(i=a.createElement("link"),l.preload=i,i.addEventListener("load",function(){return l.loading|=1}),i.addEventListener("error",function(){return l.loading|=2}),pd(i,"link",r),et(i),a.head.appendChild(i))))),t&&null===o)throw Error(s(528,""));return d}if(t&&null!==o)throw Error(s(529,""));return null;case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=Yd(n),(o=(n=Ze(c).hoistableScripts).get(t))||(o={type:"script",instance:null,count:0,state:null},n.set(t,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function Kd(e){return'href="'+vt(e)+'"'}function Vd(e){return'link[rel="stylesheet"]['+e+"]"}function $d(e){return m({},e,{"data-precedence":e.precedence,precedence:null})}function Yd(e){return'[src="'+vt(e)+'"]'}function Jd(e){return"script[async]"+e}function Xd(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var o=e.querySelector('style[data-href~="'+vt(n.href)+'"]');if(o)return t.instance=o,et(o),o;var a=m({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return et(o=(e.ownerDocument||e).createElement("style")),pd(o,"style",a),Qd(o,n.precedence,e),t.instance=o;case"stylesheet":a=Kd(n.href);var i=e.querySelector(Vd(a));if(i)return t.state.loading|=4,t.instance=i,et(i),i;o=$d(n),(a=jd.get(a))&&Zd(o,a),et(i=(e.ownerDocument||e).createElement("link"));var r=i;return r._p=new Promise(function(e,t){r.onload=e,r.onerror=t}),pd(i,"link",o),t.state.loading|=4,Qd(i,n.precedence,e),t.instance=i;case"script":return i=Yd(n.src),(a=e.querySelector(Jd(i)))?(t.instance=a,et(a),a):(o=n,(a=jd.get(i))&&ep(o=m({},n),a),et(a=(e=e.ownerDocument||e).createElement("script")),pd(a,"link",o),e.head.appendChild(a),t.instance=a);case"void":return null;default:throw Error(s(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(o=t.instance,t.state.loading|=4,Qd(o,n.precedence,e));return t.instance}function Qd(e,t,n){for(var o=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),a=o.length?o[o.length-1]:null,i=a,s=0;s<o.length;s++){var r=o[s];if(r.dataset.precedence===t)i=r;else if(i!==a)break}i?i.parentNode.insertBefore(e,i.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Zd(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function ep(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var tp=null;function np(e,t,n){if(null===tp){var o=new Map,a=tp=new Map;a.set(n,o)}else(o=(a=tp).get(n))||(o=new Map,a.set(n,o));if(o.has(e))return o;for(o.set(e,null),n=n.getElementsByTagName(e),a=0;a<n.length;a++){var i=n[a];if(!(i[$e]||i[qe]||"link"===e&&"stylesheet"===i.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==i.namespaceURI){var s=i.getAttribute(t)||"";s=e+s;var r=o.get(s);r?r.push(i):o.set(s,[i])}}return o}function op(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function ap(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var ip=0;function sp(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)lp(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var rp=null;function lp(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,rp=new Map,t.forEach(cp,e),rp=null,sp.call(e))}function cp(e,t){if(!(4&t.state.loading)){var n=rp.get(e);if(n)var o=n.get(null);else{n=new Map,rp.set(e,n);for(var a=e.querySelectorAll("link[data-precedence],style[data-precedence]"),i=0;i<a.length;i++){var s=a[i];"LINK"!==s.nodeName&&"not all"===s.getAttribute("media")||(n.set(s.dataset.precedence,s),o=s)}o&&n.set(null,o)}s=(a=t.instance).getAttribute("data-precedence"),(i=n.get(s)||o)===o&&n.set(null,a),n.set(s,a),this.count++,o=sp.bind(this),a.addEventListener("load",o),a.addEventListener("error",o),i?i.parentNode.insertBefore(a,i.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(a,e.firstChild),t.state.loading|=4}}var up={$$typeof:S,Provider:null,Consumer:null,_currentValue:M,_currentValue2:M,_threadCount:0};function dp(e,t,n,o,a,i,s,r,l){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Pe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pe(0),this.hiddenUpdates=Pe(null),this.identifierPrefix=o,this.onUncaughtError=a,this.onCaughtError=i,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function pp(e,t,n,o,a,i,s,r,l,c,u,d){return e=new dp(e,t,n,s,l,c,u,d,r),t=1,!0===i&&(t|=24),i=jo(3,null,null,t),e.current=i,i.stateNode=e,(t=Ba()).refCount++,e.pooledCache=t,t.refCount++,i.memoizedState={element:o,isDehydrated:n,cache:t},vi(i),e}function mp(e){return e?e=Uo:Uo}function gp(e,t,n,o,a,i){a=mp(a),null===o.context?o.context=a:o.pendingContext=a,(o=bi(t)).payload={element:n},null!==(i=void 0===i?null:i)&&(o.callback=i),null!==(n=Ei(e,o,t))&&($c(n,0,t),Si(n,e,t))}function fp(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function hp(e,t){fp(e,t),(e=e.alternate)&&fp(e,t)}function vp(e){if(13===e.tag||31===e.tag){var t=Lo(e,67108864);null!==t&&$c(t,0,67108864),hp(e,67108864)}}function yp(e){if(13===e.tag||31===e.tag){var t=Kc(),n=Lo(e,t=Me(t));null!==n&&$c(n,0,t),hp(e,t)}}var bp=!0;function Ep(e,t,n,o){var a=L.T;L.T=null;var i=D.p;try{D.p=2,Tp(e,t,n,o)}finally{D.p=i,L.T=a}}function Sp(e,t,n,o){var a=L.T;L.T=null;var i=D.p;try{D.p=8,Tp(e,t,n,o)}finally{D.p=i,L.T=a}}function Tp(e,t,n,o){if(bp){var a=_p(o);if(null===a)td(e,t,o,Cp,n),Dp(e,o);else if(function(e,t,n,o,a){switch(t){case"focusin":return Np=Mp(Np,e,t,n,o,a),!0;case"dragenter":return xp=Mp(xp,e,t,n,o,a),!0;case"mouseover":return wp=Mp(wp,e,t,n,o,a),!0;case"pointerover":var i=a.pointerId;return Pp.set(i,Mp(Pp.get(i)||null,e,t,n,o,a)),!0;case"gotpointercapture":return i=a.pointerId,kp.set(i,Mp(kp.get(i)||null,e,t,n,o,a)),!0}return!1}(a,e,t,n,o))o.stopPropagation();else if(Dp(e,o),4&t&&-1<Lp.indexOf(e)){for(;null!==a;){var i=Xe(a);if(null!==i)switch(i.tag){case 3:if((i=i.stateNode).current.memoizedState.isDehydrated){var s=Re(i.pendingLanes);if(0!==s){var r=i;for(r.pendingLanes|=2,r.entangledLanes|=2;s;){var l=1<<31-Ee(s);r.entanglements[1]|=l,s&=~l}Du(i),!(6&mc)&&(Lc=le()+500,Mu(0,!1))}}break;case 31:case 13:null!==(r=Lo(i,2))&&$c(r,0,2),Zc(),hp(i,2)}if(null===(i=_p(o))&&td(e,t,o,Cp,n),i===a)break;a=i}null!==a&&o.stopPropagation()}else td(e,t,o,null,n)}}function _p(e){return Ip(e=Lt(e))}var Cp=null;function Ip(e){if(Cp=null,null!==(e=Je(e))){var t=l(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=c(t)))return e;e=null}else if(31===n){if(null!==(e=u(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Cp=e,null}function Rp(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ce()){case ue:return 2;case de:return 8;case pe:case me:return 32;case ge:return 268435456;default:return 32}default:return 32}}var Ap=!1,Np=null,xp=null,wp=null,Pp=new Map,kp=new Map,Op=[],Lp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Dp(e,t){switch(e){case"focusin":case"focusout":Np=null;break;case"dragenter":case"dragleave":xp=null;break;case"mouseover":case"mouseout":wp=null;break;case"pointerover":case"pointerout":Pp.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":kp.delete(t.pointerId)}}function Mp(e,t,n,o,a,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:o,nativeEvent:i,targetContainers:[a]},null!==t&&(null!==(t=Xe(t))&&vp(t)),e):(e.eventSystemFlags|=o,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Up(e){var t=Je(e.target);if(null!==t){var n=l(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=c(n)))return e.blockedOn=t,void je(e.priority,function(){yp(n)})}else if(31===t){if(null!==(t=u(n)))return e.blockedOn=t,void je(e.priority,function(){yp(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Fp(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=_p(e.nativeEvent);if(null!==n)return null!==(t=Xe(n))&&vp(t),e.blockedOn=n,!1;var o=new(n=e.nativeEvent).constructor(n.type,n);Ot=o,n.target.dispatchEvent(o),Ot=null,t.shift()}return!0}function jp(e,t,n){Fp(e)&&n.delete(t)}function Bp(){Ap=!1,null!==Np&&Fp(Np)&&(Np=null),null!==xp&&Fp(xp)&&(xp=null),null!==wp&&Fp(wp)&&(wp=null),Pp.forEach(jp),kp.forEach(jp)}function qp(e,t){e.blockedOn===t&&(e.blockedOn=null,Ap||(Ap=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Bp)))}var Gp=null;function Hp(e){Gp!==e&&(Gp=e,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){Gp===e&&(Gp=null);for(var t=0;t<e.length;t+=3){var n=e[t],o=e[t+1],a=e[t+2];if("function"!=typeof o){if(null===Ip(o||n))continue;break}var i=Xe(n);null!==i&&(e.splice(t,3),t-=3,tr(i,{pending:!0,data:a,method:n.method,action:o},o,a))}}))}function zp(e){function t(t){return qp(t,e)}null!==Np&&qp(Np,e),null!==xp&&qp(xp,e),null!==wp&&qp(wp,e),Pp.forEach(t),kp.forEach(t);for(var n=0;n<Op.length;n++){var o=Op[n];o.blockedOn===e&&(o.blockedOn=null)}for(;0<Op.length&&null===(n=Op[0]).blockedOn;)Up(n),null===n.blockedOn&&Op.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(o=0;o<n.length;o+=3){var a=n[o],i=n[o+1],s=a[Ge]||null;if("function"==typeof i)s||Hp(n);else if(s){var r=null;if(i&&i.hasAttribute("formAction")){if(a=i,s=i[Ge]||null)r=s.formAction;else if(null!==Ip(a))continue}else r=s.action;"function"==typeof r?n[o+1]=r:(n.splice(o,3),o-=3),Hp(n)}}}function Wp(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return a=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==a&&(a(),a=null),o||setTimeout(n,20)}function n(){if(!o&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"==typeof navigation){var o=!1,a=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(n,100),function(){o=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==a&&(a(),a=null)}}}function Kp(e){this._internalRoot=e}function Vp(e){this._internalRoot=e}Vp.prototype.render=Kp.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));gp(t.current,Kc(),e,t,null,null)},Vp.prototype.unmount=Kp.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;gp(e.current,2,null,e,null,null),Zc(),t[He]=null}},Vp.prototype.unstable_scheduleHydration=function(e){if(e){var t=Fe();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Op.length&&0!==t&&t<Op[n].priority;n++);Op.splice(n,0,e),0===n&&Up(e)}};var $p=a.version;if("19.2.3"!==$p)throw Error(s(527,$p,"19.2.3"));D.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=l(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,o=t;;){var a=n.return;if(null===a)break;var i=a.alternate;if(null===i){if(null!==(o=a.return)){n=o;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return d(a),e;if(i===o)return d(a),t;i=i.sibling}throw Error(s(188))}if(n.return!==o.return)n=a,o=i;else{for(var r=!1,c=a.child;c;){if(c===n){r=!0,n=a,o=i;break}if(c===o){r=!0,o=a,n=i;break}c=c.sibling}if(!r){for(c=i.child;c;){if(c===n){r=!0,n=i,o=a;break}if(c===o){r=!0,o=i,n=a;break}c=c.sibling}if(!r)throw Error(s(189))}}if(n.alternate!==o)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?p(e):null)?null:e.stateNode};var Yp={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.2.3"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Jp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Jp.isDisabled&&Jp.supportsFiber)try{ve=Jp.inject(Yp),ye=Jp}catch(Qp){}}t.createRoot=function(e,t){if(!r(e))throw Error(s(299));var n=!1,o="",a=Cr,i=Ir,l=Rr;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(o=t.identifierPrefix),void 0!==t.onUncaughtError&&(a=t.onUncaughtError),void 0!==t.onCaughtError&&(i=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError)),t=pp(e,1,!1,null,0,n,o,null,a,i,l,Wp),e[He]=t.current,Zu(e),new Kp(t)},t.hydrateRoot=function(e,t,n){if(!r(e))throw Error(s(299));var o=!1,a="",i=Cr,l=Ir,c=Rr,u=null;return null!=n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onUncaughtError&&(i=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.formState&&(u=n.formState)),(t=pp(e,1,!0,t,0,o,a,u,i,l,c,Wp)).context=mp(null),n=t.current,(a=bi(o=Me(o=Kc()))).callback=null,Ei(n,a,o),n=o,t.current.lanes=n,ke(t,n),Du(t),e[He]=t.current,Zu(e),new Vp(t)},t.version="19.2.3"},1312(e,t,n){"use strict";n.d(t,{A:()=>c,T:()=>l});var o=n(6540),a=n(4848);function i(e,t){const n=e.split(/(\{\w+\})/).map((e,n)=>{if(n%2==1){const n=t?.[e.slice(1,-1)];if(void 0!==n)return n}return e});return n.some(e=>(0,o.isValidElement)(e))?n.map((e,t)=>(0,o.isValidElement)(e)?o.cloneElement(e,{key:t}):e).filter(e=>""!==e):n.join("")}var s=n(2654);function r({id:e,message:t}){if(void 0===e&&void 0===t)throw new Error("Docusaurus translation declarations must have at least a translation id or a default translation message");return s[e??t]??t??e}function l({message:e,id:t},n){return i(r({message:e,id:t}),n)}function c({children:e,id:t,values:n}){if(e&&"string"!=typeof e)throw console.warn("Illegal <Translate> children",e),new Error("The Docusaurus <Translate> component only accept simple string values");const o=r({message:e,id:t});return(0,a.jsx)(a.Fragment,{children:i(o,n)})}},1422(e,t,n){"use strict";n.d(t,{N:()=>g,u:()=>r});var o=n(6540),a=n(205),i=n(3109),s=n(4848);function r({initialState:e}){const[t,n]=(0,o.useState)(e??!1),a=(0,o.useCallback)(()=>{n(e=>!e)},[]);return{collapsed:t,setCollapsed:n,toggleCollapsed:a}}const l={display:"none",overflow:"hidden",height:"0px"},c={display:"block",overflow:"visible",height:"auto"};function u(e,t){const n=t?l:c;e.style.display=n.display,e.style.overflow=n.overflow,e.style.height=n.height}function d({collapsibleRef:e,collapsed:t,animation:n}){const a=(0,o.useRef)(!1);(0,o.useEffect)(()=>{const o=e.current;function s(){const e=o.scrollHeight,t=n?.duration??function(e){if((0,i.O)())return 1;const t=e/36;return Math.round(10*(4+15*t**.25+t/5))}(e);return{transition:`height ${t}ms ${n?.easing??"ease-in-out"}`,height:`${e}px`}}function r(){const e=s();o.style.transition=e.transition,o.style.height=e.height}if(!a.current)return u(o,t),void(a.current=!0);return o.style.willChange="height",function(){const e=requestAnimationFrame(()=>{t?(r(),requestAnimationFrame(()=>{o.style.height=l.height,o.style.overflow=l.overflow})):(o.style.display="block",requestAnimationFrame(()=>{r()}))});return()=>cancelAnimationFrame(e)}()},[e,t,n])}function p({as:e="div",collapsed:t,children:n,animation:a,onCollapseTransitionEnd:i,className:r}){const l=(0,o.useRef)(null);return d({collapsibleRef:l,collapsed:t,animation:a}),(0,s.jsx)(e,{ref:l,onTransitionEnd:e=>{"height"===e.propertyName&&(u(l.current,t),i?.(t))},className:r,children:n})}function m({collapsed:e,...t}){const[n,i]=(0,o.useState)(!e),[r,l]=(0,o.useState)(e);return(0,a.A)(()=>{e||i(!0)},[e]),(0,a.A)(()=>{n&&l(e)},[n,e]),n?(0,s.jsx)(p,{...t,collapsed:r}):null}function g({lazy:e,...t}){const n=e?m:p;return(0,s.jsx)(n,{...t})}},1463(e,t,n){"use strict";n.d(t,{A:()=>i});n(6540);var o=n(5260),a=n(4848);function i({locale:e,version:t,tag:n}){const i=e;return(0,a.jsxs)(o.A,{children:[e&&(0,a.jsx)("meta",{name:"docusaurus_locale",content:e}),t&&(0,a.jsx)("meta",{name:"docusaurus_version",content:t}),n&&(0,a.jsx)("meta",{name:"docusaurus_tag",content:n}),i&&(0,a.jsx)("meta",{name:"docsearch:language",content:i}),t&&(0,a.jsx)("meta",{name:"docsearch:version",content:t}),n&&(0,a.jsx)("meta",{name:"docsearch:docusaurus_tag",content:n})]})}},1513(e,t,n){"use strict";n.d(t,{zR:()=>E,TM:()=>R,yJ:()=>m,sC:()=>N,AO:()=>p});var o=n(8168);function a(e){return"/"===e.charAt(0)}function i(e,t){for(var n=t,o=n+1,a=e.length;o<a;n+=1,o+=1)e[n]=e[o];e.pop()}const s=function(e,t){void 0===t&&(t="");var n,o=e&&e.split("/")||[],s=t&&t.split("/")||[],r=e&&a(e),l=t&&a(t),c=r||l;if(e&&a(e)?s=o:o.length&&(s.pop(),s=s.concat(o)),!s.length)return"/";if(s.length){var u=s[s.length-1];n="."===u||".."===u||""===u}else n=!1;for(var d=0,p=s.length;p>=0;p--){var m=s[p];"."===m?i(s,p):".."===m?(i(s,p),d++):d&&(i(s,p),d--)}if(!c)for(;d--;d)s.unshift("..");!c||""===s[0]||s[0]&&a(s[0])||s.unshift("");var g=s.join("/");return n&&"/"!==g.substr(-1)&&(g+="/"),g};var r=n(1561);function l(e){return"/"===e.charAt(0)?e:"/"+e}function c(e){return"/"===e.charAt(0)?e.substr(1):e}function u(e,t){return function(e,t){return 0===e.toLowerCase().indexOf(t.toLowerCase())&&-1!=="/?#".indexOf(e.charAt(t.length))}(e,t)?e.substr(t.length):e}function d(e){return"/"===e.charAt(e.length-1)?e.slice(0,-1):e}function p(e){var t=e.pathname,n=e.search,o=e.hash,a=t||"/";return n&&"?"!==n&&(a+="?"===n.charAt(0)?n:"?"+n),o&&"#"!==o&&(a+="#"===o.charAt(0)?o:"#"+o),a}function m(e,t,n,a){var i;"string"==typeof e?(i=function(e){var t=e||"/",n="",o="",a=t.indexOf("#");-1!==a&&(o=t.substr(a),t=t.substr(0,a));var i=t.indexOf("?");return-1!==i&&(n=t.substr(i),t=t.substr(0,i)),{pathname:t,search:"?"===n?"":n,hash:"#"===o?"":o}}(e),i.state=t):(void 0===(i=(0,o.A)({},e)).pathname&&(i.pathname=""),i.search?"?"!==i.search.charAt(0)&&(i.search="?"+i.search):i.search="",i.hash?"#"!==i.hash.charAt(0)&&(i.hash="#"+i.hash):i.hash="",void 0!==t&&void 0===i.state&&(i.state=t));try{i.pathname=decodeURI(i.pathname)}catch(r){throw r instanceof URIError?new URIError('Pathname "'+i.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):r}return n&&(i.key=n),a?i.pathname?"/"!==i.pathname.charAt(0)&&(i.pathname=s(i.pathname,a.pathname)):i.pathname=a.pathname:i.pathname||(i.pathname="/"),i}function g(){var e=null;var t=[];return{setPrompt:function(t){return e=t,function(){e===t&&(e=null)}},confirmTransitionTo:function(t,n,o,a){if(null!=e){var i="function"==typeof e?e(t,n):e;"string"==typeof i?"function"==typeof o?o(i,a):a(!0):a(!1!==i)}else a(!0)},appendListener:function(e){var n=!0;function o(){n&&e.apply(void 0,arguments)}return t.push(o),function(){n=!1,t=t.filter(function(e){return e!==o})}},notifyListeners:function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];t.forEach(function(e){return e.apply(void 0,n)})}}}var f=!("undefined"==typeof window||!window.document||!window.document.createElement);function h(e,t){t(window.confirm(e))}var v="popstate",y="hashchange";function b(){try{return window.history.state||{}}catch(e){return{}}}function E(e){void 0===e&&(e={}),f||(0,r.A)(!1);var t,n=window.history,a=(-1===(t=window.navigator.userAgent).indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone"))&&window.history&&"pushState"in window.history,i=!(-1===window.navigator.userAgent.indexOf("Trident")),s=e,c=s.forceRefresh,E=void 0!==c&&c,S=s.getUserConfirmation,T=void 0===S?h:S,_=s.keyLength,C=void 0===_?6:_,I=e.basename?d(l(e.basename)):"";function R(e){var t=e||{},n=t.key,o=t.state,a=window.location,i=a.pathname+a.search+a.hash;return I&&(i=u(i,I)),m(i,o,n)}function A(){return Math.random().toString(36).substr(2,C)}var N=g();function x(e){(0,o.A)(q,e),q.length=n.length,N.notifyListeners(q.location,q.action)}function w(e){(function(e){return void 0===e.state&&-1===navigator.userAgent.indexOf("CriOS")})(e)||O(R(e.state))}function P(){O(R(b()))}var k=!1;function O(e){if(k)k=!1,x();else{N.confirmTransitionTo(e,"POP",T,function(t){t?x({action:"POP",location:e}):function(e){var t=q.location,n=D.indexOf(t.key);-1===n&&(n=0);var o=D.indexOf(e.key);-1===o&&(o=0);var a=n-o;a&&(k=!0,U(a))}(e)})}}var L=R(b()),D=[L.key];function M(e){return I+p(e)}function U(e){n.go(e)}var F=0;function j(e){1===(F+=e)&&1===e?(window.addEventListener(v,w),i&&window.addEventListener(y,P)):0===F&&(window.removeEventListener(v,w),i&&window.removeEventListener(y,P))}var B=!1;var q={length:n.length,action:"POP",location:L,createHref:M,push:function(e,t){var o="PUSH",i=m(e,t,A(),q.location);N.confirmTransitionTo(i,o,T,function(e){if(e){var t=M(i),s=i.key,r=i.state;if(a)if(n.pushState({key:s,state:r},null,t),E)window.location.href=t;else{var l=D.indexOf(q.location.key),c=D.slice(0,l+1);c.push(i.key),D=c,x({action:o,location:i})}else window.location.href=t}})},replace:function(e,t){var o="REPLACE",i=m(e,t,A(),q.location);N.confirmTransitionTo(i,o,T,function(e){if(e){var t=M(i),s=i.key,r=i.state;if(a)if(n.replaceState({key:s,state:r},null,t),E)window.location.replace(t);else{var l=D.indexOf(q.location.key);-1!==l&&(D[l]=i.key),x({action:o,location:i})}else window.location.replace(t)}})},go:U,goBack:function(){U(-1)},goForward:function(){U(1)},block:function(e){void 0===e&&(e=!1);var t=N.setPrompt(e);return B||(j(1),B=!0),function(){return B&&(B=!1,j(-1)),t()}},listen:function(e){var t=N.appendListener(e);return j(1),function(){j(-1),t()}}};return q}var S="hashchange",T={hashbang:{encodePath:function(e){return"!"===e.charAt(0)?e:"!/"+c(e)},decodePath:function(e){return"!"===e.charAt(0)?e.substr(1):e}},noslash:{encodePath:c,decodePath:l},slash:{encodePath:l,decodePath:l}};function _(e){var t=e.indexOf("#");return-1===t?e:e.slice(0,t)}function C(){var e=window.location.href,t=e.indexOf("#");return-1===t?"":e.substring(t+1)}function I(e){window.location.replace(_(window.location.href)+"#"+e)}function R(e){void 0===e&&(e={}),f||(0,r.A)(!1);var t=window.history,n=(window.navigator.userAgent.indexOf("Firefox"),e),a=n.getUserConfirmation,i=void 0===a?h:a,s=n.hashType,c=void 0===s?"slash":s,v=e.basename?d(l(e.basename)):"",y=T[c],b=y.encodePath,E=y.decodePath;function R(){var e=E(C());return v&&(e=u(e,v)),m(e)}var A=g();function N(e){(0,o.A)(B,e),B.length=t.length,A.notifyListeners(B.location,B.action)}var x=!1,w=null;function P(){var e,t,n=C(),o=b(n);if(n!==o)I(o);else{var a=R(),s=B.location;if(!x&&(t=a,(e=s).pathname===t.pathname&&e.search===t.search&&e.hash===t.hash))return;if(w===p(a))return;w=null,function(e){if(x)x=!1,N();else{var t="POP";A.confirmTransitionTo(e,t,i,function(n){n?N({action:t,location:e}):function(e){var t=B.location,n=D.lastIndexOf(p(t));-1===n&&(n=0);var o=D.lastIndexOf(p(e));-1===o&&(o=0);var a=n-o;a&&(x=!0,M(a))}(e)})}}(a)}}var k=C(),O=b(k);k!==O&&I(O);var L=R(),D=[p(L)];function M(e){t.go(e)}var U=0;function F(e){1===(U+=e)&&1===e?window.addEventListener(S,P):0===U&&window.removeEventListener(S,P)}var j=!1;var B={length:t.length,action:"POP",location:L,createHref:function(e){var t=document.querySelector("base"),n="";return t&&t.getAttribute("href")&&(n=_(window.location.href)),n+"#"+b(v+p(e))},push:function(e,t){var n="PUSH",o=m(e,void 0,void 0,B.location);A.confirmTransitionTo(o,n,i,function(e){if(e){var t=p(o),a=b(v+t);if(C()!==a){w=t,function(e){window.location.hash=e}(a);var i=D.lastIndexOf(p(B.location)),s=D.slice(0,i+1);s.push(t),D=s,N({action:n,location:o})}else N()}})},replace:function(e,t){var n="REPLACE",o=m(e,void 0,void 0,B.location);A.confirmTransitionTo(o,n,i,function(e){if(e){var t=p(o),a=b(v+t);C()!==a&&(w=t,I(a));var i=D.indexOf(p(B.location));-1!==i&&(D[i]=t),N({action:n,location:o})}})},go:M,goBack:function(){M(-1)},goForward:function(){M(1)},block:function(e){void 0===e&&(e=!1);var t=A.setPrompt(e);return j||(F(1),j=!0),function(){return j&&(j=!1,F(-1)),t()}},listen:function(e){var t=A.appendListener(e);return F(1),function(){F(-1),t()}}};return B}function A(e,t,n){return Math.min(Math.max(e,t),n)}function N(e){void 0===e&&(e={});var t=e,n=t.getUserConfirmation,a=t.initialEntries,i=void 0===a?["/"]:a,s=t.initialIndex,r=void 0===s?0:s,l=t.keyLength,c=void 0===l?6:l,u=g();function d(e){(0,o.A)(E,e),E.length=E.entries.length,u.notifyListeners(E.location,E.action)}function f(){return Math.random().toString(36).substr(2,c)}var h=A(r,0,i.length-1),v=i.map(function(e){return m(e,void 0,"string"==typeof e?f():e.key||f())}),y=p;function b(e){var t=A(E.index+e,0,E.entries.length-1),o=E.entries[t];u.confirmTransitionTo(o,"POP",n,function(e){e?d({action:"POP",location:o,index:t}):d()})}var E={length:v.length,action:"POP",location:v[h],index:h,entries:v,createHref:y,push:function(e,t){var o="PUSH",a=m(e,t,f(),E.location);u.confirmTransitionTo(a,o,n,function(e){if(e){var t=E.index+1,n=E.entries.slice(0);n.length>t?n.splice(t,n.length-t,a):n.push(a),d({action:o,location:a,index:t,entries:n})}})},replace:function(e,t){var o="REPLACE",a=m(e,t,f(),E.location);u.confirmTransitionTo(a,o,n,function(e){e&&(E.entries[E.index]=a,d({action:o,location:a}))})},go:b,goBack:function(){b(-1)},goForward:function(){b(1)},canGo:function(e){var t=E.index+e;return t>=0&&t<E.entries.length},block:function(e){return void 0===e&&(e=!1),u.setPrompt(e)},listen:function(e){return u.appendListener(e)}};return E}},1561(e,t,n){"use strict";n.d(t,{A:()=>a});var o="Invariant failed";function a(e,t){if(!e)throw new Error(o)}},1635(e,t,n){"use strict";n.r(t),n.d(t,{__addDisposableResource:()=>D,__assign:()=>i,__asyncDelegator:()=>I,__asyncGenerator:()=>C,__asyncValues:()=>R,__await:()=>_,__awaiter:()=>g,__classPrivateFieldGet:()=>k,__classPrivateFieldIn:()=>L,__classPrivateFieldSet:()=>O,__createBinding:()=>h,__decorate:()=>r,__disposeResources:()=>U,__esDecorate:()=>c,__exportStar:()=>v,__extends:()=>a,__generator:()=>f,__importDefault:()=>P,__importStar:()=>w,__makeTemplateObject:()=>A,__metadata:()=>m,__param:()=>l,__propKey:()=>d,__read:()=>b,__rest:()=>s,__rewriteRelativeImportExtension:()=>F,__runInitializers:()=>u,__setFunctionName:()=>p,__spread:()=>E,__spreadArray:()=>T,__spreadArrays:()=>S,__values:()=>y,default:()=>j});var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return i=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},i.apply(this,arguments)};function s(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n}function r(e,t,n,o){var a,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(a=e[r])&&(s=(i<3?a(s):i>3?a(t,n,s):a(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function l(e,t){return function(n,o){t(n,o,e)}}function c(e,t,n,o,a,i){function s(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var r,l=o.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?o.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,o.name):{}),p=!1,m=n.length-1;m>=0;m--){var g={};for(var f in o)g[f]="access"===f?{}:o[f];for(var f in o.access)g.access[f]=o.access[f];g.addInitializer=function(e){if(p)throw new TypeError("Cannot add initializers after decoration has completed");i.push(s(e||null))};var h=(0,n[m])("accessor"===l?{get:d.get,set:d.set}:d[c],g);if("accessor"===l){if(void 0===h)continue;if(null===h||"object"!=typeof h)throw new TypeError("Object expected");(r=s(h.get))&&(d.get=r),(r=s(h.set))&&(d.set=r),(r=s(h.init))&&a.unshift(r)}else(r=s(h))&&("field"===l?a.unshift(r):d[c]=r)}u&&Object.defineProperty(u,o.name,d),p=!0}function u(e,t,n){for(var o=arguments.length>2,a=0;a<t.length;a++)n=o?t[a].call(e,n):t[a].call(e);return o?n:void 0}function d(e){return"symbol"==typeof e?e:"".concat(e)}function p(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})}function m(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function g(e,t,n,o){return new(n||(n=Promise))(function(a,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function r(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,r)}l((o=o.apply(e,t||[])).next())})}function f(e,t){var n,o,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=r(0),s.throw=r(1),s.return=r(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function r(r){return function(l){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(i=0)),i;)try{if(n=1,o&&(a=2&r[0]?o.return:r[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,r[1])).done)return a;switch(o=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,o=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==r[0]&&2!==r[0])){i=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){i.label=r[1];break}if(6===r[0]&&i.label<a[1]){i.label=a[1],a=r;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(r);break}a[2]&&i.ops.pop(),i.trys.pop();continue}r=t.call(e,i)}catch(l){r=[6,l],o=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}}var h=Object.create?function(e,t,n,o){void 0===o&&(o=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,a)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]};function v(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||h(t,e,n)}function y(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function b(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,a,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(r){a={error:r}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return s}function E(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(b(arguments[t]));return e}function S(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),a=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,r=i.length;s<r;s++,a++)o[a]=i[s];return o}function T(e,t,n){if(n||2===arguments.length)for(var o,a=0,i=t.length;a<i;a++)!o&&a in t||(o||(o=Array.prototype.slice.call(t,0,a)),o[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))}function _(e){return this instanceof _?(this.v=e,this):new _(e)}function C(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,a=n.apply(e,t||[]),i=[];return o=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),o[Symbol.asyncIterator]=function(){return this},o;function s(e,t){a[e]&&(o[e]=function(t){return new Promise(function(n,o){i.push([e,t,n,o])>1||r(e,t)})},t&&(o[e]=t(o[e])))}function r(e,t){try{(n=a[e](t)).value instanceof _?Promise.resolve(n.value.v).then(l,c):u(i[0][2],n)}catch(o){u(i[0][3],o)}var n}function l(e){r("next",e)}function c(e){r("throw",e)}function u(e,t){e(t),i.shift(),i.length&&r(i[0][0],i[0][1])}}function I(e){var t,n;return t={},o("next"),o("throw",function(e){throw e}),o("return"),t[Symbol.iterator]=function(){return this},t;function o(o,a){t[o]=e[o]?function(t){return(n=!n)?{value:_(e[o](t)),done:!1}:a?a(t):t}:a}}function R(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=y(e),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(n){t[n]=e[n]&&function(t){return new Promise(function(o,a){(function(e,t,n,o){Promise.resolve(o).then(function(t){e({value:t,done:n})},t)})(o,a,(t=e[n](t)).done,t.value)})}}}function A(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var N=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},x=function(e){return x=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},x(e)};function w(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=x(e),o=0;o<n.length;o++)"default"!==n[o]&&h(t,e,n[o]);return N(t,e),t}function P(e){return e&&e.__esModule?e:{default:e}}function k(e,t,n,o){if("a"===n&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?o:"a"===n?o.call(e):o?o.value:t.get(e)}function O(e,t,n,o,a){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?a.call(e,n):a?a.value=n:t.set(e,n),n}function L(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function D(e,t,n){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var o,a;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");o=t[Symbol.asyncDispose]}if(void 0===o){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");o=t[Symbol.dispose],n&&(a=o)}if("function"!=typeof o)throw new TypeError("Object not disposable.");a&&(o=function(){try{a.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:o,async:n})}else n&&e.stack.push({async:!0});return t}var M="function"==typeof SuppressedError?SuppressedError:function(e,t,n){var o=new Error(n);return o.name="SuppressedError",o.error=e,o.suppressed=t,o};function U(e){function t(t){e.error=e.hasError?new M(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var n,o=0;return function a(){for(;n=e.stack.pop();)try{if(!n.async&&1===o)return o=0,e.stack.push(n),Promise.resolve().then(a);if(n.dispose){var i=n.dispose.call(n.value);if(n.async)return o|=2,Promise.resolve(i).then(a,function(e){return t(e),a()})}else o|=1}catch(s){t(s)}if(1===o)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}function F(e,t){return"string"==typeof e&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(e,n,o,a,i){return n?t?".jsx":".js":!o||a&&i?o+a+"."+i.toLowerCase()+"js":e}):e}const j={__extends:a,__assign:i,__rest:s,__decorate:r,__param:l,__esDecorate:c,__runInitializers:u,__propKey:d,__setFunctionName:p,__metadata:m,__awaiter:g,__generator:f,__createBinding:h,__exportStar:v,__values:y,__read:b,__spread:E,__spreadArrays:S,__spreadArray:T,__await:_,__asyncGenerator:C,__asyncDelegator:I,__asyncValues:R,__makeTemplateObject:A,__importStar:w,__importDefault:P,__classPrivateFieldGet:k,__classPrivateFieldSet:O,__classPrivateFieldIn:L,__addDisposableResource:D,__disposeResources:U,__rewriteRelativeImportExtension:F}},1656(e,t,n){"use strict";n.d(t,{A:()=>kt});var o=n(6540),a=n(4164),i=n(7489),s=n(5500),r=n(6347),l=n(1312),c=n(5062),u=n(4848);const d="__docusaurus_skipToContent_fallback";function p(e){e.setAttribute("tabindex","-1"),e.focus(),e.removeAttribute("tabindex")}function m(){const e=(0,o.useRef)(null),{action:t}=(0,r.W6)(),n=(0,o.useCallback)(e=>{e.preventDefault();const t=document.querySelector("main:first-of-type")??document.getElementById(d);t&&p(t)},[]);return(0,c.$)(({location:n})=>{e.current&&!n.hash&&"PUSH"===t&&p(e.current)}),{containerRef:e,onClick:n}}const g=(0,l.T)({id:"theme.common.skipToMainContent",description:"The skip to content label used for accessibility, allowing to rapidly navigate to main content with keyboard tab/enter navigation",message:"Skip to main content"});function f(e){const t=e.children??g,{containerRef:n,onClick:o}=m();return(0,u.jsx)("div",{ref:n,role:"region","aria-label":g,children:(0,u.jsx)("a",{...e,href:`#${d}`,onClick:o,children:t})})}var h=n(7559),v=n(4090);const y="skipToContent_fXgn";function b(){return(0,u.jsx)(f,{className:y})}var E=n(6342),S=n(5041);function T({width:e=21,height:t=21,color:n="currentColor",strokeWidth:o=1.2,className:a,...i}){return(0,u.jsx)("svg",{viewBox:"0 0 15 15",width:e,height:t,...i,children:(0,u.jsx)("g",{stroke:n,strokeWidth:o,children:(0,u.jsx)("path",{d:"M.75.75l13.5 13.5M14.25.75L.75 14.25"})})})}const _="closeButton_CVFx";function C(e){return(0,u.jsx)("button",{type:"button","aria-label":(0,l.T)({id:"theme.AnnouncementBar.closeButtonAriaLabel",message:"Close",description:"The ARIA label for close button of announcement bar"}),...e,className:(0,a.A)("clean-btn close",_,e.className),children:(0,u.jsx)(T,{width:14,height:14,strokeWidth:3.1})})}const I="content_knG7";function R(e){const{announcementBar:t}=(0,E.p)(),{content:n}=t;return(0,u.jsx)("div",{...e,className:(0,a.A)(I,e.className),dangerouslySetInnerHTML:{__html:n}})}const A="announcementBar_mb4j",N="announcementBarPlaceholder_vyr4",x="announcementBarClose_gvF7",w="announcementBarContent_xLdY";function P(){const{announcementBar:e}=(0,E.p)(),{isActive:t,close:n}=(0,S.M)();if(!t)return null;const{backgroundColor:o,textColor:i,isCloseable:s}=e;return(0,u.jsxs)("div",{className:(0,a.A)(h.G.announcementBar.container,A),style:{backgroundColor:o,color:i},role:"banner",children:[s&&(0,u.jsx)("div",{className:N}),(0,u.jsx)(R,{className:w}),s&&(0,u.jsx)(C,{onClick:n,className:x})]})}var k=n(2069),O=n(3104);var L=n(9532),D=n(5600);const M=o.createContext(null);function U({children:e}){const t=function(){const e=(0,k.M)(),t=(0,D.YL)(),[n,a]=(0,o.useState)(!1),i=null!==t.component,s=(0,L.ZC)(i);return(0,o.useEffect)(()=>{i&&!s&&a(!0)},[i,s]),(0,o.useEffect)(()=>{i?e.shown||a(!0):a(!1)},[e.shown,i]),(0,o.useMemo)(()=>[n,a],[n])}();return(0,u.jsx)(M.Provider,{value:t,children:e})}function F(e){if(e.component){const t=e.component;return(0,u.jsx)(t,{...e.props})}}function j(){const e=(0,o.useContext)(M);if(!e)throw new L.dV("NavbarSecondaryMenuDisplayProvider");const[t,n]=e,a=(0,o.useCallback)(()=>n(!1),[n]),i=(0,D.YL)();return(0,o.useMemo)(()=>({shown:t,hide:a,content:F(i)}),[a,i,t])}function B(e){return parseInt(o.version.split(".")[0],10)<19?{inert:e?"":void 0}:{inert:e}}function q({children:e,inert:t}){return(0,u.jsx)("div",{className:(0,a.A)(h.G.layout.navbar.mobileSidebar.panel,"navbar-sidebar__item menu"),...B(t),children:e})}function G({header:e,primaryMenu:t,secondaryMenu:n}){const{shown:o}=j();return(0,u.jsxs)("div",{className:(0,a.A)(h.G.layout.navbar.mobileSidebar.container,"navbar-sidebar"),children:[e,(0,u.jsxs)("div",{className:(0,a.A)("navbar-sidebar__items",{"navbar-sidebar__items--show-secondary":o}),children:[(0,u.jsx)(q,{inert:o,children:t}),(0,u.jsx)(q,{inert:!o,children:n})]})]})}var H=n(5293),z=n(2303);function W(e){return(0,u.jsx)("svg",{viewBox:"0 0 24 24",width:24,height:24,...e,children:(0,u.jsx)("path",{fill:"currentColor",d:"M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"})})}function K(e){return(0,u.jsx)("svg",{viewBox:"0 0 24 24",width:24,height:24,...e,children:(0,u.jsx)("path",{fill:"currentColor",d:"M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"})})}function V(e){return(0,u.jsx)("svg",{viewBox:"0 0 24 24",width:24,height:24,...e,children:(0,u.jsx)("path",{fill:"currentColor",d:"m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"})})}const $="toggle_vylO",Y="toggleButton_gllP",J="toggleIcon_g3eP",X="systemToggleIcon_QzmC",Q="lightToggleIcon_pyhR",Z="darkToggleIcon_wfgR",ee="toggleButtonDisabled_aARS";function te(e){switch(e){case null:return(0,l.T)({message:"system mode",id:"theme.colorToggle.ariaLabel.mode.system",description:"The name for the system color mode"});case"light":return(0,l.T)({message:"light mode",id:"theme.colorToggle.ariaLabel.mode.light",description:"The name for the light color mode"});case"dark":return(0,l.T)({message:"dark mode",id:"theme.colorToggle.ariaLabel.mode.dark",description:"The name for the dark color mode"});default:throw new Error(`unexpected color mode ${e}`)}}function ne(e){return(0,l.T)({message:"Switch between dark and light mode (currently {mode})",id:"theme.colorToggle.ariaLabel",description:"The ARIA label for the color mode toggle"},{mode:te(e)})}function oe(){return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(W,{"aria-hidden":!0,className:(0,a.A)(J,Q)}),(0,u.jsx)(K,{"aria-hidden":!0,className:(0,a.A)(J,Z)}),(0,u.jsx)(V,{"aria-hidden":!0,className:(0,a.A)(J,X)})]})}function ae({className:e,buttonClassName:t,respectPrefersColorScheme:n,value:o,onChange:i}){const s=(0,z.A)();return(0,u.jsx)("div",{className:(0,a.A)($,e),children:(0,u.jsx)("button",{className:(0,a.A)("clean-btn",Y,!s&&ee,t),type:"button",onClick:()=>i(function(e,t){if(!t)return"dark"===e?"light":"dark";switch(e){case null:return"light";case"light":return"dark";case"dark":return null;default:throw new Error(`unexpected color mode ${e}`)}}(o,n)),disabled:!s,title:te(o),"aria-label":ne(o),children:(0,u.jsx)(oe,{})})})}const ie=o.memo(ae),se="darkNavbarColorModeToggle_X3D1";function re({className:e}){const t=(0,E.p)().navbar.style,{disableSwitch:n,respectPrefersColorScheme:o}=(0,E.p)().colorMode,{colorModeChoice:a,setColorMode:i}=(0,H.G)();return n?null:(0,u.jsx)(ie,{className:e,buttonClassName:"dark"===t?se:void 0,respectPrefersColorScheme:o,value:a,onChange:i})}var le=n(3465);function ce(){return(0,u.jsx)(le.A,{className:"navbar__brand",imageClassName:"navbar__logo",titleClassName:"navbar__title text--truncate"})}function ue(){const e=(0,k.M)();return(0,u.jsx)("button",{type:"button","aria-label":(0,l.T)({id:"theme.docs.sidebar.closeSidebarButtonAriaLabel",message:"Close navigation bar",description:"The ARIA label for close button of mobile sidebar"}),className:"clean-btn navbar-sidebar__close",onClick:()=>e.toggle(),children:(0,u.jsx)(T,{color:"var(--ifm-color-emphasis-600)"})})}function de(){return(0,u.jsxs)("div",{className:"navbar-sidebar__brand",children:[(0,u.jsx)(ce,{}),(0,u.jsx)(re,{className:"margin-right--md"}),(0,u.jsx)(ue,{})]})}var pe=n(8774),me=n(6025),ge=n(6654);function fe(e,t){return void 0!==e&&void 0!==t&&new RegExp(e,"gi").test(t)}var he=n(3186);function ve({activeBasePath:e,activeBaseRegex:t,to:n,href:o,label:a,html:i,isDropdownLink:s,prependBaseUrlToHref:r,...l}){const c=(0,me.Ay)(n),d=(0,me.Ay)(e),p=(0,me.Ay)(o,{forcePrependBaseUrl:!0}),m=a&&o&&!(0,ge.A)(o),g=i?{dangerouslySetInnerHTML:{__html:i}}:{children:(0,u.jsxs)(u.Fragment,{children:[a,m&&(0,u.jsx)(he.A,{...s&&{width:12,height:12}})]})};return o?(0,u.jsx)(pe.A,{href:r?p:o,...l,...g}):(0,u.jsx)(pe.A,{to:c,isNavLink:!0,...(e||t)&&{isActive:(e,n)=>t?fe(t,n.pathname):n.pathname.startsWith(d)},...l,...g})}function ye({className:e,isDropdownItem:t,...n}){return(0,u.jsx)("li",{className:"menu__list-item",children:(0,u.jsx)(ve,{className:(0,a.A)("menu__link",e),...n})})}function be({className:e,isDropdownItem:t=!1,...n}){const o=(0,u.jsx)(ve,{className:(0,a.A)(t?"dropdown__link":"navbar__item navbar__link",e),isDropdownLink:t,...n});return t?(0,u.jsx)("li",{children:o}):o}function Ee({mobile:e=!1,position:t,...n}){const o=e?ye:be;return(0,u.jsx)(o,{...n,activeClassName:n.activeClassName??(e?"menu__link--active":"navbar__link--active")})}var Se=n(1422),Te=n(9169),_e=n(4586);const Ce="dropdownNavbarItemMobile_J0Sd";function Ie(e,t){return e.some(e=>function(e,t){return!!(0,Te.ys)(e.to,t)||!!fe(e.activeBaseRegex,t)||!(!e.activeBasePath||!t.startsWith(e.activeBasePath))}(e,t))}function Re({collapsed:e,onClick:t}){return(0,u.jsx)("button",{"aria-label":e?(0,l.T)({id:"theme.navbar.mobileDropdown.collapseButton.expandAriaLabel",message:"Expand the dropdown",description:"The ARIA label of the button to expand the mobile dropdown navbar item"}):(0,l.T)({id:"theme.navbar.mobileDropdown.collapseButton.collapseAriaLabel",message:"Collapse the dropdown",description:"The ARIA label of the button to collapse the mobile dropdown navbar item"}),"aria-expanded":!e,type:"button",className:"clean-btn menu__caret",onClick:t})}function Ae({items:e,className:t,position:n,onClick:i,...s}){const l=function(){const{siteConfig:{baseUrl:e}}=(0,_e.A)(),{pathname:t}=(0,r.zy)();return t.replace(e,"/")}(),c=(0,Te.ys)(s.to,l),d=Ie(e,l),{collapsed:p,toggleCollapsed:m}=function({active:e}){const{collapsed:t,toggleCollapsed:n,setCollapsed:a}=(0,Se.u)({initialState:()=>!e});return(0,o.useEffect)(()=>{e&&a(!1)},[e,a]),{collapsed:t,toggleCollapsed:n}}({active:c||d}),g=s.to?void 0:"#";return(0,u.jsxs)("li",{className:(0,a.A)("menu__list-item",{"menu__list-item--collapsed":p}),children:[(0,u.jsxs)("div",{className:(0,a.A)("menu__list-item-collapsible",{"menu__list-item-collapsible--active":c}),children:[(0,u.jsx)(ve,{role:"button",className:(0,a.A)(Ce,"menu__link menu__link--sublist",t),href:g,...s,onClick:e=>{"#"===g&&e.preventDefault(),m()},children:s.children??s.label}),(0,u.jsx)(Re,{collapsed:p,onClick:e=>{e.preventDefault(),m()}})]}),(0,u.jsx)(Se.N,{lazy:!0,as:"ul",className:"menu__list",collapsed:p,children:e.map((e,t)=>(0,o.createElement)(ze,{mobile:!0,isDropdownItem:!0,onClick:i,activeClassName:"menu__link--active",...e,key:t}))})]})}function Ne({items:e,position:t,className:n,onClick:i,...s}){const r=(0,o.useRef)(null),[l,c]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{const e=e=>{r.current&&!r.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),document.addEventListener("focusin",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e),document.removeEventListener("focusin",e)}},[r]),(0,u.jsxs)("div",{ref:r,className:(0,a.A)("navbar__item","dropdown","dropdown--hoverable",{"dropdown--right":"right"===t,"dropdown--show":l}),children:[(0,u.jsx)(ve,{"aria-haspopup":"true","aria-expanded":l,role:"button",href:s.to?void 0:"#",className:(0,a.A)("navbar__link",n),...s,onClick:s.to?void 0:e=>e.preventDefault(),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),c(!l))},children:s.children??s.label}),(0,u.jsx)("ul",{className:"dropdown__menu",children:e.map((e,t)=>(0,o.createElement)(ze,{isDropdownItem:!0,activeClassName:"dropdown__link--active",...e,key:t}))})]})}function xe({mobile:e=!1,...t}){const n=e?Ae:Ne;return(0,u.jsx)(n,{...t})}var we=n(2131),Pe=n(7485);function ke({width:e=20,height:t=20,...n}){return(0,u.jsx)("svg",{viewBox:"0 0 24 24",width:e,height:t,"aria-hidden":!0,...n,children:(0,u.jsx)("path",{fill:"currentColor",d:"M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"})})}const Oe="iconLanguage_nlXk";function Le(){const{siteConfig:e,i18n:{localeConfigs:t}}=(0,_e.A)(),n=(0,we.o)(),o=(0,Pe.Hl)(e=>e.location.search),a=(0,Pe.Hl)(e=>e.location.hash),i=e=>{const n=t[e];if(!n)throw new Error(`Docusaurus bug, no locale config found for locale=${e}`);return n};return{getURL:(t,s)=>{const r=(0,Pe.jy)([o,s.queryString],"append");return`${(t=>i(t).url===e.url?`pathname://${n.createUrl({locale:t,fullyQualified:!1})}`:n.createUrl({locale:t,fullyQualified:!0}))(t)}${r}${a}`},getLabel:e=>i(e).label,getLang:e=>i(e).htmlLang}}var De=n(418);const Me="navbarSearchContainer_Bca1";function Ue({children:e,className:t}){return(0,u.jsx)("div",{className:(0,a.A)(t,Me),children:e})}var Fe=n(4070),je=n(6972);var Be=n(3886);function qe({docsPluginId:e,configs:t}){return function(e,t){if(t){const n=new Map(e.map(e=>[e.name,e])),o=(t,o)=>{const a=n.get(t);if(!a)throw new Error(`No docs version exist for name '${t}', please verify your 'docsVersionDropdown' navbar item versions config.\nAvailable version names:\n- ${e.map(e=>`${e.name}`).join("\n- ")}`);return{version:a,label:o?.label??a.label}};return Array.isArray(t)?t.map(e=>o(e,void 0)):Object.entries(t).map(([e,t])=>o(e,t))}return e.map(e=>({version:e,label:e.label}))}((0,Fe.jh)(e),t)}function Ge(e,t){return t.alternateDocVersions[e.name]??function(e){return e.docs.find(t=>t.id===e.mainDocId)}(e)}const He={default:Ee,localeDropdown:function({mobile:e,dropdownItemsBefore:t,dropdownItemsAfter:n,queryString:o,...a}){const i=Le(),{i18n:{currentLocale:s,locales:r}}=(0,_e.A)(),c=[...t,...r.map(t=>({label:i.getLabel(t),lang:i.getLang(t),to:i.getURL(t,{queryString:o}),target:"_self",autoAddBaseUrl:!1,className:t===s?e?"menu__link--active":"dropdown__link--active":""})),...n],d=e?(0,l.T)({message:"Languages",id:"theme.navbar.mobileLanguageDropdown.label",description:"The label for the mobile language switcher dropdown"}):i.getLabel(s);return(0,u.jsx)(xe,{...a,mobile:e,label:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(ke,{className:Oe}),d]}),items:c})},search:function({mobile:e,className:t}){return e?null:(0,u.jsx)(Ue,{className:t,children:(0,u.jsx)(De.A,{})})},dropdown:xe,html:function({value:e,className:t,mobile:n=!1,isDropdownItem:o=!1}){const i=o?"li":"div";return(0,u.jsx)(i,{className:(0,a.A)({navbar__item:!n&&!o,"menu__list-item":n},t),dangerouslySetInnerHTML:{__html:e}})},doc:function({docId:e,label:t,docsPluginId:n,...o}){const{activeDoc:a}=(0,Fe.zK)(n),i=(0,je.QB)(e,n),s=a?.path===i?.path;return null===i||i.unlisted&&!s?null:(0,u.jsx)(Ee,{exact:!0,...o,isActive:()=>s||!!a?.sidebar&&a.sidebar===i.sidebar,label:t??i.id,to:i.path})},docSidebar:function({sidebarId:e,label:t,docsPluginId:n,...o}){const{activeDoc:a}=(0,Fe.zK)(n),i=(0,je.fW)(e,n).link;if(!i)throw new Error(`DocSidebarNavbarItem: Sidebar with ID "${e}" doesn't have anything to be linked to.`);return(0,u.jsx)(Ee,{exact:!0,...o,isActive:()=>a?.sidebar===e,label:t??i.label,to:i.path})},docsVersion:function({label:e,to:t,docsPluginId:n,...o}){const a=(0,je.Vd)(n)[0],i=e??a.label,s=t??(e=>e.docs.find(t=>t.id===e.mainDocId))(a).path;return(0,u.jsx)(Ee,{...o,label:i,to:s})},docsVersionDropdown:function({mobile:e,docsPluginId:t,dropdownActiveClassDisabled:n,dropdownItemsBefore:o,dropdownItemsAfter:a,versions:i,...s}){const r=(0,Pe.Hl)(e=>e.location.search),c=(0,Pe.Hl)(e=>e.location.hash),d=(0,Fe.zK)(t),{savePreferredVersionName:p}=(0,Be.g1)(t),m=qe({docsPluginId:t,configs:i}),g=function({docsPluginId:e,versionItems:t}){return(0,je.Vd)(e).map(e=>t.find(t=>t.version===e)).filter(e=>void 0!==e)[0]??t[0]}({docsPluginId:t,versionItems:m}),f=[...o,...m.map(function({version:e,label:t}){return{label:t,to:`${Ge(e,d).path}${r}${c}`,isActive:()=>e===d.activeVersion,onClick:()=>p(e.name)}}),...a],h=e&&f.length>1?(0,l.T)({id:"theme.navbar.mobileVersionsDropdown.label",message:"Versions",description:"The label for the navbar versions dropdown on mobile view"}):g.label,v=e&&f.length>1?void 0:Ge(g.version,d).path;return f.length<=1?(0,u.jsx)(Ee,{...s,mobile:e,label:h,to:v,isActive:n?()=>!1:void 0}):(0,u.jsx)(xe,{...s,mobile:e,label:h,to:v,items:f,isActive:n?()=>!1:void 0})}};function ze({type:e,...t}){const n=function(e,t){return e&&"default"!==e?e:"items"in t?"dropdown":"default"}(e,t),o=He[n];if(!o)throw new Error(`No NavbarItem component found for type "${e}".`);return(0,u.jsx)(o,{...t})}function We(){const e=(0,k.M)(),t=(0,E.p)().navbar.items;return(0,u.jsx)("ul",{className:"menu__list",children:t.map((t,n)=>(0,o.createElement)(ze,{mobile:!0,...t,onClick:()=>e.toggle(),key:n}))})}function Ke(e){return(0,u.jsx)("button",{...e,type:"button",className:"clean-btn navbar-sidebar__back",children:(0,u.jsx)(l.A,{id:"theme.navbar.mobileSidebarSecondaryMenu.backButtonLabel",description:"The label of the back button to return to main menu, inside the mobile navbar sidebar secondary menu (notably used to display the docs sidebar)",children:"\u2190 Back to main menu"})})}function Ve(){const e=0===(0,E.p)().navbar.items.length,t=j();return(0,u.jsxs)(u.Fragment,{children:[!e&&(0,u.jsx)(Ke,{onClick:()=>t.hide()}),t.content]})}function $e(){const e=(0,k.M)();return function(e=!0){(0,o.useEffect)(()=>(document.body.style.overflow=e?"hidden":"visible",()=>{document.body.style.overflow="visible"}),[e])}(e.shown),e.shouldRender?(0,u.jsx)(G,{header:(0,u.jsx)(de,{}),primaryMenu:(0,u.jsx)(We,{}),secondaryMenu:(0,u.jsx)(Ve,{})}):null}const Ye="navbarHideable_m1mJ",Je="navbarHidden_jGov";function Xe(e){return(0,u.jsx)("div",{role:"presentation",...e,className:(0,a.A)("navbar-sidebar__backdrop",e.className)})}function Qe({children:e}){const{navbar:{hideOnScroll:t,style:n}}=(0,E.p)(),i=(0,k.M)(),{navbarRef:s,isNavbarVisible:r}=function(e){const[t,n]=(0,o.useState)(e),a=(0,o.useRef)(!1),i=(0,o.useRef)(0),s=(0,o.useCallback)(e=>{null!==e&&(i.current=e.getBoundingClientRect().height)},[]);return(0,O.Mq)(({scrollY:t},o)=>{if(!e)return;if(t<i.current)return void n(!0);if(a.current)return void(a.current=!1);const s=o?.scrollY,r=document.documentElement.scrollHeight-i.current,l=window.innerHeight;s&&t>=s?n(!1):t+l<r&&n(!0)}),(0,c.$)(t=>{if(!e)return;const o=t.location.hash;if(o?document.getElementById(o.substring(1)):void 0)return a.current=!0,void n(!1);n(!0)}),{navbarRef:s,isNavbarVisible:t}}(t);return(0,u.jsxs)("nav",{ref:s,"aria-label":(0,l.T)({id:"theme.NavBar.navAriaLabel",message:"Main",description:"The ARIA label for the main navigation"}),className:(0,a.A)(h.G.layout.navbar.container,"navbar","navbar--fixed-top",t&&[Ye,!r&&Je],{"navbar--dark":"dark"===n,"navbar--primary":"primary"===n,"navbar-sidebar--show":i.shown}),children:[e,(0,u.jsx)(Xe,{onClick:i.toggle}),(0,u.jsx)($e,{})]})}var Ze=n(440);const et="errorBoundaryError_a6uf";function tt(e){return(0,u.jsx)("button",{type:"button",...e,children:(0,u.jsx)(l.A,{id:"theme.ErrorPageContent.tryAgain",description:"The label of the button to try again rendering when the React error boundary captures an error",children:"Try again"})})}function nt({error:e}){const t=(0,Ze.rA)(e).map(e=>e.message).join("\n\nCause:\n");return(0,u.jsx)("p",{className:et,children:t})}class ot extends o.Component{componentDidCatch(e,t){throw this.props.onError(e,t)}render(){return this.props.children}}function at({width:e=30,height:t=30,className:n,...o}){return(0,u.jsx)("svg",{className:n,width:e,height:t,viewBox:"0 0 30 30","aria-hidden":"true",...o,children:(0,u.jsx)("path",{stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"2",d:"M4 7h22M4 15h22M4 23h22"})})}function it(){const{toggle:e,shown:t}=(0,k.M)();return(0,u.jsx)("button",{onClick:e,"aria-label":(0,l.T)({id:"theme.docs.sidebar.toggleSidebarButtonAriaLabel",message:"Toggle navigation bar",description:"The ARIA label for hamburger menu button of mobile navigation"}),"aria-expanded":t,className:"navbar__toggle clean-btn",type:"button",children:(0,u.jsx)(at,{})})}const st="colorModeToggle_DEke";function rt({items:e}){return(0,u.jsx)(u.Fragment,{children:e.map((e,t)=>(0,u.jsx)(ot,{onError:t=>new Error(`A theme navbar item failed to render.\nPlease double-check the following navbar item (themeConfig.navbar.items) of your Docusaurus config:\n${JSON.stringify(e,null,2)}`,{cause:t}),children:(0,u.jsx)(ze,{...e})},t))})}function lt({left:e,right:t}){return(0,u.jsxs)("div",{className:"navbar__inner",children:[(0,u.jsx)("div",{className:(0,a.A)(h.G.layout.navbar.containerLeft,"navbar__items"),children:e}),(0,u.jsx)("div",{className:(0,a.A)(h.G.layout.navbar.containerRight,"navbar__items navbar__items--right"),children:t})]})}function ct(){const e=(0,k.M)(),t=(0,E.p)().navbar.items,[n,o]=function(e){function t(e){return"left"===(e.position??"right")}return[e.filter(t),e.filter(e=>!t(e))]}(t),a=t.find(e=>"search"===e.type);return(0,u.jsx)(lt,{left:(0,u.jsxs)(u.Fragment,{children:[!e.disabled&&(0,u.jsx)(it,{}),(0,u.jsx)(ce,{}),(0,u.jsx)(rt,{items:n})]}),right:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(rt,{items:o}),(0,u.jsx)(re,{className:st}),!a&&(0,u.jsx)(Ue,{children:(0,u.jsx)(De.A,{})})]})})}function ut(){return(0,u.jsx)(Qe,{children:(0,u.jsx)(ct,{})})}function dt({item:e}){const{to:t,href:n,label:o,prependBaseUrlToHref:i,className:s,...r}=e,l=(0,me.Ay)(t),c=(0,me.Ay)(n,{forcePrependBaseUrl:!0});return(0,u.jsxs)(pe.A,{className:(0,a.A)("footer__link-item",s),...n?{href:i?c:n}:{to:l},...r,children:[o,n&&!(0,ge.A)(n)&&(0,u.jsx)(he.A,{})]})}function pt({item:e}){return e.html?(0,u.jsx)("li",{className:(0,a.A)("footer__item",e.className),dangerouslySetInnerHTML:{__html:e.html}}):(0,u.jsx)("li",{className:"footer__item",children:(0,u.jsx)(dt,{item:e})},e.href??e.to)}function mt({column:e}){return(0,u.jsxs)("div",{className:(0,a.A)(h.G.layout.footer.column,"col footer__col",e.className),children:[(0,u.jsx)("div",{className:"footer__title",children:e.title}),(0,u.jsx)("ul",{className:"footer__items clean-list",children:e.items.map((e,t)=>(0,u.jsx)(pt,{item:e},t))})]})}function gt({columns:e}){return(0,u.jsx)("div",{className:"row footer__links",children:e.map((e,t)=>(0,u.jsx)(mt,{column:e},t))})}function ft(){return(0,u.jsx)("span",{className:"footer__link-separator",children:"\xb7"})}function ht({item:e}){return e.html?(0,u.jsx)("span",{className:(0,a.A)("footer__link-item",e.className),dangerouslySetInnerHTML:{__html:e.html}}):(0,u.jsx)(dt,{item:e})}function vt({links:e}){return(0,u.jsx)("div",{className:"footer__links text--center",children:(0,u.jsx)("div",{className:"footer__links",children:e.map((t,n)=>(0,u.jsxs)(o.Fragment,{children:[(0,u.jsx)(ht,{item:t}),e.length!==n+1&&(0,u.jsx)(ft,{})]},n))})})}function yt({links:e}){return function(e){return"title"in e[0]}(e)?(0,u.jsx)(gt,{columns:e}):(0,u.jsx)(vt,{links:e})}var bt=n(1122);const Et="footerLogoLink_BH7S";function St({logo:e}){const{withBaseUrl:t}=(0,me.hH)(),n={light:t(e.src),dark:t(e.srcDark??e.src)};return(0,u.jsx)(bt.A,{className:(0,a.A)("footer__logo",e.className),alt:e.alt,sources:n,width:e.width,height:e.height,style:e.style})}function Tt({logo:e}){return e.href?(0,u.jsx)(pe.A,{href:e.href,className:Et,target:e.target,children:(0,u.jsx)(St,{logo:e})}):(0,u.jsx)(St,{logo:e})}function _t({copyright:e}){return(0,u.jsx)("div",{className:"footer__copyright",dangerouslySetInnerHTML:{__html:e}})}function Ct({style:e,links:t,logo:n,copyright:o}){return(0,u.jsx)("footer",{className:(0,a.A)(h.G.layout.footer.container,"footer",{"footer--dark":"dark"===e}),children:(0,u.jsxs)("div",{className:"container container-fluid",children:[t,(n||o)&&(0,u.jsxs)("div",{className:"footer__bottom text--center",children:[n&&(0,u.jsx)("div",{className:"margin-bottom--sm",children:n}),o]})]})})}function It(){const{footer:e}=(0,E.p)();if(!e)return null;const{copyright:t,links:n,logo:o,style:a}=e;return(0,u.jsx)(Ct,{style:a,links:n&&n.length>0&&(0,u.jsx)(yt,{links:n}),logo:o&&(0,u.jsx)(Tt,{logo:o}),copyright:t&&(0,u.jsx)(_t,{copyright:t})})}const Rt=o.memo(It),At=(0,L.fM)([H.a,S.o,O.Tv,Be.VQ,s.Jx,function({children:e}){return(0,u.jsx)(D.y_,{children:(0,u.jsx)(k.e,{children:(0,u.jsx)(U,{children:e})})})}]);function Nt({children:e}){return(0,u.jsx)(At,{children:e})}var xt=n(1107);function wt({error:e,tryAgain:t}){return(0,u.jsx)("main",{className:"container margin-vert--xl",children:(0,u.jsx)("div",{className:"row",children:(0,u.jsxs)("div",{className:"col col--6 col--offset-3",children:[(0,u.jsx)(xt.A,{as:"h1",className:"hero__title",children:(0,u.jsx)(l.A,{id:"theme.ErrorPageContent.title",description:"The title of the fallback page when the page crashed",children:"This page crashed."})}),(0,u.jsx)("div",{className:"margin-vert--lg",children:(0,u.jsx)(tt,{onClick:t,className:"button button--primary shadow--lw"})}),(0,u.jsx)("hr",{}),(0,u.jsx)("div",{className:"margin-vert--md",children:(0,u.jsx)(nt,{error:e})})]})})})}const Pt="mainWrapper_z2l0";function kt(e){const{children:t,noFooter:n,wrapperClassName:o,title:r,description:l}=e;return(0,v.J)(),(0,u.jsxs)(Nt,{children:[(0,u.jsx)(s.be,{title:r,description:l}),(0,u.jsx)(b,{}),(0,u.jsx)(P,{}),(0,u.jsx)(ut,{}),(0,u.jsx)("div",{id:d,className:(0,a.A)(h.G.layout.main.container,h.G.wrapper.main,Pt,o),children:(0,u.jsx)(i.A,{fallback:e=>(0,u.jsx)(wt,{...e}),children:t})}),!n&&(0,u.jsx)(Rt,{})]})}},1682(e,t,n){"use strict";function o(e,t=(e,t)=>e===t){return e.filter((n,o)=>e.findIndex(e=>t(e,n))!==o)}function a(e){return Array.from(new Set(e))}n.d(t,{XI:()=>o,sb:()=>a})},1765(e,t,n){"use strict";n.d(t,{My:()=>A,f4:()=>ne});var o,a,i,s,r,l,c,u=n(6540),d=n(4164),p=Object.create,m=Object.defineProperty,g=Object.defineProperties,f=Object.getOwnPropertyDescriptor,h=Object.getOwnPropertyDescriptors,v=Object.getOwnPropertyNames,y=Object.getOwnPropertySymbols,b=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,T=(e,t,n)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_=(e,t)=>{for(var n in t||(t={}))E.call(t,n)&&T(e,n,t[n]);if(y)for(var n of y(t))S.call(t,n)&&T(e,n,t[n]);return e},C=(e,t)=>g(e,h(t)),I=(e,t)=>{var n={};for(var o in e)E.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&y)for(var o of y(e))t.indexOf(o)<0&&S.call(e,o)&&(n[o]=e[o]);return n},R=(o={"../../node_modules/.pnpm/prismjs@1.29.0_patch_hash=vrxx3pzkik6jpmgpayxfjunetu/node_modules/prismjs/prism.js"(e,t){var n=function(){var e=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,t=0,n={},o={util:{encode:function e(t){return t instanceof a?new a(t.type,e(t.content),t.alias):Array.isArray(t)?t.map(e):t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).slice(8,-1)},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function e(t,n){var a,i;switch(n=n||{},o.util.type(t)){case"Object":if(i=o.util.objId(t),n[i])return n[i];for(var s in a={},n[i]=a,t)t.hasOwnProperty(s)&&(a[s]=e(t[s],n));return a;case"Array":return i=o.util.objId(t),n[i]?n[i]:(a=[],n[i]=a,t.forEach(function(t,o){a[o]=e(t,n)}),a);default:return t}},getLanguage:function(t){for(;t;){var n=e.exec(t.className);if(n)return n[1].toLowerCase();t=t.parentElement}return"none"},setLanguage:function(t,n){t.className=t.className.replace(RegExp(e,"gi"),""),t.classList.add("language-"+n)},isActive:function(e,t,n){for(var o="no-"+t;e;){var a=e.classList;if(a.contains(t))return!0;if(a.contains(o))return!1;e=e.parentElement}return!!n}},languages:{plain:n,plaintext:n,text:n,txt:n,extend:function(e,t){var n=o.util.clone(o.languages[e]);for(var a in t)n[a]=t[a];return n},insertBefore:function(e,t,n,a){var i=(a=a||o.languages)[e],s={};for(var r in i)if(i.hasOwnProperty(r)){if(r==t)for(var l in n)n.hasOwnProperty(l)&&(s[l]=n[l]);n.hasOwnProperty(r)||(s[r]=i[r])}var c=a[e];return a[e]=s,o.languages.DFS(o.languages,function(t,n){n===c&&t!=e&&(this[t]=s)}),s},DFS:function e(t,n,a,i){i=i||{};var s=o.util.objId;for(var r in t)if(t.hasOwnProperty(r)){n.call(t,r,t[r],a||r);var l=t[r],c=o.util.type(l);"Object"!==c||i[s(l)]?"Array"!==c||i[s(l)]||(i[s(l)]=!0,e(l,n,r,i)):(i[s(l)]=!0,e(l,n,null,i))}}},plugins:{},highlight:function(e,t,n){var i={code:e,grammar:t,language:n};if(o.hooks.run("before-tokenize",i),!i.grammar)throw new Error('The language "'+i.language+'" has no grammar.');return i.tokens=o.tokenize(i.code,i.grammar),o.hooks.run("after-tokenize",i),a.stringify(o.util.encode(i.tokens),i.language)},tokenize:function(e,t){var n=t.rest;if(n){for(var o in n)t[o]=n[o];delete t.rest}var a=new r;return l(a,a.head,e),s(e,a,t,a.head,0),function(e){for(var t=[],n=e.head.next;n!==e.tail;)t.push(n.value),n=n.next;return t}(a)},hooks:{all:{},add:function(e,t){var n=o.hooks.all;n[e]=n[e]||[],n[e].push(t)},run:function(e,t){var n=o.hooks.all[e];if(n&&n.length)for(var a,i=0;a=n[i++];)a(t)}},Token:a};function a(e,t,n,o){this.type=e,this.content=t,this.alias=n,this.length=0|(o||"").length}function i(e,t,n,o){e.lastIndex=t;var a=e.exec(n);if(a&&o&&a[1]){var i=a[1].length;a.index+=i,a[0]=a[0].slice(i)}return a}function s(e,t,n,r,u,d){for(var p in n)if(n.hasOwnProperty(p)&&n[p]){var m=n[p];m=Array.isArray(m)?m:[m];for(var g=0;g<m.length;++g){if(d&&d.cause==p+","+g)return;var f=m[g],h=f.inside,v=!!f.lookbehind,y=!!f.greedy,b=f.alias;if(y&&!f.pattern.global){var E=f.pattern.toString().match(/[imsuy]*$/)[0];f.pattern=RegExp(f.pattern.source,E+"g")}for(var S=f.pattern||f,T=r.next,_=u;T!==t.tail&&!(d&&_>=d.reach);_+=T.value.length,T=T.next){var C=T.value;if(t.length>e.length)return;if(!(C instanceof a)){var I,R=1;if(y){if(!(I=i(S,_,e,v))||I.index>=e.length)break;var A=I.index,N=I.index+I[0].length,x=_;for(x+=T.value.length;A>=x;)x+=(T=T.next).value.length;if(_=x-=T.value.length,T.value instanceof a)continue;for(var w=T;w!==t.tail&&(x<N||"string"==typeof w.value);w=w.next)R++,x+=w.value.length;R--,C=e.slice(_,x),I.index-=_}else if(!(I=i(S,0,C,v)))continue;A=I.index;var P=I[0],k=C.slice(0,A),O=C.slice(A+P.length),L=_+C.length;d&&L>d.reach&&(d.reach=L);var D=T.prev;if(k&&(D=l(t,D,k),_+=k.length),c(t,D,R),T=l(t,D,new a(p,h?o.tokenize(P,h):P,b,P)),O&&l(t,T,O),R>1){var M={cause:p+","+g,reach:L};s(e,t,n,T.prev,_,M),d&&M.reach>d.reach&&(d.reach=M.reach)}}}}}}function r(){var e={value:null,prev:null,next:null},t={value:null,prev:e,next:null};e.next=t,this.head=e,this.tail=t,this.length=0}function l(e,t,n){var o=t.next,a={value:n,prev:t,next:o};return t.next=a,o.prev=a,e.length++,a}function c(e,t,n){for(var o=t.next,a=0;a<n&&o!==e.tail;a++)o=o.next;t.next=o,o.prev=t,e.length-=a}return a.stringify=function e(t,n){if("string"==typeof t)return t;if(Array.isArray(t)){var a="";return t.forEach(function(t){a+=e(t,n)}),a}var i={type:t.type,content:e(t.content,n),tag:"span",classes:["token",t.type],attributes:{},language:n},s=t.alias;s&&(Array.isArray(s)?Array.prototype.push.apply(i.classes,s):i.classes.push(s)),o.hooks.run("wrap",i);var r="";for(var l in i.attributes)r+=" "+l+'="'+(i.attributes[l]||"").replace(/"/g,"&quot;")+'"';return"<"+i.tag+' class="'+i.classes.join(" ")+'"'+r+">"+i.content+"</"+i.tag+">"},o}();t.exports=n,n.default=n}},function(){return a||(0,o[v(o)[0]])((a={exports:{}}).exports,a),a.exports}),A=((e,t,n)=>(n=null!=e?p(b(e)):{},((e,t,n,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of v(t))E.call(e,a)||a===n||m(e,a,{get:()=>t[a],enumerable:!(o=f(t,a))||o.enumerable});return e})(!t&&e&&e.__esModule?n:m(n,"default",{value:e,enumerable:!0}),e)))(R());A.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},A.languages.markup.tag.inside["attr-value"].inside.entity=A.languages.markup.entity,A.languages.markup.doctype.inside["internal-subset"].inside=A.languages.markup,A.hooks.add("wrap",function(e){"entity"===e.type&&(e.attributes.title=e.content.replace(/&amp;/,"&"))}),Object.defineProperty(A.languages.markup.tag,"addInlined",{value:function(e,t){var n;(t=((n=((n={})["language-"+t]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:A.languages[t]},n.cdata=/^<!\[CDATA\[|\]\]>$/i,{"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:n}}))["language-"+t]={pattern:/[\s\S]+/,inside:A.languages[t]},{}))[e]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return e}),"i"),lookbehind:!0,greedy:!0,inside:n},A.languages.insertBefore("markup","cdata",t)}}),Object.defineProperty(A.languages.markup.tag,"addAttribute",{value:function(e,t){A.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+e+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[t,"language-"+t],inside:A.languages[t]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),A.languages.html=A.languages.markup,A.languages.mathml=A.languages.markup,A.languages.svg=A.languages.markup,A.languages.xml=A.languages.extend("markup",{}),A.languages.ssml=A.languages.xml,A.languages.atom=A.languages.xml,A.languages.rss=A.languages.xml,i=A,s={pattern:/\\[\\(){}[\]^$+*?|.]/,alias:"escape"},l="(?:[^\\\\-]|"+(r=/\\(?:x[\da-fA-F]{2}|u[\da-fA-F]{4}|u\{[\da-fA-F]+\}|0[0-7]{0,2}|[123][0-7]{2}|c[a-zA-Z]|.)/).source+")",l=RegExp(l+"-"+l),c={pattern:/(<|')[^<>']+(?=[>']$)/,lookbehind:!0,alias:"variable"},i.languages.regex={"char-class":{pattern:/((?:^|[^\\])(?:\\\\)*)\[(?:[^\\\]]|\\[\s\S])*\]/,lookbehind:!0,inside:{"char-class-negation":{pattern:/(^\[)\^/,lookbehind:!0,alias:"operator"},"char-class-punctuation":{pattern:/^\[|\]$/,alias:"punctuation"},range:{pattern:l,inside:{escape:r,"range-punctuation":{pattern:/-/,alias:"operator"}}},"special-escape":s,"char-set":{pattern:/\\[wsd]|\\p\{[^{}]+\}/i,alias:"class-name"},escape:r}},"special-escape":s,"char-set":{pattern:/\.|\\[wsd]|\\p\{[^{}]+\}/i,alias:"class-name"},backreference:[{pattern:/\\(?![123][0-7]{2})[1-9]/,alias:"keyword"},{pattern:/\\k<[^<>']+>/,alias:"keyword",inside:{"group-name":c}}],anchor:{pattern:/[$^]|\\[ABbGZz]/,alias:"function"},escape:r,group:[{pattern:/\((?:\?(?:<[^<>']+>|'[^<>']+'|[>:]|<?[=!]|[idmnsuxU]+(?:-[idmnsuxU]+)?:?))?/,alias:"punctuation",inside:{"group-name":c}},{pattern:/\)/,alias:"punctuation"}],quantifier:{pattern:/(?:[+*?]|\{\d+(?:,\d*)?\})[?+]?/,alias:"number"},alternation:{pattern:/\|/,alias:"keyword"}},A.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},A.languages.javascript=A.languages.extend("clike",{"class-name":[A.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),A.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,A.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:A.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:A.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:A.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:A.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:A.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),A.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:A.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),A.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),A.languages.markup&&(A.languages.markup.tag.addInlined("script","javascript"),A.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),A.languages.js=A.languages.javascript,A.languages.actionscript=A.languages.extend("javascript",{keyword:/\b(?:as|break|case|catch|class|const|default|delete|do|dynamic|each|else|extends|final|finally|for|function|get|if|implements|import|in|include|instanceof|interface|internal|is|namespace|native|new|null|override|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|use|var|void|while|with)\b/,operator:/\+\+|--|(?:[+\-*\/%^]|&&?|\|\|?|<<?|>>?>?|[!=]=?)=?|[~?@]/}),A.languages.actionscript["class-name"].alias="function",delete A.languages.actionscript.parameter,delete A.languages.actionscript["literal-property"],A.languages.markup&&A.languages.insertBefore("actionscript","string",{xml:{pattern:/(^|[^.])<\/?\w+(?:\s+[^\s>\/=]+=("|')(?:\\[\s\S]|(?!\2)[^\\])*\2)*\s*\/?>/,lookbehind:!0,inside:A.languages.markup}}),function(e){var t=/#(?!\{).+/,n={pattern:/#\{[^}]+\}/,alias:"variable"};e.languages.coffeescript=e.languages.extend("javascript",{comment:t,string:[{pattern:/'(?:\\[\s\S]|[^\\'])*'/,greedy:!0},{pattern:/"(?:\\[\s\S]|[^\\"])*"/,greedy:!0,inside:{interpolation:n}}],keyword:/\b(?:and|break|by|catch|class|continue|debugger|delete|do|each|else|extend|extends|false|finally|for|if|in|instanceof|is|isnt|let|loop|namespace|new|no|not|null|of|off|on|or|own|return|super|switch|then|this|throw|true|try|typeof|undefined|unless|until|when|while|window|with|yes|yield)\b/,"class-member":{pattern:/@(?!\d)\w+/,alias:"variable"}}),e.languages.insertBefore("coffeescript","comment",{"multiline-comment":{pattern:/###[\s\S]+?###/,alias:"comment"},"block-regex":{pattern:/\/{3}[\s\S]*?\/{3}/,alias:"regex",inside:{comment:t,interpolation:n}}}),e.languages.insertBefore("coffeescript","string",{"inline-javascript":{pattern:/`(?:\\[\s\S]|[^\\`])*`/,inside:{delimiter:{pattern:/^`|`$/,alias:"punctuation"},script:{pattern:/[\s\S]+/,alias:"language-javascript",inside:e.languages.javascript}}},"multiline-string":[{pattern:/'''[\s\S]*?'''/,greedy:!0,alias:"string"},{pattern:/"""[\s\S]*?"""/,greedy:!0,alias:"string",inside:{interpolation:n}}]}),e.languages.insertBefore("coffeescript","keyword",{property:/(?!\d)\w+(?=\s*:(?!:))/}),delete e.languages.coffeescript["template-string"],e.languages.coffee=e.languages.coffeescript}(A),function(e){var t=e.languages.javadoclike={parameter:{pattern:/(^[\t ]*(?:\/{3}|\*|\/\*\*)\s*@(?:arg|arguments|param)\s+)\w+/m,lookbehind:!0},keyword:{pattern:/(^[\t ]*(?:\/{3}|\*|\/\*\*)\s*|\{)@[a-z][a-zA-Z-]+\b/m,lookbehind:!0},punctuation:/[{}]/};Object.defineProperty(t,"addSupport",{value:function(t,n){(t="string"==typeof t?[t]:t).forEach(function(t){var o=function(e){e.inside||(e.inside={}),e.inside.rest=n},a="doc-comment";if(i=e.languages[t]){var i,s=i[a];if((s=s||(i=e.languages.insertBefore(t,"comment",{"doc-comment":{pattern:/(^|[^\\])\/\*\*[^/][\s\S]*?(?:\*\/|$)/,lookbehind:!0,alias:"comment"}}))[a])instanceof RegExp&&(s=i[a]={pattern:s}),Array.isArray(s))for(var r=0,l=s.length;r<l;r++)s[r]instanceof RegExp&&(s[r]={pattern:s[r]}),o(s[r]);else o(s)}})}}),t.addSupport(["java","javascript","php"],t)}(A),function(e){var t=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;(t=(e.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+t.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+t.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+t.source+"$"),alias:"url"}}},selector:{pattern:RegExp("(^|[{}\\s])[^{}\\s](?:[^{};\"'\\s]|\\s+(?![\\s{])|"+t.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:t,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},e.languages.css.atrule.inside.rest=e.languages.css,e.languages.markup))&&(t.tag.addInlined("style","css"),t.tag.addAttribute("style","css"))}(A),function(e){var t=/("|')(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,n=(t=(e.languages.css.selector={pattern:e.languages.css.selector.pattern,lookbehind:!0,inside:t={"pseudo-element":/:(?:after|before|first-letter|first-line|selection)|::[-\w]+/,"pseudo-class":/:[-\w]+/,class:/\.[-\w]+/,id:/#[-\w]+/,attribute:{pattern:RegExp("\\[(?:[^[\\]\"']|"+t.source+")*\\]"),greedy:!0,inside:{punctuation:/^\[|\]$/,"case-sensitivity":{pattern:/(\s)[si]$/i,lookbehind:!0,alias:"keyword"},namespace:{pattern:/^(\s*)(?:(?!\s)[-*\w\xA0-\uFFFF])*\|(?!=)/,lookbehind:!0,inside:{punctuation:/\|$/}},"attr-name":{pattern:/^(\s*)(?:(?!\s)[-\w\xA0-\uFFFF])+/,lookbehind:!0},"attr-value":[t,{pattern:/(=\s*)(?:(?!\s)[-\w\xA0-\uFFFF])+(?=\s*$)/,lookbehind:!0}],operator:/[|~*^$]?=/}},"n-th":[{pattern:/(\(\s*)[+-]?\d*[\dn](?:\s*[+-]\s*\d+)?(?=\s*\))/,lookbehind:!0,inside:{number:/[\dn]+/,operator:/[+-]/}},{pattern:/(\(\s*)(?:even|odd)(?=\s*\))/i,lookbehind:!0}],combinator:/>|\+|~|\|\|/,punctuation:/[(),]/}},e.languages.css.atrule.inside["selector-function-argument"].inside=t,e.languages.insertBefore("css","property",{variable:{pattern:/(^|[^-\w\xA0-\uFFFF])--(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*/i,lookbehind:!0}}),{pattern:/(\b\d+)(?:%|[a-z]+(?![\w-]))/,lookbehind:!0}),{pattern:/(^|[^\w.-])-?(?:\d+(?:\.\d+)?|\.\d+)/,lookbehind:!0});e.languages.insertBefore("css","function",{operator:{pattern:/(\s)[+\-*\/](?=\s)/,lookbehind:!0},hexcode:{pattern:/\B#[\da-f]{3,8}\b/i,alias:"color"},color:[{pattern:/(^|[^\w-])(?:AliceBlue|AntiqueWhite|Aqua|Aquamarine|Azure|Beige|Bisque|Black|BlanchedAlmond|Blue|BlueViolet|Brown|BurlyWood|CadetBlue|Chartreuse|Chocolate|Coral|CornflowerBlue|Cornsilk|Crimson|Cyan|DarkBlue|DarkCyan|DarkGoldenRod|DarkGr[ae]y|DarkGreen|DarkKhaki|DarkMagenta|DarkOliveGreen|DarkOrange|DarkOrchid|DarkRed|DarkSalmon|DarkSeaGreen|DarkSlateBlue|DarkSlateGr[ae]y|DarkTurquoise|DarkViolet|DeepPink|DeepSkyBlue|DimGr[ae]y|DodgerBlue|FireBrick|FloralWhite|ForestGreen|Fuchsia|Gainsboro|GhostWhite|Gold|GoldenRod|Gr[ae]y|Green|GreenYellow|HoneyDew|HotPink|IndianRed|Indigo|Ivory|Khaki|Lavender|LavenderBlush|LawnGreen|LemonChiffon|LightBlue|LightCoral|LightCyan|LightGoldenRodYellow|LightGr[ae]y|LightGreen|LightPink|LightSalmon|LightSeaGreen|LightSkyBlue|LightSlateGr[ae]y|LightSteelBlue|LightYellow|Lime|LimeGreen|Linen|Magenta|Maroon|MediumAquaMarine|MediumBlue|MediumOrchid|MediumPurple|MediumSeaGreen|MediumSlateBlue|MediumSpringGreen|MediumTurquoise|MediumVioletRed|MidnightBlue|MintCream|MistyRose|Moccasin|NavajoWhite|Navy|OldLace|Olive|OliveDrab|Orange|OrangeRed|Orchid|PaleGoldenRod|PaleGreen|PaleTurquoise|PaleVioletRed|PapayaWhip|PeachPuff|Peru|Pink|Plum|PowderBlue|Purple|RebeccaPurple|Red|RosyBrown|RoyalBlue|SaddleBrown|Salmon|SandyBrown|SeaGreen|SeaShell|Sienna|Silver|SkyBlue|SlateBlue|SlateGr[ae]y|Snow|SpringGreen|SteelBlue|Tan|Teal|Thistle|Tomato|Transparent|Turquoise|Violet|Wheat|White|WhiteSmoke|Yellow|YellowGreen)(?![\w-])/i,lookbehind:!0},{pattern:/\b(?:hsl|rgb)\(\s*\d{1,3}\s*,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*\)\B|\b(?:hsl|rgb)a\(\s*\d{1,3}\s*,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*,\s*(?:0|0?\.\d+|1)\s*\)\B/i,inside:{unit:t,number:n,function:/[\w-]+(?=\()/,punctuation:/[(),]/}}],entity:/\\[\da-f]{1,8}/i,unit:t,number:n})}(A),function(e){var t=/[*&][^\s[\]{},]+/,n=/!(?:<[\w\-%#;/?:@&=+$,.!~*'()[\]]+>|(?:[a-zA-Z\d-]*!)?[\w\-%#;/?:@&=+$.~*'()]+)?/,o="(?:"+n.source+"(?:[ \t]+"+t.source+")?|"+t.source+"(?:[ \t]+"+n.source+")?)",a=/(?:[^\s\x00-\x08\x0e-\x1f!"#%&'*,\-:>?@[\]`{|}\x7f-\x84\x86-\x9f\ud800-\udfff\ufffe\uffff]|[?:-]<PLAIN>)(?:[ \t]*(?:(?![#:])<PLAIN>|:<PLAIN>))*/.source.replace(/<PLAIN>/g,function(){return/[^\s\x00-\x08\x0e-\x1f,[\]{}\x7f-\x84\x86-\x9f\ud800-\udfff\ufffe\uffff]/.source}),i=/"(?:[^"\\\r\n]|\\.)*"|'(?:[^'\\\r\n]|\\.)*'/.source;function s(e,t){t=(t||"").replace(/m/g,"")+"m";var n=/([:\-,[{]\s*(?:\s<<prop>>[ \t]+)?)(?:<<value>>)(?=[ \t]*(?:$|,|\]|\}|(?:[\r\n]\s*)?#))/.source.replace(/<<prop>>/g,function(){return o}).replace(/<<value>>/g,function(){return e});return RegExp(n,t)}e.languages.yaml={scalar:{pattern:RegExp(/([\-:]\s*(?:\s<<prop>>[ \t]+)?[|>])[ \t]*(?:((?:\r?\n|\r)[ \t]+)\S[^\r\n]*(?:\2[^\r\n]+)*)/.source.replace(/<<prop>>/g,function(){return o})),lookbehind:!0,alias:"string"},comment:/#.*/,key:{pattern:RegExp(/((?:^|[:\-,[{\r\n?])[ \t]*(?:<<prop>>[ \t]+)?)<<key>>(?=\s*:\s)/.source.replace(/<<prop>>/g,function(){return o}).replace(/<<key>>/g,function(){return"(?:"+a+"|"+i+")"})),lookbehind:!0,greedy:!0,alias:"atrule"},directive:{pattern:/(^[ \t]*)%.+/m,lookbehind:!0,alias:"important"},datetime:{pattern:s(/\d{4}-\d\d?-\d\d?(?:[tT]|[ \t]+)\d\d?:\d{2}:\d{2}(?:\.\d*)?(?:[ \t]*(?:Z|[-+]\d\d?(?::\d{2})?))?|\d{4}-\d{2}-\d{2}|\d\d?:\d{2}(?::\d{2}(?:\.\d*)?)?/.source),lookbehind:!0,alias:"number"},boolean:{pattern:s(/false|true/.source,"i"),lookbehind:!0,alias:"important"},null:{pattern:s(/null|~/.source,"i"),lookbehind:!0,alias:"important"},string:{pattern:s(i),lookbehind:!0,greedy:!0},number:{pattern:s(/[+-]?(?:0x[\da-f]+|0o[0-7]+|(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?|\.inf|\.nan)/.source,"i"),lookbehind:!0},tag:n,important:t,punctuation:/---|[:[\]{}\-,|>?]|\.\.\./},e.languages.yml=e.languages.yaml}(A),function(e){var t=/(?:\\.|[^\\\n\r]|(?:\n|\r\n?)(?![\r\n]))/.source;function n(e){return e=e.replace(/<inner>/g,function(){return t}),RegExp(/((?:^|[^\\])(?:\\{2})*)/.source+"(?:"+e+")")}var o=/(?:\\.|``(?:[^`\r\n]|`(?!`))+``|`[^`\r\n]+`|[^\\|\r\n`])+/.source,a=/\|?__(?:\|__)+\|?(?:(?:\n|\r\n?)|(?![\s\S]))/.source.replace(/__/g,function(){return o}),i=/\|?[ \t]*:?-{3,}:?[ \t]*(?:\|[ \t]*:?-{3,}:?[ \t]*)+\|?(?:\n|\r\n?)/.source,s=(e.languages.markdown=e.languages.extend("markup",{}),e.languages.insertBefore("markdown","prolog",{"front-matter-block":{pattern:/(^(?:\s*[\r\n])?)---(?!.)[\s\S]*?[\r\n]---(?!.)/,lookbehind:!0,greedy:!0,inside:{punctuation:/^---|---$/,"front-matter":{pattern:/\S+(?:\s+\S+)*/,alias:["yaml","language-yaml"],inside:e.languages.yaml}}},blockquote:{pattern:/^>(?:[\t ]*>)*/m,alias:"punctuation"},table:{pattern:RegExp("^"+a+i+"(?:"+a+")*","m"),inside:{"table-data-rows":{pattern:RegExp("^("+a+i+")(?:"+a+")*$"),lookbehind:!0,inside:{"table-data":{pattern:RegExp(o),inside:e.languages.markdown},punctuation:/\|/}},"table-line":{pattern:RegExp("^("+a+")"+i+"$"),lookbehind:!0,inside:{punctuation:/\||:?-{3,}:?/}},"table-header-row":{pattern:RegExp("^"+a+"$"),inside:{"table-header":{pattern:RegExp(o),alias:"important",inside:e.languages.markdown},punctuation:/\|/}}}},code:[{pattern:/((?:^|\n)[ \t]*\n|(?:^|\r\n?)[ \t]*\r\n?)(?: {4}|\t).+(?:(?:\n|\r\n?)(?: {4}|\t).+)*/,lookbehind:!0,alias:"keyword"},{pattern:/^```[\s\S]*?^```$/m,greedy:!0,inside:{"code-block":{pattern:/^(```.*(?:\n|\r\n?))[\s\S]+?(?=(?:\n|\r\n?)^```$)/m,lookbehind:!0},"code-language":{pattern:/^(```).+/,lookbehind:!0},punctuation:/```/}}],title:[{pattern:/\S.*(?:\n|\r\n?)(?:==+|--+)(?=[ \t]*$)/m,alias:"important",inside:{punctuation:/==+$|--+$/}},{pattern:/(^\s*)#.+/m,lookbehind:!0,alias:"important",inside:{punctuation:/^#+|#+$/}}],hr:{pattern:/(^\s*)([*-])(?:[\t ]*\2){2,}(?=\s*$)/m,lookbehind:!0,alias:"punctuation"},list:{pattern:/(^\s*)(?:[*+-]|\d+\.)(?=[\t ].)/m,lookbehind:!0,alias:"punctuation"},"url-reference":{pattern:/!?\[[^\]]+\]:[\t ]+(?:\S+|<(?:\\.|[^>\\])+>)(?:[\t ]+(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\)))?/,inside:{variable:{pattern:/^(!?\[)[^\]]+/,lookbehind:!0},string:/(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\))$/,punctuation:/^[\[\]!:]|[<>]/},alias:"url"},bold:{pattern:n(/\b__(?:(?!_)<inner>|_(?:(?!_)<inner>)+_)+__\b|\*\*(?:(?!\*)<inner>|\*(?:(?!\*)<inner>)+\*)+\*\*/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^..)[\s\S]+(?=..$)/,lookbehind:!0,inside:{}},punctuation:/\*\*|__/}},italic:{pattern:n(/\b_(?:(?!_)<inner>|__(?:(?!_)<inner>)+__)+_\b|\*(?:(?!\*)<inner>|\*\*(?:(?!\*)<inner>)+\*\*)+\*/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^.)[\s\S]+(?=.$)/,lookbehind:!0,inside:{}},punctuation:/[*_]/}},strike:{pattern:n(/(~~?)(?:(?!~)<inner>)+\2/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^~~?)[\s\S]+(?=\1$)/,lookbehind:!0,inside:{}},punctuation:/~~?/}},"code-snippet":{pattern:/(^|[^\\`])(?:``[^`\r\n]+(?:`[^`\r\n]+)*``(?!`)|`[^`\r\n]+`(?!`))/,lookbehind:!0,greedy:!0,alias:["code","keyword"]},url:{pattern:n(/!?\[(?:(?!\])<inner>)+\](?:\([^\s)]+(?:[\t ]+"(?:\\.|[^"\\])*")?\)|[ \t]?\[(?:(?!\])<inner>)+\])/.source),lookbehind:!0,greedy:!0,inside:{operator:/^!/,content:{pattern:/(^\[)[^\]]+(?=\])/,lookbehind:!0,inside:{}},variable:{pattern:/(^\][ \t]?\[)[^\]]+(?=\]$)/,lookbehind:!0},url:{pattern:/(^\]\()[^\s)]+/,lookbehind:!0},string:{pattern:/(^[ \t]+)"(?:\\.|[^"\\])*"(?=\)$)/,lookbehind:!0}}}}),["url","bold","italic","strike"].forEach(function(t){["url","bold","italic","strike","code-snippet"].forEach(function(n){t!==n&&(e.languages.markdown[t].inside.content.inside[n]=e.languages.markdown[n])})}),e.hooks.add("after-tokenize",function(e){"markdown"!==e.language&&"md"!==e.language||function e(t){if(t&&"string"!=typeof t)for(var n=0,o=t.length;n<o;n++){var a,i=t[n];"code"!==i.type?e(i.content):(a=i.content[1],i=i.content[3],a&&i&&"code-language"===a.type&&"code-block"===i.type&&"string"==typeof a.content&&(a=a.content.replace(/\b#/g,"sharp").replace(/\b\+\+/g,"pp"),a="language-"+(a=(/[a-z][\w-]*/i.exec(a)||[""])[0].toLowerCase()),i.alias?"string"==typeof i.alias?i.alias=[i.alias,a]:i.alias.push(a):i.alias=[a]))}}(e.tokens)}),e.hooks.add("wrap",function(t){if("code-block"===t.type){for(var n="",o=0,a=t.classes.length;o<a;o++){var i=t.classes[o];if(i=/language-(.+)/.exec(i)){n=i[1];break}}var c,u=e.languages[n];u?t.content=e.highlight(t.content.replace(s,"").replace(/&(\w{1,8}|#x?[\da-f]{1,8});/gi,function(e,t){var n;return"#"===(t=t.toLowerCase())[0]?(n="x"===t[1]?parseInt(t.slice(2),16):Number(t.slice(1)),l(n)):r[t]||e}),u,n):n&&"none"!==n&&e.plugins.autoloader&&(c="md-"+(new Date).valueOf()+"-"+Math.floor(1e16*Math.random()),t.attributes.id=c,e.plugins.autoloader.loadLanguages(n,function(){var t=document.getElementById(c);t&&(t.innerHTML=e.highlight(t.textContent,e.languages[n],n))}))}}),RegExp(e.languages.markup.tag.pattern.source,"gi")),r={amp:"&",lt:"<",gt:">",quot:'"'},l=String.fromCodePoint||String.fromCharCode;e.languages.md=e.languages.markdown}(A),A.languages.graphql={comment:/#.*/,description:{pattern:/(?:"""(?:[^"]|(?!""")")*"""|"(?:\\.|[^\\"\r\n])*")(?=\s*[a-z_])/i,greedy:!0,alias:"string",inside:{"language-markdown":{pattern:/(^"(?:"")?)(?!\1)[\s\S]+(?=\1$)/,lookbehind:!0,inside:A.languages.markdown}}},string:{pattern:/"""(?:[^"]|(?!""")")*"""|"(?:\\.|[^\\"\r\n])*"/,greedy:!0},number:/(?:\B-|\b)\d+(?:\.\d+)?(?:e[+-]?\d+)?\b/i,boolean:/\b(?:false|true)\b/,variable:/\$[a-z_]\w*/i,directive:{pattern:/@[a-z_]\w*/i,alias:"function"},"attr-name":{pattern:/\b[a-z_]\w*(?=\s*(?:\((?:[^()"]|"(?:\\.|[^\\"\r\n])*")*\))?:)/i,greedy:!0},"atom-input":{pattern:/\b[A-Z]\w*Input\b/,alias:"class-name"},scalar:/\b(?:Boolean|Float|ID|Int|String)\b/,constant:/\b[A-Z][A-Z_\d]*\b/,"class-name":{pattern:/(\b(?:enum|implements|interface|on|scalar|type|union)\s+|&\s*|:\s*|\[)[A-Z_]\w*/,lookbehind:!0},fragment:{pattern:/(\bfragment\s+|\.{3}\s*(?!on\b))[a-zA-Z_]\w*/,lookbehind:!0,alias:"function"},"definition-mutation":{pattern:/(\bmutation\s+)[a-zA-Z_]\w*/,lookbehind:!0,alias:"function"},"definition-query":{pattern:/(\bquery\s+)[a-zA-Z_]\w*/,lookbehind:!0,alias:"function"},keyword:/\b(?:directive|enum|extend|fragment|implements|input|interface|mutation|on|query|repeatable|scalar|schema|subscription|type|union)\b/,operator:/[!=|&]|\.{3}/,"property-query":/\w+(?=\s*\()/,object:/\w+(?=\s*\{)/,punctuation:/[!(){}\[\]:=,]/,property:/\w+/},A.hooks.add("after-tokenize",function(e){if("graphql"===e.language)for(var t=e.tokens.filter(function(e){return"string"!=typeof e&&"comment"!==e.type&&"scalar"!==e.type}),n=0;n<t.length;){var o=t[n++];if("keyword"===o.type&&"mutation"===o.content){var a=[];if(d(["definition-mutation","punctuation"])&&"("===u(1).content){n+=2;var i=p(/^\($/,/^\)$/);if(-1===i)continue;for(;n<i;n++){var s=u(0);"variable"===s.type&&(m(s,"variable-input"),a.push(s.content))}n=i+1}if(d(["punctuation","property-query"])&&"{"===u(0).content&&(n++,m(u(0),"property-mutation"),0<a.length)){var r=p(/^\{$/,/^\}$/);if(-1!==r)for(var l=n;l<r;l++){var c=t[l];"variable"===c.type&&0<=a.indexOf(c.content)&&m(c,"variable-input")}}}}function u(e){return t[n+e]}function d(e,t){t=t||0;for(var n=0;n<e.length;n++){var o=u(n+t);if(!o||o.type!==e[n])return}return 1}function p(e,o){for(var a=1,i=n;i<t.length;i++){var s=t[i],r=s.content;if("punctuation"===s.type&&"string"==typeof r)if(e.test(r))a++;else if(o.test(r)&&0===--a)return i}return-1}function m(e,t){var n=e.alias;n?Array.isArray(n)||(e.alias=n=[n]):e.alias=n=[],n.push(t)}}),A.languages.sql={comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|(?:--|\/\/|#).*)/,lookbehind:!0},variable:[{pattern:/@(["'`])(?:\\[\s\S]|(?!\1)[^\\])+\1/,greedy:!0},/@[\w.$]+/],string:{pattern:/(^|[^@\\])("|')(?:\\[\s\S]|(?!\2)[^\\]|\2\2)*\2/,greedy:!0,lookbehind:!0},identifier:{pattern:/(^|[^@\\])`(?:\\[\s\S]|[^`\\]|``)*`/,greedy:!0,lookbehind:!0,inside:{punctuation:/^`|`$/}},function:/\b(?:AVG|COUNT|FIRST|FORMAT|LAST|LCASE|LEN|MAX|MID|MIN|MOD|NOW|ROUND|SUM|UCASE)(?=\s*\()/i,keyword:/\b(?:ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR(?:ACTER|SET)?|CHECK(?:POINT)?|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMNS?|COMMENT|COMMIT(?:TED)?|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS(?:TABLE)?|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|CYCLE|DATA(?:BASES?)?|DATE(?:TIME)?|DAY|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITERS?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE|ELSE(?:IF)?|ENABLE|ENCLOSED|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPED?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|HOUR|IDENTITY(?:COL|_INSERT)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTERVAL|INTO|INVOKER|ISOLATION|ITERATE|JOIN|KEYS?|KILL|LANGUAGE|LAST|LEAVE|LEFT|LEVEL|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|LOOP|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MINUTE|MODE|MODIFIES|MODIFY|MONTH|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL|NATURAL|NCHAR|NEXT|NO|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREPARE|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READS?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEAT(?:ABLE)?|REPLACE|REPLICATION|REQUIRE|RESIGNAL|RESTORE|RESTRICT|RETURN(?:ING|S)?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SECOND|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|SQL|START(?:ING)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED|TEXT(?:SIZE)?|THEN|TIME(?:STAMP)?|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNLOCK|UNPIVOT|UNSIGNED|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?|YEAR)\b/i,boolean:/\b(?:FALSE|NULL|TRUE)\b/i,number:/\b0x[\da-f]+\b|\b\d+(?:\.\d*)?|\B\.\d+\b/i,operator:/[-+*\/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|DIV|ILIKE|IN|IS|LIKE|NOT|OR|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/i,punctuation:/[;[\]()`,.]/},function(e){var t=e.languages.javascript["template-string"],n=t.pattern.source,o=t.inside.interpolation,a=o.inside["interpolation-punctuation"],i=o.pattern.source;function s(t,o){if(e.languages[t])return{pattern:RegExp("((?:"+o+")\\s*)"+n),lookbehind:!0,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},"embedded-code":{pattern:/[\s\S]+/,alias:t}}}}function r(t,n,o){return t={code:t,grammar:n,language:o},e.hooks.run("before-tokenize",t),t.tokens=e.tokenize(t.code,t.grammar),e.hooks.run("after-tokenize",t),t.tokens}function l(t,n,s){var l=e.tokenize(t,{interpolation:{pattern:RegExp(i),lookbehind:!0}}),c=0,u={},d=(l=r(l.map(function(e){if("string"==typeof e)return e;var n,o;for(e=e.content;-1!==t.indexOf((o=c++,n="___"+s.toUpperCase()+"_"+o+"___")););return u[n]=e,n}).join(""),n,s),Object.keys(u));return c=0,function t(n){for(var i=0;i<n.length;i++){if(c>=d.length)return;var s,l,p,m,g,f,h,v=n[i];"string"==typeof v||"string"==typeof v.content?(s=d[c],-1!==(h=(f="string"==typeof v?v:v.content).indexOf(s))&&(++c,l=f.substring(0,h),g=u[s],p=void 0,(m={})["interpolation-punctuation"]=a,3===(m=e.tokenize(g,m)).length&&((p=[1,1]).push.apply(p,r(m[1],e.languages.javascript,"javascript")),m.splice.apply(m,p)),p=new e.Token("interpolation",m,o.alias,g),m=f.substring(h+s.length),g=[],l&&g.push(l),g.push(p),m&&(t(f=[m]),g.push.apply(g,f)),"string"==typeof v?(n.splice.apply(n,[i,1].concat(g)),i+=g.length-1):v.content=g)):(h=v.content,Array.isArray(h)?t(h):t([h]))}}(l),new e.Token(s,l,"language-"+s,t)}e.languages.javascript["template-string"]=[s("css",/\b(?:styled(?:\([^)]*\))?(?:\s*\.\s*\w+(?:\([^)]*\))*)*|css(?:\s*\.\s*(?:global|resolve))?|createGlobalStyle|keyframes)/.source),s("html",/\bhtml|\.\s*(?:inner|outer)HTML\s*\+?=/.source),s("svg",/\bsvg/.source),s("markdown",/\b(?:markdown|md)/.source),s("graphql",/\b(?:gql|graphql(?:\s*\.\s*experimental)?)/.source),s("sql",/\bsql/.source),t].filter(Boolean);var c={javascript:!0,js:!0,typescript:!0,ts:!0,jsx:!0,tsx:!0};function u(e){return"string"==typeof e?e:Array.isArray(e)?e.map(u).join(""):u(e.content)}e.hooks.add("after-tokenize",function(t){t.language in c&&function t(n){for(var o=0,a=n.length;o<a;o++){var i,s,r,c=n[o];"string"!=typeof c&&(i=c.content,Array.isArray(i)?"template-string"===c.type?(c=i[1],3===i.length&&"string"!=typeof c&&"embedded-code"===c.type&&(s=u(c),c=c.alias,c=Array.isArray(c)?c[0]:c,r=e.languages[c])&&(i[1]=l(s,r,c))):t(i):"string"!=typeof i&&t([i]))}}(t.tokens)})}(A),function(e){e.languages.typescript=e.languages.extend("javascript",{"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|type)\s+)(?!keyof\b)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?:\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>)?/,lookbehind:!0,greedy:!0,inside:null},builtin:/\b(?:Array|Function|Promise|any|boolean|console|never|number|string|symbol|unknown)\b/}),e.languages.typescript.keyword.push(/\b(?:abstract|declare|is|keyof|readonly|require)\b/,/\b(?:asserts|infer|interface|module|namespace|type)\b(?=\s*(?:[{_$a-zA-Z\xA0-\uFFFF]|$))/,/\btype\b(?=\s*(?:[\{*]|$))/),delete e.languages.typescript.parameter,delete e.languages.typescript["literal-property"];var t=e.languages.extend("typescript",{});delete t["class-name"],e.languages.typescript["class-name"].inside=t,e.languages.insertBefore("typescript","function",{decorator:{pattern:/@[$\w\xA0-\uFFFF]+/,inside:{at:{pattern:/^@/,alias:"operator"},function:/^[\s\S]+/}},"generic-function":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>(?=\s*\()/,greedy:!0,inside:{function:/^#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*/,generic:{pattern:/<[\s\S]+/,alias:"class-name",inside:t}}}}),e.languages.ts=e.languages.typescript}(A),function(e){var t=e.languages.javascript,n=/\{(?:[^{}]|\{(?:[^{}]|\{[^{}]*\})*\})+\}/.source,o="(@(?:arg|argument|param|property)\\s+(?:"+n+"\\s+)?)";e.languages.jsdoc=e.languages.extend("javadoclike",{parameter:{pattern:RegExp(o+/(?:(?!\s)[$\w\xA0-\uFFFF.])+(?=\s|$)/.source),lookbehind:!0,inside:{punctuation:/\./}}}),e.languages.insertBefore("jsdoc","keyword",{"optional-parameter":{pattern:RegExp(o+/\[(?:(?!\s)[$\w\xA0-\uFFFF.])+(?:=[^[\]]+)?\](?=\s|$)/.source),lookbehind:!0,inside:{parameter:{pattern:/(^\[)[$\w\xA0-\uFFFF\.]+/,lookbehind:!0,inside:{punctuation:/\./}},code:{pattern:/(=)[\s\S]*(?=\]$)/,lookbehind:!0,inside:t,alias:"language-javascript"},punctuation:/[=[\]]/}},"class-name":[{pattern:RegExp(/(@(?:augments|class|extends|interface|memberof!?|template|this|typedef)\s+(?:<TYPE>\s+)?)[A-Z]\w*(?:\.[A-Z]\w*)*/.source.replace(/<TYPE>/g,function(){return n})),lookbehind:!0,inside:{punctuation:/\./}},{pattern:RegExp("(@[a-z]+\\s+)"+n),lookbehind:!0,inside:{string:t.string,number:t.number,boolean:t.boolean,keyword:e.languages.typescript.keyword,operator:/=>|\.\.\.|[&|?:*]/,punctuation:/[.,;=<>{}()[\]]/}}],example:{pattern:/(@example\s+(?!\s))(?:[^@\s]|\s+(?!\s))+?(?=\s*(?:\*\s*)?(?:@\w|\*\/))/,lookbehind:!0,inside:{code:{pattern:/^([\t ]*(?:\*\s*)?)\S.*$/m,lookbehind:!0,inside:t,alias:"language-javascript"}}}}),e.languages.javadoclike.addSupport("javascript",e.languages.jsdoc)}(A),function(e){e.languages.flow=e.languages.extend("javascript",{}),e.languages.insertBefore("flow","keyword",{type:[{pattern:/\b(?:[Bb]oolean|Function|[Nn]umber|[Ss]tring|[Ss]ymbol|any|mixed|null|void)\b/,alias:"class-name"}]}),e.languages.flow["function-variable"].pattern=/(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=\s*(?:function\b|(?:\([^()]*\)(?:\s*:\s*\w+)?|(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/i,delete e.languages.flow.parameter,e.languages.insertBefore("flow","operator",{"flow-punctuation":{pattern:/\{\||\|\}/,alias:"punctuation"}}),Array.isArray(e.languages.flow.keyword)||(e.languages.flow.keyword=[e.languages.flow.keyword]),e.languages.flow.keyword.unshift({pattern:/(^|[^$]\b)(?:Class|declare|opaque|type)\b(?!\$)/,lookbehind:!0},{pattern:/(^|[^$]\B)\$(?:Diff|Enum|Exact|Keys|ObjMap|PropertyType|Record|Shape|Subtype|Supertype|await)\b(?!\$)/,lookbehind:!0})}(A),A.languages.n4js=A.languages.extend("javascript",{keyword:/\b(?:Array|any|boolean|break|case|catch|class|const|constructor|continue|debugger|declare|default|delete|do|else|enum|export|extends|false|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|module|new|null|number|package|private|protected|public|return|set|static|string|super|switch|this|throw|true|try|typeof|var|void|while|with|yield)\b/}),A.languages.insertBefore("n4js","constant",{annotation:{pattern:/@+\w+/,alias:"operator"}}),A.languages.n4jsd=A.languages.n4js,function(e){function t(e,t){return RegExp(e.replace(/<ID>/g,function(){return/(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*/.source}),t)}e.languages.insertBefore("javascript","function-variable",{"method-variable":{pattern:RegExp("(\\.\\s*)"+e.languages.javascript["function-variable"].pattern.source),lookbehind:!0,alias:["function-variable","method","function","property-access"]}}),e.languages.insertBefore("javascript","function",{method:{pattern:RegExp("(\\.\\s*)"+e.languages.javascript.function.source),lookbehind:!0,alias:["function","property-access"]}}),e.languages.insertBefore("javascript","constant",{"known-class-name":[{pattern:/\b(?:(?:Float(?:32|64)|(?:Int|Uint)(?:8|16|32)|Uint8Clamped)?Array|ArrayBuffer|BigInt|Boolean|DataView|Date|Error|Function|Intl|JSON|(?:Weak)?(?:Map|Set)|Math|Number|Object|Promise|Proxy|Reflect|RegExp|String|Symbol|WebAssembly)\b/,alias:"class-name"},{pattern:/\b(?:[A-Z]\w*)Error\b/,alias:"class-name"}]}),e.languages.insertBefore("javascript","keyword",{imports:{pattern:t(/(\bimport\b\s*)(?:<ID>(?:\s*,\s*(?:\*\s*as\s+<ID>|\{[^{}]*\}))?|\*\s*as\s+<ID>|\{[^{}]*\})(?=\s*\bfrom\b)/.source),lookbehind:!0,inside:e.languages.javascript},exports:{pattern:t(/(\bexport\b\s*)(?:\*(?:\s*as\s+<ID>)?(?=\s*\bfrom\b)|\{[^{}]*\})/.source),lookbehind:!0,inside:e.languages.javascript}}),e.languages.javascript.keyword.unshift({pattern:/\b(?:as|default|export|from|import)\b/,alias:"module"},{pattern:/\b(?:await|break|catch|continue|do|else|finally|for|if|return|switch|throw|try|while|yield)\b/,alias:"control-flow"},{pattern:/\bnull\b/,alias:["null","nil"]},{pattern:/\bundefined\b/,alias:"nil"}),e.languages.insertBefore("javascript","operator",{spread:{pattern:/\.{3}/,alias:"operator"},arrow:{pattern:/=>/,alias:"operator"}}),e.languages.insertBefore("javascript","punctuation",{"property-access":{pattern:t(/(\.\s*)#?<ID>/.source),lookbehind:!0},"maybe-class-name":{pattern:/(^|[^$\w\xA0-\uFFFF])[A-Z][$\w\xA0-\uFFFF]+/,lookbehind:!0},dom:{pattern:/\b(?:document|(?:local|session)Storage|location|navigator|performance|window)\b/,alias:"variable"},console:{pattern:/\bconsole(?=\s*\.)/,alias:"class-name"}});for(var n=["function","function-variable","method","method-variable","property-access"],o=0;o<n.length;o++){var a=n[o],i=e.languages.javascript[a];a=(i="RegExp"===e.util.type(i)?e.languages.javascript[a]={pattern:i}:i).inside||{};(i.inside=a)["maybe-class-name"]=/^[A-Z][\s\S]*/}}(A),function(e){var t=e.util.clone(e.languages.javascript),n=/(?:\s|\/\/.*(?!.)|\/\*(?:[^*]|\*(?!\/))\*\/)/.source,o=/(?:\{(?:\{(?:\{[^{}]*\}|[^{}])*\}|[^{}])*\})/.source,a=/(?:\{<S>*\.{3}(?:[^{}]|<BRACES>)*\})/.source;function i(e,t){return e=e.replace(/<S>/g,function(){return n}).replace(/<BRACES>/g,function(){return o}).replace(/<SPREAD>/g,function(){return a}),RegExp(e,t)}function s(t){for(var n=[],o=0;o<t.length;o++){var a=t[o],i=!1;"string"!=typeof a&&("tag"===a.type&&a.content[0]&&"tag"===a.content[0].type?"</"===a.content[0].content[0].content?0<n.length&&n[n.length-1].tagName===r(a.content[0].content[1])&&n.pop():"/>"!==a.content[a.content.length-1].content&&n.push({tagName:r(a.content[0].content[1]),openedBraces:0}):0<n.length&&"punctuation"===a.type&&"{"===a.content?n[n.length-1].openedBraces++:0<n.length&&0<n[n.length-1].openedBraces&&"punctuation"===a.type&&"}"===a.content?n[n.length-1].openedBraces--:i=!0),(i||"string"==typeof a)&&0<n.length&&0===n[n.length-1].openedBraces&&(i=r(a),o<t.length-1&&("string"==typeof t[o+1]||"plain-text"===t[o+1].type)&&(i+=r(t[o+1]),t.splice(o+1,1)),0<o&&("string"==typeof t[o-1]||"plain-text"===t[o-1].type)&&(i=r(t[o-1])+i,t.splice(o-1,1),o--),t[o]=new e.Token("plain-text",i,null,i)),a.content&&"string"!=typeof a.content&&s(a.content)}}a=i(a).source,e.languages.jsx=e.languages.extend("markup",t),e.languages.jsx.tag.pattern=i(/<\/?(?:[\w.:-]+(?:<S>+(?:[\w.:$-]+(?:=(?:"(?:\\[\s\S]|[^\\"])*"|'(?:\\[\s\S]|[^\\'])*'|[^\s{'"/>=]+|<BRACES>))?|<SPREAD>))*<S>*\/?)?>/.source),e.languages.jsx.tag.inside.tag.pattern=/^<\/?[^\s>\/]*/,e.languages.jsx.tag.inside["attr-value"].pattern=/=(?!\{)(?:"(?:\\[\s\S]|[^\\"])*"|'(?:\\[\s\S]|[^\\'])*'|[^\s'">]+)/,e.languages.jsx.tag.inside.tag.inside["class-name"]=/^[A-Z]\w*(?:\.[A-Z]\w*)*$/,e.languages.jsx.tag.inside.comment=t.comment,e.languages.insertBefore("inside","attr-name",{spread:{pattern:i(/<SPREAD>/.source),inside:e.languages.jsx}},e.languages.jsx.tag),e.languages.insertBefore("inside","special-attr",{script:{pattern:i(/=<BRACES>/.source),alias:"language-javascript",inside:{"script-punctuation":{pattern:/^=(?=\{)/,alias:"punctuation"},rest:e.languages.jsx}}},e.languages.jsx.tag);var r=function(e){return e?"string"==typeof e?e:"string"==typeof e.content?e.content:e.content.map(r).join(""):""};e.hooks.add("after-tokenize",function(e){"jsx"!==e.language&&"tsx"!==e.language||s(e.tokens)})}(A),function(e){var t=e.util.clone(e.languages.typescript);(t=(e.languages.tsx=e.languages.extend("jsx",t),delete e.languages.tsx.parameter,delete e.languages.tsx["literal-property"],e.languages.tsx.tag)).pattern=RegExp(/(^|[^\w$]|(?=<\/))/.source+"(?:"+t.pattern.source+")",t.pattern.flags),t.lookbehind=!0}(A),A.languages.swift={comment:{pattern:/(^|[^\\:])(?:\/\/.*|\/\*(?:[^/*]|\/(?!\*)|\*(?!\/)|\/\*(?:[^*]|\*(?!\/))*\*\/)*\*\/)/,lookbehind:!0,greedy:!0},"string-literal":[{pattern:RegExp(/(^|[^"#])/.source+"(?:"+/"(?:\\(?:\((?:[^()]|\([^()]*\))*\)|\r\n|[^(])|[^\\\r\n"])*"/.source+"|"+/"""(?:\\(?:\((?:[^()]|\([^()]*\))*\)|[^(])|[^\\"]|"(?!""))*"""/.source+")"+/(?!["#])/.source),lookbehind:!0,greedy:!0,inside:{interpolation:{pattern:/(\\\()(?:[^()]|\([^()]*\))*(?=\))/,lookbehind:!0,inside:null},"interpolation-punctuation":{pattern:/^\)|\\\($/,alias:"punctuation"},punctuation:/\\(?=[\r\n])/,string:/[\s\S]+/}},{pattern:RegExp(/(^|[^"#])(#+)/.source+"(?:"+/"(?:\\(?:#+\((?:[^()]|\([^()]*\))*\)|\r\n|[^#])|[^\\\r\n])*?"/.source+"|"+/"""(?:\\(?:#+\((?:[^()]|\([^()]*\))*\)|[^#])|[^\\])*?"""/.source+")\\2"),lookbehind:!0,greedy:!0,inside:{interpolation:{pattern:/(\\#+\()(?:[^()]|\([^()]*\))*(?=\))/,lookbehind:!0,inside:null},"interpolation-punctuation":{pattern:/^\)|\\#+\($/,alias:"punctuation"},string:/[\s\S]+/}}],directive:{pattern:RegExp(/#/.source+"(?:"+/(?:elseif|if)\b/.source+"(?:[ \t]*"+/(?:![ \t]*)?(?:\b\w+\b(?:[ \t]*\((?:[^()]|\([^()]*\))*\))?|\((?:[^()]|\([^()]*\))*\))(?:[ \t]*(?:&&|\|\|))?/.source+")+|"+/(?:else|endif)\b/.source+")"),alias:"property",inside:{"directive-name":/^#\w+/,boolean:/\b(?:false|true)\b/,number:/\b\d+(?:\.\d+)*\b/,operator:/!|&&|\|\||[<>]=?/,punctuation:/[(),]/}},literal:{pattern:/#(?:colorLiteral|column|dsohandle|file(?:ID|Literal|Path)?|function|imageLiteral|line)\b/,alias:"constant"},"other-directive":{pattern:/#\w+\b/,alias:"property"},attribute:{pattern:/@\w+/,alias:"atrule"},"function-definition":{pattern:/(\bfunc\s+)\w+/,lookbehind:!0,alias:"function"},label:{pattern:/\b(break|continue)\s+\w+|\b[a-zA-Z_]\w*(?=\s*:\s*(?:for|repeat|while)\b)/,lookbehind:!0,alias:"important"},keyword:/\b(?:Any|Protocol|Self|Type|actor|as|assignment|associatedtype|associativity|async|await|break|case|catch|class|continue|convenience|default|defer|deinit|didSet|do|dynamic|else|enum|extension|fallthrough|fileprivate|final|for|func|get|guard|higherThan|if|import|in|indirect|infix|init|inout|internal|is|isolated|lazy|left|let|lowerThan|mutating|none|nonisolated|nonmutating|open|operator|optional|override|postfix|precedencegroup|prefix|private|protocol|public|repeat|required|rethrows|return|right|safe|self|set|some|static|struct|subscript|super|switch|throw|throws|try|typealias|unowned|unsafe|var|weak|where|while|willSet)\b/,boolean:/\b(?:false|true)\b/,nil:{pattern:/\bnil\b/,alias:"constant"},"short-argument":/\$\d+\b/,omit:{pattern:/\b_\b/,alias:"keyword"},number:/\b(?:[\d_]+(?:\.[\de_]+)?|0x[a-f0-9_]+(?:\.[a-f0-9p_]+)?|0b[01_]+|0o[0-7_]+)\b/i,"class-name":/\b[A-Z](?:[A-Z_\d]*[a-z]\w*)?\b/,function:/\b[a-z_]\w*(?=\s*\()/i,constant:/\b(?:[A-Z_]{2,}|k[A-Z][A-Za-z_]+)\b/,operator:/[-+*/%=!<>&|^~?]+|\.[.\-+*/%=!<>&|^~?]+/,punctuation:/[{}[\]();,.:\\]/},A.languages.swift["string-literal"].forEach(function(e){e.inside.interpolation.inside=A.languages.swift}),function(e){e.languages.kotlin=e.languages.extend("clike",{keyword:{pattern:/(^|[^.])\b(?:abstract|actual|annotation|as|break|by|catch|class|companion|const|constructor|continue|crossinline|data|do|dynamic|else|enum|expect|external|final|finally|for|fun|get|if|import|in|infix|init|inline|inner|interface|internal|is|lateinit|noinline|null|object|open|operator|out|override|package|private|protected|public|reified|return|sealed|set|super|suspend|tailrec|this|throw|to|try|typealias|val|var|vararg|when|where|while)\b/,lookbehind:!0},function:[{pattern:/(?:`[^\r\n`]+`|\b\w+)(?=\s*\()/,greedy:!0},{pattern:/(\.)(?:`[^\r\n`]+`|\w+)(?=\s*\{)/,lookbehind:!0,greedy:!0}],number:/\b(?:0[xX][\da-fA-F]+(?:_[\da-fA-F]+)*|0[bB][01]+(?:_[01]+)*|\d+(?:_\d+)*(?:\.\d+(?:_\d+)*)?(?:[eE][+-]?\d+(?:_\d+)*)?[fFL]?)\b/,operator:/\+[+=]?|-[-=>]?|==?=?|!(?:!|==?)?|[\/*%<>]=?|[?:]:?|\.\.|&&|\|\||\b(?:and|inv|or|shl|shr|ushr|xor)\b/}),delete e.languages.kotlin["class-name"];var t={"interpolation-punctuation":{pattern:/^\$\{?|\}$/,alias:"punctuation"},expression:{pattern:/[\s\S]+/,inside:e.languages.kotlin}};e.languages.insertBefore("kotlin","string",{"string-literal":[{pattern:/"""(?:[^$]|\$(?:(?!\{)|\{[^{}]*\}))*?"""/,alias:"multiline",inside:{interpolation:{pattern:/\$(?:[a-z_]\w*|\{[^{}]*\})/i,inside:t},string:/[\s\S]+/}},{pattern:/"(?:[^"\\\r\n$]|\\.|\$(?:(?!\{)|\{[^{}]*\}))*"/,alias:"singleline",inside:{interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$(?:[a-z_]\w*|\{[^{}]*\})/i,lookbehind:!0,inside:t},string:/[\s\S]+/}}],char:{pattern:/'(?:[^'\\\r\n]|\\(?:.|u[a-fA-F0-9]{0,4}))'/,greedy:!0}}),delete e.languages.kotlin.string,e.languages.insertBefore("kotlin","keyword",{annotation:{pattern:/\B@(?:\w+:)?(?:[A-Z]\w*|\[[^\]]+\])/,alias:"builtin"}}),e.languages.insertBefore("kotlin","function",{label:{pattern:/\b\w+@|@\w+\b/,alias:"symbol"}}),e.languages.kt=e.languages.kotlin,e.languages.kts=e.languages.kotlin}(A),A.languages.c=A.languages.extend("clike",{comment:{pattern:/\/\/(?:[^\r\n\\]|\\(?:\r\n?|\n|(?![\r\n])))*|\/\*[\s\S]*?(?:\*\/|$)/,greedy:!0},string:{pattern:/"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,greedy:!0},"class-name":{pattern:/(\b(?:enum|struct)\s+(?:__attribute__\s*\(\([\s\S]*?\)\)\s*)?)\w+|\b[a-z]\w*_t\b/,lookbehind:!0},keyword:/\b(?:_Alignas|_Alignof|_Atomic|_Bool|_Complex|_Generic|_Imaginary|_Noreturn|_Static_assert|_Thread_local|__attribute__|asm|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|inline|int|long|register|return|short|signed|sizeof|static|struct|switch|typedef|typeof|union|unsigned|void|volatile|while)\b/,function:/\b[a-z_]\w*(?=\s*\()/i,number:/(?:\b0x(?:[\da-f]+(?:\.[\da-f]*)?|\.[\da-f]+)(?:p[+-]?\d+)?|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?)[ful]{0,4}/i,operator:/>>=?|<<=?|->|([-+&|:])\1|[?:~]|[-+*/%&|^!=<>]=?/}),A.languages.insertBefore("c","string",{char:{pattern:/'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n]){0,32}'/,greedy:!0}}),A.languages.insertBefore("c","string",{macro:{pattern:/(^[\t ]*)#\s*[a-z](?:[^\r\n\\/]|\/(?!\*)|\/\*(?:[^*]|\*(?!\/))*\*\/|\\(?:\r\n|[\s\S]))*/im,lookbehind:!0,greedy:!0,alias:"property",inside:{string:[{pattern:/^(#\s*include\s*)<[^>]+>/,lookbehind:!0},A.languages.c.string],char:A.languages.c.char,comment:A.languages.c.comment,"macro-name":[{pattern:/(^#\s*define\s+)\w+\b(?!\()/i,lookbehind:!0},{pattern:/(^#\s*define\s+)\w+\b(?=\()/i,lookbehind:!0,alias:"function"}],directive:{pattern:/^(#\s*)[a-z]+/,lookbehind:!0,alias:"keyword"},"directive-hash":/^#/,punctuation:/##|\\(?=[\r\n])/,expression:{pattern:/\S[\s\S]*/,inside:A.languages.c}}}}),A.languages.insertBefore("c","function",{constant:/\b(?:EOF|NULL|SEEK_CUR|SEEK_END|SEEK_SET|__DATE__|__FILE__|__LINE__|__TIMESTAMP__|__TIME__|__func__|stderr|stdin|stdout)\b/}),delete A.languages.c.boolean,A.languages.objectivec=A.languages.extend("c",{string:{pattern:/@?"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,greedy:!0},keyword:/\b(?:asm|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|in|inline|int|long|register|return|self|short|signed|sizeof|static|struct|super|switch|typedef|typeof|union|unsigned|void|volatile|while)\b|(?:@interface|@end|@implementation|@protocol|@class|@public|@protected|@private|@property|@try|@catch|@finally|@throw|@synthesize|@dynamic|@selector)\b/,operator:/-[->]?|\+\+?|!=?|<<?=?|>>?=?|==?|&&?|\|\|?|[~^%?*\/@]/}),delete A.languages.objectivec["class-name"],A.languages.objc=A.languages.objectivec,A.languages.reason=A.languages.extend("clike",{string:{pattern:/"(?:\\(?:\r\n|[\s\S])|[^\\\r\n"])*"/,greedy:!0},"class-name":/\b[A-Z]\w*/,keyword:/\b(?:and|as|assert|begin|class|constraint|do|done|downto|else|end|exception|external|for|fun|function|functor|if|in|include|inherit|initializer|lazy|let|method|module|mutable|new|nonrec|object|of|open|or|private|rec|sig|struct|switch|then|to|try|type|val|virtual|when|while|with)\b/,operator:/\.{3}|:[:=]|\|>|->|=(?:==?|>)?|<=?|>=?|[|^?'#!~`]|[+\-*\/]\.?|\b(?:asr|land|lor|lsl|lsr|lxor|mod)\b/}),A.languages.insertBefore("reason","class-name",{char:{pattern:/'(?:\\x[\da-f]{2}|\\o[0-3][0-7][0-7]|\\\d{3}|\\.|[^'\\\r\n])'/,greedy:!0},constructor:/\b[A-Z]\w*\b(?!\s*\.)/,label:{pattern:/\b[a-z]\w*(?=::)/,alias:"symbol"}}),delete A.languages.reason.function,function(e){for(var t=/\/\*(?:[^*/]|\*(?!\/)|\/(?!\*)|<self>)*\*\//.source,n=0;n<2;n++)t=t.replace(/<self>/g,function(){return t});t=t.replace(/<self>/g,function(){return/[^\s\S]/.source}),e.languages.rust={comment:[{pattern:RegExp(/(^|[^\\])/.source+t),lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/b?"(?:\\[\s\S]|[^\\"])*"|b?r(#*)"(?:[^"]|"(?!\1))*"\1/,greedy:!0},char:{pattern:/b?'(?:\\(?:x[0-7][\da-fA-F]|u\{(?:[\da-fA-F]_*){1,6}\}|.)|[^\\\r\n\t'])'/,greedy:!0},attribute:{pattern:/#!?\[(?:[^\[\]"]|"(?:\\[\s\S]|[^\\"])*")*\]/,greedy:!0,alias:"attr-name",inside:{string:null}},"closure-params":{pattern:/([=(,:]\s*|\bmove\s*)\|[^|]*\||\|[^|]*\|(?=\s*(?:\{|->))/,lookbehind:!0,greedy:!0,inside:{"closure-punctuation":{pattern:/^\||\|$/,alias:"punctuation"},rest:null}},"lifetime-annotation":{pattern:/'\w+/,alias:"symbol"},"fragment-specifier":{pattern:/(\$\w+:)[a-z]+/,lookbehind:!0,alias:"punctuation"},variable:/\$\w+/,"function-definition":{pattern:/(\bfn\s+)\w+/,lookbehind:!0,alias:"function"},"type-definition":{pattern:/(\b(?:enum|struct|trait|type|union)\s+)\w+/,lookbehind:!0,alias:"class-name"},"module-declaration":[{pattern:/(\b(?:crate|mod)\s+)[a-z][a-z_\d]*/,lookbehind:!0,alias:"namespace"},{pattern:/(\b(?:crate|self|super)\s*)::\s*[a-z][a-z_\d]*\b(?:\s*::(?:\s*[a-z][a-z_\d]*\s*::)*)?/,lookbehind:!0,alias:"namespace",inside:{punctuation:/::/}}],keyword:[/\b(?:Self|abstract|as|async|await|become|box|break|const|continue|crate|do|dyn|else|enum|extern|final|fn|for|if|impl|in|let|loop|macro|match|mod|move|mut|override|priv|pub|ref|return|self|static|struct|super|trait|try|type|typeof|union|unsafe|unsized|use|virtual|where|while|yield)\b/,/\b(?:bool|char|f(?:32|64)|[ui](?:8|16|32|64|128|size)|str)\b/],function:/\b[a-z_]\w*(?=\s*(?:::\s*<|\())/,macro:{pattern:/\b\w+!/,alias:"property"},constant:/\b[A-Z_][A-Z_\d]+\b/,"class-name":/\b[A-Z]\w*\b/,namespace:{pattern:/(?:\b[a-z][a-z_\d]*\s*::\s*)*\b[a-z][a-z_\d]*\s*::(?!\s*<)/,inside:{punctuation:/::/}},number:/\b(?:0x[\dA-Fa-f](?:_?[\dA-Fa-f])*|0o[0-7](?:_?[0-7])*|0b[01](?:_?[01])*|(?:(?:\d(?:_?\d)*)?\.)?\d(?:_?\d)*(?:[Ee][+-]?\d+)?)(?:_?(?:f32|f64|[iu](?:8|16|32|64|size)?))?\b/,boolean:/\b(?:false|true)\b/,punctuation:/->|\.\.=|\.{1,3}|::|[{}[\];(),:]/,operator:/[-+*\/%!^]=?|=[=>]?|&[&=]?|\|[|=]?|<<?=?|>>?=?|[@?]/},e.languages.rust["closure-params"].inside.rest=e.languages.rust,e.languages.rust.attribute.inside.string=e.languages.rust.string}(A),A.languages.go=A.languages.extend("clike",{string:{pattern:/(^|[^\\])"(?:\\.|[^"\\\r\n])*"|`[^`]*`/,lookbehind:!0,greedy:!0},keyword:/\b(?:break|case|chan|const|continue|default|defer|else|fallthrough|for|func|go(?:to)?|if|import|interface|map|package|range|return|select|struct|switch|type|var)\b/,boolean:/\b(?:_|false|iota|nil|true)\b/,number:[/\b0(?:b[01_]+|o[0-7_]+)i?\b/i,/\b0x(?:[a-f\d_]+(?:\.[a-f\d_]*)?|\.[a-f\d_]+)(?:p[+-]?\d+(?:_\d+)*)?i?(?!\w)/i,/(?:\b\d[\d_]*(?:\.[\d_]*)?|\B\.\d[\d_]*)(?:e[+-]?[\d_]+)?i?(?!\w)/i],operator:/[*\/%^!=]=?|\+[=+]?|-[=-]?|\|[=|]?|&(?:=|&|\^=?)?|>(?:>=?|=)?|<(?:<=?|=|-)?|:=|\.\.\./,builtin:/\b(?:append|bool|byte|cap|close|complex|complex(?:64|128)|copy|delete|error|float(?:32|64)|u?int(?:8|16|32|64)?|imag|len|make|new|panic|print(?:ln)?|real|recover|rune|string|uintptr)\b/}),A.languages.insertBefore("go","string",{char:{pattern:/'(?:\\.|[^'\\\r\n]){0,10}'/,greedy:!0}}),delete A.languages.go["class-name"],function(e){var t=/\b(?:alignas|alignof|asm|auto|bool|break|case|catch|char|char16_t|char32_t|char8_t|class|co_await|co_return|co_yield|compl|concept|const|const_cast|consteval|constexpr|constinit|continue|decltype|default|delete|do|double|dynamic_cast|else|enum|explicit|export|extern|final|float|for|friend|goto|if|import|inline|int|int16_t|int32_t|int64_t|int8_t|long|module|mutable|namespace|new|noexcept|nullptr|operator|override|private|protected|public|register|reinterpret_cast|requires|return|short|signed|sizeof|static|static_assert|static_cast|struct|switch|template|this|thread_local|throw|try|typedef|typeid|typename|uint16_t|uint32_t|uint64_t|uint8_t|union|unsigned|using|virtual|void|volatile|wchar_t|while)\b/,n=/\b(?!<keyword>)\w+(?:\s*\.\s*\w+)*\b/.source.replace(/<keyword>/g,function(){return t.source});e.languages.cpp=e.languages.extend("c",{"class-name":[{pattern:RegExp(/(\b(?:class|concept|enum|struct|typename)\s+)(?!<keyword>)\w+/.source.replace(/<keyword>/g,function(){return t.source})),lookbehind:!0},/\b[A-Z]\w*(?=\s*::\s*\w+\s*\()/,/\b[A-Z_]\w*(?=\s*::\s*~\w+\s*\()/i,/\b\w+(?=\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>\s*::\s*\w+\s*\()/],keyword:t,number:{pattern:/(?:\b0b[01']+|\b0x(?:[\da-f']+(?:\.[\da-f']*)?|\.[\da-f']+)(?:p[+-]?[\d']+)?|(?:\b[\d']+(?:\.[\d']*)?|\B\.[\d']+)(?:e[+-]?[\d']+)?)[ful]{0,4}/i,greedy:!0},operator:/>>=?|<<=?|->|--|\+\+|&&|\|\||[?:~]|<=>|[-+*/%&|^!=<>]=?|\b(?:and|and_eq|bitand|bitor|not|not_eq|or|or_eq|xor|xor_eq)\b/,boolean:/\b(?:false|true)\b/}),e.languages.insertBefore("cpp","string",{module:{pattern:RegExp(/(\b(?:import|module)\s+)/.source+"(?:"+/"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|<[^<>\r\n]*>/.source+"|"+/<mod-name>(?:\s*:\s*<mod-name>)?|:\s*<mod-name>/.source.replace(/<mod-name>/g,function(){return n})+")"),lookbehind:!0,greedy:!0,inside:{string:/^[<"][\s\S]+/,operator:/:/,punctuation:/\./}},"raw-string":{pattern:/R"([^()\\ ]{0,16})\([\s\S]*?\)\1"/,alias:"string",greedy:!0}}),e.languages.insertBefore("cpp","keyword",{"generic-function":{pattern:/\b(?!operator\b)[a-z_]\w*\s*<(?:[^<>]|<[^<>]*>)*>(?=\s*\()/i,inside:{function:/^\w+/,generic:{pattern:/<[\s\S]+/,alias:"class-name",inside:e.languages.cpp}}}}),e.languages.insertBefore("cpp","operator",{"double-colon":{pattern:/::/,alias:"punctuation"}}),e.languages.insertBefore("cpp","class-name",{"base-clause":{pattern:/(\b(?:class|struct)\s+\w+\s*:\s*)[^;{}"'\s]+(?:\s+[^;{}"'\s]+)*(?=\s*[;{])/,lookbehind:!0,greedy:!0,inside:e.languages.extend("cpp",{})}}),e.languages.insertBefore("inside","double-colon",{"class-name":/\b[a-z_]\w*\b(?!\s*::)/i},e.languages.cpp["base-clause"])}(A),A.languages.python={comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0,greedy:!0},"string-interpolation":{pattern:/(?:f|fr|rf)(?:("""|''')[\s\S]*?\1|("|')(?:\\.|(?!\2)[^\\\r\n])*\2)/i,greedy:!0,inside:{interpolation:{pattern:/((?:^|[^{])(?:\{\{)*)\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}])+\})+\})+\}/,lookbehind:!0,inside:{"format-spec":{pattern:/(:)[^:(){}]+(?=\}$)/,lookbehind:!0},"conversion-option":{pattern:/![sra](?=[:}]$)/,alias:"punctuation"},rest:null}},string:/[\s\S]+/}},"triple-quoted-string":{pattern:/(?:[rub]|br|rb)?("""|''')[\s\S]*?\1/i,greedy:!0,alias:"string"},string:{pattern:/(?:[rub]|br|rb)?("|')(?:\\.|(?!\1)[^\\\r\n])*\1/i,greedy:!0},function:{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_]\w*(?=\s*\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)\w+/i,lookbehind:!0},decorator:{pattern:/(^[\t ]*)@\w+(?:\.\w+)*/m,lookbehind:!0,alias:["annotation","punctuation"],inside:{punctuation:/\./}},keyword:/\b(?:_(?=\s*:)|and|as|assert|async|await|break|case|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|match|nonlocal|not|or|pass|print|raise|return|try|while|with|yield)\b/,builtin:/\b(?:__import__|abs|all|any|apply|ascii|basestring|bin|bool|buffer|bytearray|bytes|callable|chr|classmethod|cmp|coerce|compile|complex|delattr|dict|dir|divmod|enumerate|eval|execfile|file|filter|float|format|frozenset|getattr|globals|hasattr|hash|help|hex|id|input|int|intern|isinstance|issubclass|iter|len|list|locals|long|map|max|memoryview|min|next|object|oct|open|ord|pow|property|range|raw_input|reduce|reload|repr|reversed|round|set|setattr|slice|sorted|staticmethod|str|sum|super|tuple|type|unichr|unicode|vars|xrange|zip)\b/,boolean:/\b(?:False|None|True)\b/,number:/\b0(?:b(?:_?[01])+|o(?:_?[0-7])+|x(?:_?[a-f0-9])+)\b|(?:\b\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\B\.\d+(?:_\d+)*)(?:e[+-]?\d+(?:_\d+)*)?j?(?!\w)/i,operator:/[-+%=]=?|!=|:=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]/,punctuation:/[{}[\];(),.:]/},A.languages.python["string-interpolation"].inside.interpolation.inside.rest=A.languages.python,A.languages.py=A.languages.python,A.languages.json={property:{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?=\s*:)/,lookbehind:!0,greedy:!0},string:{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?!\s*:)/,lookbehind:!0,greedy:!0},comment:{pattern:/\/\/.*|\/\*[\s\S]*?(?:\*\/|$)/,greedy:!0},number:/-?\b\d+(?:\.\d+)?(?:e[+-]?\d+)?\b/i,punctuation:/[{}[\],]/,operator:/:/,boolean:/\b(?:false|true)\b/,null:{pattern:/\bnull\b/,alias:"keyword"}},A.languages.webmanifest=A.languages.json;((e,t)=>{for(var n in t)m(e,n,{get:t[n],enumerable:!0})})({},{dracula:()=>N,duotoneDark:()=>x,duotoneLight:()=>w,github:()=>P,gruvboxMaterialDark:()=>$,gruvboxMaterialLight:()=>Y,jettwaveDark:()=>z,jettwaveLight:()=>W,nightOwl:()=>k,nightOwlLight:()=>O,oceanicNext:()=>M,okaidia:()=>U,oneDark:()=>K,oneLight:()=>V,palenight:()=>F,shadesOfPurple:()=>j,synthwave84:()=>B,ultramin:()=>q,vsDark:()=>G,vsLight:()=>H});var N={plain:{color:"#F8F8F2",backgroundColor:"#282A36"},styles:[{types:["prolog","constant","builtin"],style:{color:"rgb(189, 147, 249)"}},{types:["inserted","function"],style:{color:"rgb(80, 250, 123)"}},{types:["deleted"],style:{color:"rgb(255, 85, 85)"}},{types:["changed"],style:{color:"rgb(255, 184, 108)"}},{types:["punctuation","symbol"],style:{color:"rgb(248, 248, 242)"}},{types:["string","char","tag","selector"],style:{color:"rgb(255, 121, 198)"}},{types:["keyword","variable"],style:{color:"rgb(189, 147, 249)",fontStyle:"italic"}},{types:["comment"],style:{color:"rgb(98, 114, 164)"}},{types:["attr-name"],style:{color:"rgb(241, 250, 140)"}}]},x={plain:{backgroundColor:"#2a2734",color:"#9a86fd"},styles:[{types:["comment","prolog","doctype","cdata","punctuation"],style:{color:"#6c6783"}},{types:["namespace"],style:{opacity:.7}},{types:["tag","operator","number"],style:{color:"#e09142"}},{types:["property","function"],style:{color:"#9a86fd"}},{types:["tag-id","selector","atrule-id"],style:{color:"#eeebff"}},{types:["attr-name"],style:{color:"#c4b9fe"}},{types:["boolean","string","entity","url","attr-value","keyword","control","directive","unit","statement","regex","atrule","placeholder","variable"],style:{color:"#ffcc99"}},{types:["deleted"],style:{textDecorationLine:"line-through"}},{types:["inserted"],style:{textDecorationLine:"underline"}},{types:["italic"],style:{fontStyle:"italic"}},{types:["important","bold"],style:{fontWeight:"bold"}},{types:["important"],style:{color:"#c4b9fe"}}]},w={plain:{backgroundColor:"#faf8f5",color:"#728fcb"},styles:[{types:["comment","prolog","doctype","cdata","punctuation"],style:{color:"#b6ad9a"}},{types:["namespace"],style:{opacity:.7}},{types:["tag","operator","number"],style:{color:"#063289"}},{types:["property","function"],style:{color:"#b29762"}},{types:["tag-id","selector","atrule-id"],style:{color:"#2d2006"}},{types:["attr-name"],style:{color:"#896724"}},{types:["boolean","string","entity","url","attr-value","keyword","control","directive","unit","statement","regex","atrule"],style:{color:"#728fcb"}},{types:["placeholder","variable"],style:{color:"#93abdc"}},{types:["deleted"],style:{textDecorationLine:"line-through"}},{types:["inserted"],style:{textDecorationLine:"underline"}},{types:["italic"],style:{fontStyle:"italic"}},{types:["important","bold"],style:{fontWeight:"bold"}},{types:["important"],style:{color:"#896724"}}]},P={plain:{color:"#393A34",backgroundColor:"#f6f8fa"},styles:[{types:["comment","prolog","doctype","cdata"],style:{color:"#999988",fontStyle:"italic"}},{types:["namespace"],style:{opacity:.7}},{types:["string","attr-value"],style:{color:"#e3116c"}},{types:["punctuation","operator"],style:{color:"#393A34"}},{types:["entity","url","symbol","number","boolean","variable","constant","property","regex","inserted"],style:{color:"#36acaa"}},{types:["atrule","keyword","attr-name","selector"],style:{color:"#00a4db"}},{types:["function","deleted","tag"],style:{color:"#d73a49"}},{types:["function-variable"],style:{color:"#6f42c1"}},{types:["tag","selector","keyword"],style:{color:"#00009f"}}]},k={plain:{color:"#d6deeb",backgroundColor:"#011627"},styles:[{types:["changed"],style:{color:"rgb(162, 191, 252)",fontStyle:"italic"}},{types:["deleted"],style:{color:"rgba(239, 83, 80, 0.56)",fontStyle:"italic"}},{types:["inserted","attr-name"],style:{color:"rgb(173, 219, 103)",fontStyle:"italic"}},{types:["comment"],style:{color:"rgb(99, 119, 119)",fontStyle:"italic"}},{types:["string","url"],style:{color:"rgb(173, 219, 103)"}},{types:["variable"],style:{color:"rgb(214, 222, 235)"}},{types:["number"],style:{color:"rgb(247, 140, 108)"}},{types:["builtin","char","constant","function"],style:{color:"rgb(130, 170, 255)"}},{types:["punctuation"],style:{color:"rgb(199, 146, 234)"}},{types:["selector","doctype"],style:{color:"rgb(199, 146, 234)",fontStyle:"italic"}},{types:["class-name"],style:{color:"rgb(255, 203, 139)"}},{types:["tag","operator","keyword"],style:{color:"rgb(127, 219, 202)"}},{types:["boolean"],style:{color:"rgb(255, 88, 116)"}},{types:["property"],style:{color:"rgb(128, 203, 196)"}},{types:["namespace"],style:{color:"rgb(178, 204, 214)"}}]},O={plain:{color:"#403f53",backgroundColor:"#FBFBFB"},styles:[{types:["changed"],style:{color:"rgb(162, 191, 252)",fontStyle:"italic"}},{types:["deleted"],style:{color:"rgba(239, 83, 80, 0.56)",fontStyle:"italic"}},{types:["inserted","attr-name"],style:{color:"rgb(72, 118, 214)",fontStyle:"italic"}},{types:["comment"],style:{color:"rgb(152, 159, 177)",fontStyle:"italic"}},{types:["string","builtin","char","constant","url"],style:{color:"rgb(72, 118, 214)"}},{types:["variable"],style:{color:"rgb(201, 103, 101)"}},{types:["number"],style:{color:"rgb(170, 9, 130)"}},{types:["punctuation"],style:{color:"rgb(153, 76, 195)"}},{types:["function","selector","doctype"],style:{color:"rgb(153, 76, 195)",fontStyle:"italic"}},{types:["class-name"],style:{color:"rgb(17, 17, 17)"}},{types:["tag"],style:{color:"rgb(153, 76, 195)"}},{types:["operator","property","keyword","namespace"],style:{color:"rgb(12, 150, 155)"}},{types:["boolean"],style:{color:"rgb(188, 84, 84)"}}]},L="#c5a5c5",D="#8dc891",M={plain:{backgroundColor:"#282c34",color:"#ffffff"},styles:[{types:["attr-name"],style:{color:L}},{types:["attr-value"],style:{color:D}},{types:["comment","block-comment","prolog","doctype","cdata","shebang"],style:{color:"#999999"}},{types:["property","number","function-name","constant","symbol","deleted"],style:{color:"#5a9bcf"}},{types:["boolean"],style:{color:"#ff8b50"}},{types:["tag"],style:{color:"#fc929e"}},{types:["string"],style:{color:D}},{types:["punctuation"],style:{color:D}},{types:["selector","char","builtin","inserted"],style:{color:"#D8DEE9"}},{types:["function"],style:{color:"#79b6f2"}},{types:["operator","entity","url","variable"],style:{color:"#d7deea"}},{types:["keyword"],style:{color:L}},{types:["atrule","class-name"],style:{color:"#FAC863"}},{types:["important"],style:{fontWeight:"400"}},{types:["bold"],style:{fontWeight:"bold"}},{types:["italic"],style:{fontStyle:"italic"}},{types:["namespace"],style:{opacity:.7}}]},U={plain:{color:"#f8f8f2",backgroundColor:"#272822"},styles:[{types:["changed"],style:{color:"rgb(162, 191, 252)",fontStyle:"italic"}},{types:["deleted"],style:{color:"#f92672",fontStyle:"italic"}},{types:["inserted"],style:{color:"rgb(173, 219, 103)",fontStyle:"italic"}},{types:["comment"],style:{color:"#8292a2",fontStyle:"italic"}},{types:["string","url"],style:{color:"#a6e22e"}},{types:["variable"],style:{color:"#f8f8f2"}},{types:["number"],style:{color:"#ae81ff"}},{types:["builtin","char","constant","function","class-name"],style:{color:"#e6db74"}},{types:["punctuation"],style:{color:"#f8f8f2"}},{types:["selector","doctype"],style:{color:"#a6e22e",fontStyle:"italic"}},{types:["tag","operator","keyword"],style:{color:"#66d9ef"}},{types:["boolean"],style:{color:"#ae81ff"}},{types:["namespace"],style:{color:"rgb(178, 204, 214)",opacity:.7}},{types:["tag","property"],style:{color:"#f92672"}},{types:["attr-name"],style:{color:"#a6e22e !important"}},{types:["doctype"],style:{color:"#8292a2"}},{types:["rule"],style:{color:"#e6db74"}}]},F={plain:{color:"#bfc7d5",backgroundColor:"#292d3e"},styles:[{types:["comment"],style:{color:"rgb(105, 112, 152)",fontStyle:"italic"}},{types:["string","inserted"],style:{color:"rgb(195, 232, 141)"}},{types:["number"],style:{color:"rgb(247, 140, 108)"}},{types:["builtin","char","constant","function"],style:{color:"rgb(130, 170, 255)"}},{types:["punctuation","selector"],style:{color:"rgb(199, 146, 234)"}},{types:["variable"],style:{color:"rgb(191, 199, 213)"}},{types:["class-name","attr-name"],style:{color:"rgb(255, 203, 107)"}},{types:["tag","deleted"],style:{color:"rgb(255, 85, 114)"}},{types:["operator"],style:{color:"rgb(137, 221, 255)"}},{types:["boolean"],style:{color:"rgb(255, 88, 116)"}},{types:["keyword"],style:{fontStyle:"italic"}},{types:["doctype"],style:{color:"rgb(199, 146, 234)",fontStyle:"italic"}},{types:["namespace"],style:{color:"rgb(178, 204, 214)"}},{types:["url"],style:{color:"rgb(221, 221, 221)"}}]},j={plain:{color:"#9EFEFF",backgroundColor:"#2D2A55"},styles:[{types:["changed"],style:{color:"rgb(255, 238, 128)"}},{types:["deleted"],style:{color:"rgba(239, 83, 80, 0.56)"}},{types:["inserted"],style:{color:"rgb(173, 219, 103)"}},{types:["comment"],style:{color:"rgb(179, 98, 255)",fontStyle:"italic"}},{types:["punctuation"],style:{color:"rgb(255, 255, 255)"}},{types:["constant"],style:{color:"rgb(255, 98, 140)"}},{types:["string","url"],style:{color:"rgb(165, 255, 144)"}},{types:["variable"],style:{color:"rgb(255, 238, 128)"}},{types:["number","boolean"],style:{color:"rgb(255, 98, 140)"}},{types:["attr-name"],style:{color:"rgb(255, 180, 84)"}},{types:["keyword","operator","property","namespace","tag","selector","doctype"],style:{color:"rgb(255, 157, 0)"}},{types:["builtin","char","constant","function","class-name"],style:{color:"rgb(250, 208, 0)"}}]},B={plain:{backgroundColor:"linear-gradient(to bottom, #2a2139 75%, #34294f)",backgroundImage:"#34294f",color:"#f92aad",textShadow:"0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3"},styles:[{types:["comment","block-comment","prolog","doctype","cdata"],style:{color:"#495495",fontStyle:"italic"}},{types:["punctuation"],style:{color:"#ccc"}},{types:["tag","attr-name","namespace","number","unit","hexcode","deleted"],style:{color:"#e2777a"}},{types:["property","selector"],style:{color:"#72f1b8",textShadow:"0 0 2px #100c0f, 0 0 10px #257c5575, 0 0 35px #21272475"}},{types:["function-name"],style:{color:"#6196cc"}},{types:["boolean","selector-id","function"],style:{color:"#fdfdfd",textShadow:"0 0 2px #001716, 0 0 3px #03edf975, 0 0 5px #03edf975, 0 0 8px #03edf975"}},{types:["class-name","maybe-class-name","builtin"],style:{color:"#fff5f6",textShadow:"0 0 2px #000, 0 0 10px #fc1f2c75, 0 0 5px #fc1f2c75, 0 0 25px #fc1f2c75"}},{types:["constant","symbol"],style:{color:"#f92aad",textShadow:"0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3"}},{types:["important","atrule","keyword","selector-class"],style:{color:"#f4eee4",textShadow:"0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575"}},{types:["string","char","attr-value","regex","variable"],style:{color:"#f87c32"}},{types:["parameter"],style:{fontStyle:"italic"}},{types:["entity","url"],style:{color:"#67cdcc"}},{types:["operator"],style:{color:"ffffffee"}},{types:["important","bold"],style:{fontWeight:"bold"}},{types:["italic"],style:{fontStyle:"italic"}},{types:["entity"],style:{cursor:"help"}},{types:["inserted"],style:{color:"green"}}]},q={plain:{color:"#282a2e",backgroundColor:"#ffffff"},styles:[{types:["comment"],style:{color:"rgb(197, 200, 198)"}},{types:["string","number","builtin","variable"],style:{color:"rgb(150, 152, 150)"}},{types:["class-name","function","tag","attr-name"],style:{color:"rgb(40, 42, 46)"}}]},G={plain:{color:"#9CDCFE",backgroundColor:"#1E1E1E"},styles:[{types:["prolog"],style:{color:"rgb(0, 0, 128)"}},{types:["comment"],style:{color:"rgb(106, 153, 85)"}},{types:["builtin","changed","keyword","interpolation-punctuation"],style:{color:"rgb(86, 156, 214)"}},{types:["number","inserted"],style:{color:"rgb(181, 206, 168)"}},{types:["constant"],style:{color:"rgb(100, 102, 149)"}},{types:["attr-name","variable"],style:{color:"rgb(156, 220, 254)"}},{types:["deleted","string","attr-value","template-punctuation"],style:{color:"rgb(206, 145, 120)"}},{types:["selector"],style:{color:"rgb(215, 186, 125)"}},{types:["tag"],style:{color:"rgb(78, 201, 176)"}},{types:["tag"],languages:["markup"],style:{color:"rgb(86, 156, 214)"}},{types:["punctuation","operator"],style:{color:"rgb(212, 212, 212)"}},{types:["punctuation"],languages:["markup"],style:{color:"#808080"}},{types:["function"],style:{color:"rgb(220, 220, 170)"}},{types:["class-name"],style:{color:"rgb(78, 201, 176)"}},{types:["char"],style:{color:"rgb(209, 105, 105)"}}]},H={plain:{color:"#000000",backgroundColor:"#ffffff"},styles:[{types:["comment"],style:{color:"rgb(0, 128, 0)"}},{types:["builtin"],style:{color:"rgb(0, 112, 193)"}},{types:["number","variable","inserted"],style:{color:"rgb(9, 134, 88)"}},{types:["operator"],style:{color:"rgb(0, 0, 0)"}},{types:["constant","char"],style:{color:"rgb(129, 31, 63)"}},{types:["tag"],style:{color:"rgb(128, 0, 0)"}},{types:["attr-name"],style:{color:"rgb(255, 0, 0)"}},{types:["deleted","string"],style:{color:"rgb(163, 21, 21)"}},{types:["changed","punctuation"],style:{color:"rgb(4, 81, 165)"}},{types:["function","keyword"],style:{color:"rgb(0, 0, 255)"}},{types:["class-name"],style:{color:"rgb(38, 127, 153)"}}]},z={plain:{color:"#f8fafc",backgroundColor:"#011627"},styles:[{types:["prolog"],style:{color:"#000080"}},{types:["comment"],style:{color:"#6A9955"}},{types:["builtin","changed","keyword","interpolation-punctuation"],style:{color:"#569CD6"}},{types:["number","inserted"],style:{color:"#B5CEA8"}},{types:["constant"],style:{color:"#f8fafc"}},{types:["attr-name","variable"],style:{color:"#9CDCFE"}},{types:["deleted","string","attr-value","template-punctuation"],style:{color:"#cbd5e1"}},{types:["selector"],style:{color:"#D7BA7D"}},{types:["tag"],style:{color:"#0ea5e9"}},{types:["tag"],languages:["markup"],style:{color:"#0ea5e9"}},{types:["punctuation","operator"],style:{color:"#D4D4D4"}},{types:["punctuation"],languages:["markup"],style:{color:"#808080"}},{types:["function"],style:{color:"#7dd3fc"}},{types:["class-name"],style:{color:"#0ea5e9"}},{types:["char"],style:{color:"#D16969"}}]},W={plain:{color:"#0f172a",backgroundColor:"#f1f5f9"},styles:[{types:["prolog"],style:{color:"#000080"}},{types:["comment"],style:{color:"#6A9955"}},{types:["builtin","changed","keyword","interpolation-punctuation"],style:{color:"#0c4a6e"}},{types:["number","inserted"],style:{color:"#B5CEA8"}},{types:["constant"],style:{color:"#0f172a"}},{types:["attr-name","variable"],style:{color:"#0c4a6e"}},{types:["deleted","string","attr-value","template-punctuation"],style:{color:"#64748b"}},{types:["selector"],style:{color:"#D7BA7D"}},{types:["tag"],style:{color:"#0ea5e9"}},{types:["tag"],languages:["markup"],style:{color:"#0ea5e9"}},{types:["punctuation","operator"],style:{color:"#475569"}},{types:["punctuation"],languages:["markup"],style:{color:"#808080"}},{types:["function"],style:{color:"#0e7490"}},{types:["class-name"],style:{color:"#0ea5e9"}},{types:["char"],style:{color:"#D16969"}}]},K={plain:{backgroundColor:"hsl(220, 13%, 18%)",color:"hsl(220, 14%, 71%)",textShadow:"0 1px rgba(0, 0, 0, 0.3)"},styles:[{types:["comment","prolog","cdata"],style:{color:"hsl(220, 10%, 40%)"}},{types:["doctype","punctuation","entity"],style:{color:"hsl(220, 14%, 71%)"}},{types:["attr-name","class-name","maybe-class-name","boolean","constant","number","atrule"],style:{color:"hsl(29, 54%, 61%)"}},{types:["keyword"],style:{color:"hsl(286, 60%, 67%)"}},{types:["property","tag","symbol","deleted","important"],style:{color:"hsl(355, 65%, 65%)"}},{types:["selector","string","char","builtin","inserted","regex","attr-value"],style:{color:"hsl(95, 38%, 62%)"}},{types:["variable","operator","function"],style:{color:"hsl(207, 82%, 66%)"}},{types:["url"],style:{color:"hsl(187, 47%, 55%)"}},{types:["deleted"],style:{textDecorationLine:"line-through"}},{types:["inserted"],style:{textDecorationLine:"underline"}},{types:["italic"],style:{fontStyle:"italic"}},{types:["important","bold"],style:{fontWeight:"bold"}},{types:["important"],style:{color:"hsl(220, 14%, 71%)"}}]},V={plain:{backgroundColor:"hsl(230, 1%, 98%)",color:"hsl(230, 8%, 24%)"},styles:[{types:["comment","prolog","cdata"],style:{color:"hsl(230, 4%, 64%)"}},{types:["doctype","punctuation","entity"],style:{color:"hsl(230, 8%, 24%)"}},{types:["attr-name","class-name","boolean","constant","number","atrule"],style:{color:"hsl(35, 99%, 36%)"}},{types:["keyword"],style:{color:"hsl(301, 63%, 40%)"}},{types:["property","tag","symbol","deleted","important"],style:{color:"hsl(5, 74%, 59%)"}},{types:["selector","string","char","builtin","inserted","regex","attr-value","punctuation"],style:{color:"hsl(119, 34%, 47%)"}},{types:["variable","operator","function"],style:{color:"hsl(221, 87%, 60%)"}},{types:["url"],style:{color:"hsl(198, 99%, 37%)"}},{types:["deleted"],style:{textDecorationLine:"line-through"}},{types:["inserted"],style:{textDecorationLine:"underline"}},{types:["italic"],style:{fontStyle:"italic"}},{types:["important","bold"],style:{fontWeight:"bold"}},{types:["important"],style:{color:"hsl(230, 8%, 24%)"}}]},$={plain:{color:"#ebdbb2",backgroundColor:"#292828"},styles:[{types:["imports","class-name","maybe-class-name","constant","doctype","builtin","function"],style:{color:"#d8a657"}},{types:["property-access"],style:{color:"#7daea3"}},{types:["tag"],style:{color:"#e78a4e"}},{types:["attr-name","char","url","regex"],style:{color:"#a9b665"}},{types:["attr-value","string"],style:{color:"#89b482"}},{types:["comment","prolog","cdata","operator","inserted"],style:{color:"#a89984"}},{types:["delimiter","boolean","keyword","selector","important","atrule","property","variable","deleted"],style:{color:"#ea6962"}},{types:["entity","number","symbol"],style:{color:"#d3869b"}}]},Y={plain:{color:"#654735",backgroundColor:"#f9f5d7"},styles:[{types:["delimiter","boolean","keyword","selector","important","atrule","property","variable","deleted"],style:{color:"#af2528"}},{types:["imports","class-name","maybe-class-name","constant","doctype","builtin"],style:{color:"#b4730e"}},{types:["string","attr-value"],style:{color:"#477a5b"}},{types:["property-access"],style:{color:"#266b79"}},{types:["function","attr-name","char","url"],style:{color:"#72761e"}},{types:["tag"],style:{color:"#b94c07"}},{types:["comment","prolog","cdata","operator","inserted"],style:{color:"#a89984"}},{types:["entity","number","symbol"],style:{color:"#924f79"}}]},J=/\r\n|\r|\n/,X=e=>{0===e.length?e.push({types:["plain"],content:"\n",empty:!0}):1===e.length&&""===e[0].content&&(e[0].content="\n",e[0].empty=!0)},Q=(e,t)=>{const n=e.length;return n>0&&e[n-1]===t?e:e.concat(t)},Z=e=>{const t=[[]],n=[e],o=[0],a=[e.length];let i=0,s=0,r=[];const l=[r];for(;s>-1;){for(;(i=o[s]++)<a[s];){let e,c=t[s];const u=n[s][i];if("string"==typeof u?(c=s>0?c:["plain"],e=u):(c=Q(c,u.type),u.alias&&(c=Q(c,u.alias)),e=u.content),"string"!=typeof e){s++,t.push(c),n.push(e),o.push(0),a.push(e.length);continue}const d=e.split(J),p=d.length;r.push({types:c,content:d[0]});for(let t=1;t<p;t++)X(r),l.push(r=[]),r.push({types:c,content:d[t]})}s--,t.pop(),n.pop(),o.pop(),a.pop()}return X(r),l},ee=(e,t)=>{const{plain:n}=e,o=e.styles.reduce((e,n)=>{const{languages:o,style:a}=n;return o&&!o.includes(t)||n.types.forEach(t=>{const n=_(_({},e[t]),a);e[t]=n}),e},{});return o.root=n,o.plain=C(_({},n),{backgroundColor:void 0}),o},te=({children:e,language:t,code:n,theme:o,prism:a})=>{const i=t.toLowerCase(),s=ee(o,i),r=(e=>(0,u.useCallback)(t=>{var n=t,{className:o,style:a,line:i}=n,s=I(n,["className","style","line"]);const r=C(_({},s),{className:(0,d.A)("token-line",o)});return"object"==typeof e&&"plain"in e&&(r.style=e.plain),"object"==typeof a&&(r.style=_(_({},r.style||{}),a)),r},[e]))(s),l=(e=>{const t=(0,u.useCallback)(({types:t,empty:n})=>{if(null!=e)return 1===t.length&&"plain"===t[0]?null!=n?{display:"inline-block"}:void 0:1===t.length&&null!=n?e[t[0]]:Object.assign(null!=n?{display:"inline-block"}:{},...t.map(t=>e[t]))},[e]);return(0,u.useCallback)(e=>{var n=e,{token:o,className:a,style:i}=n,s=I(n,["token","className","style"]);const r=C(_({},s),{className:(0,d.A)("token",...o.types,a),children:o.content,style:t(o)});return null!=i&&(r.style=_(_({},r.style||{}),i)),r},[t])})(s),c=(({prism:e,code:t,grammar:n,language:o})=>(0,u.useMemo)(()=>{if(null==n)return Z([t]);const a={code:t,grammar:n,language:o,tokens:[]};return e.hooks.run("before-tokenize",a),a.tokens=e.tokenize(t,n),e.hooks.run("after-tokenize",a),Z(a.tokens)},[t,n,o,e]))({prism:a,language:i,code:n,grammar:a.languages[i]});return e({tokens:c,className:`prism-code language-${i}`,style:null!=s?s.root:{},getLineProps:r,getTokenProps:l})},ne=e=>(0,u.createElement)(te,C(_({},e),{prism:e.prism||A,theme:e.theme||G,code:e.code,language:e.language}))},2069(e,t,n){"use strict";n.d(t,{M:()=>g,e:()=>m});var o=n(6540),a=n(5600),i=n(4581),s=n(7485),r=n(6342),l=n(9532),c=n(4848);const u=o.createContext(void 0);function d(){const e=function(){const e=(0,a.YL)(),{items:t}=(0,r.p)().navbar;return 0===t.length&&!e.component}(),t=(0,i.l)(),n=!e&&"mobile"===t,[s,l]=(0,o.useState)(!1),c=(0,o.useCallback)(()=>{l(e=>!e)},[]);return(0,o.useEffect)(()=>{"desktop"===t&&l(!1)},[t]),(0,o.useMemo)(()=>({disabled:e,shouldRender:n,toggle:c,shown:s}),[e,n,c,s])}function p({handler:e}){return(0,s.$Z)(e),null}function m({children:e}){const t=d();return(0,c.jsxs)(c.Fragment,{children:[t.shown&&(0,c.jsx)(p,{handler:()=>(t.toggle(),!1)}),(0,c.jsx)(u.Provider,{value:t,children:e})]})}function g(){const e=o.useContext(u);if(void 0===e)throw new l.dV("NavbarMobileSidebarProvider");return e}},2131(e,t,n){"use strict";n.d(t,{o:()=>s});var o=n(4586),a=n(6347),i=n(440);function s(){const{siteConfig:{baseUrl:e,trailingSlash:t},i18n:{localeConfigs:n}}=(0,o.A)(),{pathname:s}=(0,a.zy)(),r=(0,i.Ks)(s,{trailingSlash:t,baseUrl:e}).replace(e,"");return{createUrl:function({locale:e,fullyQualified:t}){const o=function(e){const t=n[e];if(!t)throw new Error(`Unexpected Docusaurus bug, no locale config found for locale=${e}`);return t}(e);return`${`${t?o.url:""}`}${o.baseUrl}${r}`}}}},2303(e,t,n){"use strict";n.d(t,{A:()=>i});var o=n(6540),a=n(6125);function i(){return(0,o.useContext)(a.o)}},2514(){Prism.languages.json={property:{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?=\s*:)/,lookbehind:!0,greedy:!0},string:{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?!\s*:)/,lookbehind:!0,greedy:!0},comment:{pattern:/\/\/.*|\/\*[\s\S]*?(?:\*\/|$)/,greedy:!0},number:/-?\b\d+(?:\.\d+)?(?:e[+-]?\d+)?\b/i,punctuation:/[{}[\],]/,operator:/:/,boolean:/\b(?:false|true)\b/,null:{pattern:/\bnull\b/,alias:"keyword"}},Prism.languages.webmanifest=Prism.languages.json},2566(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addPrefix=function(e,t){return e.startsWith(t)?e:`${t}${e}`},t.removeSuffix=function(e,t){if(""===t)return e;return e.endsWith(t)?e.slice(0,-t.length):e},t.addSuffix=function(e,t){return e.endsWith(t)?e:`${e}${t}`},t.removePrefix=function(e,t){return e.startsWith(t)?e.slice(t.length):e}},2654(e){"use strict";e.exports={}},2694(e,t,n){"use strict";var o=n(6925);function a(){}function i(){}i.resetWarningCache=a,e.exports=function(){function e(e,t,n,a,i,s){if(s!==o){var r=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw r.name="Invariant Violation",r}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:a};return n.PropTypes=n,n}},2799(e,t){"use strict";var n="function"==typeof Symbol&&Symbol.for,o=n?Symbol.for("react.element"):60103,a=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,r=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,p=n?Symbol.for("react.forward_ref"):60112,m=n?Symbol.for("react.suspense"):60113,g=n?Symbol.for("react.suspense_list"):60120,f=n?Symbol.for("react.memo"):60115,h=n?Symbol.for("react.lazy"):60116,v=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,E=n?Symbol.for("react.scope"):60119;function S(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case o:switch(e=e.type){case u:case d:case i:case r:case s:case m:return e;default:switch(e=e&&e.$$typeof){case c:case p:case h:case f:case l:return e;default:return t}}case a:return t}}}function T(e){return S(e)===d}t.AsyncMode=u,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=l,t.Element=o,t.ForwardRef=p,t.Fragment=i,t.Lazy=h,t.Memo=f,t.Portal=a,t.Profiler=r,t.StrictMode=s,t.Suspense=m,t.isAsyncMode=function(e){return T(e)||S(e)===u},t.isConcurrentMode=T,t.isContextConsumer=function(e){return S(e)===c},t.isContextProvider=function(e){return S(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o},t.isForwardRef=function(e){return S(e)===p},t.isFragment=function(e){return S(e)===i},t.isLazy=function(e){return S(e)===h},t.isMemo=function(e){return S(e)===f},t.isPortal=function(e){return S(e)===a},t.isProfiler=function(e){return S(e)===r},t.isStrictMode=function(e){return S(e)===s},t.isSuspense=function(e){return S(e)===m},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===i||e===d||e===r||e===s||e===m||e===g||"object"==typeof e&&null!==e&&(e.$$typeof===h||e.$$typeof===f||e.$$typeof===l||e.$$typeof===c||e.$$typeof===p||e.$$typeof===y||e.$$typeof===b||e.$$typeof===E||e.$$typeof===v)},t.typeOf=S},2831(e,t,n){"use strict";n.d(t,{u:()=>s,v:()=>r});var o=n(6347),a=n(8168),i=n(6540);function s(e,t,n){return void 0===n&&(n=[]),e.some(function(e){var a=e.path?(0,o.B6)(t,e):n.length?n[n.length-1].match:o.Ix.computeRootMatch(t);return a&&(n.push({route:e,match:a}),e.routes&&s(e.routes,t,n)),a}),n}function r(e,t,n){return void 0===t&&(t={}),void 0===n&&(n={}),e?i.createElement(o.dO,n,e.map(function(e,n){return i.createElement(o.qh,{key:e.key||n,path:e.path,exact:e.exact,strict:e.strict,render:function(n){return e.render?e.render((0,a.A)({},n,{},t,{route:e})):i.createElement(e.component,(0,a.A)({},n,t,{route:e}))}})})):null}},2833(e){e.exports=function(e,t,n,o){var a=n?n.call(o,e,t):void 0;if(void 0!==a)return!!a;if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;for(var r=Object.prototype.hasOwnProperty.bind(t),l=0;l<i.length;l++){var c=i[l];if(!r(c))return!1;var u=e[c],d=t[c];if(!1===(a=n?n.call(o,u,d,c):void 0)||void 0===a&&u!==d)return!1}return!0}},2892(e,t,n){"use strict";function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,o(e,t)}n.d(t,{A:()=>a})},2983(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addTrailingSlash=a,t.default=function(e,t){const{trailingSlash:n,baseUrl:o}=t;if(e.startsWith("#"))return e;if(void 0===n)return e;const[s]=e.split(/[#?]/),r="/"===s||s===o?s:(l=s,c=n,c?a(l):i(l));var l,c;return e.replace(s,r)},t.addLeadingSlash=function(e){return(0,o.addPrefix)(e,"/")},t.removeTrailingSlash=i;const o=n(2566);function a(e){return e.endsWith("/")?e:`${e}/`}function i(e){return(0,o.removeSuffix)(e,"/")}},3001(e,t,n){"use strict";n.r(t)},3025(e,t,n){"use strict";n.d(t,{n:()=>r,r:()=>l});var o=n(6540),a=n(9532),i=n(4848);const s=o.createContext(null);function r({children:e,version:t}){return(0,i.jsx)(s.Provider,{value:t,children:e})}function l(){const e=(0,o.useContext)(s);if(null===e)throw new a.dV("DocsVersionProvider");return e}},3102(e,t,n){"use strict";n.d(t,{W:()=>s,o:()=>i});var o=n(6540),a=n(4848);const i=o.createContext(null);function s({children:e,value:t}){const n=o.useContext(i),s=(0,o.useMemo)(()=>function({parent:e,value:t}){if(!e){if(!t)throw new Error("Unexpected: no Docusaurus route context found");if(!("plugin"in t))throw new Error("Unexpected: Docusaurus topmost route context has no `plugin` attribute");return t}const n={...e.data,...t?.data};return{plugin:e.plugin,data:n}}({parent:n,value:t}),[n,t]);return(0,a.jsx)(i.Provider,{value:s,children:e})}},3104(e,t,n){"use strict";n.d(t,{Mq:()=>m,Tv:()=>u,a_:()=>g,gk:()=>f});var o=n(6540),a=n(8193),i=n(2303),s=n(205),r=n(9532),l=n(4848);const c=o.createContext(void 0);function u({children:e}){const t=function(){const e=(0,o.useRef)(!0);return(0,o.useMemo)(()=>({scrollEventsEnabledRef:e,enableScrollEvents:()=>{e.current=!0},disableScrollEvents:()=>{e.current=!1}}),[])}();return(0,l.jsx)(c.Provider,{value:t,children:e})}function d(){const e=(0,o.useContext)(c);if(null==e)throw new r.dV("ScrollControllerProvider");return e}const p=()=>a.A.canUseDOM?{scrollX:window.pageXOffset,scrollY:window.pageYOffset}:null;function m(e,t=[]){const{scrollEventsEnabledRef:n}=d(),a=(0,o.useRef)(p()),i=(0,r._q)(e);(0,o.useEffect)(()=>{const e=()=>{if(!n.current)return;const e=p();i(e,a.current),a.current=e},t={passive:!0};return e(),window.addEventListener("scroll",e,t),()=>window.removeEventListener("scroll",e,t)},[i,n,...t])}function g(){const e=d(),t=function(){const e=(0,o.useRef)({elem:null,top:0}),t=(0,o.useCallback)(t=>{e.current={elem:t,top:t.getBoundingClientRect().top}},[]),n=(0,o.useCallback)(()=>{const{current:{elem:t,top:n}}=e;if(!t)return{restored:!1};const o=t.getBoundingClientRect().top-n;return o&&window.scrollBy({left:0,top:o}),e.current={elem:null,top:0},{restored:0!==o}},[]);return(0,o.useMemo)(()=>({save:t,restore:n}),[n,t])}(),n=(0,o.useRef)(void 0),a=(0,o.useCallback)(o=>{t.save(o),e.disableScrollEvents(),n.current=()=>{const{restored:o}=t.restore();if(n.current=void 0,o){const t=()=>{e.enableScrollEvents(),window.removeEventListener("scroll",t)};window.addEventListener("scroll",t)}else e.enableScrollEvents()}},[e,t]);return(0,s.A)(()=>{queueMicrotask(()=>n.current?.())}),{blockElementScrollPositionUntilNextRender:a}}function f(){const e=(0,o.useRef)(null),t=(0,i.A)()&&"smooth"===getComputedStyle(document.documentElement).scrollBehavior;return{startScroll:n=>{e.current=t?function(e){return window.scrollTo({top:e,behavior:"smooth"}),()=>{}}(n):function(e){let t=null;const n=document.documentElement.scrollTop>e;return function o(){const a=document.documentElement.scrollTop;(n&&a>e||!n&&a<e)&&(t=requestAnimationFrame(o),window.scrollTo(0,Math.floor(.85*(a-e))+e))}(),()=>t&&cancelAnimationFrame(t)}(n)},cancelScroll:()=>e.current?.()}}},3109(e,t,n){"use strict";function o(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}n.d(t,{O:()=>o})},3186(e,t,n){"use strict";n.d(t,{A:()=>s});n(6540);var o=n(1312);const a="iconExternalLink_nPIU";var i=n(4848);function s({width:e=13.5,height:t=13.5}){return(0,i.jsx)("svg",{width:e,height:t,"aria-label":(0,o.T)({id:"theme.IconExternalLink.ariaLabel",message:"(opens in new tab)",description:"The ARIA label for the external link icon"}),className:a,children:(0,i.jsx)("use",{href:"#theme-svg-external-link"})})}},3259(e,t,n){"use strict";function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(){return s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},s.apply(this,arguments)}var r=n(6540),l=[],c=[];var u=r.createContext(null);function d(e){var t=e(),n={loading:!0,loaded:null,error:null};return n.promise=t.then(function(e){return n.loading=!1,n.loaded=e,e}).catch(function(e){throw n.loading=!1,n.error=e,e}),n}function p(e){var t={loading:!1,loaded:{},error:null},n=[];try{Object.keys(e).forEach(function(o){var a=d(e[o]);a.loading?t.loading=!0:(t.loaded[o]=a.loaded,t.error=a.error),n.push(a.promise),a.promise.then(function(e){t.loaded[o]=e}).catch(function(e){t.error=e})})}catch(o){t.error=o}return t.promise=Promise.all(n).then(function(e){return t.loading=!1,e}).catch(function(e){throw t.loading=!1,e}),t}function m(e,t){return r.createElement((n=e)&&n.__esModule?n.default:n,t);var n}function g(e,t){var d,p;if(!t.loading)throw new Error("react-loadable requires a `loading` component");var g=s({loader:null,loading:null,delay:200,timeout:null,render:m,webpack:null,modules:null},t),f=null;function h(){return f||(f=e(g.loader)),f.promise}return l.push(h),"function"==typeof g.webpack&&c.push(function(){if((0,g.webpack)().every(function(e){return void 0!==e&&void 0!==n.m[e]}))return h()}),p=d=function(t){function n(n){var o;return i(a(a(o=t.call(this,n)||this)),"retry",function(){o.setState({error:null,loading:!0,timedOut:!1}),f=e(g.loader),o._loadModule()}),h(),o.state={error:f.error,pastDelay:!1,timedOut:!1,loading:f.loading,loaded:f.loaded},o}o(n,t),n.preload=function(){return h()};var s=n.prototype;return s.UNSAFE_componentWillMount=function(){this._loadModule()},s.componentDidMount=function(){this._mounted=!0},s._loadModule=function(){var e=this;if(this.context&&Array.isArray(g.modules)&&g.modules.forEach(function(t){e.context.report(t)}),f.loading){var t=function(t){e._mounted&&e.setState(t)};"number"==typeof g.delay&&(0===g.delay?this.setState({pastDelay:!0}):this._delay=setTimeout(function(){t({pastDelay:!0})},g.delay)),"number"==typeof g.timeout&&(this._timeout=setTimeout(function(){t({timedOut:!0})},g.timeout));var n=function(){t({error:f.error,loaded:f.loaded,loading:f.loading}),e._clearTimeouts()};f.promise.then(function(){return n(),null}).catch(function(e){return n(),null})}},s.componentWillUnmount=function(){this._mounted=!1,this._clearTimeouts()},s._clearTimeouts=function(){clearTimeout(this._delay),clearTimeout(this._timeout)},s.render=function(){return this.state.loading||this.state.error?r.createElement(g.loading,{isLoading:this.state.loading,pastDelay:this.state.pastDelay,timedOut:this.state.timedOut,error:this.state.error,retry:this.retry}):this.state.loaded?g.render(this.state.loaded,this.props):null},n}(r.Component),i(d,"contextType",u),p}function f(e){return g(d,e)}f.Map=function(e){if("function"!=typeof e.render)throw new Error("LoadableMap requires a `render(loaded, props)` function");return g(p,e)};var h=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.render=function(){return r.createElement(u.Provider,{value:{report:this.props.report}},r.Children.only(this.props.children))},t}(r.Component);function v(e){for(var t=[];e.length;){var n=e.pop();t.push(n())}return Promise.all(t).then(function(){if(e.length)return v(e)})}f.Capture=h,f.preloadAll=function(){return new Promise(function(e,t){v(l).then(e,t)})},f.preloadReady=function(){return new Promise(function(e,t){v(c).then(e,e)})},e.exports=f},3427(e,t,n){"use strict";n.d(t,{A:()=>i});var o=n(6540);n(4848);const a=o.createContext({collectAnchor:()=>{},collectLink:()=>{}});function i(){return(0,o.useContext)(a)}},3465(e,t,n){"use strict";n.d(t,{A:()=>u});n(6540);var o=n(8774),a=n(6025),i=n(4586),s=n(6342),r=n(1122),l=n(4848);function c({logo:e,alt:t,imageClassName:n}){const o={light:(0,a.Ay)(e.src),dark:(0,a.Ay)(e.srcDark||e.src)},i=(0,l.jsx)(r.A,{className:e.className,sources:o,height:e.height,width:e.width,alt:t,style:e.style});return n?(0,l.jsx)("div",{className:n,children:i}):i}function u(e){const{siteConfig:{title:t}}=(0,i.A)(),{navbar:{title:n,logo:r}}=(0,s.p)(),{imageClassName:u,titleClassName:d,...p}=e,m=(0,a.Ay)(r?.href||"/"),g=n?"":t,f=r?.alt??g;return(0,l.jsxs)(o.A,{to:m,...p,...r?.target&&{target:r.target},children:[r&&(0,l.jsx)(c,{logo:r,alt:f,imageClassName:u}),null!=n&&(0,l.jsx)("b",{className:d,children:n})]})}},3535(e,t,n){"use strict";n.d(t,{v:()=>s});var o=n(6342);const a="anchorTargetStickyNavbar_Vzrq",i="anchorTargetHideOnScrollNavbar_vjPI";function s(e){const{navbar:{hideOnScroll:t}}=(0,o.p)();if(void 0!==e)return t?i:a}},3886(e,t,n){"use strict";n.d(t,{VQ:()=>v,g1:()=>b});var o=n(6540),a=n(4070),i=n(7065),s=n(6342),r=n(679),l=n(9532),c=n(4848);const u=e=>`docs-preferred-version-${e}`,d=(e,t,n)=>{(0,r.Wf)(u(e),{persistence:t}).set(n)},p=(e,t)=>(0,r.Wf)(u(e),{persistence:t}).get(),m=(e,t)=>{(0,r.Wf)(u(e),{persistence:t}).del()};const g=o.createContext(null);function f(){const e=(0,a.Gy)(),t=(0,s.p)().docs.versionPersistence,n=(0,o.useMemo)(()=>Object.keys(e),[e]),[i,r]=(0,o.useState)(()=>(e=>Object.fromEntries(e.map(e=>[e,{preferredVersionName:null}])))(n));(0,o.useEffect)(()=>{r(function({pluginIds:e,versionPersistence:t,allDocsData:n}){function o(e){const o=p(e,t);return n[e].versions.some(e=>e.name===o)?{preferredVersionName:o}:(m(e,t),{preferredVersionName:null})}return Object.fromEntries(e.map(e=>[e,o(e)]))}({allDocsData:e,versionPersistence:t,pluginIds:n}))},[e,t,n]);return[i,(0,o.useMemo)(()=>({savePreferredVersion:function(e,n){d(e,t,n),r(t=>({...t,[e]:{preferredVersionName:n}}))}}),[t])]}function h({children:e}){const t=f();return(0,c.jsx)(g.Provider,{value:t,children:e})}function v({children:e}){return(0,c.jsx)(h,{children:e})}function y(){const e=(0,o.useContext)(g);if(!e)throw new l.dV("DocsPreferredVersionContextProvider");return e}function b(e=i.W){const t=(0,a.ht)(e),[n,s]=y(),{preferredVersionName:r}=n[e];return{preferredVersion:t.versions.find(e=>e.name===r)??null,savePreferredVersionName:(0,o.useCallback)(t=>{s.savePreferredVersion(e,t)},[s,e])}}},4054(e){"use strict";e.exports=JSON.parse('{"/markdown-page-3d7":{"__comp":"1f391b9e","__context":{"plugin":"a7456010"},"content":"393be207"},"/docs/v1-b1e":{"__comp":"5e95c892","__context":{"plugin":"586ac986"}},"/docs/v1-f1e":{"__comp":"a7bd4aaa","__props":"0704e49c"},"/docs/v1-38e":{"__comp":"a94703ab"},"/docs/v1/api/audit-trace-331":{"__comp":"17896441","content":"85216760"},"/docs/v1/api/java-api-98f":{"__comp":"17896441","content":"55d9634d"},"/docs/v1/api/rest-api-432":{"__comp":"17896441","content":"7f42d669"},"/docs/v1/api/stream-api-db6":{"__comp":"17896441","content":"c42527f6"},"/docs/v1/architecture-425":{"__comp":"17896441","content":"a241b271"},"/docs/v1/consumer-723":{"__comp":"17896441","content":"9e073b48"},"/docs/v1/consumer/annotations-reference-64b":{"__comp":"17896441","content":"7f68cf2c"},"/docs/v1/consumer/backend-integration-c4f":{"__comp":"17896441","content":"ea48d3b4"},"/docs/v1/consumer/configuration-e2d":{"__comp":"17896441","content":"d37b6ad6"},"/docs/v1/consumer/extensions-241":{"__comp":"17896441","content":"947805b2"},"/docs/v1/consumer/new-consumer-onboarding-576":{"__comp":"17896441","content":"98300e78"},"/docs/v1/consumer/session-reset-and-continuity-63c":{"__comp":"17896441","content":"83e26d28"},"/docs/v1/consumer/ui-integration-430":{"__comp":"17896441","content":"9e83c9cc"},"/docs/v1/deep-dive-8e0":{"__comp":"17896441","content":"80ffc973"},"/docs/v1/deep-dive/data-model-254":{"__comp":"17896441","content":"c96f7375"},"/docs/v1/deep-dive/developer-guide-46a":{"__comp":"17896441","content":"27a4ec52"},"/docs/v1/deep-dive/examples-866":{"__comp":"17896441","content":"d56c8658"},"/docs/v1/deep-dive/failure-gotchas-14d":{"__comp":"17896441","content":"8e38d733"},"/docs/v1/deep-dive/file-map-54f":{"__comp":"17896441","content":"ae205812"},"/docs/v1/deep-dive/improvement-backlog-f35":{"__comp":"17896441","content":"9da55969"},"/docs/v1/deep-dive/intent-and-schema-6b8":{"__comp":"17896441","content":"77efaed7"},"/docs/v1/deep-dive/lifecycle-a72":{"__comp":"17896441","content":"51bc3415"},"/docs/v1/deep-dive/mcp-audit-d53":{"__comp":"17896441","content":"e82d54d3"},"/docs/v1/deep-dive/pipeline-steps-27f":{"__comp":"17896441","content":"98fa3606"},"/docs/v1/deep-dive/request-lifecycle-dde":{"__comp":"17896441","content":"1bd52e39"},"/docs/v1/deep-dive/rules-responses-217":{"__comp":"17896441","content":"1bcf784f"},"/docs/v1/examples-c2e":{"__comp":"17896441","content":"8bf4086b"},"/docs/v1/local-development-93d":{"__comp":"17896441","content":"fe6d72a3"},"/docs/v1/overview-55c":{"__comp":"17896441","content":"5259eca5"},"/docs/v1/version-history-28e":{"__comp":"17896441","content":"d9156863"},"/docs/v2-8b7":{"__comp":"5e95c892","__context":{"plugin":"fd276725"}},"/docs/v2-72c":{"__comp":"a7bd4aaa","__props":"6acfdb62"},"/docs/v2-c78":{"__comp":"a94703ab"},"/docs/v2/api/audit-trace-52f":{"__comp":"17896441","content":"b5676ef2"},"/docs/v2/api/java-api-6b9":{"__comp":"17896441","content":"3ebda8dc"},"/docs/v2/api/rest-api-8d8":{"__comp":"17896441","content":"dc029a89"},"/docs/v2/api/stream-api-df2":{"__comp":"17896441","content":"4c746c58"},"/docs/v2/architecture-03d":{"__comp":"17896441","content":"8f9485e8"},"/docs/v2/consumer-684":{"__comp":"17896441","content":"a70918c9"},"/docs/v2/consumer/annotations-reference-fe5":{"__comp":"17896441","content":"f4397bd6"},"/docs/v2/consumer/backend-integration-740":{"__comp":"17896441","content":"be6500c0"},"/docs/v2/consumer/caching-and-persistence-aef":{"__comp":"17896441","content":"1082ba27"},"/docs/v2/consumer/configuration-025":{"__comp":"17896441","content":"dd0e6d67"},"/docs/v2/consumer/extensions-171":{"__comp":"17896441","content":"3b21f5bc"},"/docs/v2/consumer/mcp/advanced-b9c":{"__comp":"17896441","content":"4a749c87"},"/docs/v2/consumer/mcp/basics-b22":{"__comp":"17896441","content":"0312e064"},"/docs/v2/consumer/mcp/deep-dive-8ef":{"__comp":"17896441","content":"25ed139f"},"/docs/v2/consumer/mcp/example1-0a5":{"__comp":"17896441","content":"7ed18201"},"/docs/v2/consumer/mcp/example2-a65":{"__comp":"17896441","content":"aa51eb9c"},"/docs/v2/consumer/mcp/http-tool-8fc":{"__comp":"17896441","content":"bdd58070"},"/docs/v2/consumer/new-consumer-onboarding-7ae":{"__comp":"17896441","content":"5d38660f"},"/docs/v2/consumer/session-reset-and-continuity-75f":{"__comp":"17896441","content":"ed731a92"},"/docs/v2/consumer/ui-integration-3d9":{"__comp":"17896441","content":"ef425a30"},"/docs/v2/deep-dive-e52":{"__comp":"17896441","content":"14941fe8"},"/docs/v2/deep-dive/data-model-0ac":{"__comp":"17896441","content":"e6179d5e"},"/docs/v2/deep-dive/developer-guide-de7":{"__comp":"17896441","content":"f47f1c71"},"/docs/v2/deep-dive/examples-dd1":{"__comp":"17896441","content":"c71f4ab2"},"/docs/v2/deep-dive/failure-gotchas-4f2":{"__comp":"17896441","content":"dec5a43c"},"/docs/v2/deep-dive/file-map-73d":{"__comp":"17896441","content":"1a0c881c"},"/docs/v2/deep-dive/improvement-backlog-9ee":{"__comp":"17896441","content":"2396873c"},"/docs/v2/deep-dive/intent-and-schema-c0c":{"__comp":"17896441","content":"fd2f5e0a"},"/docs/v2/deep-dive/lifecycle-af8":{"__comp":"17896441","content":"f618ef7d"},"/docs/v2/deep-dive/mcp-audit-444":{"__comp":"17896441","content":"9aedba33"},"/docs/v2/deep-dive/pipeline-steps-ca5":{"__comp":"17896441","content":"82a8309b"},"/docs/v2/deep-dive/request-lifecycle-4a2":{"__comp":"17896441","content":"7268a1d7"},"/docs/v2/deep-dive/rules-responses-3d0":{"__comp":"17896441","content":"617e4c86"},"/docs/v2/deep-dive/v2-features-b85":{"__comp":"17896441","content":"4bf65dbd"},"/docs/v2/examples-1c9":{"__comp":"17896441","content":"c3ba5c0f"},"/docs/v2/faq-780":{"__comp":"17896441","content":"1442c29a"},"/docs/v2/local-development-40d":{"__comp":"17896441","content":"9ca8e147"},"/docs/v2/overview-3dc":{"__comp":"17896441","content":"b0362358"},"/docs/v2/version-history-aa1":{"__comp":"17896441","content":"2f300dfb"},"/-2e1":{"__comp":"c4f5d8e4","__context":{"plugin":"a7456010"},"config":"5e9f5e1a"}}')},4070(e,t,n){"use strict";n.d(t,{zK:()=>f,vT:()=>p,Gy:()=>u,HW:()=>h,ht:()=>d,r7:()=>g,jh:()=>m});var o=n(6347),a=n(4586),i=n(7065);function s(e,t={}){const n=function(){const{globalData:e}=(0,a.A)();return e}()[e];if(!n&&t.failfast)throw new Error(`Docusaurus plugin global data not found for "${e}" plugin.`);return n}const r=e=>e.versions.find(e=>e.isLast);function l(e,t){const n=function(e,t){return[...e.versions].sort((e,t)=>e.path===t.path?0:e.path.includes(t.path)?-1:t.path.includes(e.path)?1:0).find(e=>!!(0,o.B6)(t,{path:e.path,exact:!1,strict:!1}))}(e,t),a=n?.docs.find(e=>!!(0,o.B6)(t,{path:e.path,exact:!0,strict:!1}));return{activeVersion:n,activeDoc:a,alternateDocVersions:a?function(t){const n={};return e.versions.forEach(e=>{e.docs.forEach(o=>{o.id===t&&(n[e.name]=o)})}),n}(a.id):{}}}const c={},u=()=>s("docusaurus-plugin-content-docs")??c,d=e=>{try{return function(e,t=i.W,n={}){const o=s(e),a=o?.[t];if(!a&&n.failfast)throw new Error(`Docusaurus plugin global data not found for "${e}" plugin with id "${t}".`);return a}("docusaurus-plugin-content-docs",e,{failfast:!0})}catch(t){throw new Error("You are using a feature of the Docusaurus docs plugin, but this plugin does not seem to be enabled"+("Default"===e?"":` (pluginId=${e}`),{cause:t})}};function p(e={}){const t=u(),{pathname:n}=(0,o.zy)();return function(e,t,n={}){const a=Object.entries(e).sort((e,t)=>t[1].path.localeCompare(e[1].path)).find(([,e])=>!!(0,o.B6)(t,{path:e.path,exact:!1,strict:!1})),i=a?{pluginId:a[0],pluginData:a[1]}:void 0;if(!i&&n.failfast)throw new Error(`Can't find active docs plugin for "${t}" pathname, while it was expected to be found. Maybe you tried to use a docs feature that can only be used on a docs-related page? Existing docs plugin paths are: ${Object.values(e).map(e=>e.path).join(", ")}`);return i}(t,n,e)}function m(e){return d(e).versions}function g(e){const t=d(e);return r(t)}function f(e){const t=d(e),{pathname:n}=(0,o.zy)();return l(t,n)}function h(e){const t=d(e),{pathname:n}=(0,o.zy)();return function(e,t){const n=r(e);return{latestDocSuggestion:l(e,t).alternateDocVersions[n.name],latestVersionSuggestion:n}}(t,n)}},4090(e,t,n){"use strict";n.d(t,{w:()=>a,J:()=>i});var o=n(6540);const a="navigation-with-keyboard";function i(){(0,o.useEffect)(()=>{function e(e){"keydown"===e.type&&"Tab"===e.key&&document.body.classList.add(a),"mousedown"===e.type&&document.body.classList.remove(a)}return document.addEventListener("keydown",e),document.addEventListener("mousedown",e),()=>{document.body.classList.remove(a),document.removeEventListener("keydown",e),document.removeEventListener("mousedown",e)}},[])}},4146(e,t,n){"use strict";var o=n(4363),a={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},r={};function l(e){return o.isMemo(e)?s:r[e.$$typeof]||a}r[o.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},r[o.Memo]=s;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,m=Object.getPrototypeOf,g=Object.prototype;e.exports=function e(t,n,o){if("string"!=typeof n){if(g){var a=m(n);a&&a!==g&&e(t,a,o)}var s=u(n);d&&(s=s.concat(d(n)));for(var r=l(t),f=l(n),h=0;h<s.length;++h){var v=s[h];if(!(i[v]||o&&o[v]||f&&f[v]||r&&r[v])){var y=p(n,v);try{c(t,v,y)}catch(b){}}}}return t}},4164(e,t,n){"use strict";function o(e){var t,n,a="";if("string"==typeof e||"number"==typeof e)a+=e;else if("object"==typeof e)if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(n=o(e[t]))&&(a&&(a+=" "),a+=n)}else for(n in e)e[n]&&(a&&(a+=" "),a+=n);return a}n.d(t,{A:()=>a});const a=function(){for(var e,t,n=0,a="",i=arguments.length;n<i;n++)(e=arguments[n])&&(t=o(e))&&(a&&(a+=" "),a+=t);return a}},4351(e,t,n){"use strict";var o=n(6540),a=n(5338),i=n(545),s=n(4625),r=n(4784),l=n(8193);const c=[n(3001),n(119),n(6134),n(6294),n(1043)];var u=n(8328),d=n(6347),p=n(2831);var m=n(4848);function g(e){return"auto"===e||"dark"===e||"light"===e}function f({key:e="mantine-color-scheme-value"}={}){let t;return{get:t=>{if("undefined"==typeof window)return t;try{const n=window.localStorage.getItem(e);return g(n)?n:t}catch{return t}},set:t=>{try{window.localStorage.setItem(e,t)}catch(n){console.warn("[@mantine/core] Local storage color scheme manager was unable to save color scheme.",n)}},subscribe:n=>{t=t=>{t.storageArea===window.localStorage&&t.key===e&&g(t.newValue)&&n(t.newValue)},window.addEventListener("storage",t)},unsubscribe:()=>{window.removeEventListener("storage",t)},clear:()=>{window.localStorage.removeItem(e)}}}const h=(0,o.createContext)(null);function v(){const e=(0,o.useContext)(h);if(!e)throw new Error("[@mantine/core] MantineProvider was not found in tree");return e}function y(){return v().getStyleNonce}function b(e){return Object.keys(e)}function E(e){return"0rem"===e?"0rem":`calc(${e} * var(--mantine-scale))`}function S(e,{shouldScale:t=!1}={}){return function n(o){if(0===o||"0"===o)return`0${e}`;if("number"==typeof o){const n=`${o/16}${e}`;return t?E(n):n}if("string"==typeof o){if(""===o)return o;if(o.startsWith("calc(")||o.startsWith("clamp(")||o.includes("rgba("))return o;if(o.includes(","))return o.split(",").map(e=>n(e)).join(",");if(o.includes(" "))return o.split(" ").map(e=>n(e)).join(" ");const a=o.replace("px","");if(!Number.isNaN(Number(a))){const n=`${Number(a)/16}${e}`;return t?E(n):n}}return o}}const T=S("rem",{shouldScale:!0}),_=S("em");function C(e){return/^#?([0-9A-F]{3}){1,2}([0-9A-F]{2})?$/i.test(e)?function(e){let t=e.replace("#","");if(3===t.length){const e=t.split("");t=[e[0],e[0],e[1],e[1],e[2],e[2]].join("")}if(8===t.length){const e=parseInt(t.slice(6,8),16)/255;return{r:parseInt(t.slice(0,2),16),g:parseInt(t.slice(2,4),16),b:parseInt(t.slice(4,6),16),a:e}}const n=parseInt(t,16);return{r:n>>16&255,g:n>>8&255,b:255&n,a:1}}(e):e.startsWith("rgb")?function(e){const[t,n,o,a]=e.replace(/[^0-9,./]/g,"").split(/[/,]/).map(Number);return{r:t,g:n,b:o,a:void 0===a?1:a}}(e):e.startsWith("hsl")?function(e){const t=e.match(/^hsla?\(\s*(\d+)\s*,\s*(\d+%)\s*,\s*(\d+%)\s*(,\s*(0?\.\d+|\d+(\.\d+)?))?\s*\)$/i);if(!t)return{r:0,g:0,b:0,a:1};const n=parseInt(t[1],10),o=parseInt(t[2],10)/100,a=parseInt(t[3],10)/100,i=t[5]?parseFloat(t[5]):void 0,s=(1-Math.abs(2*a-1))*o,r=n/60,l=s*(1-Math.abs(r%2-1)),c=a-s/2;let u,d,p;return r>=0&&r<1?(u=s,d=l,p=0):r>=1&&r<2?(u=l,d=s,p=0):r>=2&&r<3?(u=0,d=s,p=l):r>=3&&r<4?(u=0,d=l,p=s):r>=4&&r<5?(u=l,d=0,p=s):(u=s,d=0,p=l),{r:Math.round(255*(u+c)),g:Math.round(255*(d+c)),b:Math.round(255*(p+c)),a:i||1}}(e):{r:0,g:0,b:0,a:1}}function I(e,t){if(e.startsWith("var("))return`color-mix(in srgb, ${e}, black ${100*t}%)`;const{r:n,g:o,b:a,a:i}=C(e),s=1-t,r=e=>Math.round(e*s);return`rgba(${r(n)}, ${r(o)}, ${r(a)}, ${i})`}function R(e,t){return"number"==typeof e.primaryShade?e.primaryShade:"dark"===t?e.primaryShade.dark:e.primaryShade.light}function A(e){return e<=.03928?e/12.92:((e+.055)/1.055)**2.4}function N(e){if(e.startsWith("oklch("))return(function(e){const t=e.match(/oklch\((.*?)%\s/);return t?parseFloat(t[1]):null}(e)||0)/100;const{r:t,g:n,b:o}=C(e),a=n/255,i=o/255;return.2126*A(t/255)+.7152*A(a)+.0722*A(i)}function x(e,t=.179){return!e.startsWith("var(")&&N(e)>t}function w({color:e,theme:t,colorScheme:n}){if("string"!=typeof e)throw new Error("[@mantine/core] Failed to parse color. Expected color to be a string, instead got "+typeof e);if("bright"===e)return{color:e,value:"dark"===n?t.white:t.black,shade:void 0,isThemeColor:!1,isLight:x("dark"===n?t.white:t.black,t.luminanceThreshold),variable:"--mantine-color-bright"};if("dimmed"===e)return{color:e,value:"dark"===n?t.colors.dark[2]:t.colors.gray[7],shade:void 0,isThemeColor:!1,isLight:x("dark"===n?t.colors.dark[2]:t.colors.gray[6],t.luminanceThreshold),variable:"--mantine-color-dimmed"};if("white"===e||"black"===e)return{color:e,value:"white"===e?t.white:t.black,shade:void 0,isThemeColor:!1,isLight:x("white"===e?t.white:t.black,t.luminanceThreshold),variable:`--mantine-color-${e}`};const[o,a]=e.split("."),i=a?Number(a):void 0,s=o in t.colors;if(s){const e=void 0!==i?t.colors[o][i]:t.colors[o][R(t,n||"light")];return{color:o,value:e,shade:i,isThemeColor:s,isLight:x(e,t.luminanceThreshold),variable:a?`--mantine-color-${o}-${i}`:`--mantine-color-${o}-filled`}}return{color:e,value:e,isThemeColor:s,isLight:x(e,t.luminanceThreshold),shade:i,variable:void 0}}function P(e,t){const n=w({color:e||t.primaryColor,theme:t});return n.variable?`var(${n.variable})`:e}function k(e,t){const n={from:e?.from||t.defaultGradient.from,to:e?.to||t.defaultGradient.to,deg:e?.deg??t.defaultGradient.deg??0},o=P(n.from,t),a=P(n.to,t);return`linear-gradient(${n.deg}deg, ${o} 0%, ${a} 100%)`}function O(e,t){if("string"!=typeof e||t>1||t<0)return"rgba(0, 0, 0, 1)";if(e.startsWith("var(")){return`color-mix(in srgb, ${e}, transparent ${100*(1-t)}%)`}if(e.startsWith("oklch"))return e.includes("/")?e.replace(/\/\s*[\d.]+\s*\)/,`/ ${t})`):e.replace(")",` / ${t})`);const{r:n,g:o,b:a}=C(e);return`rgba(${n}, ${o}, ${a}, ${t})`}const L=O,D="-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji",M={scale:1,fontSmoothing:!0,focusRing:"auto",white:"#fff",black:"#000",colors:{dark:["#C9C9C9","#b8b8b8","#828282","#696969","#424242","#3b3b3b","#2e2e2e","#242424","#1f1f1f","#141414"],gray:["#f8f9fa","#f1f3f5","#e9ecef","#dee2e6","#ced4da","#adb5bd","#868e96","#495057","#343a40","#212529"],red:["#fff5f5","#ffe3e3","#ffc9c9","#ffa8a8","#ff8787","#ff6b6b","#fa5252","#f03e3e","#e03131","#c92a2a"],pink:["#fff0f6","#ffdeeb","#fcc2d7","#faa2c1","#f783ac","#f06595","#e64980","#d6336c","#c2255c","#a61e4d"],grape:["#f8f0fc","#f3d9fa","#eebefa","#e599f7","#da77f2","#cc5de8","#be4bdb","#ae3ec9","#9c36b5","#862e9c"],violet:["#f3f0ff","#e5dbff","#d0bfff","#b197fc","#9775fa","#845ef7","#7950f2","#7048e8","#6741d9","#5f3dc4"],indigo:["#edf2ff","#dbe4ff","#bac8ff","#91a7ff","#748ffc","#5c7cfa","#4c6ef5","#4263eb","#3b5bdb","#364fc7"],blue:["#e7f5ff","#d0ebff","#a5d8ff","#74c0fc","#4dabf7","#339af0","#228be6","#1c7ed6","#1971c2","#1864ab"],cyan:["#e3fafc","#c5f6fa","#99e9f2","#66d9e8","#3bc9db","#22b8cf","#15aabf","#1098ad","#0c8599","#0b7285"],teal:["#e6fcf5","#c3fae8","#96f2d7","#63e6be","#38d9a9","#20c997","#12b886","#0ca678","#099268","#087f5b"],green:["#ebfbee","#d3f9d8","#b2f2bb","#8ce99a","#69db7c","#51cf66","#40c057","#37b24d","#2f9e44","#2b8a3e"],lime:["#f4fce3","#e9fac8","#d8f5a2","#c0eb75","#a9e34b","#94d82d","#82c91e","#74b816","#66a80f","#5c940d"],yellow:["#fff9db","#fff3bf","#ffec99","#ffe066","#ffd43b","#fcc419","#fab005","#f59f00","#f08c00","#e67700"],orange:["#fff4e6","#ffe8cc","#ffd8a8","#ffc078","#ffa94d","#ff922b","#fd7e14","#f76707","#e8590c","#d9480f"]},primaryShade:{light:6,dark:8},primaryColor:"blue",variantColorResolver:({color:e,theme:t,variant:n,gradient:o,autoContrast:a})=>{const i=w({color:e,theme:t}),s="boolean"==typeof a?a:t.autoContrast;if("none"===n)return{background:"transparent",hover:"transparent",color:"inherit",border:"none"};if("filled"===n){const t=s&&i.isLight?"var(--mantine-color-black)":"var(--mantine-color-white)";return i.isThemeColor?void 0===i.shade?{background:`var(--mantine-color-${e}-filled)`,hover:`var(--mantine-color-${e}-filled-hover)`,color:t,border:`${T(1)} solid transparent`}:{background:`var(--mantine-color-${i.color}-${i.shade})`,hover:`var(--mantine-color-${i.color}-${9===i.shade?8:i.shade+1})`,color:t,border:`${T(1)} solid transparent`}:{background:e,hover:I(e,.1),color:t,border:`${T(1)} solid transparent`}}if("light"===n){if(i.isThemeColor){if(void 0===i.shade)return{background:`var(--mantine-color-${e}-light)`,hover:`var(--mantine-color-${e}-light-hover)`,color:`var(--mantine-color-${e}-light-color)`,border:`${T(1)} solid transparent`};const n=t.colors[i.color][i.shade];return{background:O(n,.1),hover:O(n,.12),color:`var(--mantine-color-${i.color}-${Math.min(i.shade,6)})`,border:`${T(1)} solid transparent`}}return{background:O(e,.1),hover:O(e,.12),color:e,border:`${T(1)} solid transparent`}}if("outline"===n)return i.isThemeColor?void 0===i.shade?{background:"transparent",hover:`var(--mantine-color-${e}-outline-hover)`,color:`var(--mantine-color-${e}-outline)`,border:`${T(1)} solid var(--mantine-color-${e}-outline)`}:{background:"transparent",hover:O(t.colors[i.color][i.shade],.05),color:`var(--mantine-color-${i.color}-${i.shade})`,border:`${T(1)} solid var(--mantine-color-${i.color}-${i.shade})`}:{background:"transparent",hover:O(e,.05),color:e,border:`${T(1)} solid ${e}`};if("subtle"===n){if(i.isThemeColor){if(void 0===i.shade)return{background:"transparent",hover:`var(--mantine-color-${e}-light-hover)`,color:`var(--mantine-color-${e}-light-color)`,border:`${T(1)} solid transparent`};return{background:"transparent",hover:O(t.colors[i.color][i.shade],.12),color:`var(--mantine-color-${i.color}-${Math.min(i.shade,6)})`,border:`${T(1)} solid transparent`}}return{background:"transparent",hover:O(e,.12),color:e,border:`${T(1)} solid transparent`}}return"transparent"===n?i.isThemeColor?void 0===i.shade?{background:"transparent",hover:"transparent",color:`var(--mantine-color-${e}-light-color)`,border:`${T(1)} solid transparent`}:{background:"transparent",hover:"transparent",color:`var(--mantine-color-${i.color}-${Math.min(i.shade,6)})`,border:`${T(1)} solid transparent`}:{background:"transparent",hover:"transparent",color:e,border:`${T(1)} solid transparent`}:"white"===n?i.isThemeColor?void 0===i.shade?{background:"var(--mantine-color-white)",hover:I(t.white,.01),color:`var(--mantine-color-${e}-filled)`,border:`${T(1)} solid transparent`}:{background:"var(--mantine-color-white)",hover:I(t.white,.01),color:`var(--mantine-color-${i.color}-${i.shade})`,border:`${T(1)} solid transparent`}:{background:"var(--mantine-color-white)",hover:I(t.white,.01),color:e,border:`${T(1)} solid transparent`}:"gradient"===n?{background:k(o,t),hover:k(o,t),color:"var(--mantine-color-white)",border:"none"}:"default"===n?{background:"var(--mantine-color-default)",hover:"var(--mantine-color-default-hover)",color:"var(--mantine-color-default-color)",border:`${T(1)} solid var(--mantine-color-default-border)`}:{}},autoContrast:!1,luminanceThreshold:.3,fontFamily:D,fontFamilyMonospace:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace",respectReducedMotion:!1,cursorType:"default",defaultGradient:{from:"blue",to:"cyan",deg:45},defaultRadius:"sm",activeClassName:"mantine-active",focusClassName:"",headings:{fontFamily:D,fontWeight:"700",textWrap:"wrap",sizes:{h1:{fontSize:T(34),lineHeight:"1.3"},h2:{fontSize:T(26),lineHeight:"1.35"},h3:{fontSize:T(22),lineHeight:"1.4"},h4:{fontSize:T(18),lineHeight:"1.45"},h5:{fontSize:T(16),lineHeight:"1.5"},h6:{fontSize:T(14),lineHeight:"1.5"}}},fontSizes:{xs:T(12),sm:T(14),md:T(16),lg:T(18),xl:T(20)},lineHeights:{xs:"1.4",sm:"1.45",md:"1.55",lg:"1.6",xl:"1.65"},radius:{xs:T(2),sm:T(4),md:T(8),lg:T(16),xl:T(32)},spacing:{xs:T(10),sm:T(12),md:T(16),lg:T(20),xl:T(32)},breakpoints:{xs:"36em",sm:"48em",md:"62em",lg:"75em",xl:"88em"},shadows:{xs:`0 ${T(1)} ${T(3)} rgba(0, 0, 0, 0.05), 0 ${T(1)} ${T(2)} rgba(0, 0, 0, 0.1)`,sm:`0 ${T(1)} ${T(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${T(10)} ${T(15)} ${T(-5)}, rgba(0, 0, 0, 0.04) 0 ${T(7)} ${T(7)} ${T(-5)}`,md:`0 ${T(1)} ${T(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${T(20)} ${T(25)} ${T(-5)}, rgba(0, 0, 0, 0.04) 0 ${T(10)} ${T(10)} ${T(-5)}`,lg:`0 ${T(1)} ${T(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${T(28)} ${T(23)} ${T(-7)}, rgba(0, 0, 0, 0.04) 0 ${T(12)} ${T(12)} ${T(-7)}`,xl:`0 ${T(1)} ${T(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${T(36)} ${T(28)} ${T(-7)}, rgba(0, 0, 0, 0.04) 0 ${T(17)} ${T(17)} ${T(-7)}`},other:{},components:{}};function U(e){return e&&"object"==typeof e&&!Array.isArray(e)}function F(e,t){const n={...e},o=t;return U(e)&&U(t)&&Object.keys(t).forEach(t=>{U(o[t])?n[t]=t in e?F(n[t],o[t]):o[t]:n[t]=o[t]}),n}const j="[@mantine/core] MantineProvider: Invalid theme.primaryShade, it accepts only 0-9 integers or an object { light: 0-9, dark: 0-9 }";function B(e){return!(e<0||e>9)&&parseInt(e.toString(),10)===e}function q(e){if(!(e.primaryColor in e.colors))throw new Error("[@mantine/core] MantineProvider: Invalid theme.primaryColor, it accepts only key of theme.colors, learn more \u2013 https://mantine.dev/theming/colors/#primary-color");if(!("object"!=typeof e.primaryShade||B(e.primaryShade.dark)&&B(e.primaryShade.light)))throw new Error(j);if("number"==typeof e.primaryShade&&!B(e.primaryShade))throw new Error(j)}const G=(0,o.createContext)(null);function H(){const e=(0,o.useContext)(G);if(!e)throw new Error("@mantine/core: MantineProvider was not found in component tree, make sure you have it in your app");return e}function z({theme:e,children:t,inherit:n=!0}){const a=(0,o.useContext)(G)||M,i=(0,o.useMemo)(()=>function(e,t){if(!t)return q(e),e;const n=F(e,t);return t.fontFamily&&!t.headings?.fontFamily&&(n.headings.fontFamily=t.fontFamily),q(n),n}(n?a:M,e),[e,a,n]);return(0,m.jsx)(G.Provider,{value:i,children:t})}function W(){const e=H(),t=y(),n=b(e.breakpoints).reduce((t,n)=>{const o=e.breakpoints[n].includes("px"),a=function(e){const t=function(e){return"string"==typeof e&&e.includes("var(--mantine-scale)")?e.match(/^calc\((.*?)\)$/)?.[1].split("*")[0].trim():e}(e);return"number"==typeof t?t:"string"==typeof t?t.includes("calc")||t.includes("var")?t:t.includes("px")?Number(t.replace("px","")):t.includes("rem")?16*Number(t.replace("rem","")):t.includes("em")?16*Number(t.replace("em","")):Number(t):NaN}(e.breakpoints[n]);return`${t}@media (max-width: ${o?a-.1+"px":_(a-.1)}) {.mantine-visible-from-${n} {display: none !important;}}@media (min-width: ${o?`${a}px`:_(a)}) {.mantine-hidden-from-${n} {display: none !important;}}`},"");return(0,m.jsx)("style",{"data-mantine-styles":"classes",nonce:t?.(),dangerouslySetInnerHTML:{__html:n}})}function K(e){return Object.entries(e).map(([e,t])=>`${e}: ${t};`).join("")}function V(e,t){const n=t?[t]:[":root",":host"],o=K(e.variables),a=o?`${n.join(", ")}{${o}}`:"",i=K(e.dark),s=K(e.light),r=e=>n.map(t=>":host"===t?`${t}([data-mantine-color-scheme="${e}"])`:`${t}[data-mantine-color-scheme="${e}"]`).join(", ");return`${a}\n\n${i?`${r("dark")}{${i}}`:""}\n\n${s?`${r("light")}{${s}}`:""}`}function $(e,t){return function({color:e,theme:t,autoContrast:n}){return("boolean"==typeof n?n:t.autoContrast)&&w({color:e||t.primaryColor,theme:t}).isLight?"var(--mantine-color-black)":"var(--mantine-color-white)"}({color:e.colors[e.primaryColor][R(e,t)],theme:e,autoContrast:null})}function Y({theme:e,color:t,colorScheme:n,name:o=t,withColorValues:a=!0}){if(!e.colors[t])return{};if("light"===n){const n=R(e,"light"),i={[`--mantine-color-${o}-text`]:`var(--mantine-color-${o}-filled)`,[`--mantine-color-${o}-filled`]:`var(--mantine-color-${o}-${n})`,[`--mantine-color-${o}-filled-hover`]:`var(--mantine-color-${o}-${9===n?8:n+1})`,[`--mantine-color-${o}-light`]:L(e.colors[t][n],.1),[`--mantine-color-${o}-light-hover`]:L(e.colors[t][n],.12),[`--mantine-color-${o}-light-color`]:`var(--mantine-color-${o}-${n})`,[`--mantine-color-${o}-outline`]:`var(--mantine-color-${o}-${n})`,[`--mantine-color-${o}-outline-hover`]:L(e.colors[t][n],.05)};return a?{[`--mantine-color-${o}-0`]:e.colors[t][0],[`--mantine-color-${o}-1`]:e.colors[t][1],[`--mantine-color-${o}-2`]:e.colors[t][2],[`--mantine-color-${o}-3`]:e.colors[t][3],[`--mantine-color-${o}-4`]:e.colors[t][4],[`--mantine-color-${o}-5`]:e.colors[t][5],[`--mantine-color-${o}-6`]:e.colors[t][6],[`--mantine-color-${o}-7`]:e.colors[t][7],[`--mantine-color-${o}-8`]:e.colors[t][8],[`--mantine-color-${o}-9`]:e.colors[t][9],...i}:i}const i=R(e,"dark"),s={[`--mantine-color-${o}-text`]:`var(--mantine-color-${o}-4)`,[`--mantine-color-${o}-filled`]:`var(--mantine-color-${o}-${i})`,[`--mantine-color-${o}-filled-hover`]:`var(--mantine-color-${o}-${9===i?8:i+1})`,[`--mantine-color-${o}-light`]:L(e.colors[t][Math.max(0,i-2)],.15),[`--mantine-color-${o}-light-hover`]:L(e.colors[t][Math.max(0,i-2)],.2),[`--mantine-color-${o}-light-color`]:`var(--mantine-color-${o}-${Math.max(i-5,0)})`,[`--mantine-color-${o}-outline`]:`var(--mantine-color-${o}-${Math.max(i-4,0)})`,[`--mantine-color-${o}-outline-hover`]:L(e.colors[t][Math.max(i-4,0)],.05)};return a?{[`--mantine-color-${o}-0`]:e.colors[t][0],[`--mantine-color-${o}-1`]:e.colors[t][1],[`--mantine-color-${o}-2`]:e.colors[t][2],[`--mantine-color-${o}-3`]:e.colors[t][3],[`--mantine-color-${o}-4`]:e.colors[t][4],[`--mantine-color-${o}-5`]:e.colors[t][5],[`--mantine-color-${o}-6`]:e.colors[t][6],[`--mantine-color-${o}-7`]:e.colors[t][7],[`--mantine-color-${o}-8`]:e.colors[t][8],[`--mantine-color-${o}-9`]:e.colors[t][9],...s}:s}function J(e,t,n){b(t).forEach(o=>Object.assign(e,{[`--mantine-${n}-${o}`]:t[o]}))}z.displayName="@mantine/core/MantineThemeProvider";const X=e=>{const t=R(e,"light"),n=e.defaultRadius in e.radius?e.radius[e.defaultRadius]:T(e.defaultRadius),o={variables:{"--mantine-z-index-app":"100","--mantine-z-index-modal":"200","--mantine-z-index-popover":"300","--mantine-z-index-overlay":"400","--mantine-z-index-max":"9999","--mantine-scale":e.scale.toString(),"--mantine-cursor-type":e.cursorType,"--mantine-webkit-font-smoothing":e.fontSmoothing?"antialiased":"unset","--mantine-moz-font-smoothing":e.fontSmoothing?"grayscale":"unset","--mantine-color-white":e.white,"--mantine-color-black":e.black,"--mantine-line-height":e.lineHeights.md,"--mantine-font-family":e.fontFamily,"--mantine-font-family-monospace":e.fontFamilyMonospace,"--mantine-font-family-headings":e.headings.fontFamily,"--mantine-heading-font-weight":e.headings.fontWeight,"--mantine-heading-text-wrap":e.headings.textWrap,"--mantine-radius-default":n,"--mantine-primary-color-filled":`var(--mantine-color-${e.primaryColor}-filled)`,"--mantine-primary-color-filled-hover":`var(--mantine-color-${e.primaryColor}-filled-hover)`,"--mantine-primary-color-light":`var(--mantine-color-${e.primaryColor}-light)`,"--mantine-primary-color-light-hover":`var(--mantine-color-${e.primaryColor}-light-hover)`,"--mantine-primary-color-light-color":`var(--mantine-color-${e.primaryColor}-light-color)`},light:{"--mantine-color-scheme":"light","--mantine-primary-color-contrast":$(e,"light"),"--mantine-color-bright":"var(--mantine-color-black)","--mantine-color-text":e.black,"--mantine-color-body":e.white,"--mantine-color-error":"var(--mantine-color-red-6)","--mantine-color-placeholder":"var(--mantine-color-gray-5)","--mantine-color-anchor":`var(--mantine-color-${e.primaryColor}-${t})`,"--mantine-color-default":"var(--mantine-color-white)","--mantine-color-default-hover":"var(--mantine-color-gray-0)","--mantine-color-default-color":"var(--mantine-color-black)","--mantine-color-default-border":"var(--mantine-color-gray-4)","--mantine-color-dimmed":"var(--mantine-color-gray-6)","--mantine-color-disabled":"var(--mantine-color-gray-2)","--mantine-color-disabled-color":"var(--mantine-color-gray-5)","--mantine-color-disabled-border":"var(--mantine-color-gray-3)"},dark:{"--mantine-color-scheme":"dark","--mantine-primary-color-contrast":$(e,"dark"),"--mantine-color-bright":"var(--mantine-color-white)","--mantine-color-text":"var(--mantine-color-dark-0)","--mantine-color-body":"var(--mantine-color-dark-7)","--mantine-color-error":"var(--mantine-color-red-8)","--mantine-color-placeholder":"var(--mantine-color-dark-3)","--mantine-color-anchor":`var(--mantine-color-${e.primaryColor}-4)`,"--mantine-color-default":"var(--mantine-color-dark-6)","--mantine-color-default-hover":"var(--mantine-color-dark-5)","--mantine-color-default-color":"var(--mantine-color-white)","--mantine-color-default-border":"var(--mantine-color-dark-4)","--mantine-color-dimmed":"var(--mantine-color-dark-2)","--mantine-color-disabled":"var(--mantine-color-dark-6)","--mantine-color-disabled-color":"var(--mantine-color-dark-3)","--mantine-color-disabled-border":"var(--mantine-color-dark-4)"}};J(o.variables,e.breakpoints,"breakpoint"),J(o.variables,e.spacing,"spacing"),J(o.variables,e.fontSizes,"font-size"),J(o.variables,e.lineHeights,"line-height"),J(o.variables,e.shadows,"shadow"),J(o.variables,e.radius,"radius"),e.colors[e.primaryColor].forEach((t,n)=>{o.variables[`--mantine-primary-color-${n}`]=`var(--mantine-color-${e.primaryColor}-${n})`}),b(e.colors).forEach(t=>{const n=e.colors[t];if(function(e){return!!e&&"object"==typeof e&&"mantine-virtual-color"in e}(n))return Object.assign(o.light,Y({theme:e,name:n.name,color:n.light,colorScheme:"light",withColorValues:!0})),void Object.assign(o.dark,Y({theme:e,name:n.name,color:n.dark,colorScheme:"dark",withColorValues:!0}));n.forEach((e,n)=>{o.variables[`--mantine-color-${t}-${n}`]=e}),Object.assign(o.light,Y({theme:e,color:t,colorScheme:"light",withColorValues:!1})),Object.assign(o.dark,Y({theme:e,color:t,colorScheme:"dark",withColorValues:!1}))});const a=e.headings.sizes;return b(a).forEach(t=>{o.variables[`--mantine-${t}-font-size`]=a[t].fontSize,o.variables[`--mantine-${t}-line-height`]=a[t].lineHeight,o.variables[`--mantine-${t}-font-weight`]=a[t].fontWeight||e.headings.fontWeight}),o};const Q=X(M);function Z({cssVariablesSelector:e,deduplicateCssVariables:t}){const n=H(),o=y(),a=function({theme:e,generator:t}){const n=X(e),o=t?.(e);return o?F(n,o):n}({theme:n,generator:v().cssVariablesResolver}),i=(void 0===e||":root"===e||":host"===e)&&t,s=V(i?function(e){const t={variables:{},light:{},dark:{}};return b(e.variables).forEach(n=>{Q.variables[n]!==e.variables[n]&&(t.variables[n]=e.variables[n])}),b(e.light).forEach(n=>{Q.light[n]!==e.light[n]&&(t.light[n]=e.light[n])}),b(e.dark).forEach(n=>{Q.dark[n]!==e.dark[n]&&(t.dark[n]=e.dark[n])}),t}(a):a,e);return s?(0,m.jsx)("style",{"data-mantine-styles":!0,nonce:o?.(),dangerouslySetInnerHTML:{__html:`${s}${i?"":(r=e,V({variables:{},dark:{"--mantine-color-scheme":"dark"},light:{"--mantine-color-scheme":"light"}},r))}`}}):null;var r}Z.displayName="@mantine/CssVariables";const ee="undefined"!=typeof document?o.useLayoutEffect:o.useEffect;function te(e,t){const n="undefined"!=typeof window&&"matchMedia"in window&&window.matchMedia("(prefers-color-scheme: dark)")?.matches,o="auto"!==e?e:n?"dark":"light";t()?.setAttribute("data-mantine-color-scheme",o)}function ne({theme:e,children:t,getStyleNonce:n,withStaticClasses:a=!0,withGlobalClasses:i=!0,deduplicateCssVariables:s=!0,withCssVariables:r=!0,cssVariablesSelector:l,classNamesPrefix:c="mantine",colorSchemeManager:u=f(),defaultColorScheme:d="light",getRootElement:p=()=>document.documentElement,cssVariablesResolver:g,forceColorScheme:v,stylesTransform:y,env:b}){const{colorScheme:E,setColorScheme:S,clearColorScheme:T}=function({manager:e,defaultColorScheme:t,getRootElement:n,forceColorScheme:a}){const i=(0,o.useRef)(null),[s,r]=(0,o.useState)(()=>e.get(t)),l=a||s,c=(0,o.useCallback)(t=>{a||(te(t,n),r(t),e.set(t))},[e.set,l,a]),u=(0,o.useCallback)(()=>{r(t),te(t,n),e.clear()},[e.clear,t]);return(0,o.useEffect)(()=>(e.subscribe(c),e.unsubscribe),[e.subscribe,e.unsubscribe]),ee(()=>{te(e.get(t),n)},[]),(0,o.useEffect)(()=>{if(a)return te(a,n),()=>{};void 0===a&&te(s,n),"undefined"!=typeof window&&"matchMedia"in window&&(i.current=window.matchMedia("(prefers-color-scheme: dark)"));const e=e=>{"auto"===s&&te(e.matches?"dark":"light",n)};return i.current?.addEventListener("change",e),()=>i.current?.removeEventListener("change",e)},[s,a]),{colorScheme:l,setColorScheme:c,clearColorScheme:u}}({defaultColorScheme:d,forceColorScheme:v,manager:u,getRootElement:p});return function({respectReducedMotion:e,getRootElement:t}){ee(()=>{e&&t()?.setAttribute("data-respect-reduced-motion","true")},[e])}({respectReducedMotion:e?.respectReducedMotion||!1,getRootElement:p}),(0,m.jsx)(h.Provider,{value:{colorScheme:E,setColorScheme:S,clearColorScheme:T,getRootElement:p,classNamesPrefix:c,getStyleNonce:n,cssVariablesResolver:g,cssVariablesSelector:l??":root",withStaticClasses:a,stylesTransform:y,env:b},children:(0,m.jsxs)(z,{theme:e,children:[r&&(0,m.jsx)(Z,{cssVariablesSelector:l,deduplicateCssVariables:s}),i&&(0,m.jsx)(W,{}),t]})})}ne.displayName="@mantine/core/MantineProvider";var oe=n(961),ae=n(5390);function ie(){const[e,t]=(0,o.useState)(!1),[n,a]=(0,o.useState)("closed"),[i,s]=(0,o.useState)(""),r=(0,d.W6)(),l=(0,o.useRef)(null),c=(0,o.useRef)(null),u=(0,o.useRef)(null),p=()=>{c.current=(()=>{if("undefined"==typeof document)return null;const e=document.querySelector(".ce-navbar-search-trigger");return e?e.getBoundingClientRect():null})(),u.current=null,t(!0),a("opening")},g=t=>{e&&"closing"!==n&&(u.current=t||null,a("closing"))};(0,o.useEffect)(()=>{const e=e=>{(function(e){const t=(e.key||"").toLowerCase();return(e.metaKey||e.ctrlKey)&&("k"===t||" "===t||"Space"===e.code)})(e)&&(e.preventDefault(),p())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[e,n]),(0,o.useEffect)(()=>{const e=e=>{const t=e.target;t instanceof Element&&t.closest(".ce-navbar-search-trigger")&&(e.preventDefault(),p())};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[e,n]),(0,o.useEffect)(()=>{if(!e)return;const t=e=>{"Escape"===e.key&&g()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,n]),(0,o.useEffect)(()=>{if(!e||!l.current)return;const o=l.current,i=o.getBoundingClientRect(),s=c.current,r=i.left+i.width/2,d=i.top+i.height/2,p=(s?s.left+s.width/2:r)-r,m=(s?s.top+s.height/2:d)-d,g=s?Math.max(.16,Math.min(.5,s.width/i.width)):.9,f=s?Math.max(.16,Math.min(.5,s.height/i.height)):.9;let h=null;return"opening"===n?(h=o.animate([{transform:`translate(${p}px, ${m}px) scale(${g}, ${f})`,opacity:.22,filter:"blur(2px)"},{transform:"translate(0px, 0px) scale(1, 1)",opacity:1,filter:"blur(0px)"}],{duration:340,easing:"cubic-bezier(0.2, 0.8, 0.2, 1)",fill:"forwards"}),h.onfinish=()=>a("open")):"closing"===n&&(h=o.animate([{transform:"translate(0px, 0px) scale(1, 1)",opacity:1,filter:"blur(0px)"},{transform:`translate(${p}px, ${m}px) scale(${g}, ${f})`,opacity:.06,filter:"blur(2px)"}],{duration:240,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards"}),h.onfinish=()=>{t(!1),a("closed");const e=u.current;u.current=null,e&&e()}),()=>{h&&h.cancel()}},[e,n]);const f=(0,o.useMemo)(()=>(0,ae._)(i,200),[i]),h=(0,o.useMemo)(()=>String(i||"").split(/[\s:/().,_-]+/).map(e=>e.trim()).filter(Boolean).filter(e=>e.length>=3).slice(0,4),[i]),v=e&&"undefined"!=typeof document?(0,oe.createPortal)((0,m.jsx)("div",{className:"ce-search-overlay",role:"dialog","aria-modal":"true",children:(0,m.jsxs)("div",{ref:l,className:"ce-search-card ce-search-card--animated",onClick:e=>e.stopPropagation(),children:[(0,m.jsxs)("div",{className:"ce-search-head",children:[(0,m.jsx)("div",{className:"ce-search-title",children:"Search Docs"}),(0,m.jsx)("div",{className:"ce-search-head-right",children:(0,m.jsxs)("div",{className:"ce-search-count",children:[(0,ae.V)()," indexed pages"]})})]}),(0,m.jsx)("input",{autoFocus:!0,className:"ce-search-input",placeholder:"Search classes, methods, tables, files...",value:i,onChange:e=>s(e.target.value)}),h.length>0&&(0,m.jsx)("div",{className:"ce-search-badges ce-search-badges-query",children:h.map(e=>(0,m.jsx)("span",{className:"ce-search-badge",children:e},`q-${e}`))}),(0,m.jsxs)("div",{className:"ce-search-results",children:[i&&0===f.length&&(0,m.jsxs)("div",{className:"ce-search-empty",children:["No results for \u201c",i,"\u201d."]}),f.map(e=>{const t=function(e,t){const n=[t,e.title,e.permalink,e.excerpt].filter(Boolean).join(" ").match(/(?:ce_[a-z0-9_]+|@[A-Z][A-Za-z0-9_]+|[A-Z][A-Za-z0-9_$.]*(?:Step|Resolver|Factory|Controller|Service|Repository|Session|Config|Hook|Pipeline|Engine|Transformer|Interceptor|Provider)|[a-zA-Z_][a-zA-Z0-9_$.]*\([^)]*\)|[a-zA-Z0-9_.\/-]+\.(?:java|mdx|md|sql|yml|yaml|json|js|jsx|ts|tsx))/g)||[];return[...new Set(n.map(e=>e.trim()))].slice(0,3)}(e,i);return(0,m.jsxs)("button",{className:"ce-search-item",type:"button",onClick:()=>{return t=e.permalink,void g(()=>{s(""),r.push(t)});var t},children:[(0,m.jsx)("span",{className:"ce-search-item-title",children:e.title}),(0,m.jsx)("span",{className:"ce-search-item-path",children:e.permalink}),t.length>0&&(0,m.jsx)("span",{className:"ce-search-item-badges",children:t.map(t=>(0,m.jsx)("span",{className:"ce-search-item-badge",children:t},`${e.id}-${t}`))}),(0,m.jsx)("span",{className:"ce-search-item-excerpt",children:e.excerpt})]},`${e.id}-${e.permalink}`)})]}),(0,m.jsxs)("div",{className:"ce-search-foot",children:[!i&&(0,m.jsx)("div",{className:"ce-search-close-hint",children:"Type to search. Shortcut: Cmd/Ctrl + K"}),(0,m.jsx)("div",{className:"ce-search-close-hint",children:"Press Esc to close"})]})]})}),document.body):null;return(0,m.jsx)(m.Fragment,{children:v})}function se(e){return String(e||"").replace(/\s+/g," ").replace(/^`|`$/g,"").replace(/^package:\s*/i,"").replace(/^file:\s*/i,"").replace(/^[\s"'`([{]+/,"").replace(/[\s"'`)\]}:;,.!?]+$/,"").trim()}function re(e){return!(!e||e.length<3||e.length>140)&&(!!/^ce_[a-z0-9_*]+$/i.test(e)||(!!/^CE_[A-Z0-9_]+$/.test(e)||(!!/convengine/i.test(e)||(!!/\b(com\.github\.salilvnair\.convengine)\b/.test(e)||(!!/^[A-Z][A-Za-z0-9_$.]*(Step|Resolver|Factory|Controller|Service|Repository|Session|Config|Hook|Pipeline|Engine|Transformer|Interceptor|Provider|Client)$/.test(e)||(!!/^[A-Z][A-Za-z0-9_$.]{3,}$/.test(e)||(!!/^[a-zA-Z_][a-zA-Z0-9_$.]*\([^)]*\)(\.[a-zA-Z_][a-zA-Z0-9_$.]*\([^)]*\))*$/.test(e)||(!!/^[a-zA-Z0-9_.-]+\.(java|mdx|md|sql|yml|yaml|json|js|jsx|ts|tsx)$/.test(e)||(!!/[\/][a-zA-Z0-9_.\/-]+\.(java|mdx|md|sql|yml|yaml|json|js|jsx|ts|tsx)$/.test(e)||!!/^@[A-Z][A-Za-z0-9_]+$/.test(e))))))))))}function le(e){return(0,ae._)(e,3).length>1}function ce(){const[e,t]=(0,o.useState)(!1),[n,a]=(0,o.useState)(""),i=(0,d.W6)();(0,o.useEffect)(()=>{const e=e=>{const n=e.target;if(!(n instanceof Element))return;if(n.closest("a, button, .ce-search-card"))return;const o=function(e){if(!e)return null;const t=e.closest(".ce-file-ref, .ce-method-ref, .ce-table-cell-content, code");return t?t.closest("pre, .theme-code-block")?null:se(t.textContent)||null:null}(n);if(!o)return;const i=function(e){const t=se(e);if(t&&le(t))return t;const n=new Set,o=e=>{const t=se(e);t&&t.length>=3&&n.add(t)};o(t),String(e||"").split(/[\s,;|]+/).forEach(o),(String(e||"").match(/(?:ce_[a-zA-Z0-9_*]+|@[A-Z][A-Za-z0-9_]+|[A-Za-z_][A-Za-z0-9_$.]*\([^)]*\)|[A-Z][A-Za-z0-9_$.]{3,}|[a-zA-Z0-9_.\/-]+\.(?:java|mdx|md|sql|yml|yaml|json|js|jsx|ts|tsx))/g)||[]).forEach(o);const a=[...n].sort((e,t)=>t.length-e.length);for(const i of a)if((re(i)||le(i))&&le(i))return i;return null}(o);i&&(e.preventDefault(),a(i),t(!0))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),(0,o.useEffect)(()=>{if(!e)return;const n=e=>{"Escape"===e.key&&t(!1)};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[e]);const s=(0,o.useMemo)(()=>(0,ae._)(n,200),[n]),r=(0,o.useMemo)(()=>se(n).split(/[\s:/().,_-]+/).map(e=>e.trim()).filter(Boolean).filter(e=>e.length>=3).slice(0,4),[n]);return e&&"undefined"!=typeof document?(0,oe.createPortal)((0,m.jsx)("div",{className:"ce-search-overlay",role:"dialog","aria-modal":"true",children:(0,m.jsxs)("div",{className:"ce-search-card ce-term-card",onClick:e=>e.stopPropagation(),children:[(0,m.jsxs)("div",{className:"ce-search-head",children:[(0,m.jsx)("div",{className:"ce-search-title",children:"References"}),(0,m.jsx)("div",{className:"ce-search-close-hint",children:"Press Esc to close"})]}),(0,m.jsx)("div",{className:"ce-search-term",children:n}),r.length>0&&(0,m.jsx)("div",{className:"ce-search-badges",children:r.map(e=>(0,m.jsx)("span",{className:"ce-search-badge",children:e},`${n}-${e}`))}),(0,m.jsx)("div",{className:"ce-search-results",children:0===s.length?(0,m.jsx)("div",{className:"ce-search-empty",children:"No matching pages found."}):s.map(e=>{const o=function(e,t){const n=[t,e.title,e.permalink,e.excerpt].filter(Boolean).join(" ").match(/(?:ce_[a-z0-9_]+|@[A-Z][A-Za-z0-9_]+|[A-Z][A-Za-z0-9_$.]*(?:Step|Resolver|Factory|Controller|Service|Repository|Session|Config|Hook|Pipeline|Engine|Transformer|Interceptor|Provider)|[a-zA-Z_][a-zA-Z0-9_$.]*\([^)]*\)|[a-zA-Z0-9_.\/-]+\.(?:java|mdx|md|sql|yml|yaml|json|js|jsx|ts|tsx))/g)||[];return[...new Set(n.map(e=>e.trim()))].slice(0,3)}(e,n);return(0,m.jsxs)("button",{className:"ce-search-item",type:"button",onClick:()=>{return n=e.permalink,t(!1),void i.push(n);var n},children:[(0,m.jsx)("span",{className:"ce-search-item-title",children:e.title}),(0,m.jsx)("span",{className:"ce-search-item-path",children:e.permalink}),o.length>0&&(0,m.jsx)("span",{className:"ce-search-item-badges",children:o.map(t=>(0,m.jsx)("span",{className:"ce-search-item-badge",children:t},`${e.id}-${t}`))}),(0,m.jsx)("span",{className:"ce-search-item-excerpt",children:e.excerpt})]},`${n}-${e.id}`)})})]})}),document.body):null}var ue=n(478),de=n(7295);const pe={primaryColor:"blue"},me={v1:new Set((ue||[]).map(e=>e?.permalink).filter(Boolean)),v2:new Set((de||[]).map(e=>e?.permalink).filter(Boolean))};function ge(e=""){return"/"!==e&&e.endsWith("/")?e.slice(0,-1):e}function fe(e,t){const n=ge(e||"");if(!n.startsWith("/docs/"))return`/docs/${t}/overview`;const o=n.startsWith("/docs/v1"),a=n.startsWith("/docs/v2");if(!o&&!a)return`/docs/${t}/overview`;const i=o?"/docs/v1":"/docs/v2",s=`/docs/${t}`,r=`${s}${n.slice(i.length)||""}`;return function(e,t){const n=ge(t);return me[e]?.has(n)||!1}(t,r)?r:`${s}/overview`}function he({children:e}){const t=(0,d.zy)();function n(e){return e instanceof Element&&(e.classList.contains("ce-version-item-v1")||e.classList.contains("ce-version-item-v2"))}function a(e,t){if(!e||"string"!=typeof e||!e.startsWith("/docs"))return e;const n=[e.indexOf("?"),e.indexOf("#")].filter(e=>e>=0).sort((e,t)=>e-t)[0]??e.length,o=e.slice(0,n),a=e.slice(n);let i=o;return i.startsWith("/docs/v1/")?i="/docs/v2/"+i.slice(9):("/docs/v1"===i||"/docs"===i)&&(i="/docs/v2"),"v1"===t?"/docs/v2"===i?"/docs/v1"+a:"/docs/v1"+i.slice(8)+a:i+a}return(0,o.useEffect)(()=>{function e(){try{return"true"===window.localStorage.getItem("ce.docs.showToc")}catch(e){return!1}}function t(t){const n=e();t.setAttribute("title",n?"Hide TOC":"Show TOC"),t.setAttribute("aria-label",n?"Hide table of contents":"Show table of contents"),t.classList.toggle("ce-navbar-toc-btn-active",n)}function n(){const n=document.querySelectorAll(".ce-navbar-toc-btn");if(!n.length)return;n.forEach(n=>{n.dataset.bound||(n.addEventListener("click",()=>{!function(e){try{window.localStorage.setItem("ce.docs.showToc",e?"true":"false")}catch(t){}document.documentElement.classList.toggle("ce-show-toc",e)}(!e()),document.querySelectorAll(".ce-navbar-toc-btn").forEach(t)}),n.dataset.bound="1")});const o=e();document.documentElement.classList.toggle("ce-show-toc",o),n.forEach(t)}n();const o=new MutationObserver(()=>n());return o.observe(document.body,{childList:!0,subtree:!0}),()=>o.disconnect()},[]),(0,o.useEffect)(()=>{const e=t?.pathname||"",o=(new URLSearchParams(t?.search||"").get("version")||"").toLowerCase();let i="v2";if(e.startsWith("/docs/v1"))i="v1";else if(e.startsWith("/docs/v2")||"/docs"===e)i="v2";else if("v1"===o||"v2"===o)i=o;else try{const e=(window.localStorage.getItem("ce.docs.version")||"").toLowerCase();"v1"!==e&&"v2"!==e||(i=e)}catch(r){}try{window.localStorage.setItem("ce.docs.version",i)}catch(r){}document.documentElement.setAttribute("data-docs-version",i),function(e){const t=document.querySelector(".ce-version-dropdown");t&&("v1"===e||"v2"===e?(t.innerHTML=`<span class="ce-doc-version-chip ce-doc-version-chip-${e}">${e}<svg class="ce-doc-version-chip-icon" viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></span>`,t.classList.add("ce-version-has-chip")):(t.textContent="Version",t.classList.remove("ce-version-has-chip"))),document.querySelectorAll(".navbar a.ce-version-item-v1, .navbar a.ce-version-item-v2").forEach(t=>{const n=t.classList.contains("ce-version-item-v1"),o=e===(n?"v1":"v2");t.classList.toggle("ce-version-item-selected",o),t.setAttribute("aria-current",o?"page":"false")})}(i);document.querySelectorAll(".navbar a[href]").forEach(e=>{if(n(e))return;const t=e.getAttribute("href");if(!t)return;let o=t;try{o=new URL(t,window.location.origin).pathname}catch(r){}if(!o.startsWith("/docs"))return;const s=a(o,i);s&&s!==t&&e.setAttribute("href",s)});const s=e=>{if(e.defaultPrevented||0!==e.button)return;if(e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)return;const t=e.target instanceof Element?e.target.closest(".navbar a[href]"):null;if(!t)return;const o=t.getAttribute("href");if(!o)return;if(n(t)){const n=t.classList.contains("ce-version-item-v1")?"v1":"v2";e.preventDefault(),e.stopPropagation();try{window.localStorage.setItem("ce.docs.version",n)}catch(r){}const o=fe(window.location.pathname,n);return void(o&&o!==window.location.pathname&&window.location.assign(o))}let s=o;try{s=new URL(o,window.location.origin).pathname}catch(r){}if(!s.startsWith("/docs"))return;const l=a(s,i);l&&l!==o&&(e.preventDefault(),e.stopPropagation(),window.location.assign(l))};return document.addEventListener("click",s,!0),()=>{document.removeEventListener("click",s,!0)}},[t?.pathname,t?.search]),(0,m.jsxs)(ne,{theme:pe,children:[e,(0,m.jsx)(ie,{}),(0,m.jsx)(ce,{})]})}var ve=n(4563);const ye=e=>e.defaultFormatter(e);function be({children:e}){return(0,m.jsx)(ve.AL,{formatter:ye,children:e})}function Ee({children:e}){return(0,m.jsx)(be,{children:e})}var Se=n(5260),Te=n(4586),_e=n(6025),Ce=n(6342),Ie=n(5500),Re=n(2131),Ae=n(4090);var Ne=n(440),xe=n(1463);function we(){const{i18n:{currentLocale:e,defaultLocale:t,localeConfigs:n}}=(0,Te.A)(),o=(0,Re.o)(),a=n[e].htmlLang,i=e=>e.replace("-","_");return(0,m.jsxs)(Se.A,{children:[Object.entries(n).map(([e,{htmlLang:t}])=>(0,m.jsx)("link",{rel:"alternate",href:o.createUrl({locale:e,fullyQualified:!0}),hrefLang:t},e)),(0,m.jsx)("link",{rel:"alternate",href:o.createUrl({locale:t,fullyQualified:!0}),hrefLang:"x-default"}),(0,m.jsx)("meta",{property:"og:locale",content:i(a)}),Object.values(n).filter(e=>a!==e.htmlLang).map(e=>(0,m.jsx)("meta",{property:"og:locale:alternate",content:i(e.htmlLang)},`meta-og-${e.htmlLang}`))]})}function Pe({permalink:e}){const{siteConfig:{url:t}}=(0,Te.A)(),n=function(){const{siteConfig:{url:e,baseUrl:t,trailingSlash:n}}=(0,Te.A)(),{pathname:o}=(0,d.zy)();return e+(0,Ne.Ks)((0,_e.Ay)(o),{trailingSlash:n,baseUrl:t})}(),o=e?`${t}${e}`:n;return(0,m.jsxs)(Se.A,{children:[(0,m.jsx)("meta",{property:"og:url",content:o}),(0,m.jsx)("link",{rel:"canonical",href:o})]})}function ke(){const{i18n:{currentLocale:e}}=(0,Te.A)(),{metadata:t,image:n}=(0,Ce.p)();return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(Se.A,{children:[(0,m.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,m.jsx)("body",{className:Ae.w})]}),n&&(0,m.jsx)(Ie.be,{image:n}),(0,m.jsx)(Pe,{}),(0,m.jsx)(we,{}),(0,m.jsx)(xe.A,{tag:"default",locale:e}),(0,m.jsx)(Se.A,{children:t.map((e,t)=>(0,m.jsx)("meta",{...e},t))})]})}const Oe=new Map;var Le=n(6125),De=n(6988),Me=n(205);function Ue(e,...t){const n=c.map(n=>{const o=n.default?.[e]??n[e];return o?.(...t)});return()=>n.forEach(e=>e?.())}const Fe=function({children:e,location:t,previousLocation:n}){return(0,Me.A)(()=>{n!==t&&(!function({location:e,previousLocation:t}){if(!t)return;const n=e.pathname===t.pathname,o=e.hash===t.hash,a=e.search===t.search;if(n&&o&&!a)return;const{hash:i}=e;if(i){const e=decodeURIComponent(i.substring(1)),t=document.getElementById(e);t?.scrollIntoView()}else window.scrollTo(0,0)}({location:t,previousLocation:n}),Ue("onRouteDidUpdate",{previousLocation:n,location:t}))},[n,t]),e};function je(e){const t=Array.from(new Set([e,decodeURI(e)])).map(e=>(0,p.u)(u.A,e)).flat();return Promise.all(t.map(e=>e.route.component.preload?.()))}class Be extends o.Component{previousLocation;routeUpdateCleanupCb;constructor(e){super(e),this.previousLocation=null,this.routeUpdateCleanupCb=l.A.canUseDOM?Ue("onRouteUpdate",{previousLocation:null,location:this.props.location}):()=>{},this.state={nextRouteHasLoaded:!0}}shouldComponentUpdate(e,t){if(e.location===this.props.location)return t.nextRouteHasLoaded;const n=e.location;return this.previousLocation=this.props.location,this.setState({nextRouteHasLoaded:!1}),this.routeUpdateCleanupCb=Ue("onRouteUpdate",{previousLocation:this.previousLocation,location:n}),je(n.pathname).then(()=>{this.routeUpdateCleanupCb(),this.setState({nextRouteHasLoaded:!0})}).catch(e=>{console.warn(e),window.location.reload()}),!1}render(){const{children:e,location:t}=this.props;return(0,m.jsx)(Fe,{previousLocation:this.previousLocation,location:t,children:(0,m.jsx)(d.qh,{location:t,render:()=>e})})}}const qe=Be,Ge="__docusaurus-base-url-issue-banner-suggestion-container";function He(e){return`\ndocument.addEventListener('DOMContentLoaded', function maybeInsertBanner() {\n  var shouldInsert = typeof window['docusaurus'] === 'undefined';\n  shouldInsert && insertBanner();\n});\n\nfunction insertBanner() {\n  var bannerContainer = document.createElement('div');\n  bannerContainer.id = '__docusaurus-base-url-issue-banner-container';\n  var bannerHtml = ${JSON.stringify(function(e){return`\n<div id="__docusaurus-base-url-issue-banner" style="border: thick solid red; background-color: rgb(255, 230, 179); margin: 20px; padding: 20px; font-size: 20px;">\n   <p style="font-weight: bold; font-size: 30px;">Your Docusaurus site did not load properly.</p>\n   <p>A very common reason is a wrong site <a href="https://docusaurus.io/docs/docusaurus.config.js/#baseUrl" style="font-weight: bold;">baseUrl configuration</a>.</p>\n   <p>Current configured baseUrl = <span style="font-weight: bold; color: red;">${e}</span> ${"/"===e?" (default value)":""}</p>\n   <p>We suggest trying baseUrl = <span id="${Ge}" style="font-weight: bold; color: green;"></span></p>\n</div>\n`}(e)).replace(/</g,"\\<")};\n  bannerContainer.innerHTML = bannerHtml;\n  document.body.prepend(bannerContainer);\n  var suggestionContainer = document.getElementById('${Ge}');\n  var actualHomePagePath = window.location.pathname;\n  var suggestedBaseUrl = actualHomePagePath.substr(-1) === '/'\n        ? actualHomePagePath\n        : actualHomePagePath + '/';\n  suggestionContainer.innerHTML = suggestedBaseUrl;\n}\n`}function ze(){const{siteConfig:{baseUrl:e}}=(0,Te.A)();return(0,m.jsx)(m.Fragment,{children:!l.A.canUseDOM&&(0,m.jsx)(Se.A,{children:(0,m.jsx)("script",{children:He(e)})})})}function We(){const{siteConfig:{baseUrl:e,baseUrlIssueBanner:t}}=(0,Te.A)(),{pathname:n}=(0,d.zy)();return t&&n===e?(0,m.jsx)(ze,{}):null}function Ke(){const{siteConfig:{favicon:e,title:t,noIndex:n},i18n:{currentLocale:o,localeConfigs:a}}=(0,Te.A)(),i=(0,_e.Ay)(e),{htmlLang:s,direction:r}=a[o];return(0,m.jsxs)(Se.A,{children:[(0,m.jsx)("html",{lang:s,dir:r}),(0,m.jsx)("title",{children:t}),(0,m.jsx)("meta",{property:"og:title",content:t}),(0,m.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),n&&(0,m.jsx)("meta",{name:"robots",content:"noindex, nofollow"}),e&&(0,m.jsx)("link",{rel:"icon",href:i})]})}var Ve=n(7489),$e=n(2303);function Ye(){const e=(0,$e.A)();return(0,m.jsx)(Se.A,{children:(0,m.jsx)("html",{"data-has-hydrated":e})})}const Je=(0,p.v)(u.A);function Xe(){const e=function(e){if(Oe.has(e.pathname))return{...e,pathname:Oe.get(e.pathname)};if((0,p.u)(u.A,e.pathname).some(({route:e})=>!0===e.exact))return Oe.set(e.pathname,e.pathname),e;const t=e.pathname.trim().replace(/(?:\/index)?\.html$/,"")||"/";return Oe.set(e.pathname,t),{...e,pathname:t}}((0,d.zy)());return(0,m.jsx)(qe,{location:e,children:Je})}function Qe(){return(0,m.jsx)(Ve.A,{children:(0,m.jsx)(De.l,{children:(0,m.jsxs)(Le.x,{children:[(0,m.jsx)(he,{children:(0,m.jsxs)(Ee,{children:[(0,m.jsx)(Ke,{}),(0,m.jsx)(ke,{}),(0,m.jsx)(We,{}),(0,m.jsx)(Xe,{})]})}),(0,m.jsx)(Ye,{})]})})})}var Ze=n(4054);const et=function(e){try{return document.createElement("link").relList.supports(e)}catch{return!1}}("prefetch")?function(e){return new Promise((t,n)=>{if("undefined"==typeof document)return void n();const o=document.createElement("link");o.setAttribute("rel","prefetch"),o.setAttribute("href",e),o.onload=()=>t(),o.onerror=()=>n();const a=document.getElementsByTagName("head")[0]??document.getElementsByName("script")[0]?.parentNode;a?.appendChild(o)})}:function(e){return new Promise((t,n)=>{const o=new XMLHttpRequest;o.open("GET",e,!0),o.withCredentials=!0,o.onload=()=>{200===o.status?t():n()},o.send(null)})};var tt=n(6921);const nt=new Set,ot=new Set,at=()=>navigator.connection?.effectiveType.includes("2g")||navigator.connection?.saveData,it={prefetch:e=>{if(!(e=>!at()&&!ot.has(e)&&!nt.has(e))(e))return!1;nt.add(e);const t=(0,p.u)(u.A,e).flatMap(e=>{return t=e.route.path,Object.entries(Ze).filter(([e])=>e.replace(/-[^-]+$/,"")===t).flatMap(([,e])=>Object.values((0,tt.A)(e)));var t});return Promise.all(t.map(e=>{const t=n.gca(e);return t&&!t.includes("undefined")?et(t).catch(()=>{}):Promise.resolve()}))},preload:e=>!!(e=>!at()&&!ot.has(e))(e)&&(ot.add(e),je(e))},st=Object.freeze(it);function rt({children:e}){return"hash"===r.default.future.experimental_router?(0,m.jsx)(s.I9,{children:e}):(0,m.jsx)(s.Kd,{children:e})}const lt=Boolean(!0);if(l.A.canUseDOM){window.docusaurus=st;const e=document.getElementById("__docusaurus"),t=(0,m.jsx)(i.vd,{children:(0,m.jsx)(rt,{children:(0,m.jsx)(Qe,{})})}),n=(e,t)=>{console.error("Docusaurus React Root onRecoverableError:",e,t)},s=()=>{if(window.docusaurusRoot)window.docusaurusRoot.render(t);else if(lt)window.docusaurusRoot=a.hydrateRoot(e,t,{onRecoverableError:n});else{const o=a.createRoot(e,{onRecoverableError:n});o.render(t),window.docusaurusRoot=o}};je(window.location.pathname).then(()=>{(0,o.startTransition)(s)})}},4363(e,t,n){"use strict";e.exports=n(2799)},4477(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var o=n-1>>>1,a=e[o];if(!(0<i(a,t)))break e;e[o]=t,e[n]=a,n=o}}function o(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var o=0,a=e.length,s=a>>>1;o<s;){var r=2*(o+1)-1,l=e[r],c=r+1,u=e[c];if(0>i(l,n))c<a&&0>i(u,l)?(e[o]=u,e[c]=n,o=c):(e[o]=l,e[r]=n,o=r);else{if(!(c<a&&0>i(u,n)))break e;e[o]=u,e[c]=n,o=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var r=Date,l=r.now();t.unstable_now=function(){return r.now()-l}}var c=[],u=[],d=1,p=null,m=3,g=!1,f=!1,h=!1,v=!1,y="function"==typeof setTimeout?setTimeout:null,b="function"==typeof clearTimeout?clearTimeout:null,E="undefined"!=typeof setImmediate?setImmediate:null;function S(e){for(var t=o(u);null!==t;){if(null===t.callback)a(u);else{if(!(t.startTime<=e))break;a(u),t.sortIndex=t.expirationTime,n(c,t)}t=o(u)}}function T(e){if(h=!1,S(e),!f)if(null!==o(c))f=!0,C||(C=!0,_());else{var t=o(u);null!==t&&k(T,t.startTime-e)}}var _,C=!1,I=-1,R=5,A=-1;function N(){return!!v||!(t.unstable_now()-A<R)}function x(){if(v=!1,C){var e=t.unstable_now();A=e;var n=!0;try{e:{f=!1,h&&(h=!1,b(I),I=-1),g=!0;var i=m;try{t:{for(S(e),p=o(c);null!==p&&!(p.expirationTime>e&&N());){var s=p.callback;if("function"==typeof s){p.callback=null,m=p.priorityLevel;var r=s(p.expirationTime<=e);if(e=t.unstable_now(),"function"==typeof r){p.callback=r,S(e),n=!0;break t}p===o(c)&&a(c),S(e)}else a(c);p=o(c)}if(null!==p)n=!0;else{var l=o(u);null!==l&&k(T,l.startTime-e),n=!1}}break e}finally{p=null,m=i,g=!1}n=void 0}}finally{n?_():C=!1}}}if("function"==typeof E)_=function(){E(x)};else if("undefined"!=typeof MessageChannel){var w=new MessageChannel,P=w.port2;w.port1.onmessage=x,_=function(){P.postMessage(null)}}else _=function(){y(x,0)};function k(e,n){I=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_next=function(e){switch(m){case 1:case 2:case 3:var t=3;break;default:t=m}var n=m;m=t;try{return e()}finally{m=n}},t.unstable_requestPaint=function(){v=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=m;m=e;try{return t()}finally{m=n}},t.unstable_scheduleCallback=function(e,a,i){var s=t.unstable_now();switch("object"==typeof i&&null!==i?i="number"==typeof(i=i.delay)&&0<i?s+i:s:i=s,e){case 1:var r=-1;break;case 2:r=250;break;case 5:r=1073741823;break;case 4:r=1e4;break;default:r=5e3}return e={id:d++,callback:a,priorityLevel:e,startTime:i,expirationTime:r=i+r,sortIndex:-1},i>s?(e.sortIndex=i,n(u,e),null===o(c)&&e===o(u)&&(h?(b(I),I=-1):h=!0,k(T,i-s))):(e.sortIndex=r,n(c,e),f||g||(f=!0,C||(C=!0,_()))),e},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(e){var t=m;return function(){var n=m;m=t;try{return e.apply(this,arguments)}finally{m=n}}}},4563(e,t,n){"use strict";n.d(t,{AL:()=>u,s$:()=>d});var o=n(6540),a=n(4586),i=n(6803),s=n(9532),r=n(4848);const l=({title:e,siteTitle:t,titleDelimiter:n})=>{const o=e?.trim();return o&&o!==t?`${o} ${n} ${t}`:t},c=(0,o.createContext)(null);function u({formatter:e,children:t}){return(0,r.jsx)(c.Provider,{value:e,children:t})}function d(){const e=function(){const e=(0,o.useContext)(c);if(null===e)throw new s.dV("TitleFormatterProvider");return e}(),{siteConfig:t}=(0,a.A)(),{title:n,titleDelimiter:r}=t,{plugin:u}=(0,i.A)();return{format:t=>e({title:t,siteTitle:n,titleDelimiter:r,plugin:u,defaultFormatter:l})}}},4581(e,t,n){"use strict";n.d(t,{l:()=>r});var o=n(6540),a=n(8193);const i="desktop",s="mobile";function r({desktopBreakpoint:e=996}={}){const[t,n]=(0,o.useState)(()=>"ssr");return(0,o.useEffect)(()=>{function t(){n(function(e){if(!a.A.canUseDOM)throw new Error("getWindowSize() should only be called after React hydration");return window.innerWidth>e?i:s}(e))}return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e]),t}},4586(e,t,n){"use strict";n.d(t,{A:()=>i});var o=n(6540),a=n(6988);function i(){return(0,o.useContext)(a.o)}},4625(e,t,n){"use strict";n.d(t,{I9:()=>d,Kd:()=>u,N_:()=>v,k2:()=>E});var o=n(6347),a=n(2892),i=n(6540),s=n(1513),r=n(8168),l=n(8587),c=n(1561),u=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(t=e.call.apply(e,[this].concat(o))||this).history=(0,s.zR)(t.props),t}return(0,a.A)(t,e),t.prototype.render=function(){return i.createElement(o.Ix,{history:this.history,children:this.props.children})},t}(i.Component);var d=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(t=e.call.apply(e,[this].concat(o))||this).history=(0,s.TM)(t.props),t}return(0,a.A)(t,e),t.prototype.render=function(){return i.createElement(o.Ix,{history:this.history,children:this.props.children})},t}(i.Component);var p=function(e,t){return"function"==typeof e?e(t):e},m=function(e,t){return"string"==typeof e?(0,s.yJ)(e,null,null,t):e},g=function(e){return e},f=i.forwardRef;void 0===f&&(f=g);var h=f(function(e,t){var n=e.innerRef,o=e.navigate,a=e.onClick,s=(0,l.A)(e,["innerRef","navigate","onClick"]),c=s.target,u=(0,r.A)({},s,{onClick:function(e){try{a&&a(e)}catch(t){throw e.preventDefault(),t}e.defaultPrevented||0!==e.button||c&&"_self"!==c||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)||(e.preventDefault(),o())}});return u.ref=g!==f&&t||n,i.createElement("a",u)});var v=f(function(e,t){var n=e.component,a=void 0===n?h:n,u=e.replace,d=e.to,v=e.innerRef,y=(0,l.A)(e,["component","replace","to","innerRef"]);return i.createElement(o.XZ.Consumer,null,function(e){e||(0,c.A)(!1);var n=e.history,o=m(p(d,e.location),e.location),l=o?n.createHref(o):"",h=(0,r.A)({},y,{href:l,navigate:function(){var t=p(d,e.location),o=(0,s.AO)(e.location)===(0,s.AO)(m(t));(u||o?n.replace:n.push)(t)}});return g!==f?h.ref=t||v:h.innerRef=v,i.createElement(a,h)})}),y=function(e){return e},b=i.forwardRef;void 0===b&&(b=y);var E=b(function(e,t){var n=e["aria-current"],a=void 0===n?"page":n,s=e.activeClassName,u=void 0===s?"active":s,d=e.activeStyle,g=e.className,f=e.exact,h=e.isActive,E=e.location,S=e.sensitive,T=e.strict,_=e.style,C=e.to,I=e.innerRef,R=(0,l.A)(e,["aria-current","activeClassName","activeStyle","className","exact","isActive","location","sensitive","strict","style","to","innerRef"]);return i.createElement(o.XZ.Consumer,null,function(e){e||(0,c.A)(!1);var n=E||e.location,s=m(p(C,n),n),l=s.pathname,A=l&&l.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),N=A?(0,o.B6)(n.pathname,{path:A,exact:f,sensitive:S,strict:T}):null,x=!!(h?h(N,n):N),w="function"==typeof g?g(x):g,P="function"==typeof _?_(x):_;x&&(w=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(function(e){return e}).join(" ")}(w,u),P=(0,r.A)({},P,d));var k=(0,r.A)({"aria-current":x&&a||null,className:w,style:P,to:s},R);return y!==b?k.ref=t||I:k.innerRef=I,i.createElement(v,k)})})},4634(e){e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},4784(e,t,n){"use strict";n.r(t),n.d(t,{default:()=>o});const o={title:"ConvEngine",tagline:"Deterministic conversational workflow engine",favicon:"img/favicon.ico",future:{v4:{removeLegacyPostBuildHeadAttribute:!0,useCssCascadeLayers:!0},experimental_faster:{swcJsLoader:!1,swcJsMinimizer:!1,swcHtmlMinimizer:!1,lightningCssMinimizer:!1,mdxCrossCompilerCache:!1,rspackBundler:!1,rspackPersistentCache:!1,ssgWorkerThreads:!1},experimental_storage:{type:"localStorage",namespace:!1},experimental_router:"browser"},trailingSlash:!1,url:"https://salilvnair.com",baseUrl:"/",organizationName:"salilvnair",projectName:"convengine-docs",onBrokenLinks:"throw",markdown:{hooks:{onBrokenMarkdownLinks:"warn",onBrokenMarkdownImages:"throw"},format:"mdx",mermaid:!1,emoji:!0,mdx1Compat:{comments:!0,admonitions:!0,headingIds:!0},anchors:{maintainCase:!1}},i18n:{defaultLocale:"en",locales:["en"],path:"i18n",localeConfigs:{}},presets:[["classic",{docs:!1,blog:!1,theme:{customCss:"./src/css/custom.css"}}]],plugins:[["@docusaurus/plugin-content-docs",{id:"v2",path:"docs/v2",routeBasePath:"docs/v2",sidebarPath:"./sidebars.v2.js",editUrl:"https://github.com/salilvnair/convengine-docs/tree/main/"}],["@docusaurus/plugin-content-docs",{id:"v1",path:"docs/v1",routeBasePath:"docs/v1",sidebarPath:"./sidebars.v1.js",editUrl:"https://github.com/salilvnair/convengine-docs/tree/main/"}]],themeConfig:{image:"img/docusaurus-social-card.jpg",docs:{sidebar:{hideable:!0,autoCollapseCategories:!1},versionPersistence:"localStorage"},colorMode:{defaultMode:"dark",disableSwitch:!1,respectPrefersColorScheme:!0},navbar:{title:"ConvEngine Docs",logo:{alt:"ConvEngine",src:"img/logo_light.png",srcDark:"img/logo.png"},items:[{to:"/docs/v2/overview",position:"left",label:"Overview",activeBaseRegex:"^/docs/v[12]/overview/?$"},{to:"/docs/v2/architecture",position:"left",label:"Architecture",activeBaseRegex:"^/docs/v[12]/architecture/?$"},{to:"/docs/v2/examples",position:"left",label:"Examples",activeBaseRegex:"^/docs/v[12]/examples/?$"},{to:"/docs/v2/version-history",position:"left",label:"Version History",activeBaseRegex:"^/docs/v[12]/version-history/?$"},{to:"/docs/v2/consumer",position:"left",label:"Consumer",activeBaseRegex:"^/docs/v[12]/consumer(?:/|$)"},{to:"/docs/v2/deep-dive",position:"left",label:"Deep Dive",activeBaseRegex:"^/docs/v[12]/deep-dive(?:/|$)"},{to:"/docs/v2/api/rest-api",position:"left",label:"API",activeBaseRegex:"^/docs/v[12]/api(?:/|$)"},{type:"dropdown",position:"right",label:"Version",className:"ce-version-dropdown",activeBaseRegex:"^/docs/v[12](?:/|$)",items:[{label:"v2",to:"/docs/v2/overview",className:"ce-version-item-v2"},{label:"v1",to:"/docs/v1/overview",className:"ce-version-item-v1"}]},{type:"html",position:"right",value:'<button class="clean-btn ce-navbar-search-trigger" aria-label="Open global search" title="Open global search"><span class="ce-navbar-search-icon" aria-hidden="true"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="7"></circle><line x1="16.65" y1="16.65" x2="21" y2="21"></line></svg></span><span class="ce-navbar-search-text">Search</span><span class="ce-navbar-search-kbd">Cmd/Ctrl + K</span></button>'},{href:"https://github.com/salilvnair/convengine",label:"GitHub",position:"right"}],hideOnScroll:!1},footer:{style:"dark",links:[{title:"Docs",items:[{label:"Overview",to:"/docs/v2/overview"},{label:"Architecture",to:"/docs/v2/architecture"},{label:"Local Development",to:"/docs/v2/local-development"}]},{title:"Reference",items:[{label:"REST API",to:"/docs/v2/api/rest-api"},{label:"Java API",to:"/docs/v2/api/java-api"},{label:"Deep Dive",to:"/docs/v2/deep-dive"}]}],copyright:"Copyright \xa9 2026 ConvEngine."},prism:{theme:{plain:{backgroundColor:"hsl(230, 1%, 98%)",color:"hsl(230, 8%, 24%)"},styles:[{types:["comment","prolog","cdata"],style:{color:"hsl(230, 4%, 64%)"}},{types:["doctype","punctuation","entity"],style:{color:"hsl(230, 8%, 24%)"}},{types:["attr-name","class-name","boolean","constant","number","atrule"],style:{color:"hsl(35, 99%, 36%)"}},{types:["keyword"],style:{color:"hsl(301, 63%, 40%)"}},{types:["property","tag","symbol","deleted","important"],style:{color:"hsl(5, 74%, 59%)"}},{types:["selector","string","char","builtin","inserted","regex","attr-value","punctuation"],style:{color:"hsl(119, 34%, 47%)"}},{types:["variable","operator","function"],style:{color:"hsl(221, 87%, 60%)"}},{types:["url"],style:{color:"hsl(198, 99%, 37%)"}},{types:["deleted"],style:{textDecorationLine:"line-through"}},{types:["inserted"],style:{textDecorationLine:"underline"}},{types:["italic"],style:{fontStyle:"italic"}},{types:["important","bold"],style:{fontWeight:"bold"}},{types:["important"],style:{color:"hsl(230, 8%, 24%)"}}]},darkTheme:{plain:{backgroundColor:"hsl(220, 13%, 18%)",color:"hsl(220, 14%, 71%)",textShadow:"0 1px rgba(0, 0, 0, 0.3)"},styles:[{types:["comment","prolog","cdata"],style:{color:"hsl(220, 10%, 40%)"}},{types:["doctype","punctuation","entity"],style:{color:"hsl(220, 14%, 71%)"}},{types:["attr-name","class-name","maybe-class-name","boolean","constant","number","atrule"],style:{color:"hsl(29, 54%, 61%)"}},{types:["keyword"],style:{color:"hsl(286, 60%, 67%)"}},{types:["property","tag","symbol","deleted","important"],style:{color:"hsl(355, 65%, 65%)"}},{types:["selector","string","char","builtin","inserted","regex","attr-value"],style:{color:"hsl(95, 38%, 62%)"}},{types:["variable","operator","function"],style:{color:"hsl(207, 82%, 66%)"}},{types:["url"],style:{color:"hsl(187, 47%, 55%)"}},{types:["deleted"],style:{textDecorationLine:"line-through"}},{types:["inserted"],style:{textDecorationLine:"underline"}},{types:["italic"],style:{fontStyle:"italic"}},{types:["important","bold"],style:{fontWeight:"bold"}},{types:["important"],style:{color:"hsl(220, 14%, 71%)"}}]},additionalLanguages:["json","java","sql","bash","yaml"],magicComments:[{className:"theme-code-block-highlighted-line",line:"highlight-next-line",block:{start:"highlight-start",end:"highlight-end"}}]},blog:{sidebar:{groupByYear:!0}},metadata:[],tableOfContents:{minHeadingLevel:2,maxHeadingLevel:3}},baseUrlIssueBanner:!0,onBrokenAnchors:"warn",onDuplicateRoutes:"warn",staticDirectories:["static"],customFields:{},themes:[],scripts:[],headTags:[],stylesheets:[],clientModules:[],titleDelimiter:"|",noIndex:!1}},4848(e,t,n){"use strict";e.exports=n(9698)},5041(e,t,n){"use strict";n.d(t,{M:()=>f,o:()=>g});var o=n(6540),a=n(2303),i=n(679),s=n(9532),r=n(6342),l=n(4848);const c=(0,i.Wf)("docusaurus.announcement.dismiss"),u=(0,i.Wf)("docusaurus.announcement.id"),d=()=>"true"===c.get(),p=e=>c.set(String(e)),m=o.createContext(null);function g({children:e}){const t=function(){const{announcementBar:e}=(0,r.p)(),t=(0,a.A)(),[n,i]=(0,o.useState)(()=>!!t&&d());(0,o.useEffect)(()=>{i(d())},[]);const s=(0,o.useCallback)(()=>{p(!0),i(!0)},[]);return(0,o.useEffect)(()=>{if(!e)return;const{id:t}=e;let n=u.get();"annoucement-bar"===n&&(n="announcement-bar");const o=t!==n;u.set(t),o&&p(!1),!o&&d()||i(!1)},[e]),(0,o.useMemo)(()=>({isActive:!!e&&!n,close:s}),[e,n,s])}();return(0,l.jsx)(m.Provider,{value:t,children:e})}function f(){const e=(0,o.useContext)(m);if(!e)throw new s.dV("AnnouncementBarProvider");return e}},5062(e,t,n){"use strict";n.d(t,{$:()=>s});var o=n(6540),a=n(6347),i=n(9532);function s(e){const t=(0,a.zy)(),n=(0,i.ZC)(t),s=(0,i._q)(e);(0,o.useEffect)(()=>{n&&t!==n&&s({location:t,previousLocation:n})},[s,t,n])}},5260(e,t,n){"use strict";n.d(t,{A:()=>i});n(6540);var o=n(545),a=n(4848);function i(e){return(0,a.jsx)(o.mg,{...e})}},5293(e,t,n){"use strict";n.d(t,{G:()=>T,a:()=>S});var o=n(6540),a=n(2303),i=n(9532),s=n(679),r=n(6342),l=n(4848);function c(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function u(e){return function(e,t){const n=window.matchMedia(e);return n.addEventListener("change",t),()=>n.removeEventListener("change",t)}("(prefers-color-scheme: dark)",()=>e(c()))}const d=o.createContext(void 0),p=(0,s.Wf)("theme"),m="system",g=e=>"dark"===e?"dark":"light",f=e=>null===e||e===m?null:g(e),h=()=>g(document.documentElement.getAttribute("data-theme")),v=e=>{document.documentElement.setAttribute("data-theme",g(e))},y=()=>f(document.documentElement.getAttribute("data-theme-choice")),b=e=>{document.documentElement.setAttribute("data-theme-choice",f(e)??m)};function E(){const{colorMode:{defaultMode:e,disableSwitch:t,respectPrefersColorScheme:n}}=(0,r.p)(),{colorMode:i,setColorModeState:s,colorModeChoice:l,setColorModeChoiceState:d}=function(){const{colorMode:{defaultMode:e}}=(0,r.p)(),t=(0,a.A)(),[n,i]=(0,o.useState)(t?h():e),[s,l]=(0,o.useState)(t?y():null);return(0,o.useEffect)(()=>{i(h()),l(y())},[]),{colorMode:n,setColorModeState:i,colorModeChoice:s,setColorModeChoiceState:l}}();(0,o.useEffect)(()=>{t&&p.del()},[t]);const m=(0,o.useCallback)((t,o={})=>{const{persist:a=!0}=o;if(null===t){const t=n?c():e;v(t),s(t),b(null),d(null)}else v(t),b(t),s(t),d(t);var i;a&&(null===(i=t)?p.del():p.set(g(i)))},[s,d,n,e]);return(0,o.useEffect)(()=>p.listen(e=>{m(f(e.newValue))}),[m]),(0,o.useEffect)(()=>{if(null===l&&n)return u(e=>{s(e),v(e)})},[n,l,s]),(0,o.useMemo)(()=>({colorMode:i,colorModeChoice:l,setColorMode:m,get isDarkTheme(){return"dark"===i},setLightTheme(){m("light")},setDarkTheme(){m("dark")}}),[i,l,m])}function S({children:e}){const t=E();return(0,l.jsx)(d.Provider,{value:t,children:e})}function T(){const e=(0,o.useContext)(d);if(null==e)throw new i.dV("ColorModeProvider","Please see https://docusaurus.io/docs/api/themes/configuration#use-color-mode.");return e}},5302(e,t,n){var o=n(4634);e.exports=f,e.exports.parse=i,e.exports.compile=function(e,t){return c(i(e,t),t)},e.exports.tokensToFunction=c,e.exports.tokensToRegExp=g;var a=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function i(e,t){for(var n,o=[],i=0,r=0,l="",c=t&&t.delimiter||"/";null!=(n=a.exec(e));){var u=n[0],p=n[1],m=n.index;if(l+=e.slice(r,m),r=m+u.length,p)l+=p[1];else{var g=e[r],f=n[2],h=n[3],v=n[4],y=n[5],b=n[6],E=n[7];l&&(o.push(l),l="");var S=null!=f&&null!=g&&g!==f,T="+"===b||"*"===b,_="?"===b||"*"===b,C=f||c,I=v||y,R=f||("string"==typeof o[o.length-1]?o[o.length-1]:"");o.push({name:h||i++,prefix:f||"",delimiter:C,optional:_,repeat:T,partial:S,asterisk:!!E,pattern:I?d(I):E?".*":s(C,R)})}}return r<e.length&&(l+=e.substr(r)),l&&o.push(l),o}function s(e,t){return!t||t.indexOf(e)>-1?"[^"+u(e)+"]+?":u(t)+"|(?:(?!"+u(t)+")[^"+u(e)+"])+?"}function r(e){return encodeURI(e).replace(/[\/?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function l(e){return encodeURI(e).replace(/[?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function c(e,t){for(var n=new Array(e.length),a=0;a<e.length;a++)"object"==typeof e[a]&&(n[a]=new RegExp("^(?:"+e[a].pattern+")$",m(t)));return function(t,a){for(var i="",s=t||{},c=(a||{}).pretty?r:encodeURIComponent,u=0;u<e.length;u++){var d=e[u];if("string"!=typeof d){var p,m=s[d.name];if(null==m){if(d.optional){d.partial&&(i+=d.prefix);continue}throw new TypeError('Expected "'+d.name+'" to be defined')}if(o(m)){if(!d.repeat)throw new TypeError('Expected "'+d.name+'" to not repeat, but received `'+JSON.stringify(m)+"`");if(0===m.length){if(d.optional)continue;throw new TypeError('Expected "'+d.name+'" to not be empty')}for(var g=0;g<m.length;g++){if(p=c(m[g]),!n[u].test(p))throw new TypeError('Expected all "'+d.name+'" to match "'+d.pattern+'", but received `'+JSON.stringify(p)+"`");i+=(0===g?d.prefix:d.delimiter)+p}}else{if(p=d.asterisk?l(m):c(m),!n[u].test(p))throw new TypeError('Expected "'+d.name+'" to match "'+d.pattern+'", but received "'+p+'"');i+=d.prefix+p}}else i+=d}return i}}function u(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function d(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function p(e,t){return e.keys=t,e}function m(e){return e&&e.sensitive?"":"i"}function g(e,t,n){o(t)||(n=t||n,t=[]);for(var a=(n=n||{}).strict,i=!1!==n.end,s="",r=0;r<e.length;r++){var l=e[r];if("string"==typeof l)s+=u(l);else{var c=u(l.prefix),d="(?:"+l.pattern+")";t.push(l),l.repeat&&(d+="(?:"+c+d+")*"),s+=d=l.optional?l.partial?c+"("+d+")?":"(?:"+c+"("+d+"))?":c+"("+d+")"}}var g=u(n.delimiter||"/"),f=s.slice(-g.length)===g;return a||(s=(f?s.slice(0,-g.length):s)+"(?:"+g+"(?=$))?"),s+=i?"$":a&&f?"":"(?="+g+"|$)",p(new RegExp("^"+s,m(n)),t)}function f(e,t,n){return o(t)||(n=t||n,t=[]),n=n||{},e instanceof RegExp?function(e,t){var n=e.source.match(/\((?!\?)/g);if(n)for(var o=0;o<n.length;o++)t.push({name:o,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return p(e,t)}(e,t):o(e)?function(e,t,n){for(var o=[],a=0;a<e.length;a++)o.push(f(e[a],t,n).source);return p(new RegExp("(?:"+o.join("|")+")",m(n)),t)}(e,t,n):function(e,t,n){return g(i(e,n),t,n)}(e,t,n)}},5338(e,t,n){"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(1247)},5390(e,t,n){"use strict";n.d(t,{V:()=>p,_:()=>d});var o=n(7295),a=n(478);function i(e){return String(e||"").toLowerCase()}function s(){return"v1"===function(){if("undefined"==typeof window)return"v2";const e=window.location?.pathname||"";if(e.startsWith("/docs/v1"))return"v1";if(e.startsWith("/docs/v2")||"/docs"===e)return"v2";try{const e=(window.localStorage.getItem("ce.docs.version")||"").toLowerCase();if("v1"===e||"v2"===e)return e}catch(t){}return"v2"}()?a:o}function r(e){return i(e).replace(/\*/g,"").replace(/\s+/g," ").trim()}function l(e,t){const n=String(e.rawContent||e.content||"");if(!n)return"";const o=r(t);if(!o)return c(e.excerpt||n.slice(0,220));const a=n.toLowerCase().indexOf(o);if(a<0)return c(e.excerpt||n.slice(0,220));const i=Math.max(0,a-70),s=Math.min(n.length,a+o.length+130);return c(`${i>0?"\u2026":""}${n.slice(i,s).trim()}${s<n.length?"\u2026":""}`)}function c(e){return String(e||"").replace(/<[^>]+>/g," ").replace(/\b[A-Za-z_][A-Za-z0-9_.-]*=/g," ").replace(/[{}[\]]/g," ").replace(/`/g," ").replace(/[#>*]+/g," ").replace(/\s+/g," ").trim()}function u(e,t){if(!t)return 0;const n=i(e.title||""),o=i(e.rawContent||e.content||""),a=i(e.content||"");let s=0;return n===t&&(s+=250),n.includes(t)&&(s+=120),o.includes(t)?s+=80:a.includes(t)&&(s+=40),s+=4*function(e,t){if(!e||!t)return 0;let n=0,o=0;for(;o=e.indexOf(t,o),-1!==o;)n+=1,o+=t.length;return n}(o,t),s}function d(e,t=Number.POSITIVE_INFINITY){const n=r(e);if(!n)return[];const o=s().map(e=>({...e,_score:u(e,n)})).filter(e=>e._score>0).sort((e,t)=>t._score-e._score||e.title.localeCompare(t.title)).map(({_score:e,...t})=>({...t,excerpt:l(t,n)}));return Number.isFinite(t)?o.slice(0,Math.max(0,t)):o}function p(){return s().length}},5500(e,t,n){"use strict";n.d(t,{Jx:()=>v,be:()=>g,e3:()=>h});var o=n(6540),a=n(4164),i=n(5260),s=n(6803),r=n(6025),l=n(4563),c=n(4848);function u({title:e}){const t=(0,l.s$)().format(e);return(0,c.jsxs)(i.A,{children:[(0,c.jsx)("title",{children:t}),(0,c.jsx)("meta",{property:"og:title",content:t})]})}function d({description:e}){return(0,c.jsxs)(i.A,{children:[(0,c.jsx)("meta",{name:"description",content:e}),(0,c.jsx)("meta",{property:"og:description",content:e})]})}function p({image:e}){const{withBaseUrl:t}=(0,r.hH)(),n=t(e,{absolute:!0});return(0,c.jsxs)(i.A,{children:[(0,c.jsx)("meta",{property:"og:image",content:n}),(0,c.jsx)("meta",{name:"twitter:image",content:n})]})}function m({keywords:e}){return(0,c.jsx)(i.A,{children:(0,c.jsx)("meta",{name:"keywords",content:Array.isArray(e)?e.join(","):e})})}function g({title:e,description:t,keywords:n,image:o,children:a}){return(0,c.jsxs)(c.Fragment,{children:[e&&(0,c.jsx)(u,{title:e}),t&&(0,c.jsx)(d,{description:t}),n&&(0,c.jsx)(m,{keywords:n}),o&&(0,c.jsx)(p,{image:o}),a&&(0,c.jsx)(i.A,{children:a})]})}const f=o.createContext(void 0);function h({className:e,children:t}){const n=o.useContext(f),s=(0,a.A)(n,e);return(0,c.jsxs)(f.Provider,{value:s,children:[(0,c.jsx)(i.A,{children:(0,c.jsx)("html",{className:s})}),t]})}function v({children:e}){const t=(0,s.A)(),n=`plugin-${t.plugin.name.replace(/docusaurus-(?:plugin|theme)-(?:content-)?/gi,"")}`;const o=`plugin-id-${t.plugin.id}`;return(0,c.jsx)(h,{className:(0,a.A)(n,o),children:e})}},5556(e,t,n){e.exports=n(2694)()},5600(e,t,n){"use strict";n.d(t,{GX:()=>c,YL:()=>l,y_:()=>r});var o=n(6540),a=n(9532),i=n(4848);const s=o.createContext(null);function r({children:e}){const t=(0,o.useState)({component:null,props:null});return(0,i.jsx)(s.Provider,{value:t,children:e})}function l(){const e=(0,o.useContext)(s);if(!e)throw new a.dV("NavbarSecondaryMenuContentProvider");return e[0]}function c({component:e,props:t}){const n=(0,o.useContext)(s);if(!n)throw new a.dV("NavbarSecondaryMenuContentProvider");const[,i]=n,r=(0,a.Be)(t);return(0,o.useEffect)(()=>{i({component:e,props:r})},[i,e,r]),(0,o.useEffect)(()=>()=>i({component:null,props:null}),[i]),null}},5947(e,t,n){var o,a;o=function(){var e,t,n={version:"0.2.0"},o=n.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function a(e,t,n){return e<t?t:e>n?n:e}function i(e){return 100*(-1+e)}function s(e,t,n){var a;return(a="translate3d"===o.positionUsing?{transform:"translate3d("+i(e)+"%,0,0)"}:"translate"===o.positionUsing?{transform:"translate("+i(e)+"%,0)"}:{"margin-left":i(e)+"%"}).transition="all "+t+"ms "+n,a}n.configure=function(e){var t,n;for(t in e)void 0!==(n=e[t])&&e.hasOwnProperty(t)&&(o[t]=n);return this},n.status=null,n.set=function(e){var t=n.isStarted();e=a(e,o.minimum,1),n.status=1===e?null:e;var i=n.render(!t),c=i.querySelector(o.barSelector),u=o.speed,d=o.easing;return i.offsetWidth,r(function(t){""===o.positionUsing&&(o.positionUsing=n.getPositioningCSS()),l(c,s(e,u,d)),1===e?(l(i,{transition:"none",opacity:1}),i.offsetWidth,setTimeout(function(){l(i,{transition:"all "+u+"ms linear",opacity:0}),setTimeout(function(){n.remove(),t()},u)},u)):setTimeout(t,u)}),this},n.isStarted=function(){return"number"==typeof n.status},n.start=function(){n.status||n.set(0);var e=function(){setTimeout(function(){n.status&&(n.trickle(),e())},o.trickleSpeed)};return o.trickle&&e(),this},n.done=function(e){return e||n.status?n.inc(.3+.5*Math.random()).set(1):this},n.inc=function(e){var t=n.status;return t?("number"!=typeof e&&(e=(1-t)*a(Math.random()*t,.1,.95)),t=a(t+e,0,.994),n.set(t)):n.start()},n.trickle=function(){return n.inc(Math.random()*o.trickleRate)},e=0,t=0,n.promise=function(o){return o&&"resolved"!==o.state()?(0===t&&n.start(),e++,t++,o.always(function(){0===--t?(e=0,n.done()):n.set((e-t)/e)}),this):this},n.render=function(e){if(n.isRendered())return document.getElementById("nprogress");u(document.documentElement,"nprogress-busy");var t=document.createElement("div");t.id="nprogress",t.innerHTML=o.template;var a,s=t.querySelector(o.barSelector),r=e?"-100":i(n.status||0),c=document.querySelector(o.parent);return l(s,{transition:"all 0 linear",transform:"translate3d("+r+"%,0,0)"}),o.showSpinner||(a=t.querySelector(o.spinnerSelector))&&m(a),c!=document.body&&u(c,"nprogress-custom-parent"),c.appendChild(t),t},n.remove=function(){d(document.documentElement,"nprogress-busy"),d(document.querySelector(o.parent),"nprogress-custom-parent");var e=document.getElementById("nprogress");e&&m(e)},n.isRendered=function(){return!!document.getElementById("nprogress")},n.getPositioningCSS=function(){var e=document.body.style,t="WebkitTransform"in e?"Webkit":"MozTransform"in e?"Moz":"msTransform"in e?"ms":"OTransform"in e?"O":"";return t+"Perspective"in e?"translate3d":t+"Transform"in e?"translate":"margin"};var r=function(){var e=[];function t(){var n=e.shift();n&&n(t)}return function(n){e.push(n),1==e.length&&t()}}(),l=function(){var e=["Webkit","O","Moz","ms"],t={};function n(e){return e.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(e,t){return t.toUpperCase()})}function o(t){var n=document.body.style;if(t in n)return t;for(var o,a=e.length,i=t.charAt(0).toUpperCase()+t.slice(1);a--;)if((o=e[a]+i)in n)return o;return t}function a(e){return e=n(e),t[e]||(t[e]=o(e))}function i(e,t,n){t=a(t),e.style[t]=n}return function(e,t){var n,o,a=arguments;if(2==a.length)for(n in t)void 0!==(o=t[n])&&t.hasOwnProperty(n)&&i(e,n,o);else i(e,a[1],a[2])}}();function c(e,t){return("string"==typeof e?e:p(e)).indexOf(" "+t+" ")>=0}function u(e,t){var n=p(e),o=n+t;c(n,t)||(e.className=o.substring(1))}function d(e,t){var n,o=p(e);c(e,t)&&(n=o.replace(" "+t+" "," "),e.className=n.substring(1,n.length-1))}function p(e){return(" "+(e.className||"")+" ").replace(/\s+/gi," ")}function m(e){e&&e.parentNode&&e.parentNode.removeChild(e)}return n},void 0===(a="function"==typeof o?o.call(t,n,t,e):o)||(e.exports=a)},6025(e,t,n){"use strict";n.d(t,{Ay:()=>r,hH:()=>s});var o=n(6540),a=n(4586),i=n(6654);function s(){const{siteConfig:e}=(0,a.A)(),{baseUrl:t,url:n}=e,s=e.future.experimental_router,r=(0,o.useCallback)((e,o)=>function({siteUrl:e,baseUrl:t,url:n,options:{forcePrependBaseUrl:o=!1,absolute:a=!1}={},router:s}){if(!n||n.startsWith("#")||(0,i.z)(n))return n;if("hash"===s)return n.startsWith("/")?`.${n}`:`./${n}`;if(o)return t+n.replace(/^\//,"");if(n===t.replace(/\/$/,""))return t;const r=n.startsWith(t)?n:t+n.replace(/^\//,"");return a?e+r:r}({siteUrl:n,baseUrl:t,url:e,options:o,router:s}),[n,t,s]);return{withBaseUrl:r}}function r(e,t={}){const{withBaseUrl:n}=s();return n(e,t)}},6125(e,t,n){"use strict";n.d(t,{o:()=>i,x:()=>s});var o=n(6540),a=n(4848);const i=o.createContext(!1);function s({children:e}){const[t,n]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{n(!0)},[]),(0,a.jsx)(i.Provider,{value:t,children:e})}},6134(e,t,n){"use strict";var o=n(1765),a=n(4784);!function(e){const{themeConfig:{prism:t}}=a.default,{additionalLanguages:o}=t,i=globalThis.Prism;globalThis.Prism=e,o.forEach(e=>{"php"===e&&n(9700),n(6159)(`./prism-${e}`)}),delete globalThis.Prism,void 0!==i&&(globalThis.Prism=e)}(o.My)},6159(e,t,n){var o={"./prism-bash":7022,"./prism-java":6976,"./prism-json":2514,"./prism-sql":6966,"./prism-yaml":83};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=i,e.exports=a,a.id=6159},6221(e,t,n){"use strict";var o=n(6540);function a(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var s={d:{f:i,r:function(){throw Error(a(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},r=Symbol.for("react.portal");var l=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(a(299));return function(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:r,key:null==o?null:""+o,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=s.p;try{if(l.T=null,s.p=2,e)return e()}finally{l.T=t,s.p=n,s.d.f()}},t.preconnect=function(e,t){"string"==typeof e&&(t?t="string"==typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,s.d.C(e,t))},t.prefetchDNS=function(e){"string"==typeof e&&s.d.D(e)},t.preinit=function(e,t){if("string"==typeof e&&t&&"string"==typeof t.as){var n=t.as,o=c(n,t.crossOrigin),a="string"==typeof t.integrity?t.integrity:void 0,i="string"==typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?s.d.S(e,"string"==typeof t.precedence?t.precedence:void 0,{crossOrigin:o,integrity:a,fetchPriority:i}):"script"===n&&s.d.X(e,{crossOrigin:o,integrity:a,fetchPriority:i,nonce:"string"==typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"==typeof e)if("object"==typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);s.d.M(e,{crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0})}}else null==t&&s.d.M(e)},t.preload=function(e,t){if("string"==typeof e&&"object"==typeof t&&null!==t&&"string"==typeof t.as){var n=t.as,o=c(n,t.crossOrigin);s.d.L(e,n,{crossOrigin:o,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0,type:"string"==typeof t.type?t.type:void 0,fetchPriority:"string"==typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"==typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"==typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"==typeof t.imageSizes?t.imageSizes:void 0,media:"string"==typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"==typeof e)if(t){var n=c(t.as,t.crossOrigin);s.d.m(e,{as:"string"==typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0})}else s.d.m(e)},t.requestFormReset=function(e){s.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.2.3"},6294(e,t,n){"use strict";n.r(t),n.d(t,{default:()=>i});var o=n(5947),a=n.n(o);a().configure({showSpinner:!1});const i={onRouteUpdate({location:e,previousLocation:t}){if(t&&e.pathname!==t.pathname){const e=window.setTimeout(()=>{a().start()},200);return()=>window.clearTimeout(e)}},onRouteDidUpdate(){a().done()}}},6342(e,t,n){"use strict";n.d(t,{p:()=>a});var o=n(4586);function a(){return(0,o.A)().siteConfig.themeConfig}},6347(e,t,n){"use strict";n.d(t,{B6:()=>T,Ix:()=>b,W6:()=>P,XZ:()=>y,dO:()=>x,qh:()=>_,zy:()=>k});var o=n(2892),a=n(6540),i=n(5556),s=n.n(i),r=n(1513),l=n(1561),c=n(8168),u=n(5302),d=n.n(u),p=(n(4363),n(8587)),m=(n(4146),1073741823),g="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:{};var f=a.createContext||function(e,t){var n,i,r="__create-react-context-"+function(){var e="__global_unique_id__";return g[e]=(g[e]||0)+1}()+"__",l=function(e){function n(){for(var t,n,o,a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(t=e.call.apply(e,[this].concat(i))||this).emitter=(n=t.props.value,o=[],{on:function(e){o.push(e)},off:function(e){o=o.filter(function(t){return t!==e})},get:function(){return n},set:function(e,t){n=e,o.forEach(function(e){return e(n,t)})}}),t}(0,o.A)(n,e);var a=n.prototype;return a.getChildContext=function(){var e;return(e={})[r]=this.emitter,e},a.componentWillReceiveProps=function(e){if(this.props.value!==e.value){var n,o=this.props.value,a=e.value;((i=o)===(s=a)?0!==i||1/i==1/s:i!=i&&s!=s)?n=0:(n="function"==typeof t?t(o,a):m,0!==(n|=0)&&this.emitter.set(e.value,n))}var i,s},a.render=function(){return this.props.children},n}(a.Component);l.childContextTypes=((n={})[r]=s().object.isRequired,n);var c=function(t){function n(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))||this).observedBits=void 0,e.state={value:e.getValue()},e.onUpdate=function(t,n){0!==((0|e.observedBits)&n)&&e.setState({value:e.getValue()})},e}(0,o.A)(n,t);var a=n.prototype;return a.componentWillReceiveProps=function(e){var t=e.observedBits;this.observedBits=null==t?m:t},a.componentDidMount=function(){this.context[r]&&this.context[r].on(this.onUpdate);var e=this.props.observedBits;this.observedBits=null==e?m:e},a.componentWillUnmount=function(){this.context[r]&&this.context[r].off(this.onUpdate)},a.getValue=function(){return this.context[r]?this.context[r].get():e},a.render=function(){return(e=this.props.children,Array.isArray(e)?e[0]:e)(this.state.value);var e},n}(a.Component);return c.contextTypes=((i={})[r]=s().object,i),{Provider:l,Consumer:c}},h=function(e){var t=f();return t.displayName=e,t},v=h("Router-History"),y=h("Router"),b=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={location:t.history.location},n._isMounted=!1,n._pendingLocation=null,t.staticContext||(n.unlisten=t.history.listen(function(e){n._pendingLocation=e})),n}(0,o.A)(t,e),t.computeRootMatch=function(e){return{path:"/",url:"/",params:{},isExact:"/"===e}};var n=t.prototype;return n.componentDidMount=function(){var e=this;this._isMounted=!0,this.unlisten&&this.unlisten(),this.props.staticContext||(this.unlisten=this.props.history.listen(function(t){e._isMounted&&e.setState({location:t})})),this._pendingLocation&&this.setState({location:this._pendingLocation})},n.componentWillUnmount=function(){this.unlisten&&(this.unlisten(),this._isMounted=!1,this._pendingLocation=null)},n.render=function(){return a.createElement(y.Provider,{value:{history:this.props.history,location:this.state.location,match:t.computeRootMatch(this.state.location.pathname),staticContext:this.props.staticContext}},a.createElement(v.Provider,{children:this.props.children||null,value:this.props.history}))},t}(a.Component);a.Component;a.Component;var E={},S=0;function T(e,t){void 0===t&&(t={}),("string"==typeof t||Array.isArray(t))&&(t={path:t});var n=t,o=n.path,a=n.exact,i=void 0!==a&&a,s=n.strict,r=void 0!==s&&s,l=n.sensitive,c=void 0!==l&&l;return[].concat(o).reduce(function(t,n){if(!n&&""!==n)return null;if(t)return t;var o=function(e,t){var n=""+t.end+t.strict+t.sensitive,o=E[n]||(E[n]={});if(o[e])return o[e];var a=[],i={regexp:d()(e,a,t),keys:a};return S<1e4&&(o[e]=i,S++),i}(n,{end:i,strict:r,sensitive:c}),a=o.regexp,s=o.keys,l=a.exec(e);if(!l)return null;var u=l[0],p=l.slice(1),m=e===u;return i&&!m?null:{path:n,url:"/"===n&&""===u?"/":u,isExact:m,params:s.reduce(function(e,t,n){return e[t.name]=p[n],e},{})}},null)}var _=function(e){function t(){return e.apply(this,arguments)||this}return(0,o.A)(t,e),t.prototype.render=function(){var e=this;return a.createElement(y.Consumer,null,function(t){t||(0,l.A)(!1);var n=e.props.location||t.location,o=e.props.computedMatch?e.props.computedMatch:e.props.path?T(n.pathname,e.props):t.match,i=(0,c.A)({},t,{location:n,match:o}),s=e.props,r=s.children,u=s.component,d=s.render;return Array.isArray(r)&&function(e){return 0===a.Children.count(e)}(r)&&(r=null),a.createElement(y.Provider,{value:i},i.match?r?"function"==typeof r?r(i):r:u?a.createElement(u,i):d?d(i):null:"function"==typeof r?r(i):null)})},t}(a.Component);function C(e){return"/"===e.charAt(0)?e:"/"+e}function I(e,t){if(!e)return t;var n=C(e);return 0!==t.pathname.indexOf(n)?t:(0,c.A)({},t,{pathname:t.pathname.substr(n.length)})}function R(e){return"string"==typeof e?e:(0,r.AO)(e)}function A(e){return function(){(0,l.A)(!1)}}function N(){}a.Component;var x=function(e){function t(){return e.apply(this,arguments)||this}return(0,o.A)(t,e),t.prototype.render=function(){var e=this;return a.createElement(y.Consumer,null,function(t){t||(0,l.A)(!1);var n,o,i=e.props.location||t.location;return a.Children.forEach(e.props.children,function(e){if(null==o&&a.isValidElement(e)){n=e;var s=e.props.path||e.props.from;o=s?T(i.pathname,(0,c.A)({},e.props,{path:s})):t.match}}),o?a.cloneElement(n,{location:i,computedMatch:o}):null})},t}(a.Component);var w=a.useContext;function P(){return w(v)}function k(){return w(y).location}},6540(e,t,n){"use strict";e.exports=n(9869)},6654(e,t,n){"use strict";function o(e){return/^(?:\w*:|\/\/)/.test(e)}function a(e){return void 0!==e&&!o(e)}n.d(t,{A:()=>a,z:()=>o})},6803(e,t,n){"use strict";n.d(t,{A:()=>i});var o=n(6540),a=n(3102);function i(){const e=o.useContext(a.o);if(!e)throw new Error("Unexpected: no Docusaurus route context found");return e}},6921(e,t,n){"use strict";n.d(t,{A:()=>o});function o(e){const t={};return function e(n,o){Object.entries(n).forEach(([n,a])=>{const i=o?`${o}.${n}`:n;var s;"object"==typeof(s=a)&&s&&Object.keys(s).length>0?e(a,i):t[i]=a})}(e),t}},6925(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},6966(){Prism.languages.sql={comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|(?:--|\/\/|#).*)/,lookbehind:!0},variable:[{pattern:/@(["'`])(?:\\[\s\S]|(?!\1)[^\\])+\1/,greedy:!0},/@[\w.$]+/],string:{pattern:/(^|[^@\\])("|')(?:\\[\s\S]|(?!\2)[^\\]|\2\2)*\2/,greedy:!0,lookbehind:!0},identifier:{pattern:/(^|[^@\\])`(?:\\[\s\S]|[^`\\]|``)*`/,greedy:!0,lookbehind:!0,inside:{punctuation:/^`|`$/}},function:/\b(?:AVG|COUNT|FIRST|FORMAT|LAST|LCASE|LEN|MAX|MID|MIN|MOD|NOW|ROUND|SUM|UCASE)(?=\s*\()/i,keyword:/\b(?:ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR(?:ACTER|SET)?|CHECK(?:POINT)?|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMNS?|COMMENT|COMMIT(?:TED)?|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS(?:TABLE)?|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|CYCLE|DATA(?:BASES?)?|DATE(?:TIME)?|DAY|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITERS?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE|ELSE(?:IF)?|ENABLE|ENCLOSED|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPED?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|HOUR|IDENTITY(?:COL|_INSERT)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTERVAL|INTO|INVOKER|ISOLATION|ITERATE|JOIN|KEYS?|KILL|LANGUAGE|LAST|LEAVE|LEFT|LEVEL|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|LOOP|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MINUTE|MODE|MODIFIES|MODIFY|MONTH|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL|NATURAL|NCHAR|NEXT|NO|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREPARE|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READS?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEAT(?:ABLE)?|REPLACE|REPLICATION|REQUIRE|RESIGNAL|RESTORE|RESTRICT|RETURN(?:ING|S)?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SECOND|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|SQL|START(?:ING)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED|TEXT(?:SIZE)?|THEN|TIME(?:STAMP)?|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNLOCK|UNPIVOT|UNSIGNED|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?|YEAR)\b/i,boolean:/\b(?:FALSE|NULL|TRUE)\b/i,number:/\b0x[\da-f]+\b|\b\d+(?:\.\d*)?|\B\.\d+\b/i,operator:/[-+*\/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|DIV|ILIKE|IN|IS|LIKE|NOT|OR|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/i,punctuation:/[;[\]()`,.]/}},6972(e,t,n){"use strict";n.d(t,{B5:()=>T,Nr:()=>p,OF:()=>y,QB:()=>S,Vd:()=>b,Y:()=>h,fW:()=>E,w8:()=>g});var o=n(6540),a=n(6347),i=n(2831),s=n(4070),r=n(9169),l=n(1682),c=n(3886),u=n(3025),d=n(609);function p(e){return"link"!==e.type||e.unlisted?"category"===e.type?function(e){if(e.href&&!e.linkUnlisted)return e.href;for(const t of e.items){const e=p(t);if(e)return e}}(e):void 0:e.href}const m=(e,t)=>void 0!==e&&(0,r.ys)(e,t);function g(e,t){return"link"===e.type?m(e.href,t):"category"===e.type&&(m(e.href,t)||((e,t)=>e.some(e=>g(e,t)))(e.items,t))}function f(e,t){switch(e.type){case"category":return g(e,t)||void 0!==e.href&&!e.linkUnlisted||e.items.some(e=>f(e,t));case"link":return!e.unlisted||g(e,t);default:return!0}}function h(e,t){return(0,o.useMemo)(()=>e.filter(e=>f(e,t)),[e,t])}function v({sidebarItems:e,pathname:t,onlyCategories:n=!1}){const o=[];return function e(a){for(const i of a)if("category"===i.type&&((0,r.ys)(i.href,t)||e(i.items))||"link"===i.type&&(0,r.ys)(i.href,t)){return n&&"category"!==i.type||o.unshift(i),!0}return!1}(e),o}function y(){const e=(0,d.t)(),{pathname:t}=(0,a.zy)(),n=(0,s.vT)()?.pluginData.breadcrumbs;return!1!==n&&e?v({sidebarItems:e.items,pathname:t}):null}function b(e){const{activeVersion:t}=(0,s.zK)(e),{preferredVersion:n}=(0,c.g1)(e),a=(0,s.r7)(e);return(0,o.useMemo)(()=>(0,l.sb)([t,n,a].filter(Boolean)),[t,n,a])}function E(e,t){const n=b(t);return(0,o.useMemo)(()=>{const t=n.flatMap(e=>e.sidebars?Object.entries(e.sidebars):[]),o=t.find(t=>t[0]===e);if(!o)throw new Error(`Can't find any sidebar with id "${e}" in version${n.length>1?"s":""} ${n.map(e=>e.name).join(", ")}".\nAvailable sidebar ids are:\n- ${t.map(e=>e[0]).join("\n- ")}`);return o[1]},[e,n])}function S(e,t){const n=b(t);return(0,o.useMemo)(()=>{const t=n.flatMap(e=>e.docs),o=t.find(t=>t.id===e);if(!o){if(n.flatMap(e=>e.draftIds).includes(e))return null;throw new Error(`Couldn't find any doc with id "${e}" in version${n.length>1?"s":""} "${n.map(e=>e.name).join(", ")}".\nAvailable doc ids are:\n- ${(0,l.sb)(t.map(e=>e.id)).join("\n- ")}`)}return o},[e,n])}function T({route:e}){const t=(0,a.zy)(),n=(0,u.r)(),o=e.routes,s=o.find(e=>(0,a.B6)(t.pathname,e));if(!s)return null;const r=s.sidebar,l=r?n.docsSidebars[r]:void 0;return{docElement:(0,i.v)(o),sidebarName:r,sidebarItems:l}}},6976(){!function(e){var t=/\b(?:abstract|assert|boolean|break|byte|case|catch|char|class|const|continue|default|do|double|else|enum|exports|extends|final|finally|float|for|goto|if|implements|import|instanceof|int|interface|long|module|native|new|non-sealed|null|open|opens|package|permits|private|protected|provides|public|record(?!\s*[(){}[\]<>=%~.:,;?+\-*/&|^])|requires|return|sealed|short|static|strictfp|super|switch|synchronized|this|throw|throws|to|transient|transitive|try|uses|var|void|volatile|while|with|yield)\b/,n=/(?:[a-z]\w*\s*\.\s*)*(?:[A-Z]\w*\s*\.\s*)*/.source,o={pattern:RegExp(/(^|[^\w.])/.source+n+/[A-Z](?:[\d_A-Z]*[a-z]\w*)?\b/.source),lookbehind:!0,inside:{namespace:{pattern:/^[a-z]\w*(?:\s*\.\s*[a-z]\w*)*(?:\s*\.)?/,inside:{punctuation:/\./}},punctuation:/\./}};e.languages.java=e.languages.extend("clike",{string:{pattern:/(^|[^\\])"(?:\\.|[^"\\\r\n])*"/,lookbehind:!0,greedy:!0},"class-name":[o,{pattern:RegExp(/(^|[^\w.])/.source+n+/[A-Z]\w*(?=\s+\w+\s*[;,=()]|\s*(?:\[[\s,]*\]\s*)?::\s*new\b)/.source),lookbehind:!0,inside:o.inside},{pattern:RegExp(/(\b(?:class|enum|extends|implements|instanceof|interface|new|record|throws)\s+)/.source+n+/[A-Z]\w*\b/.source),lookbehind:!0,inside:o.inside}],keyword:t,function:[e.languages.clike.function,{pattern:/(::\s*)[a-z_]\w*/,lookbehind:!0}],number:/\b0b[01][01_]*L?\b|\b0x(?:\.[\da-f_p+-]+|[\da-f_]+(?:\.[\da-f_p+-]+)?)\b|(?:\b\d[\d_]*(?:\.[\d_]*)?|\B\.\d[\d_]*)(?:e[+-]?\d[\d_]*)?[dfl]?/i,operator:{pattern:/(^|[^.])(?:<<=?|>>>?=?|->|--|\+\+|&&|\|\||::|[?:~]|[-+*/%&|^!=<>]=?)/m,lookbehind:!0},constant:/\b[A-Z][A-Z_\d]+\b/}),e.languages.insertBefore("java","string",{"triple-quoted-string":{pattern:/"""[ \t]*[\r\n](?:(?:"|"")?(?:\\.|[^"\\]))*"""/,greedy:!0,alias:"string"},char:{pattern:/'(?:\\.|[^'\\\r\n]){1,6}'/,greedy:!0}}),e.languages.insertBefore("java","class-name",{annotation:{pattern:/(^|[^.])@\w+(?:\s*\.\s*\w+)*/,lookbehind:!0,alias:"punctuation"},generics:{pattern:/<(?:[\w\s,.?]|&(?!&)|<(?:[\w\s,.?]|&(?!&)|<(?:[\w\s,.?]|&(?!&)|<(?:[\w\s,.?]|&(?!&))*>)*>)*>)*>/,inside:{"class-name":o,keyword:t,punctuation:/[<>(),.:]/,operator:/[?&|]/}},import:[{pattern:RegExp(/(\bimport\s+)/.source+n+/(?:[A-Z]\w*|\*)(?=\s*;)/.source),lookbehind:!0,inside:{namespace:o.inside.namespace,punctuation:/\./,operator:/\*/,"class-name":/\w+/}},{pattern:RegExp(/(\bimport\s+static\s+)/.source+n+/(?:\w+|\*)(?=\s*;)/.source),lookbehind:!0,alias:"static",inside:{namespace:o.inside.namespace,static:/\b\w+$/,punctuation:/\./,operator:/\*/,"class-name":/\w+/}}],namespace:{pattern:RegExp(/(\b(?:exports|import(?:\s+static)?|module|open|opens|package|provides|requires|to|transitive|uses|with)\s+)(?!<keyword>)[a-z]\w*(?:\.[a-z]\w*)*\.?/.source.replace(/<keyword>/g,function(){return t.source})),lookbehind:!0,inside:{punctuation:/\./}}})}(Prism)},6988(e,t,n){"use strict";n.d(t,{o:()=>d,l:()=>p});var o=n(6540),a=n(4784);const i=JSON.parse('{"docusaurus-plugin-content-docs":{"v2":{"path":"/docs/v2","versions":[{"name":"current","label":"Next","isLast":true,"path":"/docs/v2","mainDocId":"overview","docs":[{"id":"api/audit-trace","path":"/docs/v2/api/audit-trace","sidebar":"docSidebar"},{"id":"api/java-api","path":"/docs/v2/api/java-api","sidebar":"docSidebar"},{"id":"api/rest-api","path":"/docs/v2/api/rest-api","sidebar":"docSidebar"},{"id":"api/stream-api","path":"/docs/v2/api/stream-api","sidebar":"docSidebar"},{"id":"architecture","path":"/docs/v2/architecture","sidebar":"docSidebar"},{"id":"consumer/annotations-reference","path":"/docs/v2/consumer/annotations-reference","sidebar":"docSidebar"},{"id":"consumer/backend-integration","path":"/docs/v2/consumer/backend-integration","sidebar":"docSidebar"},{"id":"consumer/caching-and-persistence","path":"/docs/v2/consumer/caching-and-persistence","sidebar":"docSidebar"},{"id":"consumer/configuration","path":"/docs/v2/consumer/configuration","sidebar":"docSidebar"},{"id":"consumer/extensions","path":"/docs/v2/consumer/extensions","sidebar":"docSidebar"},{"id":"consumer/index","path":"/docs/v2/consumer/","sidebar":"docSidebar"},{"id":"consumer/mcp/advanced","path":"/docs/v2/consumer/mcp/advanced","sidebar":"docSidebar"},{"id":"consumer/mcp/basics","path":"/docs/v2/consumer/mcp/basics","sidebar":"docSidebar"},{"id":"consumer/mcp/deep-dive","path":"/docs/v2/consumer/mcp/deep-dive","sidebar":"docSidebar"},{"id":"consumer/mcp/example1","path":"/docs/v2/consumer/mcp/example1","sidebar":"docSidebar"},{"id":"consumer/mcp/example2","path":"/docs/v2/consumer/mcp/example2","sidebar":"docSidebar"},{"id":"consumer/mcp/http-tool","path":"/docs/v2/consumer/mcp/http-tool","sidebar":"docSidebar"},{"id":"consumer/new-consumer-onboarding","path":"/docs/v2/consumer/new-consumer-onboarding","sidebar":"docSidebar"},{"id":"consumer/session-reset-and-continuity","path":"/docs/v2/consumer/session-reset-and-continuity","sidebar":"docSidebar"},{"id":"consumer/ui-integration","path":"/docs/v2/consumer/ui-integration","sidebar":"docSidebar"},{"id":"deep-dive/data-model","path":"/docs/v2/deep-dive/data-model","sidebar":"docSidebar"},{"id":"deep-dive/developer-guide","path":"/docs/v2/deep-dive/developer-guide","sidebar":"docSidebar"},{"id":"deep-dive/examples","path":"/docs/v2/deep-dive/examples","sidebar":"docSidebar"},{"id":"deep-dive/failure-gotchas","path":"/docs/v2/deep-dive/failure-gotchas","sidebar":"docSidebar"},{"id":"deep-dive/file-map","path":"/docs/v2/deep-dive/file-map","sidebar":"docSidebar"},{"id":"deep-dive/improvement-backlog","path":"/docs/v2/deep-dive/improvement-backlog","sidebar":"docSidebar"},{"id":"deep-dive/index","path":"/docs/v2/deep-dive/","sidebar":"docSidebar"},{"id":"deep-dive/intent-and-schema","path":"/docs/v2/deep-dive/intent-and-schema","sidebar":"docSidebar"},{"id":"deep-dive/lifecycle","path":"/docs/v2/deep-dive/lifecycle","sidebar":"docSidebar"},{"id":"deep-dive/mcp-audit","path":"/docs/v2/deep-dive/mcp-audit","sidebar":"docSidebar"},{"id":"deep-dive/pipeline-steps","path":"/docs/v2/deep-dive/pipeline-steps","sidebar":"docSidebar"},{"id":"deep-dive/request-lifecycle","path":"/docs/v2/deep-dive/request-lifecycle"},{"id":"deep-dive/rules-responses","path":"/docs/v2/deep-dive/rules-responses","sidebar":"docSidebar"},{"id":"deep-dive/v2-features","path":"/docs/v2/deep-dive/v2-features","sidebar":"docSidebar"},{"id":"examples","path":"/docs/v2/examples","sidebar":"docSidebar"},{"id":"faq","path":"/docs/v2/faq","sidebar":"docSidebar"},{"id":"local-development","path":"/docs/v2/local-development","sidebar":"docSidebar"},{"id":"overview","path":"/docs/v2/overview","sidebar":"docSidebar"},{"id":"version-history","path":"/docs/v2/version-history","sidebar":"docSidebar"}],"draftIds":[],"sidebars":{"docSidebar":{"link":{"path":"/docs/v2/overview","label":"overview"}}}}],"breadcrumbs":true},"v1":{"path":"/docs/v1","versions":[{"name":"current","label":"Next","isLast":true,"path":"/docs/v1","mainDocId":"overview","docs":[{"id":"api/audit-trace","path":"/docs/v1/api/audit-trace","sidebar":"docSidebar"},{"id":"api/java-api","path":"/docs/v1/api/java-api","sidebar":"docSidebar"},{"id":"api/rest-api","path":"/docs/v1/api/rest-api","sidebar":"docSidebar"},{"id":"api/stream-api","path":"/docs/v1/api/stream-api","sidebar":"docSidebar"},{"id":"architecture","path":"/docs/v1/architecture","sidebar":"docSidebar"},{"id":"consumer/annotations-reference","path":"/docs/v1/consumer/annotations-reference","sidebar":"docSidebar"},{"id":"consumer/backend-integration","path":"/docs/v1/consumer/backend-integration","sidebar":"docSidebar"},{"id":"consumer/configuration","path":"/docs/v1/consumer/configuration","sidebar":"docSidebar"},{"id":"consumer/extensions","path":"/docs/v1/consumer/extensions","sidebar":"docSidebar"},{"id":"consumer/index","path":"/docs/v1/consumer/","sidebar":"docSidebar"},{"id":"consumer/new-consumer-onboarding","path":"/docs/v1/consumer/new-consumer-onboarding","sidebar":"docSidebar"},{"id":"consumer/session-reset-and-continuity","path":"/docs/v1/consumer/session-reset-and-continuity","sidebar":"docSidebar"},{"id":"consumer/ui-integration","path":"/docs/v1/consumer/ui-integration","sidebar":"docSidebar"},{"id":"deep-dive/data-model","path":"/docs/v1/deep-dive/data-model","sidebar":"docSidebar"},{"id":"deep-dive/developer-guide","path":"/docs/v1/deep-dive/developer-guide","sidebar":"docSidebar"},{"id":"deep-dive/examples","path":"/docs/v1/deep-dive/examples","sidebar":"docSidebar"},{"id":"deep-dive/failure-gotchas","path":"/docs/v1/deep-dive/failure-gotchas","sidebar":"docSidebar"},{"id":"deep-dive/file-map","path":"/docs/v1/deep-dive/file-map","sidebar":"docSidebar"},{"id":"deep-dive/improvement-backlog","path":"/docs/v1/deep-dive/improvement-backlog","sidebar":"docSidebar"},{"id":"deep-dive/index","path":"/docs/v1/deep-dive/","sidebar":"docSidebar"},{"id":"deep-dive/intent-and-schema","path":"/docs/v1/deep-dive/intent-and-schema","sidebar":"docSidebar"},{"id":"deep-dive/lifecycle","path":"/docs/v1/deep-dive/lifecycle","sidebar":"docSidebar"},{"id":"deep-dive/mcp-audit","path":"/docs/v1/deep-dive/mcp-audit","sidebar":"docSidebar"},{"id":"deep-dive/pipeline-steps","path":"/docs/v1/deep-dive/pipeline-steps","sidebar":"docSidebar"},{"id":"deep-dive/request-lifecycle","path":"/docs/v1/deep-dive/request-lifecycle"},{"id":"deep-dive/rules-responses","path":"/docs/v1/deep-dive/rules-responses","sidebar":"docSidebar"},{"id":"examples","path":"/docs/v1/examples","sidebar":"docSidebar"},{"id":"local-development","path":"/docs/v1/local-development","sidebar":"docSidebar"},{"id":"overview","path":"/docs/v1/overview","sidebar":"docSidebar"},{"id":"version-history","path":"/docs/v1/version-history","sidebar":"docSidebar"}],"draftIds":[],"sidebars":{"docSidebar":{"link":{"path":"/docs/v1/overview","label":"overview"}}}}],"breadcrumbs":true}}}'),s=JSON.parse('{"defaultLocale":"en","locales":["en"],"path":"i18n","currentLocale":"en","localeConfigs":{"en":{"label":"English","direction":"ltr","htmlLang":"en","calendar":"gregory","path":"en","translate":false,"url":"https://salilvnair.com","baseUrl":"/"}}}');var r=n(2654);const l=JSON.parse('{"docusaurusVersion":"3.9.2","siteVersion":"0.0.0","pluginVersions":{"docusaurus-plugin-css-cascade-layers":{"type":"package","name":"@docusaurus/plugin-css-cascade-layers","version":"3.9.2"},"docusaurus-plugin-content-pages":{"type":"package","name":"@docusaurus/plugin-content-pages","version":"3.9.2"},"docusaurus-plugin-sitemap":{"type":"package","name":"@docusaurus/plugin-sitemap","version":"3.9.2"},"docusaurus-plugin-svgr":{"type":"package","name":"@docusaurus/plugin-svgr","version":"3.9.2"},"docusaurus-theme-classic":{"type":"package","name":"@docusaurus/theme-classic","version":"3.9.2"},"docusaurus-plugin-content-docs":{"type":"package","name":"@docusaurus/plugin-content-docs","version":"3.9.2"}}}');var c=n(4848);const u={siteConfig:a.default,siteMetadata:l,globalData:i,i18n:s,codeTranslations:r},d=o.createContext(u);function p({children:e}){return(0,c.jsx)(d.Provider,{value:u,children:e})}},7022(){!function(e){var t="\\b(?:BASH|BASHOPTS|BASH_ALIASES|BASH_ARGC|BASH_ARGV|BASH_CMDS|BASH_COMPLETION_COMPAT_DIR|BASH_LINENO|BASH_REMATCH|BASH_SOURCE|BASH_VERSINFO|BASH_VERSION|COLORTERM|COLUMNS|COMP_WORDBREAKS|DBUS_SESSION_BUS_ADDRESS|DEFAULTS_PATH|DESKTOP_SESSION|DIRSTACK|DISPLAY|EUID|GDMSESSION|GDM_LANG|GNOME_KEYRING_CONTROL|GNOME_KEYRING_PID|GPG_AGENT_INFO|GROUPS|HISTCONTROL|HISTFILE|HISTFILESIZE|HISTSIZE|HOME|HOSTNAME|HOSTTYPE|IFS|INSTANCE|JOB|LANG|LANGUAGE|LC_ADDRESS|LC_ALL|LC_IDENTIFICATION|LC_MEASUREMENT|LC_MONETARY|LC_NAME|LC_NUMERIC|LC_PAPER|LC_TELEPHONE|LC_TIME|LESSCLOSE|LESSOPEN|LINES|LOGNAME|LS_COLORS|MACHTYPE|MAILCHECK|MANDATORY_PATH|NO_AT_BRIDGE|OLDPWD|OPTERR|OPTIND|ORBIT_SOCKETDIR|OSTYPE|PAPERSIZE|PATH|PIPESTATUS|PPID|PS1|PS2|PS3|PS4|PWD|RANDOM|REPLY|SECONDS|SELINUX_INIT|SESSION|SESSIONTYPE|SESSION_MANAGER|SHELL|SHELLOPTS|SHLVL|SSH_AUTH_SOCK|TERM|UID|UPSTART_EVENTS|UPSTART_INSTANCE|UPSTART_JOB|UPSTART_SESSION|USER|WINDOWID|XAUTHORITY|XDG_CONFIG_DIRS|XDG_CURRENT_DESKTOP|XDG_DATA_DIRS|XDG_GREETER_DATA_DIR|XDG_MENU_PREFIX|XDG_RUNTIME_DIR|XDG_SEAT|XDG_SEAT_PATH|XDG_SESSION_DESKTOP|XDG_SESSION_ID|XDG_SESSION_PATH|XDG_SESSION_TYPE|XDG_VTNR|XMODIFIERS)\\b",n={pattern:/(^(["']?)\w+\2)[ \t]+\S.*/,lookbehind:!0,alias:"punctuation",inside:null},o={bash:n,environment:{pattern:RegExp("\\$"+t),alias:"constant"},variable:[{pattern:/\$?\(\([\s\S]+?\)\)/,greedy:!0,inside:{variable:[{pattern:/(^\$\(\([\s\S]+)\)\)/,lookbehind:!0},/^\$\(\(/],number:/\b0x[\dA-Fa-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:[Ee]-?\d+)?/,operator:/--|\+\+|\*\*=?|<<=?|>>=?|&&|\|\||[=!+\-*/%<>^&|]=?|[?~:]/,punctuation:/\(\(?|\)\)?|,|;/}},{pattern:/\$\((?:\([^)]+\)|[^()])+\)|`[^`]+`/,greedy:!0,inside:{variable:/^\$\(|^`|\)$|`$/}},{pattern:/\$\{[^}]+\}/,greedy:!0,inside:{operator:/:[-=?+]?|[!\/]|##?|%%?|\^\^?|,,?/,punctuation:/[\[\]]/,environment:{pattern:RegExp("(\\{)"+t),lookbehind:!0,alias:"constant"}}},/\$(?:\w+|[#?*!@$])/],entity:/\\(?:[abceEfnrtv\\"]|O?[0-7]{1,3}|U[0-9a-fA-F]{8}|u[0-9a-fA-F]{4}|x[0-9a-fA-F]{1,2})/};e.languages.bash={shebang:{pattern:/^#!\s*\/.*/,alias:"important"},comment:{pattern:/(^|[^"{\\$])#.*/,lookbehind:!0},"function-name":[{pattern:/(\bfunction\s+)[\w-]+(?=(?:\s*\(?:\s*\))?\s*\{)/,lookbehind:!0,alias:"function"},{pattern:/\b[\w-]+(?=\s*\(\s*\)\s*\{)/,alias:"function"}],"for-or-select":{pattern:/(\b(?:for|select)\s+)\w+(?=\s+in\s)/,alias:"variable",lookbehind:!0},"assign-left":{pattern:/(^|[\s;|&]|[<>]\()\w+(?:\.\w+)*(?=\+?=)/,inside:{environment:{pattern:RegExp("(^|[\\s;|&]|[<>]\\()"+t),lookbehind:!0,alias:"constant"}},alias:"variable",lookbehind:!0},parameter:{pattern:/(^|\s)-{1,2}(?:\w+:[+-]?)?\w+(?:\.\w+)*(?=[=\s]|$)/,alias:"variable",lookbehind:!0},string:[{pattern:/((?:^|[^<])<<-?\s*)(\w+)\s[\s\S]*?(?:\r?\n|\r)\2/,lookbehind:!0,greedy:!0,inside:o},{pattern:/((?:^|[^<])<<-?\s*)(["'])(\w+)\2\s[\s\S]*?(?:\r?\n|\r)\3/,lookbehind:!0,greedy:!0,inside:{bash:n}},{pattern:/(^|[^\\](?:\\\\)*)"(?:\\[\s\S]|\$\([^)]+\)|\$(?!\()|`[^`]+`|[^"\\`$])*"/,lookbehind:!0,greedy:!0,inside:o},{pattern:/(^|[^$\\])'[^']*'/,lookbehind:!0,greedy:!0},{pattern:/\$'(?:[^'\\]|\\[\s\S])*'/,greedy:!0,inside:{entity:o.entity}}],environment:{pattern:RegExp("\\$?"+t),alias:"constant"},variable:o.variable,function:{pattern:/(^|[\s;|&]|[<>]\()(?:add|apropos|apt|apt-cache|apt-get|aptitude|aspell|automysqlbackup|awk|basename|bash|bc|bconsole|bg|bzip2|cal|cargo|cat|cfdisk|chgrp|chkconfig|chmod|chown|chroot|cksum|clear|cmp|column|comm|composer|cp|cron|crontab|csplit|curl|cut|date|dc|dd|ddrescue|debootstrap|df|diff|diff3|dig|dir|dircolors|dirname|dirs|dmesg|docker|docker-compose|du|egrep|eject|env|ethtool|expand|expect|expr|fdformat|fdisk|fg|fgrep|file|find|fmt|fold|format|free|fsck|ftp|fuser|gawk|git|gparted|grep|groupadd|groupdel|groupmod|groups|grub-mkconfig|gzip|halt|head|hg|history|host|hostname|htop|iconv|id|ifconfig|ifdown|ifup|import|install|ip|java|jobs|join|kill|killall|less|link|ln|locate|logname|logrotate|look|lpc|lpr|lprint|lprintd|lprintq|lprm|ls|lsof|lynx|make|man|mc|mdadm|mkconfig|mkdir|mke2fs|mkfifo|mkfs|mkisofs|mknod|mkswap|mmv|more|most|mount|mtools|mtr|mutt|mv|nano|nc|netstat|nice|nl|node|nohup|notify-send|npm|nslookup|op|open|parted|passwd|paste|pathchk|ping|pkill|pnpm|podman|podman-compose|popd|pr|printcap|printenv|ps|pushd|pv|quota|quotacheck|quotactl|ram|rar|rcp|reboot|remsync|rename|renice|rev|rm|rmdir|rpm|rsync|scp|screen|sdiff|sed|sendmail|seq|service|sftp|sh|shellcheck|shuf|shutdown|sleep|slocate|sort|split|ssh|stat|strace|su|sudo|sum|suspend|swapon|sync|sysctl|tac|tail|tar|tee|time|timeout|top|touch|tr|traceroute|tsort|tty|umount|uname|unexpand|uniq|units|unrar|unshar|unzip|update-grub|uptime|useradd|userdel|usermod|users|uudecode|uuencode|v|vcpkg|vdir|vi|vim|virsh|vmstat|wait|watch|wc|wget|whereis|which|who|whoami|write|xargs|xdg-open|yarn|yes|zenity|zip|zsh|zypper)(?=$|[)\s;|&])/,lookbehind:!0},keyword:{pattern:/(^|[\s;|&]|[<>]\()(?:case|do|done|elif|else|esac|fi|for|function|if|in|select|then|until|while)(?=$|[)\s;|&])/,lookbehind:!0},builtin:{pattern:/(^|[\s;|&]|[<>]\()(?:\.|:|alias|bind|break|builtin|caller|cd|command|continue|declare|echo|enable|eval|exec|exit|export|getopts|hash|help|let|local|logout|mapfile|printf|pwd|read|readarray|readonly|return|set|shift|shopt|source|test|times|trap|type|typeset|ulimit|umask|unalias|unset)(?=$|[)\s;|&])/,lookbehind:!0,alias:"class-name"},boolean:{pattern:/(^|[\s;|&]|[<>]\()(?:false|true)(?=$|[)\s;|&])/,lookbehind:!0},"file-descriptor":{pattern:/\B&\d\b/,alias:"important"},operator:{pattern:/\d?<>|>\||\+=|=[=~]?|!=?|<<[<-]?|[&\d]?>>|\d[<>]&?|[<>][&=]?|&[>&]?|\|[&|]?/,inside:{"file-descriptor":{pattern:/^\d/,alias:"important"}}},punctuation:/\$?\(\(?|\)\)?|\.\.|[{}[\];\\]/,number:{pattern:/(^|\s)(?:[1-9]\d*|0)(?:[.,]\d+)?\b/,lookbehind:!0}},n.inside=e.languages.bash;for(var a=["comment","function-name","for-or-select","assign-left","parameter","string","environment","function","keyword","builtin","boolean","file-descriptor","operator","punctuation","number"],i=o.variable[1].inside,s=0;s<a.length;s++)i[a[s]]=e.languages.bash[a[s]];e.languages.sh=e.languages.bash,e.languages.shell=e.languages.bash}(Prism)},7065(e,t,n){"use strict";n.d(t,{W:()=>o});const o="default"},7295(e){"use strict";e.exports=JSON.parse('[{"id":"api/audit-trace.mdx","version":"v2","title":"audit trace","permalink":"/docs/v2/api/audit-trace","content":"Audit Trace API Endpoint GET /api/v1/conversation/audit/ /trace Response shape ], \\"stages\\": [ } ] } } Why this endpoint exists separates timeline from raw audit payload parsing easier UI rendering for runbooks and debug tools complements ce_conversation_history , which stores normalized user/AI turns even when audit persistence runs deferred preserves both domain and technical stages Use both endpoints together: /audit/ for raw forensic payload, /audit/ /trace for step flow visualization.","rawContent":"# Audit Trace API ## Endpoint GET /api/v1/conversation/audit/{conversationId}/trace ## Response shape <CodeBlockToggle title=\\"Trace response\\" language=\\"json\\" defaultOpen={true}> { { \\"conversationId\\": \\"9bf7540a-b129-4685-a120-730e8a0cb94b\\", \\"steps\\": [ { \\"step\\": \\"IntentResolutionStep\\", \\"stepClass\\": \\"com.github.salilvnair.convengine.engine.steps.IntentResolutionStep\\", \\"status\\": \\"OK\\", \\"startedAt\\": \\"2026-02-14T10:22:01.102Z\\", \\"endedAt\\": \\"2026-02-14T10:22:01.147Z\\", \\"durationMs\\": 45, \\"error\\": null, \\"stages\\": [] } ], \\"stages\\": [ { \\"auditId\\": 12031, \\"stage\\": \\"STEP_ENTER\\", \\"createdAt\\": \\"2026-02-14T10:22:01.102Z\\", \\"payload\\": { \\"step\\": \\"IntentResolutionStep\\" } } ] } } </CodeBlockToggle> ## Why this endpoint exists - separates timeline from raw audit payload parsing - easier UI rendering for runbooks and debug tools - complements ce_conversation_history , which stores normalized user/AI turns even when audit persistence runs deferred - preserves both domain and technical stages <Highlight type=\\"tip\\" title=\\"Best practice\\"> Use both endpoints together: /audit/{id} for raw forensic payload, /audit/{id}/trace for step-flow visualization. </Highlight>","excerpt":"Audit Trace API Endpoint GET /api/v1/conversation/audit/ /trace Response shape ], \\"stages\\": [ } ] } } Why this endpoint exists separates timeline from raw audit payload parsing easier UI rendering for runbooks and debug \u2026"},{"id":"api/java-api.mdx","version":"v2","title":"java api","permalink":"/docs/v2/api/java-api","content":"Java API (Core Contracts) Entry points } } } } } default void write(EngineSession session, String summary) } } Flow configuration API Extension contracts ResponseTransformerHandler ContainerDataTransformerHandler rule task execution pathway via SET_TASK pending action execution via CeTaskExecutor tool adapters through McpToolExecutor implementations","rawContent":"# Java API (Core Contracts) ## Entry points <DbTable title=\\"Primary interfaces\\" columns={[\\"Type\\", \\"Package\\", \\"Role\\"]} rows={[ [\\"ConversationalEngine\\", \\"engine.core\\", \\"Main process method\\"], [\\"LlmClient\\", \\"llm.core\\", \\"LLM adapter contract\\"], [\\"EngineStep\\", \\"engine.pipeline\\", \\"Step unit contract\\"], [\\"EngineStepHook\\", \\"engine.hook\\", \\"Step interception contract\\"], [\\"McpToolExecutor\\", \\"engine.mcp.executor\\", \\"Tool-group executor contract\\"], [\\"ConversationMemoryStore\\", \\"engine.memory\\", \\"Pluggable memory adapter\\"], [\\"CeTask\\", \\"engine.task\\", \\"Task contract for pending/rule execution\\"], ]} /> <CodeBlockToggle title=\\"ConversationalEngine\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.core\\"> { public interface ConversationalEngine { EngineResult process(EngineContext engineContext); } } </CodeBlockToggle> <CodeBlockToggle title=\\"LlmClient\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.llm.core\\"> { public interface LlmClient { String generateText(String hint, String contextJson); String generateJson(String hint, String jsonSchema, String contextJson); float[] generateEmbedding(String input); } } </CodeBlockToggle> <CodeBlockToggle title=\\"EngineStep.Name enum (current)\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.pipeline\\"> { public interface EngineStep { enum Name { AuditUserInputStep, CacheInspectAuditStep, DialogueActStep, InteractionPolicyStep, ActionLifecycleStep, DisambiguationStep, GuardrailStep, IntentResolutionStep, AddContainerDataStep, SchemaExtractionStep, PendingActionStep, ToolOrchestrationStep, StateGraphStep, ResponseResolutionStep, MemoryStep, AutoAdvanceStep, McpToolStep, LoadOrCreateConversationStep, FallbackIntentStateStep, PersistConversationBootstrapStep, ResetConversationStep, PersistConversationStep, PipelineEndGuardStep, ResetResolvedIntentStep, PolicyEnforcementStep, RulesStep, Unknown; } } } </CodeBlockToggle> <CodeBlockToggle title=\\"McpToolExecutor\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.mcp.executor\\"> { public interface McpToolExecutor { String toolGroup(); String execute(CeMcpTool tool, Map<String, Object> args, EngineSession session); } } </CodeBlockToggle> <CodeBlockToggle title=\\"ConversationMemoryStore\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.memory\\"> { public interface ConversationMemoryStore { default String read(EngineSession session) { return null; } default void write(EngineSession session, String summary) {} } } </CodeBlockToggle> ## Flow configuration API <DbTable title=\\"Configuration classes\\" columns={[\\"Class\\", \\"Purpose\\"]} rows={[ [\\"ConvEngineFlowConfig\\", \\"Runtime controls for dialogue/policy/lifecycle/guardrail/tool/stategraph/disambiguation/memory\\"], [\\"ConvEngineEntityConfig\\", \\"Dynamic table name mapping via convengine.tables\\"], [\\"ConvEngineAuditConfig\\", \\"Audit behavior controls\\"], ]} /> ## Extension contracts - <MethodRef>ResponseTransformerHandler</MethodRef> - <MethodRef>ContainerDataTransformerHandler</MethodRef> - rule task execution pathway via <MethodRef>SET_TASK</MethodRef> - pending action execution via CeTaskExecutor - tool adapters through McpToolExecutor implementations","excerpt":"Java API (Core Contracts) Entry points } } } } } default void write(EngineSession session, String summary) } } Flow configuration API Extension contracts ResponseTransformerHandler ContainerDataTransformerHandler rule ta\u2026"},{"id":"api/rest-api.mdx","version":"v2","title":"rest api","permalink":"/docs/v2/api/rest-api","content":"REST API Base /api/v1/conversation Endpoints POST /message } } , \\"context\\": \\" \\" } } Experimental endpoint (feature flagged) Base: /api/v1/conversation/experimental POST /generate sql Enable with: } \' } } generate sql is designed for non transactional configuration tables ( ce_config , ce_intent , ce_rule , ce_prompt_template , ce_response , ce_output_schema , ce_container_config , optional MCP tables). It does not generate runtime conversation/audit data. Generated SQL should be reviewed before use. The endpoint applies safety checks but does not replace human review.","rawContent":"# REST API ## Base <FileRef>/api/v1/conversation</FileRef> ## Endpoints <DbTable title=\\"Conversation endpoints\\" columns={[\\"Method\\", \\"Path\\", \\"Purpose\\"]} rows={[ [\\"POST\\", \\"/message\\", \\"Process one turn and return payload\\"], [\\"GET\\", \\"/audit/{conversationId}\\", \\"Raw audit rows for conversation\\"], [\\"GET\\", \\"/audit/{conversationId}/trace\\", \\"Normalized step+stage timeline\\"], [\\"GET\\", \\"/cache/refresh\\", \\"Evicts static configs memory tree ( ce_static_configs ) and triggers a Spring DB pre-loader to dynamically swap framework configuration\\"] ]} /> ## POST <FileRef>/message</FileRef> <CodeBlockToggle title=\\"Request body\\" language=\\"json\\" defaultOpen={true}> { { \\"conversationId\\": \\"uuid-optional\\", \\"message\\": \\"Track request REQ-778102\\", \\"reset\\": false, \\"inputParams\\": { \\"tenant\\": \\"acme\\" } } } </CodeBlockToggle> <CodeBlockToggle title=\\"Success response\\" language=\\"json\\" defaultOpen={true}> { { \\"success\\": true, \\"conversationId\\": \\"9bf7540a-b129-4685-a120-730e8a0cb94b\\", \\"intent\\": \\"REQUEST_TRACKER\\", \\"state\\": \\"IDLE\\", \\"payload\\": { \\"type\\": \\"TEXT\\", \\"value\\": \\"Request REQ-778102 is IN_REVIEW.\\" }, \\"context\\": \\"{...}\\" } } </CodeBlockToggle> ## Experimental endpoint (feature-flagged) Base: <FileRef>/api/v1/conversation/experimental</FileRef> - <MethodRef>POST /generate-sql</MethodRef> Enable with: <CodeBlockToggle title=\\"application.yml (feature flag)\\" language=\\"yaml\\"> { convengine: experimental: enabled: true } </CodeBlockToggle> <Tabs groupId=\\"experimental-generate-sql\\"> <TabItem value=\\"postman\\" label=\\"Postman\\" default> <DbTable title=\\"Postman setup\\" columns={[\\"Field\\", \\"Value\\"]} rows={[ [\\"Method\\", \\"POST\\"], [\\"URL\\", \\"http://localhost:8080/api/v1/conversation/experimental/generate-sql\\"], [\\"Headers\\", \\"Content-Type: application/json\\"], [\\"Body Mode\\", \\"raw (JSON)\\"], ]} /> <CodeBlockToggle title=\\"Postman body (JSON)\\" language=\\"json\\"> { { \\"scenario\\": \\"Build disconnect electricity workflow\\", \\"domain\\": \\"utilities\\", \\"constraints\\": \\"Collect account number before action\\", \\"includeMcp\\": true } } </CodeBlockToggle> </TabItem> <TabItem value=\\"curl\\" label=\\"curl\\"> <CodeBlockToggle title=\\"curl request\\" language=\\"bash\\"> { curl -X POST \\"http://localhost:8080/api/v1/conversation/experimental/generate-sql\\" \\\\\\\\ -H \\"Content-Type: application/json\\" \\\\\\\\ -d \'{ \\"scenario\\": \\"Build disconnect electricity workflow\\", \\"domain\\": \\"utilities\\", \\"constraints\\": \\"Collect account number before action\\", \\"includeMcp\\": true }\' } </CodeBlockToggle> </TabItem> </Tabs> <CodeBlockToggle title=\\"/experimental/generate-sql success response\\" language=\\"json\\"> { { \\"success\\": true, \\"sql\\": \\"INSERT INTO ce_config ...;\\\\\\\\nINSERT INTO ce_intent ...;\\", \\"warnings\\": [], \\"note\\": \\"Experimental output: review before applying in production.\\" } } </CodeBlockToggle> <Highlight type=\\"info\\" title=\\"Generation scope\\"> generate-sql is designed for non-transactional configuration tables ( ce_config , ce_intent , ce_rule , ce_prompt_template , ce_response , ce_output_schema , ce_container_config , optional MCP tables). It does not generate runtime conversation/audit data. </Highlight> <Highlight type=\\"warning\\" title=\\"Experimental output\\"> Generated SQL should be reviewed before use. The endpoint applies safety checks but does not replace human review. </Highlight>","excerpt":"REST API Base /api/v1/conversation Endpoints POST /message } } , \\"context\\": \\" \\" } } Experimental endpoint (feature flagged) Base: /api/v1/conversation/experimental POST /generate sql Enable with: } \' } } generate sql is \u2026"},{"id":"api/stream-api.mdx","version":"v2","title":"stream api","permalink":"/docs/v2/api/stream-api","content":"Stream API (Socket) Base transport endpoints Conversation turns are submitted through POST /api/v1/conversation/message . Socket/SSE channels stream audit stages for that same conversationId . SSE subscription ; source.addEventListener(\\"STEP_ENTER\\", (event) = ); source.addEventListener(\\"ASSISTANT_OUTPUT\\", (event) = ); } STOMP subscription , }); client.activate(); } Socket audit payload contract } } } Socket + Audit API usage 1. Call POST /api/v1/conversation/message with conversationId . 2. Subscribe to SSE/STOMP for live stages. 3. Query GET /api/v1/conversation/audit/ \'} for raw events. 4. Query GET /api/v1/conversation/audit/ \'}/trace for normalized step timeline. Use REST endpoints for deterministic request/response behavior, and use streaming endpoints for observability UX.","rawContent":"# Stream API (Socket) ## Base transport endpoints <DbTable title=\\"Streaming endpoints\\" columns={[\\"Transport\\", \\"Endpoint / Destination\\", \\"Purpose\\"]} rows={[ [\\"SSE\\", \\"GET /api/v1/conversation/stream/{conversationId}\\", \\"Server-sent live audit events for one conversation\\"], [\\"STOMP WS\\", \\"WS handshake: /ws-convengine\\", \\"WebSocket endpoint for STOMP clients\\"], [\\"STOMP topic\\", \\"/topic/convengine/audit/{conversationId}\\", \\"Conversation-scoped audit stream destination\\"], ]} /> <Highlight type=\\"info\\" title=\\"Flow contract\\"> Conversation turns are submitted through <MethodRef>POST /api/v1/conversation/message</MethodRef>. Socket/SSE channels stream audit stages for that same <MethodRef>conversationId</MethodRef>. </Highlight> ## SSE subscription <CodeBlockToggle title=\\"SSE client (browser)\\" language=\\"javascript\\"> { const conversationId = \\"9bf7540a-b129-4685-a120-730e8a0cb94b\\"; const source = new EventSource( \\"/api/v1/conversation/stream/\\" + conversationId ); source.onmessage = (event) => { // fallback event channel console.log(\\"SSE message:\\", event.data); }; source.addEventListener(\\"STEP_ENTER\\", (event) => { console.log(\\"STEP_ENTER:\\", JSON.parse(event.data)); }); source.addEventListener(\\"ASSISTANT_OUTPUT\\", (event) => { console.log(\\"ASSISTANT_OUTPUT:\\", JSON.parse(event.data)); }); } </CodeBlockToggle> ## STOMP subscription <CodeBlockToggle title=\\"STOMP client (JS)\\" language=\\"javascript\\"> { // npm i @stomp/stompjs sockjs-client const conversationId = \\"9bf7540a-b129-4685-a120-730e8a0cb94b\\"; const client = new Client({ webSocketFactory: () => new SockJS(\\"/ws-convengine\\"), reconnectDelay: 5000, onConnect: () => { client.subscribe( \\"/topic/convengine/audit/\\" + conversationId, (message) => console.log(\\"STOMP audit:\\", JSON.parse(message.body)) ); }, }); client.activate(); } </CodeBlockToggle> ## Socket audit payload contract <CodeBlockToggle title=\\"SSE/STOMP audit event payload\\" language=\\"json\\"> { { \\"auditId\\": 12031, \\"stage\\": \\"STEP_ENTER\\", \\"createdAt\\": \\"2026-02-14T10:22:01.102Z\\", \\"payload\\": { \\"_meta\\": { \\"stage\\": \\"STEP_ENTER\\", \\"conversationId\\": \\"9bf7540a-b129-4685-a120-730e8a0cb94b\\", \\"intent\\": \\"FAQ\\", \\"state\\": \\"IDLE\\" } } } } </CodeBlockToggle> ## Socket + Audit API usage 1. Call <FileRef>POST /api/v1/conversation/message</FileRef> with conversationId . 2. Subscribe to SSE/STOMP for live stages. 3. Query <FileRef>GET /api/v1/conversation/audit/{\'{conversationId}\'}</FileRef> for raw events. 4. Query <FileRef>GET /api/v1/conversation/audit/{\'{conversationId}\'}/trace</FileRef> for normalized step timeline. <Highlight type=\\"tip\\" title=\\"Operational recommendation\\"> Use REST endpoints for deterministic request/response behavior, and use streaming endpoints for observability UX. </Highlight>","excerpt":"Stream API (Socket) Base transport endpoints Conversation turns are submitted through POST /api/v1/conversation/message . Socket/SSE channels stream audit stages for that same conversationId . SSE subscription ; source.a\u2026"},{"id":"architecture.mdx","version":"v2","title":"architecture","permalink":"/docs/v2/architecture","content":"Architecture Layers API + Transport Layer ConversationController request ingress + validation + correlation ids SSE / STOMP event transport for audit streams Runtime Pipeline Layer DefaultConversationalEngine EnginePipelineFactory (DAG sort + wrappers + timing + step hooks) EngineSession (per turn mutable state) Decision + Control Layer dialogue act: DialogueActStep policy: InteractionPolicyStep pending action lifecycle: ActionLifecycleStep , DisambiguationStep , PendingActionStep guard + transition validation: GuardrailStep , StateGraphStep core intent/schema/rules/response path Tooling Layer ToolOrchestrationStep (unified tool request/execute/result contract) McpToolStep (planner loop + CALL_TOOL / ANSWER ) Persistence + Audit Layer JPA repositories on ce_ ce_conversation , ce_audit , ce_memory write path Request Path (high level) Builds EngineContext from conversationId , message , inputParams , optional reset flag. EngineSessionFactory creates session and history provider injects last turns. Dialogue act + interaction policy + pending action lifecycle decide whether to execute task, clarify, or continue standard intent flow. Intent/schema/rules/response steps produce deterministic state transition + assistant payload. Final payload is persisted and returned as TEXT/JSON response, with full audit trail. Code references } } } :::tip Intervention point You can intercept any step via EngineStepHook ( beforeStep , afterStep , onStepError ) without forking the engine. ::: Rules execute by phase: PRE_RESPONSE_RESOLUTION , POST_AGENT_INTENT , POST_AGENT_MCP , and POST_TOOL_EXECUTION . Keep business transitions in ce_rule and state graph config, not hardcoded in steps, so behavior remains data driven and auditable.","rawContent":"# Architecture ## Layers ### API + Transport Layer - <MethodRef>ConversationController</MethodRef> - request ingress + validation + correlation ids - SSE / STOMP event transport for audit streams ### Runtime Pipeline Layer - <MethodRef>DefaultConversationalEngine</MethodRef> - <MethodRef>EnginePipelineFactory</MethodRef> (DAG sort + wrappers + timing + step hooks) - <MethodRef>EngineSession</MethodRef> (per-turn mutable state) ### Decision + Control Layer - dialogue act: <MethodRef>DialogueActStep</MethodRef> - policy: <MethodRef>InteractionPolicyStep</MethodRef> - pending action lifecycle: <MethodRef>ActionLifecycleStep</MethodRef>, <MethodRef>DisambiguationStep</MethodRef>, <MethodRef>PendingActionStep</MethodRef> - guard + transition validation: <MethodRef>GuardrailStep</MethodRef>, <MethodRef>StateGraphStep</MethodRef> - core intent/schema/rules/response path ### Tooling Layer - <MethodRef>ToolOrchestrationStep</MethodRef> (unified tool request/execute/result contract) - <MethodRef>McpToolStep</MethodRef> (planner loop + CALL_TOOL / ANSWER ) ### Persistence + Audit Layer - JPA repositories on <FileRef>ce_*</FileRef> - <FileRef>ce_conversation</FileRef>, <FileRef>ce_audit</FileRef>, <FileRef>ce_memory</FileRef> write path ## Request Path (high-level) <FlowStep step=\\"1\\" title=\\"Controller receives request\\"> Builds <MethodRef>EngineContext</MethodRef> from <MethodRef>conversationId</MethodRef>, <MethodRef>message</MethodRef>, <MethodRef>inputParams</MethodRef>, optional <MethodRef>reset</MethodRef> flag. </FlowStep> <FlowStep step=\\"2\\" title=\\"Engine opens session\\"> <MethodRef>EngineSessionFactory</MethodRef> creates session and history provider injects last turns. </FlowStep> <FlowStep step=\\"3\\" title=\\"Control steps run\\"> Dialogue act + interaction policy + pending-action lifecycle decide whether to execute task, clarify, or continue standard intent flow. </FlowStep> <FlowStep step=\\"4\\" title=\\"Core flow resolves output\\"> Intent/schema/rules/response steps produce deterministic state transition + assistant payload. </FlowStep> <FlowStep step=\\"5\\" title=\\"Persist + return result\\"> Final payload is persisted and returned as TEXT/JSON response, with full audit trail. </FlowStep> ## Code references <CodeBlockToggle title=\\"Engine entrypoint\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.provider\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/provider/DefaultConversationalEngine.java\\" > { @Override public EngineResult process(EngineContext engineContext) { EngineSession session = sessionFactory.open(engineContext); session.setConversationHistory(historyProvider.lastTurns(session.getConversationId(), 10)); EnginePipeline pipeline = pipelineFactory.create(); return pipeline.execute(session); } } </CodeBlockToggle> <CodeBlockToggle title=\\"Pipeline execution loop\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.pipeline\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/pipeline/EnginePipeline.java\\" > { for (EngineStep step : steps) { StepResult r = step.execute(session); if (r instanceof StepResult.Stop(EngineResult result)) { return result; } } } </CodeBlockToggle> :::tip Intervention point You can intercept any step via <MethodRef>EngineStepHook</MethodRef> (<MethodRef>beforeStep</MethodRef>, <MethodRef>afterStep</MethodRef>, <MethodRef>onStepError</MethodRef>) without forking the engine. ::: <Highlight type=\\"info\\" title=\\"Control phases\\"> Rules execute by phase: <MethodRef>PRE_RESPONSE_RESOLUTION</MethodRef>, <MethodRef>POST_AGENT_INTENT</MethodRef>, <MethodRef>POST_AGENT_MCP</MethodRef>, and <MethodRef>POST_TOOL_EXECUTION</MethodRef>. </Highlight> <Highlight type=\\"warning\\" title=\\"Deterministic boundary\\"> Keep business transitions in <FileRef>ce_rule</FileRef> and state graph config, not hardcoded in steps, so behavior remains data-driven and auditable. </Highlight>","excerpt":"Architecture Layers API + Transport Layer ConversationController request ingress + validation + correlation ids SSE / STOMP event transport for audit streams Runtime Pipeline Layer DefaultConversationalEngine EnginePipel\u2026"},{"id":"consumer/annotations-reference.mdx","version":"v2","title":"annotations reference","permalink":"/docs/v2/consumer/annotations-reference","content":"Annotations Reference This page lists all annotation types currently present in ConvEngine and how consumers should use them. Consumer entry annotations } } } stream is an annotation parameter on @EnableConvEngine , not a YAML key. Keep it aligned with convengine.transport.sse.enabled and convengine.transport.stomp.enabled . Extension annotations (consumer customization) } } } } @Override public ContainerComponentResponse intercept(ContainerComponentResponse response, EngineSession session) } } If a class uses @ResponseTransformer or @ContainerDataTransformer but does not implement the required handler interface, startup fails. Internal pipeline annotations (advanced / framework contributors) } } Pipeline requires exactly one @ConversationBootstrapStep and one @TerminalStep . Misuse can break startup DAG validation. Quick recommendations for consumers 1. Use @EnableConvEngine , @EnableConvEngineCaching , and @EnableConvEngineAsyncConversation initially for zero latency pipelines. 2. Add @ResponseTransformer or container annotations only when you have a concrete customization need. 3. Avoid pipeline DAG annotations unless you are intentionally adding custom engine steps and can test full ordering. 4. Keep annotation usage paired with integration tests for one real conversation flow. See , , and for end to end integration context.","rawContent":"# Annotations Reference This page lists all annotation types currently present in ConvEngine and how consumers should use them. ## Consumer entry annotations <DbTable title=\\"Use these in your consumer app\\" columns={[\\"Annotation\\", \\"Target\\", \\"Purpose\\", \\"Typical usage\\"]} rows={[ [\\" @EnableConvEngine(stream = true|false) \\", \\"Spring Boot app class\\", \\"Bootstraps ConvEngine auto-configuration and stream setting.\\", \\"Always required to activate framework.\\"], [\\" @EnableConvEngineCaching \\", \\"Spring Boot app class\\", \\"Hooks ConvEngine\'s pipeline to Spring\'s CacheManager to intercept slow relational DB saves.\\", \\"Apply to resolve conversation I/O latency.\\"], [\\" @EnableConvEngineAsyncConversation \\", \\"Spring Boot app class\\", \\"Ties ConvEngine into Spring\'s thread pools for asynchronous background tasks.\\", \\"Apply alongside caching.\\"], [\\" @EnableConvEngineAsyncAuditDispatch \\", \\"Spring config/app class\\", \\"Forces async audit dispatch marker mode.\\", \\"Use when you intentionally want async listener dispatch.\\"], [\\" @EnableConvEngineStompBrokerRelay \\", \\"Spring config/app class\\", \\"Forces STOMP broker relay marker mode.\\", \\"Use when deploying with external STOMP broker relay.\\"], ]} /> <CodeBlockToggle title=\\"Basic enablement\\" language=\\"java\\"> { @SpringBootApplication @EnableConvEngine(stream = true) @EnableConvEngineCaching @EnableConvEngineAsyncConversation public class MyApplication { public static void main(String[] args) { SpringApplication.run(MyApplication.class, args); } } } </CodeBlockToggle> <CodeBlockToggle title=\\"Optional relay + async markers\\" language=\\"java\\"> { @Configuration @EnableConvEngineAsyncAuditDispatch @EnableConvEngineStompBrokerRelay public class ConvEngineFeatureFlags { } } </CodeBlockToggle> <Highlight type=\\"info\\" title=\\"How stream mode works\\"> stream is an annotation parameter on @EnableConvEngine , not a YAML key. Keep it aligned with convengine.transport.sse.enabled and convengine.transport.stomp.enabled . </Highlight> ## Extension annotations (consumer customization) <DbTable title=\\"Extension points\\" columns={[\\"Annotation\\", \\"Must implement\\", \\"Purpose\\", \\"Key parameters\\"]} rows={[ [\\" @ResponseTransformer \\", \\" ResponseTransformerHandler \\", \\"Last-mile payload shaping by intent/state.\\", \\" intent , state \\"], [\\" @ContainerDataTransformer \\", \\" ContainerDataTransformerHandler \\", \\"Transforms CCF container data before session attach.\\", \\" intent , state \\"], [\\" @ContainerDataInterceptor \\", \\" ContainerDataRequestInterceptor and/or ContainerDataResponseInterceptor \\", \\"Intercepts CCF request/response around execution.\\", \\" intent , state , order \\"], ]} /> <CodeBlockToggle title=\\"Response transformer example\\" language=\\"java\\"> { @Component @ResponseTransformer(intent = \\"REQUEST_TRACKER\\", state = \\"IDLE\\") public class TrackerResponseTransformer implements ResponseTransformerHandler { @Override public OutputPayload transform(OutputPayload responsePayload, EngineSession session, Map<String, Object> inputParams) { return responsePayload; } } } </CodeBlockToggle> <CodeBlockToggle title=\\"Container transformer example\\" language=\\"java\\"> { @Component @ContainerDataTransformer(intent = \\"DISCONNECT_ELECTRICITY\\", state = \\"COLLECTING\\") public class DisconnectContainerTransformer implements ContainerDataTransformerHandler { @Override public Map<String, Object> transform(ContainerComponentResponse response, EngineSession session, Map<String, Object> inputParams) { return Map.of(\\"normalized\\", response); } } } </CodeBlockToggle> <CodeBlockToggle title=\\"Container interceptor example\\" language=\\"java\\"> { @Component @ContainerDataInterceptor(intent = \\"*\\", state = \\"*\\", order = 10) public class TraceContainerInterceptor implements ContainerDataRequestInterceptor, ContainerDataResponseInterceptor { @Override public void intercept(ContainerComponentRequest request, EngineSession session) { // mutate request if needed } @Override public ContainerComponentResponse intercept(ContainerComponentResponse response, EngineSession session) { return response; } } } </CodeBlockToggle> <Highlight type=\\"warning\\" title=\\"Transformer/interceptor registration rules\\"> If a class uses @ResponseTransformer or @ContainerDataTransformer but does not implement the required handler interface, startup fails. </Highlight> ## Internal pipeline annotations (advanced / framework contributors) <DbTable title=\\"Engine DAG annotations\\" columns={[\\"Annotation\\", \\"Role\\", \\"Who should use it\\"]} rows={[ [\\" @MustRunAfter(...) \\", \\"Declares DAG dependency: step runs after listed steps.\\", \\"Framework contributors adding new EngineStep beans.\\"], [\\" @MustRunBefore(...) \\", \\"Declares DAG dependency: step runs before listed steps.\\", \\"Framework contributors adding new EngineStep beans.\\"], [\\" @RequiresConversationPersisted \\", \\"Forces ordering after bootstrap persistence step.\\", \\"Framework/internal step authors.\\"], [\\" @ConversationBootstrapStep \\", \\"Marks the single bootstrap step in pipeline.\\", \\"Framework internals only.\\"], [\\" @TerminalStep \\", \\"Marks the single terminal step in pipeline.\\", \\"Framework internals only.\\"], [\\" @PromptVar \\", \\"Maps fields in internal prompt context models to template aliases.\\", \\"Framework internals only; not for consumer app classes.\\"], ]} /> <CodeBlockToggle title=\\"Custom step with ordering\\" language=\\"java\\"> { @Component @RequiresConversationPersisted @MustRunAfter(IntentResolutionStep.class) @MustRunBefore(ResponseResolutionStep.class) public class CustomValidationStep implements EngineStep { @Override public StepResult execute(EngineSession session) { return new StepResult.Continue(); } } } </CodeBlockToggle> <Highlight type=\\"warning\\" title=\\"Important constraints\\"> Pipeline requires exactly one @ConversationBootstrapStep and one @TerminalStep . Misuse can break startup DAG validation. </Highlight> ## Quick recommendations for consumers 1. Use @EnableConvEngine , @EnableConvEngineCaching , and @EnableConvEngineAsyncConversation initially for zero-latency pipelines. 2. Add @ResponseTransformer or container annotations only when you have a concrete customization need. 3. Avoid pipeline DAG annotations unless you are intentionally adding custom engine steps and can test full ordering. 4. Keep annotation usage paired with integration tests for one real conversation flow. <Highlight type=\\"info\\" title=\\"Related pages\\"> See [Consumer Guide](/docs/v2/consumer/), [New Consumer Onboarding](/docs/v2/consumer/new-consumer-onboarding), and [Extensions](/docs/v2/consumer/extensions) for end-to-end integration context. </Highlight>","excerpt":"Annotations Reference This page lists all annotation types currently present in ConvEngine and how consumers should use them. Consumer entry annotations } } } stream is an annotation parameter on @EnableConvEngine , not \u2026"},{"id":"consumer/backend-integration.mdx","version":"v2","title":"backend integration","permalink":"/docs/v2/consumer/backend-integration","content":"Backend Integration This page uses your demo repos directly: backend reference: convengine demo UI reference: zapper ui What each demo proves convengine demo : Spring Boot consumer setup, transport mode config, step hooks, LLM wiring. zapper ui : conversation client, SSE subscription, audit timeline UI. Add @EnableConvEngine and provide required beans. Use profile yaml ( sse , stomp , both ) to switch runtime behavior. Frontend posts to message endpoint and listens to SSE/STOMP for audit updates. convengine demo: Core app bootstrap ) @EntityScan(basePackages = ) @EnableJpaRepositories(basePackages = ) public class ConvengineDemoApplication } } @Bean public ObjectMapper objectMapper() } } convengine demo: Runtime config model: gpt 4.1 base url: https://api.openai.com lmstudio: api key: \\\\$ model: openai/gpt oss 20b base url: http://localhost:1234 transport: sse: enabled: true emitter timeout ms: 1800000 stomp: enabled: false endpoint: /ws convengine app destination prefix: /app topic prefix: /topic audit destination base: /topic/convengine/audit allowed origin pattern: \\" \\" sock js: true broker: mode: SIMPLE relay destination prefixes: /topic,/queue relay host: localhost relay port: 61613 client login: \\"\\" client passcode: \\"\\" system login: \\"\\" system passcode: \\"\\" virtual host: \\"\\" system heartbeat send interval ms: 10000 system heartbeat receive interval ms: 10000 audit: enabled: true level: ALL include stages: [] exclude stages: [] persistence: mode: IMMEDIATE jdbc batch size: 200 max buffered events: 5000 flush stages: ENGINE_KNOWN_FAILURE,ENGINE_UNKNOWN_FAILURE final step names: PipelineEndGuardStep flush on stop outcome: true dispatch: async enabled: false worker threads: 2 queue capacity: 2000 rejection policy: CALLER_RUNS keep alive seconds: 60 rate limit: enabled: false max events: 200 window ms: 1000 per conversation: true per stage: true max tracked buckets: 20000 } Keep broker.mode: SIMPLE and audit.dispatch.async enabled: false for baseline. Enable relay and async in non prod first, then tune queue capacity , rejection policy , and rate limit using audit volume. convengine demo: Transport + Hook diagnostics public static class StepHook } } } } @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) @Override public void afterStep(EngineStep.Name stepName, EngineSession session, StepResult result) @Override public void onStepError(EngineStep.Name stepName, EngineSession session, Throwable error) } } zapper ui: How frontend consumes backend ); return () = stream.close(); }, [conversationId]); } ]); // Typing indicator shown while request is in flight } 1. Start backend ( convengine demo ) with profile sse , stomp , or both . 2. Start zapper ui and point API base to backend URL. 3. Send message, verify live timeline from stream + detailed payloads from audit API.","rawContent":"# Backend Integration This page uses your demo repos directly: - backend reference: <FileRef>convengine-demo</FileRef> - UI reference: <FileRef>zapper-ui</FileRef> ## What each demo proves - <FileRef>convengine-demo</FileRef>: Spring Boot consumer setup, transport mode config, step hooks, LLM wiring. - <FileRef>zapper-ui</FileRef>: conversation client, SSE subscription, audit timeline UI. <FlowStep step=\\"1\\" title=\\"Enable ConvEngine in backend\\"> Add <MethodRef>@EnableConvEngine</MethodRef> and provide required beans. </FlowStep> <FlowStep step=\\"2\\" title=\\"Configure transport mode\\"> Use profile yaml ( sse , stomp , both ) to switch runtime behavior. </FlowStep> <FlowStep step=\\"3\\" title=\\"Connect frontend\\"> Frontend posts to message endpoint and listens to SSE/STOMP for audit updates. </FlowStep> ## convengine-demo: Core app bootstrap <CodeBlockToggle title=\\"ConvengineDemoApplication.java\\" language=\\"java\\" packagePath=\\"com.github.salilvnair\\" filePath=\\"convengine-demo/src/main/java/com/github/salilvnair/ConvengineDemoApplication.java\\" > { @SpringBootApplication @ComponentScan(basePackages = {\\"com.github.salilvnair.convengdemo\\"}) @EntityScan(basePackages = {\\"com.github.salilvnair.convengdemo.entity\\"}) @EnableJpaRepositories(basePackages = {\\"com.github.salilvnair.convengdemo.repo\\"}) public class ConvengineDemoApplication { public static void main(String[] args) { SpringApplication.run(ConvengineDemoApplication.class, args); } } } </CodeBlockToggle> <CodeBlockToggle title=\\"ConvEngineConfig.java\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengdemo.config\\" filePath=\\"convengine-demo/src/main/java/com/github/salilvnair/convengdemo/config/ConvEngineConfig.java\\" > { @Configuration @EnableConvEngine @EnableConvEngineAsyncAuditDispatch // optional @EnableConvEngineStompBrokerRelay // optional @EnableCcfCore public class ConvEngineConfig { @Bean public RestWebServiceFacade restWebServiceFacade() { return new RestWebServiceFacade(); } @Bean public ObjectMapper objectMapper() { return new ObjectMapper(); } } } </CodeBlockToggle> ## convengine-demo: Runtime config <CodeBlockToggle title=\\"application.yml\\" language=\\"yaml\\" filePath=\\"convengine-demo/src/main/resources/application.yml\\" > { server: port: 8080 spring: datasource: url: jdbc:postgresql://localhost:5432/convengine username: convengine_user password: convengine_pwd convengine: demo: stream-mode: SSE step-hook: enabled: true tables: AUDIT: CE_AUDIT CONTAINER_CONFIG: CE_CONTAINER_CONFIG CONVERSATION: CE_CONVERSATION INTENT: CE_INTENT INTENT_CLASSIFIER: CE_INTENT_CLASSIFIER LLM_CALL_LOG: CE_LLM_CALL_LOG MCP_DB_TOOL: CE_MCP_DB_TOOL MCP_PLANNER: CE_MCP_PLANNER MCP_TOOL: CE_MCP_TOOL OUTPUT_SCHEMA: CE_OUTPUT_SCHEMA PROMPT_TEMPLATE: CE_PROMPT_TEMPLATE RESPONSE: CE_RESPONSE RULE: CE_RULE llm: provider: openai temperature: 0.3 openai: api-key: \\\\${OPENAI_API_KEY\\\\} model: gpt-4.1 base-url: https://api.openai.com lmstudio: api-key: \\\\${LMSTUDIO_API_KEY\\\\} model: openai/gpt-oss-20b base-url: http://localhost:1234 transport: sse: enabled: true emitter-timeout-ms: 1800000 stomp: enabled: false endpoint: /ws-convengine app-destination-prefix: /app topic-prefix: /topic audit-destination-base: /topic/convengine/audit allowed-origin-pattern: \\"*\\" sock-js: true broker: mode: SIMPLE relay-destination-prefixes: /topic,/queue relay-host: localhost relay-port: 61613 client-login: \\"\\" client-passcode: \\"\\" system-login: \\"\\" system-passcode: \\"\\" virtual-host: \\"\\" system-heartbeat-send-interval-ms: 10000 system-heartbeat-receive-interval-ms: 10000 audit: enabled: true level: ALL include-stages: [] exclude-stages: [] persistence: mode: IMMEDIATE jdbc-batch-size: 200 max-buffered-events: 5000 flush-stages: ENGINE_KNOWN_FAILURE,ENGINE_UNKNOWN_FAILURE final-step-names: PipelineEndGuardStep flush-on-stop-outcome: true dispatch: async-enabled: false worker-threads: 2 queue-capacity: 2000 rejection-policy: CALLER_RUNS keep-alive-seconds: 60 rate-limit: enabled: false max-events: 200 window-ms: 1000 per-conversation: true per-stage: true max-tracked-buckets: 20000 } </CodeBlockToggle> <CodeBlockToggle title=\\"application-sse.yml\\" language=\\"yaml\\" filePath=\\"convengine-demo/src/main/resources/application-sse.yml\\"> { convengine: demo: stream-mode: SSE transport: sse: enabled: true stomp: enabled: false } </CodeBlockToggle> <CodeBlockToggle title=\\"application-stomp.yml\\" language=\\"yaml\\" filePath=\\"convengine-demo/src/main/resources/application-stomp.yml\\"> { convengine: demo: stream-mode: STOMP transport: sse: enabled: false stomp: enabled: true } </CodeBlockToggle> <CodeBlockToggle title=\\"application-both.yml\\" language=\\"yaml\\" filePath=\\"convengine-demo/src/main/resources/application-both.yml\\"> { convengine: demo: stream-mode: BOTH transport: sse: enabled: true stomp: enabled: true } </CodeBlockToggle> <Highlight type=\\"tip\\" title=\\"Relay + async audit rollout\\"> Keep broker.mode: SIMPLE and audit.dispatch.async-enabled: false for baseline. Enable relay and async in non-prod first, then tune queue-capacity , rejection-policy , and rate-limit using audit volume. </Highlight> ## convengine-demo: Transport + Hook diagnostics <CodeBlockToggle title=\\"DemoTransportProperties.java\\" language=\\"java\\" filePath=\\"convengine-demo/src/main/java/com/github/salilvnair/convengdemo/config/DemoTransportProperties.java\\" > { @Component @ConfigurationProperties(prefix = \\"convengine.demo\\") public class DemoTransportProperties { private StreamMode streamMode = StreamMode.SSE; private StepHook stepHook = new StepHook(); public enum StreamMode { SSE, STOMP, BOTH } public static class StepHook { private boolean enabled = true; } } } </CodeBlockToggle> <CodeBlockToggle title=\\"ConvEngineTransportStartupLogger.java\\" language=\\"java\\" filePath=\\"convengine-demo/src/main/java/com/github/salilvnair/convengdemo/config/ConvEngineTransportStartupLogger.java\\" > { @Component @RequiredArgsConstructor public class ConvEngineTransportStartupLogger { private final DemoTransportProperties demoTransportProperties; private final ConvEngineTransportConfig transportConfig; private final Environment environment; @EventListener(ApplicationReadyEvent.class) public void logTransportConfiguration() { boolean sseEnabled = transportConfig.getSse().isEnabled(); boolean stompEnabled = transportConfig.getStomp().isEnabled(); // validates mode and prints endpoints } } } </CodeBlockToggle> <CodeBlockToggle title=\\"DemoEngineStepHook.java\\" language=\\"java\\" filePath=\\"convengine-demo/src/main/java/com/github/salilvnair/convengdemo/config/DemoEngineStepHook.java\\" > { @Component @RequiredArgsConstructor public class DemoEngineStepHook implements EngineStepHook { private static final Set<EngineStep.Name> TRACKED_STEPS = Set.of( EngineStep.Name.IntentResolutionStep, EngineStep.Name.SchemaExtractionStep, EngineStep.Name.RulesStep, EngineStep.Name.ResponseResolutionStep ); @Override public boolean supports(EngineStep.Name stepName, EngineSession session) { return demoTransportProperties.getStepHook().isEnabled() && TRACKED_STEPS.contains(stepName); } @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) { /* logs */ } @Override public void afterStep(EngineStep.Name stepName, EngineSession session, StepResult result) { /* logs */ } @Override public void onStepError(EngineStep.Name stepName, EngineSession session, Throwable error) { /* logs */ } } } </CodeBlockToggle> ## zapper-ui: How frontend consumes backend <CodeBlockToggle title=\\"convengine.api.js (zapper-ui)\\" language=\\"js\\" filePath=\\"zapper-ui/src/api/convengine.api.js\\" > { const API_BASE = \\"http://localhost:8080/api/v1/conversation\\"; // STOMP scaffold commented for optional enablement } </CodeBlockToggle> <CodeBlockToggle title=\\"App.jsx (zapper-ui)\\" language=\\"jsx\\" filePath=\\"zapper-ui/src/App.jsx\\" > { useEffect(() => { const stream = subscribeConversationSse(conversationId, { onConnected: () => setAuditVersion(v => v + 1), onEvent: () => setAuditVersion(v => v + 1), }); return () => stream.close(); }, [conversationId]); } </CodeBlockToggle> <CodeBlockToggle title=\\"ChatPanel.jsx (zapper-ui)\\" language=\\"jsx\\" filePath=\\"zapper-ui/src/components/ChatPanel.jsx\\" > { const res = await sendMessage(conversationId, userText); setMessages(m => [...m, { role: \\"assistant\\", text: assistantText }]); // Typing indicator shown while request is in-flight } </CodeBlockToggle> <Highlight type=\\"info\\" title=\\"Backend + UI runbook\\"> 1. Start backend ( convengine-demo ) with profile <MethodRef>sse</MethodRef>, <MethodRef>stomp</MethodRef>, or <MethodRef>both</MethodRef>. 2. Start <FileRef>zapper-ui</FileRef> and point API base to backend URL. 3. Send message, verify live timeline from stream + detailed payloads from audit API. </Highlight> <CodeBlockToggle title=\\"Run commands\\" language=\\"bash\\" defaultOpen={false}> { # backend (convengine-demo) ./mvnw spring-boot:run -Dspring-boot.run.profiles=sse # or ./mvnw spring-boot:run -Dspring-boot.run.profiles=stomp # or ./mvnw spring-boot:run -Dspring-boot.run.profiles=both # frontend (zapper-ui) npm install npm run dev } </CodeBlockToggle>","excerpt":"Backend Integration This page uses your demo repos directly: backend reference: convengine demo UI reference: zapper ui What each demo proves convengine demo : Spring Boot consumer setup, transport mode config, step hook\u2026"},{"id":"consumer/caching-and-persistence.mdx","version":"v2","title":"caching and persistence","permalink":"/docs/v2/consumer/caching-and-persistence","content":"Caching & Persistence ConvEngine v2 is heavily optimized to decouple real time generative latency from slow relational database I/O. The framework accomplishes this by utilizing Asynchronous Persistence Threads alongside Spring\'s Abstract CacheManager . To activate this optimization on your backend, add the following decorators to your application class: 1. @EnableConvEngineCaching 2. @EnableConvEngineAsyncConversation The actual datastore powering @EnableConvEngineCaching is entirely controlled by the Consumer application , not the ConvEngine framework. ConvEngine relies on the generic Spring CacheManager interface to save and load CeConversation instances via the ce_conversation_cache routing key. By default, to activate ConvEngine caching, you must pull in Spring Boot\'s caching abstraction layer. If you import this module but do not import any external caching dependencies (like Redis or Ehcache), Spring Boot will automatically fall back to providing a ConcurrentMapCacheManager out of the box. Dependency requirement ( pom.xml ) : If you annotate your application class with @EnableConvEngineCaching but fail to include spring boot starter cache in your pom.xml , the Spring context will fatally crash on startup because it cannot find an underlying CacheManager bean to bind to. This operates seamlessly once the module is present. It holds conversation states inside a standard Java HashMap residing in your server\'s active JVM memory. Pros : Blazing fast ( 0ms read/write latency), requires zero configuration. Cons : Cache is completely wiped if the Spring Boot application restarts or crashes; not horizontal scale (multi pod) friendly. 1. Ehcache 3 (JSR 107) For robust, production grade memory bounds, Ehcache is a highly recommended on premise memory provider. It allows conversational payloads to spill over from the active heap into offheap memory to prevent JVM garbage collection thrashing during large multi turn flows. Dependency update ( pom.xml ) : App configuration ( application.yml ) : Provider specification ( src/main/resources/ehcache.xml ) : 2. Caffeine Cache If you prefer a highly optimized, high performance local cache strictly contained inside the JVM (without off heap spillage but statistically faster hit rates than Ehcache), Caffeine is Spring Boot\'s default local provider replacement. Dependency update ( pom.xml ) : App configuration ( application.yml ) : Unlike Ehcache, Caffeine can be fully initialized inside application.yml without distinct XML files. 3. Redis For horizontally scaled environments like Kubernetes ( k8s ) where your user traffic rotates across multiple server pods mid conversation, you cannot use local memory (Ehcache/Caffeine). Redis binds ConvEngine\'s cache into an external centralized datastore. Dependency update ( pom.xml ) : App configuration ( application.yml ) : Because Redis runs outside the active server JVM, it relies on network transmission. You must ensure that your Spring application has a generic RedisTemplate or Jackson configured RedisCacheConfiguration bean configured to serialize CeConversation entities, otherwise Java will throw NotSerializableException when attempting to push the object to the internet. 4. Static Configuration Preloading Beyond dynamic conversational sessions, ConvEngine also permanently caches all non transactional database rules ( ce_intent , ce_rule , ce_mcp_tool , ce_mcp_planner , ce_config , etc.) into a generic ce_static_configs memory tree entirely upon JVM live initiation. This ensures that the engine never triggers synchronous relational fetches during the middle of a customer\'s turn. If you connect to your database and update a ce_rule row manually using SQL , the active Java application won\'t automatically see it until you flush this static cache. Flushing the Cache Tree: You can do this by hitting the integrated Admin Controller endpoint mapped generically natively into your backend: This endpoint executes @CacheEvict(value = \\"ce_static_configs\\", allEntries = true) and immediately re triggers the Spring Data Preloader, locking in your latest SQL tweaks live. 5. Cache Analyzer API ( /api/v1/cache/analyze ) Use this endpoint when you want to validate cache health without guessing whether misses are caused by provider, proxying, or runtime wiring. warmup=true actively calls static cache loaders before reporting timing metrics. warmup=false only inspects current state and does not trigger additional warmup calls. CE IDE Panel: How the Response Should Be Read If your CE IDE panel renders the JSON response, interpret each block as follows: , \\"ce_mcp_tool\\": , \\"ce_mcp_db_tool\\": , \\"ce_mcp_planner\\": , \\"ce_prompt_template\\": , \\"ce_policy\\": , \\"ce_pending_action\\": , \\"ce_intent\\": , \\"ce_output_schema\\": , \\"ce_response\\": , \\"ce_rule\\": , \\"ce_intent_classifier\\": , \\"ce_container_config\\": }, \\"registeredCacheNames\\": [ \\"ce_config\\", \\"ce_prompt_template\\", \\"ce_policy\\", \\"ce_output_schema\\", \\"ce_conversation_history_cache\\", \\"ce_rule\\", \\"ce_container_config\\", \\"ce_mcp_tool\\", \\"ce_mcp_db_tool\\", \\"ce_mcp_planner\\", \\"ce_conversation_cache\\", \\"ce_pending_action\\", \\"ce_intent\\", \\"ce_response\\", \\"ce_intent_classifier\\" ], \\"staticCaches\\": , \\"ce_mcp_tool\\": , \\"ce_mcp_db_tool\\": , \\"ce_mcp_planner\\": , \\"ce_prompt_template\\": , \\"ce_policy\\": , \\"ce_pending_action\\": , \\"ce_intent\\": , \\"ce_output_schema\\": , \\"ce_response\\": , \\"ce_rule\\": , \\"ce_intent_classifier\\": , \\"ce_container_config\\": }, \\"runtimeCaches\\": , \\"ce_conversation_history_cache\\": } } } Interpreting the sample you shared cacheManagerClass=ConcurrentMapCacheManager : Local in memory cache provider is active and valid. Static caches all show exists=true , hasSimpleKeyEntry=true , nativeEntryCount=1 : static ce_ cache population is healthy. Static listSize values are non zero: static rows are loaded into cache as expected. firstCallMs=0 and secondCallMs=0 : data is tiny and runtime is fast enough to round to 0 ms; this is normal. Runtime caches at nativeEntryCount=0 : no conversation/historical entries cached yet at capture time, or traffic was not running when the snapshot was taken.","rawContent":"# Caching & Persistence ConvEngine v2 is heavily optimized to decouple real-time generative latency from slow relational database I/O. The framework accomplishes this by utilizing **Asynchronous Persistence Threads** alongside **Spring\'s Abstract CacheManager**. To activate this optimization on your backend, add the following decorators to your application class: 1. <MethodRef>@EnableConvEngineCaching</MethodRef> 2. <MethodRef>@EnableConvEngineAsyncConversation</MethodRef> <Highlight type=\\"tip\\" title=\\"How the abstraction works\\"> The actual datastore powering @EnableConvEngineCaching is **entirely controlled by the Consumer application**, not the ConvEngine framework. ConvEngine relies on the generic Spring CacheManager interface to save and load CeConversation instances via the ce_conversation_cache routing key. </Highlight> By default, to activate ConvEngine caching, you must pull in Spring Boot\'s caching abstraction layer. If you import this module but do not import any external caching dependencies (like Redis or Ehcache), Spring Boot will automatically fall back to providing a ** ConcurrentMapCacheManager ** out of the box. **Dependency requirement ( pom.xml )**: <CodeBlockToggle title=\\"pom.xml\\" language=\\"xml\\"> { <dependency> <groupId>org.springframework.boot</groupId> <artifactId>spring-boot-starter-cache</artifactId> </dependency> } </CodeBlockToggle> <Highlight type=\\"warning\\" title=\\"Startup crashes without this dependency\\"> If you annotate your application class with @EnableConvEngineCaching but fail to include spring-boot-starter-cache in your pom.xml , the Spring context will fatally crash on startup because it cannot find an underlying CacheManager bean to bind to. </Highlight> This operates seamlessly once the module is present. It holds conversation states inside a standard Java HashMap residing in your server\'s active JVM memory. - **Pros**: Blazing fast ( 0ms read/write latency), requires zero configuration. - **Cons**: Cache is completely wiped if the Spring Boot application restarts or crashes; not horizontal-scale (multi-pod) friendly. --- ## 1. Ehcache 3 (JSR-107) For robust, production-grade memory bounds, **Ehcache** is a highly recommended on-premise memory provider. It allows conversational payloads to spill over from the active heap into offheap memory to prevent JVM garbage collection thrashing during large multi-turn flows. **Dependency update ( pom.xml )**: <CodeBlockToggle title=\\"pom.xml\\" language=\\"xml\\"> { <dependency> <groupId>org.springframework.boot</groupId> <artifactId>spring-boot-starter-cache</artifactId> </dependency> <dependency> <groupId>javax.cache</groupId> <artifactId>cache-api</artifactId> </dependency> <dependency> <groupId>org.ehcache</groupId> <artifactId>ehcache</artifactId> </dependency> } </CodeBlockToggle> **App configuration ( application.yml )**: <CodeBlockToggle title=\\"application.yml\\" language=\\"yaml\\"> { spring: cache: jcache: config: classpath:ehcache.xml } </CodeBlockToggle> **Provider specification ( src/main/resources/ehcache.xml )**: <CodeBlockToggle title=\\"ehcache.xml\\" language=\\"xml\\"> { <config xmlns:xsi=\\"http://www.w3.org/2001/XMLSchema-instance\\" xmlns=\\"http://www.ehcache.org/v3\\" xmlns:jsr107=\\"http://www.ehcache.org/v3/jsr107\\" xsi:schemaLocation=\\" http://www.ehcache.org/v3 http://www.ehcache.org/schema/ehcache-core-3.0.xsd http://www.ehcache.org/v3/jsr107 http://www.ehcache.org/schema/ehcache-107-ext-3.0.xsd\\"> \x3c!-- This MUST exactly match ConvEngine\'s requested alias --\x3e <cache alias=\\"ce_conversation_cache\\"> <key-type>java.lang.String</key-type> <value-type>com.github.salilvnair.convengine.entity.CeConversation</value-type> <expiry> <ttl unit=\\"minutes\\">60</ttl> </expiry> <resources> <heap unit=\\"entries\\">2000</heap> <offheap unit=\\"MB\\">100</offheap> </resources> </cache> </config> } </CodeBlockToggle> --- ## 2. Caffeine Cache If you prefer a highly optimized, high-performance local cache strictly contained inside the JVM (without off-heap spillage but statistically faster hit-rates than Ehcache), **Caffeine** is Spring Boot\'s default local provider replacement. **Dependency update ( pom.xml )**: <CodeBlockToggle title=\\"pom.xml\\" language=\\"xml\\"> { <dependency> <groupId>org.springframework.boot</groupId> <artifactId>spring-boot-starter-cache</artifactId> </dependency> <dependency> <groupId>com.github.ben-manes.caffeine</groupId> <artifactId>caffeine</artifactId> </dependency> } </CodeBlockToggle> **App configuration ( application.yml )**: Unlike Ehcache, Caffeine can be fully initialized inside application.yml without distinct XML files. <CodeBlockToggle title=\\"application.yml\\" language=\\"yaml\\"> { spring: cache: type: caffeine cache-names: ce_conversation_cache caffeine: # Max limits the cache to 5,000 conversational objects, expiring them 60 minutes after their last network write spec: maximumSize=5000,expireAfterWrite=60m } </CodeBlockToggle> --- ## 3. Redis For horizontally scaled environments like Kubernetes ( k8s ) where your user traffic rotates across multiple server pods mid-conversation, you cannot use local memory (Ehcache/Caffeine). **Redis** binds ConvEngine\'s cache into an external centralized datastore. **Dependency update ( pom.xml )**: <CodeBlockToggle title=\\"pom.xml\\" language=\\"xml\\"> { <dependency> <groupId>org.springframework.boot</groupId> <artifactId>spring-boot-starter-data-redis</artifactId> </dependency> <dependency> <groupId>org.springframework.boot</groupId> <artifactId>spring-boot-starter-cache</artifactId> </dependency> } </CodeBlockToggle> **App configuration ( application.yml )**: <CodeBlockToggle title=\\"application.yml\\" language=\\"yaml\\"> { spring: data: redis: host: localhost port: 6379 cache: type: redis redis: time-to-live: 60m cache-null-values: false use-key-prefix: true key-prefix: \\"convengine:\\" } </CodeBlockToggle> <Highlight type=\\"warning\\" title=\\"A note on serialization\\"> Because Redis runs outside the active server JVM, it relies on network transmission. You must ensure that your Spring application has a generic RedisTemplate or Jackson-configured RedisCacheConfiguration bean configured to serialize CeConversation entities, otherwise Java will throw NotSerializableException when attempting to push the object to the internet. </Highlight> --- ## 4. Static Configuration Preloading Beyond dynamic conversational sessions, ConvEngine also permanently caches all non-transactional database rules ( ce_intent , ce_rule , ce_mcp_tool , ce_mcp_planner , ce_config , etc.) into a generic ce_static_configs memory tree entirely upon JVM live initiation. This ensures that the engine never triggers synchronous relational fetches during the middle of a customer\'s turn. If you connect to your database and update a ce_rule row manually using SQL , the active Java application won\'t automatically see it until you flush this static cache. **Flushing the Cache Tree:** You can do this by hitting the integrated Admin Controller endpoint mapped generically natively into your backend: <CodeBlockToggle title=\\"Cache Refresh Trigger\\" language=\\"bash\\"> { curl -X GET \\"http://localhost:8080/api/v1/cache/refresh\\" } </CodeBlockToggle> This endpoint executes @CacheEvict(value = \\"ce_static_configs\\", allEntries = true) and immediately re-triggers the Spring Data Preloader, locking in your latest SQL tweaks live. --- ## 5. Cache Analyzer API ( /api/v1/cache/analyze ) Use this endpoint when you want to validate cache health without guessing whether misses are caused by provider, proxying, or runtime wiring. <DbTable title=\\"Analyzer endpoint contract\\" columns={[\\"Method\\", \\"Path\\", \\"Query Param\\", \\"Purpose\\"]} rows={[ [\\"GET\\", \\"/api/v1/cache/analyze\\", \\"warmup=true|false\\", \\"Returns cache/provider/proxy diagnostics and cache entry visibility.\\"], ]} /> <CodeBlockToggle title=\\"Example calls\\" language=\\"bash\\"> { # Deep probe (runs warmup timing first-call vs second-call) curl \\"http://localhost:8080/api/v1/cache/analyze?warmup=true\\" # Passive snapshot (no extra warmup/timing calls) curl \\"http://localhost:8080/api/v1/cache/analyze?warmup=false\\" } </CodeBlockToggle> <Highlight type=\\"info\\" title=\\"warmup flag behavior\\"> warmup=true actively calls static cache loaders before reporting timing metrics. warmup=false only inspects current state and does not trigger additional warmup calls. </Highlight> ### CE IDE Panel: How the Response Should Be Read If your CE IDE panel renders the JSON response, interpret each block as follows: <DbTable title=\\"Field-by-field meaning in CE IDE\\" columns={[\\"Field\\", \\"What it means\\", \\"Healthy signal\\", \\"When to investigate\\"]} rows={[ [\\"warmupAndTimingEnabled\\", \\"Whether analyzer executed active timing probe.\\", \\"Matches your request flag.\\", \\"Unexpected value indicates wrong request or proxy/caching to old endpoint.\\"], [\\"cacheManagerClass\\", \\"Actual Spring cache provider at runtime.\\", \\" ConcurrentMapCacheManager , Caffeine, Redis, etc. as expected.\\", \\"Unexpected provider means environment config drift.\\"], [\\"registeredCacheNames\\", \\"Caches currently known to provider.\\", \\"Includes static ce_* and runtime caches.\\", \\"Missing cache names means cache operations are not being registered/hit.\\"], [\\"warmupTimingMs\\", \\"First vs second invocation latency by static cache.\\", \\"Second call <= first call, usually much faster.\\", \\"Both large or growing means repeated misses or backend latency.\\"], [\\"staticCaches.*.hasSimpleKeyEntry\\", \\"Whether no-arg @Cacheable entry exists.\\", \\" true for all static ce_* datasets.\\", \\" false means static caches were not populated/hit.\\"], [\\"staticCaches.*.listSize\\", \\"Rows currently held in memory for each static table.\\", \\"Non-zero sizes matching expected SQL data.\\", \\"Unexpected zero/low values indicates seed/data/environment mismatch.\\"], [\\"runtimeCaches.*.nativeEntryCount\\", \\"Current conversation/history cache occupancy.\\", \\"Grows when conversations run.\\", \\"Always zero during active traffic indicates runtime cache path not used.\\"], ]} /> <CodeBlockToggle title=\\"Sample response (from CE IDE)\\" language=\\"json\\"> { { \\"warmupAndTimingEnabled\\": true, \\"cacheManagerClass\\": \\"org.springframework.cache.concurrent.ConcurrentMapCacheManager\\", \\"warmupTimingMs\\": { \\"ce_config\\": { \\"secondCallMs\\": 0, \\"firstCallMs\\": 0 }, \\"ce_mcp_tool\\": { \\"secondCallMs\\": 0, \\"firstCallMs\\": 0 }, \\"ce_mcp_db_tool\\": { \\"secondCallMs\\": 0, \\"firstCallMs\\": 0 }, \\"ce_mcp_planner\\": { \\"secondCallMs\\": 0, \\"firstCallMs\\": 0 }, \\"ce_prompt_template\\": { \\"secondCallMs\\": 0, \\"firstCallMs\\": 0 }, \\"ce_policy\\": { \\"secondCallMs\\": 0, \\"firstCallMs\\": 0 }, \\"ce_pending_action\\": { \\"secondCallMs\\": 0, \\"firstCallMs\\": 0 }, \\"ce_intent\\": { \\"secondCallMs\\": 0, \\"firstCallMs\\": 0 }, \\"ce_output_schema\\": { \\"secondCallMs\\": 0, \\"firstCallMs\\": 0 }, \\"ce_response\\": { \\"secondCallMs\\": 0, \\"firstCallMs\\": 0 }, \\"ce_rule\\": { \\"secondCallMs\\": 0, \\"firstCallMs\\": 0 }, \\"ce_intent_classifier\\": { \\"secondCallMs\\": 0, \\"firstCallMs\\": 0 }, \\"ce_container_config\\": { \\"secondCallMs\\": 0, \\"firstCallMs\\": 0 } }, \\"registeredCacheNames\\": [ \\"ce_config\\", \\"ce_prompt_template\\", \\"ce_policy\\", \\"ce_output_schema\\", \\"ce_conversation_history_cache\\", \\"ce_rule\\", \\"ce_container_config\\", \\"ce_mcp_tool\\", \\"ce_mcp_db_tool\\", \\"ce_mcp_planner\\", \\"ce_conversation_cache\\", \\"ce_pending_action\\", \\"ce_intent\\", \\"ce_response\\", \\"ce_intent_classifier\\" ], \\"staticCaches\\": { \\"ce_config\\": { \\"valueType\\": \\"java.util.ArrayList\\", \\"exists\\": true, \\"listSize\\": 12, \\"hasSimpleKeyEntry\\": true, \\"nativeEntryCount\\": 1 }, \\"ce_mcp_tool\\": { \\"valueType\\": \\"java.util.ArrayList\\", \\"exists\\": true, \\"listSize\\": 2, \\"hasSimpleKeyEntry\\": true, \\"nativeEntryCount\\": 1 }, \\"ce_mcp_db_tool\\": { \\"valueType\\": \\"java.util.ArrayList\\", \\"exists\\": true, \\"listSize\\": 2, \\"hasSimpleKeyEntry\\": true, \\"nativeEntryCount\\": 1 }, \\"ce_mcp_planner\\": { \\"valueType\\": \\"java.util.ArrayList\\", \\"exists\\": true, \\"listSize\\": 3, \\"hasSimpleKeyEntry\\": true, \\"nativeEntryCount\\": 1 }, \\"ce_prompt_template\\": { \\"valueType\\": \\"java.util.ArrayList\\", \\"exists\\": true, \\"listSize\\": 4, \\"hasSimpleKeyEntry\\": true, \\"nativeEntryCount\\": 1 }, \\"ce_policy\\": { \\"valueType\\": \\"java.util.ArrayList\\", \\"exists\\": true, \\"listSize\\": 1, \\"hasSimpleKeyEntry\\": true, \\"nativeEntryCount\\": 1 }, \\"ce_pending_action\\": { \\"valueType\\": \\"java.util.ArrayList\\", \\"exists\\": true, \\"listSize\\": 1, \\"hasSimpleKeyEntry\\": true, \\"nativeEntryCount\\": 1 }, \\"ce_intent\\": { \\"valueType\\": \\"java.util.ArrayList\\", \\"exists\\": true, \\"listSize\\": 4, \\"hasSimpleKeyEntry\\": true, \\"nativeEntryCount\\": 1 }, \\"ce_output_schema\\": { \\"valueType\\": \\"java.util.ArrayList\\", \\"exists\\": true, \\"listSize\\": 2, \\"hasSimpleKeyEntry\\": true, \\"nativeEntryCount\\": 1 }, \\"ce_response\\": { \\"valueType\\": \\"java.util.ArrayList\\", \\"exists\\": true, \\"listSize\\": 7, \\"hasSimpleKeyEntry\\": true, \\"nativeEntryCount\\": 1 }, \\"ce_rule\\": { \\"valueType\\": \\"java.util.ArrayList\\", \\"exists\\": true, \\"listSize\\": 4, \\"hasSimpleKeyEntry\\": true, \\"nativeEntryCount\\": 1 }, \\"ce_intent_classifier\\": { \\"valueType\\": \\"java.util.ArrayList\\", \\"exists\\": true, \\"listSize\\": 3, \\"hasSimpleKeyEntry\\": true, \\"nativeEntryCount\\": 1 }, \\"ce_container_config\\": { \\"valueType\\": \\"java.util.ArrayList\\", \\"exists\\": true, \\"listSize\\": 1, \\"hasSimpleKeyEntry\\": true, \\"nativeEntryCount\\": 1 } }, \\"runtimeCaches\\": { \\"ce_conversation_cache\\": { \\"exists\\": true, \\"nativeEntryCount\\": 0 }, \\"ce_conversation_history_cache\\": { \\"exists\\": true, \\"nativeEntryCount\\": 0 } } } } </CodeBlockToggle> ### Interpreting the sample you shared - cacheManagerClass=ConcurrentMapCacheManager : Local in-memory cache provider is active and valid. - Static caches all show exists=true , hasSimpleKeyEntry=true , nativeEntryCount=1 : static ce_* cache population is healthy. - Static listSize values are non-zero: static rows are loaded into cache as expected. - firstCallMs=0 and secondCallMs=0 : data is tiny and runtime is fast enough to round to 0 ms; this is normal. - Runtime caches at nativeEntryCount=0 : no conversation/historical entries cached yet at capture time, or traffic was not running when the snapshot was taken.","excerpt":"Caching & Persistence ConvEngine v2 is heavily optimized to decouple real time generative latency from slow relational database I/O. The framework accomplishes this by utilizing Asynchronous Persistence Threads alongside\u2026"},{"id":"consumer/configuration.mdx","version":"v2","title":"configuration","permalink":"/docs/v2/consumer/configuration","content":"Consumer Configuration This guide covers the core tunable properties available for ConvEngine consumers. Properties are managed via Spring Boot @ConfigurationProperties and can be set in your application.yml or application.properties . Core namespaces ConvEngine introduces several configuration namespaces: convengine.flow. (runtime behavior tuning) convengine.audit. (event and tracking controls) convengine.transport. (SSE/STOMP delivery settings) convengine.tables. (dynamic table mapping overrides) convengine.experimental. (forward looking toggles) Complete application.yml Reference Below is a complete reference of the default configuration options exposed by ConvEngine. disambiguation: enabled: true max options: 5 memory: enabled: true summary max chars: 1200 recent turns for summary: 3 Transport mechanisms transport: sse: enabled: true emitter timeout ms: 1800000 stomp: enabled: false endpoint: /ws convengine app destination prefix: /app topic prefix: /topic audit destination base: /topic/convengine/audit allowed origin pattern: \\" \\" sock js: true broker: mode: SIMPLE SIMPLE | RELAY relay destination prefixes: /topic,/queue relay host: localhost relay port: 61613 client login: \\"\\" client passcode: \\"\\" system login: \\"\\" system passcode: \\"\\" virtual host: \\"\\" system heartbeat send interval ms: 10000 system heartbeat receive interval ms: 10000 Auditing controls audit: enabled: true persist meta: true cache inspector: false level: ALL ALL | STANDARD | ERROR_ONLY | NONE include stages: [] exclude stages: [] persistence: mode: IMMEDIATE IMMEDIATE | DEFERRED_BULK jdbc batch size: 200 max buffered events: 5000 flush stages: ENGINE_KNOWN_FAILURE,ENGINE_UNKNOWN_FAILURE final step names: PipelineEndGuardStep flush on stop outcome: true dispatch: async enabled: false worker threads: 2 queue capacity: 2000 rejection policy: CALLER_RUNS CALLER_RUNS | DROP_NEWEST | DROP_OLDEST | ABORT keep alive seconds: 60 rate limit: enabled: false max events: 200 window ms: 1000 per conversation: true per stage: true max tracked buckets: 20000 } Breakdown: Flow Configuration The convengine.flow. properties control the nuanced routing behavior without requiring consumer side hardcoded Java branching for common dialogue/action patterns. EXECUTE_PENDING_ACTION)\\"] ]} / Breakdown: Audit Configuration convengine.audit. dictates how the system records telemetry and metric payloads down to the individual pipeline stage logic. Breakdown: Transport Configuration convengine.transport. applies to interactive async communication paths like Server Sent Events (SSE) or WebSockets via STOMP. Some transport handlers may also be gated by @EnableConvEngine(stream = true) in your main application class.","rawContent":"# Consumer Configuration This guide covers the core tunable properties available for ConvEngine consumers. Properties are managed via Spring Boot @ConfigurationProperties and can be set in your application.yml or application.properties . ## Core namespaces ConvEngine introduces several configuration namespaces: - convengine.flow.* (runtime behavior tuning) - convengine.audit.* (event and tracking controls) - convengine.transport.* (SSE/STOMP delivery settings) - convengine.tables.* (dynamic table mapping overrides) - convengine.experimental.* (forward-looking toggles) --- ## Complete application.yml Reference Below is a complete reference of the default configuration options exposed by ConvEngine. <CodeBlockToggle title=\\"Complete application.yml reference\\" language=\\"yaml\\" defaultOpen={true}> { convengine: # Dynamic table mapping for CE_* entities (same as V1) tables: AUDIT: CE_AUDIT CONFIG: CE_CONFIG CONTAINER_CONFIG: CE_CONTAINER_CONFIG CONVERSATION: CE_CONVERSATION INTENT: CE_INTENT INTENT_CLASSIFIER: CE_INTENT_CLASSIFIER LLM_CALL_LOG: CE_LLM_CALL_LOG MCP_DB_TOOL: CE_MCP_DB_TOOL MCP_PLANNER: CE_MCP_PLANNER MCP_TOOL: CE_MCP_TOOL OUTPUT_SCHEMA: CE_OUTPUT_SCHEMA POLICY: CE_POLICY PROMPT_TEMPLATE: CE_PROMPT_TEMPLATE RESPONSE: CE_RESPONSE RULE: CE_RULE # Feature flags for experimental features experimental: enabled: false # Flow tuning flow: query-rewrite: enabled: true conversation-history: max-turns: 10 dialogue-act: resolute: REGEX_THEN_LLM # REGEX_ONLY | REGEX_THEN_LLM | LLM_ONLY llm-threshold: 0.90 interaction-policy: execute-pending-on-affirm: true reject-pending-on-negate: true fill-pending-slot-on-non-new-request: true require-resolved-intent-and-state: true matrix: \\"PENDING_ACTION:AFFIRM\\": EXECUTE_PENDING_ACTION \\"PENDING_ACTION:NEGATE\\": REJECT_PENDING_ACTION \\"PENDING_SLOT:EDIT\\": FILL_PENDING_SLOT \\"PENDING_SLOT:QUESTION\\": FILL_PENDING_SLOT \\"PENDING_SLOT:NEGATE\\": FILL_PENDING_SLOT \\"PENDING_SLOT:AFFIRM\\": FILL_PENDING_SLOT action-lifecycle: enabled: true ttl-turns: 3 ttl-minutes: 30 tool-orchestration: enabled: true guardrail: enabled: true sanitize-input: true require-approval-for-sensitive-actions: false approval-gate-fail-closed: false sensitive-patterns: [] state-graph: enabled: true soft-block-on-violation: false allowed-transitions: {} disambiguation: enabled: true max-options: 5 memory: enabled: true summary-max-chars: 1200 recent-turns-for-summary: 3 # Transport mechanisms transport: sse: enabled: true emitter-timeout-ms: 1800000 stomp: enabled: false endpoint: /ws-convengine app-destination-prefix: /app topic-prefix: /topic audit-destination-base: /topic/convengine/audit allowed-origin-pattern: \\"*\\" sock-js: true broker: mode: SIMPLE # SIMPLE | RELAY relay-destination-prefixes: /topic,/queue relay-host: localhost relay-port: 61613 client-login: \\"\\" client-passcode: \\"\\" system-login: \\"\\" system-passcode: \\"\\" virtual-host: \\"\\" system-heartbeat-send-interval-ms: 10000 system-heartbeat-receive-interval-ms: 10000 # Auditing controls audit: enabled: true persist-meta: true cache-inspector: false level: ALL # ALL | STANDARD | ERROR_ONLY | NONE include-stages: [] exclude-stages: [] persistence: mode: IMMEDIATE # IMMEDIATE | DEFERRED_BULK jdbc-batch-size: 200 max-buffered-events: 5000 flush-stages: ENGINE_KNOWN_FAILURE,ENGINE_UNKNOWN_FAILURE final-step-names: PipelineEndGuardStep flush-on-stop-outcome: true dispatch: async-enabled: false worker-threads: 2 queue-capacity: 2000 rejection-policy: CALLER_RUNS # CALLER_RUNS | DROP_NEWEST | DROP_OLDEST | ABORT keep-alive-seconds: 60 rate-limit: enabled: false max-events: 200 window-ms: 1000 per-conversation: true per-stage: true max-tracked-buckets: 20000 } </CodeBlockToggle> --- ## Breakdown: Flow Configuration The convengine.flow.* properties control the nuanced routing behavior without requiring consumer-side hardcoded Java branching for common dialogue/action patterns. <DbTable title=\\"convengine.flow.dialogue-act\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"resolute\\", \\"REGEX_THEN_LLM\\", \\"Intent resolution strategy (REGEX_ONLY, REGEX_THEN_LLM, LLM_ONLY)\\"], [\\"llm-threshold\\", \\"0.90\\", \\"Confidence threshold for LLM intent classification via DialogueAct\\"] ]} /> <DbTable title=\\"convengine.flow.query-rewrite\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"enabled\\", \\"true\\", \\"Automatically derives a standalone query from conversation history for contextual downstream RAG tool injection.\\"] ]} /> <DbTable title=\\"convengine.flow.conversation-history\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"maxTurns\\", \\"10\\", \\"Maximum number of conversation turns to retain in history before summarization.\\"] ]} /> <DbTable title=\\"convengine.flow.interaction-policy\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"execute-pending-on-affirm\\", \\"true\\", \\"Automatically run pending action if user says yes\\"], [\\"reject-pending-on-negate\\", \\"true\\", \\"Cancel pending action if user says no\\"], [\\"fill-pending-slot-on-non-new-request\\", \\"true\\", \\"Assign input to a waiting required parameter slot\\"], [\\"require-resolved-intent-and-state\\", \\"true\\", \\"Enforce strict intent tracking\\"], [\\"matrix\\", \\"{...}\\", \\"Configures the fallback resolution engine for dialogue act intent mapping to standard actions (e.g. PENDING_ACTION:AFFIRM -> EXECUTE_PENDING_ACTION)\\"] ]} /> <DbTable title=\\"convengine.flow.action-lifecycle\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"enabled\\", \\"true\\", \\"Tracks how long pending actions remain valid\\"], [\\"ttl-turns\\", \\"3\\", \\"Number of conversational turns a pending action survives before eviction\\"], [\\"ttl-minutes\\", \\"30\\", \\"Wall-clock time bounds for pending action survival\\"] ]} /> <DbTable title=\\"convengine.flow.guardrail\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"enabled\\", \\"true\\", \\"General guardrail functionality\\"], [\\"sanitize-input\\", \\"true\\", \\"Basic textual sanitization\\"], [\\"require-approval-for-sensitive-actions\\", \\"false\\", \\"If true, high-privilege tool execution demands explicit user affirmation\\"], [\\"approval-gate-fail-closed\\", \\"false\\", \\"If true, guardrail rejections fail closed rather than degrading gracefully\\"], [\\"sensitive-patterns\\", \\"[]\\", \\"Regex signatures for proactive redaction\\"] ]} /> <DbTable title=\\"convengine.flow.state-graph\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"enabled\\", \\"true\\", \\"Turn state transition validation on/off\\"], [\\"soft-block-on-violation\\", \\"false\\", \\"Allow transition but mark warning if violating strict pathing\\"], [\\"allowed-transitions\\", \\"{}\\", \\"Map defining hard-coded allowed path trajectories\\"] ]} /> <DbTable title=\\"convengine.flow.disambiguation\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"enabled\\", \\"true\\", \\"Allow engine to propose follow-ups when intent density intersects/collides\\"], [\\"max-options\\", \\"5\\", \\"Clamp the number of disambiguation choices returned\\"] ]} /> <DbTable title=\\"convengine.flow.memory\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"enabled\\", \\"true\\", \\"Enables LLM-driven session summarization for long dialogues\\"], [\\"summary-max-chars\\", \\"1200\\", \\"Maximum characters allowed in token context injection for memory\\"], [\\"recent-turns-for-summary\\", \\"3\\", \\"Sliding window of interaction chunks prior to memory compression\\"] ]} /> --- ## Breakdown: Audit Configuration convengine.audit.* dictates how the system records telemetry and metric payloads down to the individual pipeline stage logic. <DbTable title=\\"convengine.audit\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"enabled\\", \\"true\\", \\"Root toggle for the audit framework\\"], [\\"persist-meta\\", \\"true\\", \\"Attach engine metadata to the payload (intent, state, emittedAt)\\"], [\\"cache-inspector\\", \\"false\\", \\"Takes full snapshots of the memory session tree on every cache step\\"], [\\"level\\", \\"ALL\\", \\"Logging verbosity threshold (ALL, STANDARD, ERROR_ONLY, NONE)\\"], [\\"include-stages\\", \\"[]\\", \\"Whitelist specific stages\\"], [\\"exclude-stages\\", \\"[]\\", \\"Blacklist specific stages\\"] ]} /> <DbTable title=\\"convengine.audit.dispatch\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"async-enabled\\", \\"false\\", \\"Moves transport fan-out off the main request thread when true\\"], [\\"worker-threads\\", \\"2\\", \\"Number of async audit dispatcher threads\\"], [\\"queue-capacity\\", \\"2000\\", \\"Maximum queued events\\"], [\\"rejection-policy\\", \\"CALLER_RUNS\\", \\"Backpressure handling when capacity exceeded (CALLER_RUNS, DROP_NEWEST, DROP_OLDEST, ABORT)\\"], [\\"keep-alive-seconds\\", \\"60\\", \\"Metrics keep-alive window\\"] ]} /> <DbTable title=\\"convengine.audit.persistence\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"mode\\", \\"IMMEDIATE\\", \\"Write style. IMMEDIATE writes row by row. DEFERRED_BULK buffers events and writes batch inserts (safer under load).\\"], [\\"jdbc-batch-size\\", \\"200\\", \\"Row chunking factor for DB connection drivers\\"], [\\"max-buffered-events\\", \\"5000\\", \\"Maximum heap objects maintained for bulk emission\\"], [\\"flush-stages\\", \\"ENGINE_KNOWN_FAILURE, ENGINE_UNKNOWN_FAILURE\\", \\"Immediate force-flush triggers\\"], [\\"final-step-names\\", \\"PipelineEndGuardStep\\", \\"Trigger to signify request termination to commit remainder logs\\"], [\\"flush-on-stop-outcome\\", \\"true\\", \\"Flush early if a stage explicitly terminates the pipeline\\"] ]} /> <DbTable title=\\"convengine.audit.rate-limit\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"enabled\\", \\"false\\", \\"Protects DB from noisy event generation loop conditions\\"], [\\"max-events\\", \\"200\\", \\"Cap on volume\\"], [\\"window-ms\\", \\"1000\\", \\"Time interval (sliding)\\"], [\\"per-conversation\\", \\"true\\", \\"Bucket per conversation UUID\\"], [\\"per-stage\\", \\"true\\", \\"Bucket per discrete execution component logic\\"], [\\"max-tracked-buckets\\", \\"20000\\", \\"Upper memory footprint limit for Token Bucket store\\"] ]} /> --- ## Breakdown: Transport Configuration convengine.transport.* applies to interactive async communication paths like Server Sent Events (SSE) or WebSockets via STOMP. <DbTable title=\\"convengine.transport.stomp.broker\\" columns={[\\"Property\\", \\"Default\\", \\"Description\\"]} rows={[ [\\"mode\\", \\"SIMPLE\\", \\"SIMPLE operates an in-memory broker. RELAY interfaces with external STOMP brokers (e.g., RabbitMQ).\\"], [\\"relay-destination-prefixes\\", \\"/topic, /queue\\", \\"Path segments bound to external relay dispatch\\"], [\\"relay-host\\", \\"localhost\\", \\"Address of standard STOMP capable broker\\"], [\\"relay-port\\", \\"61613\\", \\"Network port\\"], [\\"system-heartbeat-send-interval-ms\\", \\"10000\\", \\"Broker heartbeat outgoing frequency\\"], [\\"system-heartbeat-receive-interval-ms\\", \\"10000\\", \\"Broker heartbeat tolerance incoming frequency\\"] ]} /> <Highlight type=\\"tip\\" title=\\"Stream enablement note\\"> Some transport handlers may also be gated by @EnableConvEngine(stream = true) in your main application class. </Highlight>","excerpt":"Consumer Configuration This guide covers the core tunable properties available for ConvEngine consumers. Properties are managed via Spring Boot @ConfigurationProperties and can be set in your application.yml or applicati\u2026"},{"id":"consumer/extensions.mdx","version":"v2","title":"extensions","permalink":"/docs/v2/consumer/extensions","content":"Extension Points and Intervention Scenarios EngineStepHook intervene between any steps Real scenario: For LOG_ANALYSIS , inject additional retrieval hint before schema extraction. @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) } } :::tip Where to use this Use hooks when you need low friction runtime intervention without forking framework steps. ::: ContainerDataTransformer reshape container response Real scenario: CCF returns nested payload; you flatten to schema friendly map. } } ResponseTransformer post process final payload Real scenario: Add support team escalation footer for high severity disconnect failures. return responsePayload; } } } ContainerDataInterceptor intercept request/response around CCF Real scenario: add tenant metadata and redact a field before persistence. Rule Action Playbook ( SET_TASK , SET_JSON , GET_CONTEXT , GET_SESSION ) These actions execute inside RulesStep.execute(...) and mutate the live EngineSession . Set ce_rule.phase based on where you want the action to run: PRE_RESPONSE_RESOLUTION : normal RulesStep pass. POST_AGENT_INTENT : post intent pass inside AgentIntentResolver . SET_TASK execute consumer Java methods from rule Use this when a rule match must trigger consumer side business logic (incident raise, tracker lookup, eligibility fetch, etc). Set ce_rule.action to SET_TASK and provide bean/method mapping in action_value . Bean must be a Spring bean with the configured bean name and implement CeRuleTask . Methods are invoked with (EngineSession session, CeRule rule) . public void attachEta(EngineSession session, CeRule rule) } } Downstream prompt/response can read new context/inputParams (for example requestStatus , lastUpdated , eta_hours ). SET_JSON move JSONPath value into input params Use this to extract one value from runtime session JSON into a flat prompt var. SET_JSON writes to session.putInputParam(\\"error_code\\", value) . It does not change session.contextJson unless your subsequent task/hook updates context explicitly. GET_CONTEXT snapshot context into input params Use this when prompt templates or tasks need full context as a single variable. If action_value is blank, engine uses default key context . GET_SESSION snapshot session facts into input params Use this for advanced derived responses that need runtime flags ( schemaComplete , intentLocked , missingRequiredFields , etc). If action_value is blank, engine uses default key session . SET_TASK methods run during rule execution. Keep methods deterministic and idempotent. For side effecting calls (ticket creation, webhook dispatch), guard with strict rule conditions and add idempotency keys from conversationId . Resolvers engine/rule/type/provider/SetTaskActionResolver.java engine/rule/type/provider/SetJsonActionResolver.java engine/rule/type/provider/GetContextActionResolver.java engine/rule/type/provider/GetSessionActionResolver.java Task invocation engine/rule/task/CeRuleTaskExecutor.java Execution loop engine/steps/RulesStep.java Custom action resolver ( RuleActionResolver ) Consumer can define a brand new rule action without changing framework core. Implement RuleActionResolver and return your action name from action() . @Override public void resolve(EngineSession session, CeRule rule) } } Set ce_rule.action to your custom token (case insensitive lookup), for example ENRICH_TIER . No manual factory config is needed. RuleActionResolverFactory auto registration behavior auto discovers all Spring beans implementing RuleActionResolver and maps by action().toUpperCase() .","rawContent":"# Extension Points and Intervention Scenarios <div className=\\"ce-extensions-page\\"> ## EngineStepHook - intervene between any steps {#1-enginestephook---intervene-between-any-steps} Real scenario: For LOG_ANALYSIS , inject additional retrieval hint before schema extraction. <CodeBlockToggle title=\\"EngineStepHook example\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.hooks\\"> { @Component public class LogAnalysisHintHook implements EngineStepHook { @Override public boolean supports(EngineStep.Name stepName, EngineSession session) { return EngineStep.Name.SchemaExtractionStep == stepName && \\"LOG_ANALYSIS\\".equalsIgnoreCase(session.getIntent()); } @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) { session.putInputParam(\\"log_source_priority\\", \\"APM_FIRST\\"); } } } </CodeBlockToggle> :::tip Where to use this Use hooks when you need low-friction runtime intervention without forking framework steps. ::: ## ContainerDataTransformer - reshape container response {#2-containerdatatransformer---reshape-container-response} Real scenario: CCF returns nested payload; you flatten to schema-friendly map. <CodeBlockToggle title=\\"ContainerDataTransformer example\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.transformers\\"> { @Component @ContainerDataTransformer(intent = \\"REQUEST_TRACKER\\", state = \\"IDLE\\") public class RequestTrackerContainerTransformer implements ContainerDataTransformerHandler { @Override public Map<String, Object> transform(ContainerComponentResponse response, EngineSession session, Map<String, Object> inputParams) { Map<String, Object> out = new LinkedHashMap<>(); out.put(\\"ticket_id\\", inputParams.get(\\"ticketId\\")); out.put(\\"status\\", \\"IN_REVIEW\\"); return out; } } } </CodeBlockToggle> ## ResponseTransformer - post-process final payload {#3-responsetransformer---post-process-final-payload} Real scenario: Add support-team escalation footer for high-severity disconnect failures. <CodeBlockToggle title=\\"ResponseTransformer example\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.transformers\\"> { @Component @ResponseTransformer(intent = \\"DISCONNECT_ELECTRICITY\\", state = \\"FAILED\\") public class DisconnectFailureResponseTransformer implements ResponseTransformerHandler { @Override public OutputPayload transform(OutputPayload responsePayload, EngineSession session, Map<String, Object> inputParams) { if (responsePayload instanceof TextPayload(String text)) { return new TextPayload(text + \\"\\\\\\\\nIf this is urgent, call support at +1-800-000-0000.\\"); } return responsePayload; } } } </CodeBlockToggle> ## ContainerDataInterceptor - intercept request/response around CCF {#4-containerdatainterceptor---intercept-requestresponse-around-ccf} Real scenario: add tenant metadata and redact a field before persistence. <CodeBlockToggle title=\\"Interceptor scenario (concept)\\" language=\\"text\\"> { Before Execute: - inject tenantId/requestId - attach observability headers After Execute: - redact sensitive node from raw container payload - enrich session input params for downstream rule checks } </CodeBlockToggle> ## Rule Action Playbook ( SET_TASK , SET_JSON , GET_CONTEXT , GET_SESSION ) {#5-rule-action-playbook-set_task-set_json-get_context-get_session} These actions execute inside <MethodRef>RulesStep.execute(...)</MethodRef> and mutate the live <MethodRef>EngineSession</MethodRef>. Set <MethodRef>ce_rule.phase</MethodRef> based on where you want the action to run: - <MethodRef>PRE_RESPONSE_RESOLUTION</MethodRef>: normal <MethodRef>RulesStep</MethodRef> pass. - <MethodRef>POST_AGENT_INTENT</MethodRef>: post-intent pass inside <MethodRef>AgentIntentResolver</MethodRef>. <DbTable title=\\"Action value format (exact runtime behavior)\\" columns={[\\"Action\\", \\"action_value format\\", \\"Engine behavior\\"]} rows={[ [\\"SET_TASK\\", \\"beanName:methodName or beanName:methodA,methodB\\", \\"Invokes Spring bean methods via CeRuleTaskExecutor\\"], [\\"SET_JSON\\", \\"targetKey:jsonPath\\", \\"Extracts JSONPath from session eject and stores into inputParams[targetKey]\\"], [\\"GET_CONTEXT\\", \\"targetKey (optional)\\", \\"Stores session.contextDict() into inputParams[targetKey] (default key=context)\\"], [\\"GET_SESSION\\", \\"targetKey (optional)\\", \\"Stores session.sessionDict() into inputParams[targetKey] (default key=session)\\"], ]} /> ### SET_TASK - execute consumer Java methods from rule {#51-set_task---execute-consumer-java-methods-from-rule} Use this when a rule match must trigger consumer-side business logic (incident raise, tracker lookup, eligibility fetch, etc). <FlowStep step=\\"1\\" title=\\"Create ce_rule row\\"> Set <MethodRef>ce_rule.action</MethodRef> to <MethodRef>SET_TASK</MethodRef> and provide bean/method mapping in <MethodRef>action_value</MethodRef>. </FlowStep> <CodeBlockToggle title=\\"SET_TASK rule example (SQL)\\" language=\\"sql\\"> { INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'PRE_RESPONSE_RESOLUTION\', \'REQUEST_TRACKER\', \'ANY\', \'REGEX\', \'(?i).*track.*request.*\', \'SET_TASK\', \'requestTrackerTask:loadStatus,attachEta\', 10, true, \'Load tracker status + ETA from consumer service\'); } </CodeBlockToggle> <FlowStep step=\\"2\\" title=\\"Implement task bean\\"> Bean must be a Spring bean with the configured bean name and implement <MethodRef>CeRuleTask</MethodRef>. Methods are invoked with <MethodRef>(EngineSession session, CeRule rule)</MethodRef>. </FlowStep> <CodeBlockToggle title=\\"Consumer task bean (Java)\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.tasks\\" filePath=\\"src/main/java/com/acme/convengine/tasks/RequestTrackerTask.java\\" > { @Component(\\"requestTrackerTask\\") public class RequestTrackerTask implements CeRuleTask { public void loadStatus(EngineSession session, CeRule rule) { String requestId = String.valueOf(session.getInputParams().getOrDefault(\\"requestId\\", \\"\\")); // fetch from your DB/service session.putInputParam(\\"requestStatus\\", \\"APPROVAL_PENDING\\"); session.putInputParam(\\"lastUpdated\\", \\"2026-02-10T11:40:00Z\\"); } public void attachEta(EngineSession session, CeRule rule) { session.putInputParam(\\"eta_hours\\", 12); } } } </CodeBlockToggle> <FlowStep step=\\"3\\" title=\\"Use in response generation\\"> Downstream prompt/response can read new context/inputParams (for example requestStatus , lastUpdated , eta_hours ). </FlowStep> ### SET_JSON - move JSONPath value into input params {#52-set_json---move-jsonpath-value-into-input-params} Use this to extract one value from runtime session JSON into a flat prompt var. <CodeBlockToggle title=\\"SET_JSON rule example (SQL)\\" language=\\"sql\\"> { INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'PRE_RESPONSE_RESOLUTION\', \'LOG_ANALYSIS\', \'ANY\', \'JSON_PATH\', \'$.schemaJson.errorCode != null\', \'SET_JSON\', \'error_code:$.schemaJson.errorCode\', 20, true, \'Expose extracted errorCode as prompt var\'); } </CodeBlockToggle> <Highlight type=\\"info\\" title=\\"What exactly gets updated\\"> SET_JSON writes to <MethodRef>session.putInputParam(\\"error_code\\", value)</MethodRef>. It does not change session.contextJson unless your subsequent task/hook updates context explicitly. </Highlight> ### GET_CONTEXT - snapshot context into input params {#53-get_context---snapshot-context-into-input-params} Use this when prompt templates or tasks need full context as a single variable. <CodeBlockToggle title=\\"GET_CONTEXT rule example (SQL)\\" language=\\"sql\\"> { INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'PRE_RESPONSE_RESOLUTION\', \'REQUEST_TRACKER\', \'ANY\', \'REGEX\', \'(?i).*status.*\', \'GET_CONTEXT\', \'ctx_snapshot\', 30, true, \'Expose full context to prompt/task layer\'); } </CodeBlockToggle> If action_value is blank, engine uses default key context . ### GET_SESSION - snapshot session facts into input params {#54-get_session---snapshot-session-facts-into-input-params} Use this for advanced derived responses that need runtime flags ( schemaComplete , intentLocked , missingRequiredFields , etc). <CodeBlockToggle title=\\"GET_SESSION rule example (SQL)\\" language=\\"sql\\"> { INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'PRE_RESPONSE_RESOLUTION\', \'DISCONNECT_ELECTRICITY\', \'ANY\', \'JSON_PATH\', \'$.schemaComplete == false\', \'GET_SESSION\', \'session_snapshot\', 40, true, \'Expose full runtime session facts for follow-up prompt decisions\'); } </CodeBlockToggle> If action_value is blank, engine uses default key session . <Highlight type=\\"warning\\" title=\\"Operational guardrails\\"> SET_TASK methods run during rule execution. Keep methods deterministic and idempotent. For side-effecting calls (ticket creation, webhook dispatch), guard with strict rule conditions and add idempotency keys from <MethodRef>conversationId</MethodRef>. </Highlight> <Highlight type=\\"tip\\" title=\\"Where to trace this in code\\"> <div className=\\"ce-chip-groups\\"> <div className=\\"ce-chip-group\\"> <span className=\\"ce-chip-group-label\\">Resolvers</span> <div className=\\"ce-chip-list\\"> <span className=\\"ce-chip-item\\"><FileRef>engine/rule/type/provider/SetTaskActionResolver.java</FileRef></span> <span className=\\"ce-chip-item\\"><FileRef>engine/rule/type/provider/SetJsonActionResolver.java</FileRef></span> <span className=\\"ce-chip-item\\"><FileRef>engine/rule/type/provider/GetContextActionResolver.java</FileRef></span> <span className=\\"ce-chip-item\\"><FileRef>engine/rule/type/provider/GetSessionActionResolver.java</FileRef></span> </div> </div> <div className=\\"ce-chip-group\\"> <span className=\\"ce-chip-group-label\\">Task invocation</span> <div className=\\"ce-chip-list\\"> <span className=\\"ce-chip-item\\"><FileRef>engine/rule/task/CeRuleTaskExecutor.java</FileRef></span> </div> </div> <div className=\\"ce-chip-group\\"> <span className=\\"ce-chip-group-label\\">Execution loop</span> <div className=\\"ce-chip-list\\"> <span className=\\"ce-chip-item\\"><FileRef>engine/steps/RulesStep.java</FileRef></span> </div> </div> </div> </Highlight> ### Custom action resolver ( RuleActionResolver ) {#55-custom-action-resolver-ruleactionresolver} Consumer can define a brand-new rule action without changing framework core. <FlowStep step=\\"1\\" title=\\"Create custom resolver bean\\"> Implement <MethodRef>RuleActionResolver</MethodRef> and return your action name from <MethodRef>action()</MethodRef>. </FlowStep> <CodeBlockToggle title=\\"Custom RuleActionResolver example\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.rules\\" filePath=\\"src/main/java/com/acme/convengine/rules/EnrichCustomerTierActionResolver.java\\" > { @Component public class EnrichCustomerTierActionResolver implements RuleActionResolver { @Override public String action() { return \\"ENRICH_TIER\\"; } @Override public void resolve(EngineSession session, CeRule rule) { // action_value example: customerTier:PREMIUM String raw = rule.getActionValue() == null ? \\"\\" : rule.getActionValue(); String[] parts = raw.split(\\":\\", 2); String key = parts.length > 0 && !parts[0].isBlank() ? parts[0] : \\"customerTier\\"; String value = parts.length > 1 ? parts[1] : \\"STANDARD\\"; session.putInputParam(key, value); } } } </CodeBlockToggle> <FlowStep step=\\"2\\" title=\\"Use action in ce_rule\\"> Set <MethodRef>ce_rule.action</MethodRef> to your custom token (case-insensitive lookup), for example <MethodRef>ENRICH_TIER</MethodRef>. </FlowStep> <CodeBlockToggle title=\\"ce_rule row for custom action\\" language=\\"sql\\"> { INSERT INTO ce_rule (phase, intent_code, rule_type, match_pattern, action, action_value, priority, enabled, description) VALUES (\'PRE_RESPONSE_RESOLUTION\', \'REQUEST_TRACKER\', \'REGEX\', \'(?i).*vip.*\', \'ENRICH_TIER\', \'customerTier:PREMIUM\', 5, true, \'Mark VIP tier for downstream response logic\'); } </CodeBlockToggle> <Highlight type=\\"tip\\" title=\\"Auto-registration behavior\\"> No manual factory config is needed. <DocTermPopup term=\\"Auto-registration behavior\\">RuleActionResolverFactory auto-registration behavior</DocTermPopup> auto-discovers all Spring beans implementing <MethodRef>RuleActionResolver</MethodRef> and maps by <MethodRef>action().toUpperCase()</MethodRef>. </Highlight> </div>","excerpt":"Extension Points and Intervention Scenarios EngineStepHook intervene between any steps Real scenario: For LOG_ANALYSIS , inject additional retrieval hint before schema extraction. @Override public void beforeStep(EngineS\u2026"},{"id":"consumer/index.mdx","version":"v2","title":"index","permalink":"/docs/v2/consumer","content":"Consumer Integration What changed in integration Configure behavior via convengine.flow. Use ce_pending_action for confirmable actions Prefer rules/policy over custom Java branching Add tool executors through tool group adapters Minimum setup @EnableConvEngine LlmClient implementation DDL + seed for required ce_ tables response/rule rows for initial and terminal states Dive deeper","rawContent":"# Consumer Integration ## What changed in integration - Configure behavior via convengine.flow.* - Use ce_pending_action for confirmable actions - Prefer rules/policy over custom Java branching - Add tool executors through tool-group adapters ## Minimum setup - @EnableConvEngine - LlmClient implementation - DDL + seed for required ce_* tables - response/rule rows for initial and terminal states ## Dive deeper - [New Consumer Onboarding](/docs/v2/consumer/new-consumer-onboarding) - [Backend Integration](/docs/v2/consumer/backend-integration) - [Caching & Persistence](/docs/v2/consumer/caching-and-persistence) - [Configuration](/docs/v2/consumer/configuration) - [Annotations Reference](/docs/v2/consumer/annotations-reference) - [Extensions](/docs/v2/consumer/extensions) - [Session Reset & Continuity](/docs/v2/consumer/session-reset-and-continuity) - [MCP Basics](/docs/v2/consumer/mcp/basics) - [MCP Advanced Guide](/docs/v2/consumer/mcp/advanced) - [MCP Example 1 (Mockey + Demo)](/docs/v2/consumer/mcp/example1) - [MCP Example 2 - Loan Application](/docs/v2/consumer/mcp/example2) - [UI Integration](/docs/v2/consumer/ui-integration)","excerpt":"Consumer Integration What changed in integration Configure behavior via convengine.flow. Use ce_pending_action for confirmable actions Prefer rules/policy over custom Java branching Add tool executors through tool group \u2026"},{"id":"consumer/mcp/advanced.mdx","version":"v2","title":"advanced","permalink":"/docs/v2/consumer/mcp/advanced","content":"MCP Advanced Guide (v2.0.7) This page documents the production MCP model in ConvEngine 2.0.7 , including planner guardrails, post phase rules, and MCP context metadata used by ce_rule JSON_PATH. Read order 1. 2. MCP Advanced Guide (this page) 3. 4. 5. 6. Phase names (current) PRE_RESPONSE_RESOLUTION POST_AGENT_INTENT POST_AGENT_MCP POST_TOOL_EXECUTION Compatibility note: legacy values ( PIPELINE_RULES , AGENT_POST_INTENT , AGENT_POST_MCP , TOOL_POST_EXECUTION ) are normalized at runtime. Tool execution paths Planner MCP path ( McpToolStep ) 1. Planner returns CALL_TOOL or ANSWER . 2. Tool results are appended to context.mcp.observations . 3. For ANSWER , final text is written to context.mcp.finalAnswer . 4. Rules run in phase POST_AGENT_MCP . 5. Response resolution runs after rule transitions. Direct tool path ( ToolOrchestrationStep ) 1. Request contains tool_request . 2. Exactly one tool executes. 3. Result stored in inputParams.tool_result and context.mcp.toolExecution . 4. Rules run in phase POST_TOOL_EXECUTION . 5. Response resolution runs with updated state/context. Guardrail blocked answer semantics When MCP_STATUS=GUARDRAIL_BLOCKED_NEXT_TOOL : 1. McpToolStep writes fallback text ( McpConstants.FALLBACK_GUARDRAIL_BLOCKED ) to context.mcp.finalAnswer . 2. Rules in POST_AGENT_MCP still execute. 3. ce_response remains the final response authority (commonly DERIVED using context.mcp.finalAnswer ). MCP metadata model for rules context.mcp.lifecycle : phase , status , outcome , finished blocked , error , errorMessage lastAction , lastToolCode , lastToolGroup , lastToolArgs toolExecuted context.mcp.toolExecution : phase , status , outcome , finished error , scopeMismatch , toolExecuted toolCode , toolGroup , meta , result , errorMessage JSON_PATH patterns you can use in ce_rule.match_pattern text $[?(@.context.mcp.lifecycle.finished == true && @.context.mcp.lifecycle.outcome == \'BLOCKED\')] $[?(@.context.mcp.lifecycle.error == true)] $[?(@.context.mcp.toolExecution.phase == \'POST_TOOL_EXECUTION\' && @.context.mcp.toolExecution.status == \'SUCCESS\')] $[?(@.context.mcp.toolExecution.scopeMismatch == true)] Direct tool example ( POST_TOOL_EXECUTION ) User asks: Check order ORD 7017 status. json } } Execution: ToolOrchestrationStep executes one tool. Writes tool_result + tool_status=SUCCESS . Writes context.mcp.toolExecution. . Executes POST_TOOL_EXECUTION rules. Example: rule sets state to ORDER_SUBMITTED_DIAGNOSIS when tool status is submitted. ce_mcp_tool and ce_mcp_planner scoping rules intent_code and state_code are mandatory (no null/blank scope). Allowed values: intent_code : defined ce_intent.intent_code or ANY or UNKNOWN state_code : values present in ce_rule.state_code or ANY or UNKNOWN Invalid scope rows are blocked at startup by static scope validation. Planner prompt source ( ce_mcp_planner ) Planner prompt selection: 1. exact intent_code + state_code 2. exact intent_code + ANY 3. global ANY + ANY 4. legacy fallback ( ce_config McpPlanner keys) if planner rows are unavailable SQL snippets sql INSERT INTO ce_mcp_planner (planner_id, intent_code, state_code, system_prompt, user_prompt, enabled) VALUES (1001, \'ANY\', \'ANY\', \'...\', \'...\', true), (1002, \'LOAN_APPLICATION\', \'ELIGIBILITY_GATE\', \'...\', \'...\', true); sql INSERT INTO ce_mcp_tool (tool_id, tool_code, tool_group, intent_code, state_code, enabled, description) VALUES (9001, \'db.knowledge.graph\', \'DB\', \'ANY\', \'ANY\', true, \'DB knowledge graph\'), (9002, \'order.status.api\', \'HTTP_API\', \'ANY\', \'ANY\', true, \'Order status API\'); For MCP chains, keep final user text in ce_response / ce_prompt_template and treat context.mcp.finalAnswer as a derived source, not the final transport payload.","rawContent":"# MCP Advanced Guide (v2.0.7) This page documents the production MCP model in ConvEngine 2.0.7 , including planner guardrails, post-phase rules, and MCP context metadata used by ce_rule JSON_PATH. ## Read order 1. [MCP Basics](/docs/v2/consumer/mcp/basics) 2. MCP Advanced Guide (this page) 3. [MCP HTTP Tool](/docs/v2/consumer/mcp/http-tool) 4. [MCP Deep Dive](/docs/v2/consumer/mcp/deep-dive) 5. [MCP Example 1](/docs/v2/consumer/mcp/example1) 6. [MCP Example 2](/docs/v2/consumer/mcp/example2) ## Phase names (current) - PRE_RESPONSE_RESOLUTION - POST_AGENT_INTENT - POST_AGENT_MCP - POST_TOOL_EXECUTION Compatibility note: legacy values ( PIPELINE_RULES , AGENT_POST_INTENT , AGENT_POST_MCP , TOOL_POST_EXECUTION ) are normalized at runtime. ## Tool execution paths ### Planner MCP path ( McpToolStep ) 1. Planner returns CALL_TOOL or ANSWER . 2. Tool results are appended to context.mcp.observations . 3. For ANSWER , final text is written to context.mcp.finalAnswer . 4. Rules run in phase POST_AGENT_MCP . 5. Response resolution runs after rule transitions. ### Direct tool path ( ToolOrchestrationStep ) 1. Request contains tool_request . 2. Exactly one tool executes. 3. Result stored in inputParams.tool_result and context.mcp.toolExecution . 4. Rules run in phase POST_TOOL_EXECUTION . 5. Response resolution runs with updated state/context. ## Guardrail blocked answer semantics When MCP_STATUS=GUARDRAIL_BLOCKED_NEXT_TOOL : 1. McpToolStep writes fallback text ( McpConstants.FALLBACK_GUARDRAIL_BLOCKED ) to context.mcp.finalAnswer . 2. Rules in POST_AGENT_MCP still execute. 3. ce_response remains the final response authority (commonly DERIVED using context.mcp.finalAnswer ). ## MCP metadata model for rules context.mcp.lifecycle : - phase , status , outcome , finished - blocked , error , errorMessage - lastAction , lastToolCode , lastToolGroup , lastToolArgs - toolExecuted context.mcp.toolExecution : - phase , status , outcome , finished - error , scopeMismatch , toolExecuted - toolCode , toolGroup , meta , result , errorMessage ## JSON_PATH patterns you can use in ce_rule.match_pattern text $[?(@.context.mcp.lifecycle.finished == true && @.context.mcp.lifecycle.outcome == \'BLOCKED\')] $[?(@.context.mcp.lifecycle.error == true)] $[?(@.context.mcp.toolExecution.phase == \'POST_TOOL_EXECUTION\' && @.context.mcp.toolExecution.status == \'SUCCESS\')] $[?(@.context.mcp.toolExecution.scopeMismatch == true)] ## Direct tool example ( POST_TOOL_EXECUTION ) User asks: Check order ORD-7017 status. json { \\"tool_request\\": { \\"tool_code\\": \\"mock.order.status\\", \\"tool_group\\": \\"HTTP_API\\", \\"args\\": { \\"orderId\\": \\"ORD-7017\\" } } } Execution: - ToolOrchestrationStep executes one tool. - Writes tool_result + tool_status=SUCCESS . - Writes context.mcp.toolExecution.* . - Executes POST_TOOL_EXECUTION rules. - Example: rule sets state to ORDER_SUBMITTED_DIAGNOSIS when tool status is submitted. ## ce_mcp_tool and ce_mcp_planner scoping rules intent_code and state_code are mandatory (no null/blank scope). Allowed values: - intent_code : defined ce_intent.intent_code or ANY or UNKNOWN - state_code : values present in ce_rule.state_code or ANY or UNKNOWN Invalid scope rows are blocked at startup by static scope validation. ## Planner prompt source ( ce_mcp_planner ) Planner prompt selection: 1. exact intent_code + state_code 2. exact intent_code + ANY 3. global ANY + ANY 4. legacy fallback ( ce_config McpPlanner keys) if planner rows are unavailable ## SQL snippets <Tabs groupId=\\"mcp-advanced-sql\\"> <TabItem value=\\"planner\\" label=\\"Planner Rows\\" default> sql INSERT INTO ce_mcp_planner (planner_id, intent_code, state_code, system_prompt, user_prompt, enabled) VALUES (1001, \'ANY\', \'ANY\', \'...\', \'...\', true), (1002, \'LOAN_APPLICATION\', \'ELIGIBILITY_GATE\', \'...\', \'...\', true); </TabItem> <TabItem value=\\"tool\\" label=\\"Tool Rows\\"> sql INSERT INTO ce_mcp_tool (tool_id, tool_code, tool_group, intent_code, state_code, enabled, description) VALUES (9001, \'db.knowledge.graph\', \'DB\', \'ANY\', \'ANY\', true, \'DB knowledge graph\'), (9002, \'order.status.api\', \'HTTP_API\', \'ANY\', \'ANY\', true, \'Order status API\'); </TabItem> </Tabs> <Highlight type=\\"info\\" title=\\"Recommended response pattern\\"> For MCP chains, keep final user text in ce_response / ce_prompt_template and treat context.mcp.finalAnswer as a derived source, not the final transport payload. </Highlight>","excerpt":"MCP Advanced Guide (v2.0.7) This page documents the production MCP model in ConvEngine 2.0.7 , including planner guardrails, post phase rules, and MCP context metadata used by ce_rule JSON_PATH. Read order 1. 2. MCP Adva\u2026"},{"id":"consumer/mcp/basics.mdx","version":"v2","title":"basics","permalink":"/docs/v2/consumer/mcp/basics","content":"MCP Basics This page is the simple mental model for MCP in ConvEngine. What MCP does MCP lets the engine decide and call tools during a chat turn. Basic flow: 1. user asks a question 2. planner chooses CALL_TOOL or ANSWER 3. tool output is stored in context.mcp.observations 4. planner eventually writes context.mcp.finalAnswer 5. response resolver generates final user output Core tables Two execution modes Use planner mode first for real chat behavior. Use direct mode only for deterministic tool testing. Read next","rawContent":"# MCP Basics This page is the simple mental model for MCP in ConvEngine. ## What MCP does MCP lets the engine decide and call tools during a chat turn. Basic flow: 1. user asks a question 2. planner chooses CALL_TOOL or ANSWER 3. tool output is stored in context.mcp.observations 4. planner eventually writes context.mcp.finalAnswer 5. response resolver generates final user output ## Core tables <DbTable title=\\"MCP table map\\" columns={[\\"Table\\", \\"Purpose\\", \\"Used by\\"]} rows={[ [\\"ce_mcp_tool\\", \\"Tool registry and scope\\", \\"McpToolStep / ToolOrchestrationStep\\"], [\\"ce_mcp_db_tool\\", \\"DB SQL template fallback config\\", \\"McpDbToolExecutor\\"], [\\"ce_mcp_planner\\", \\"Planner prompts by intent/state\\", \\"McpPlanner\\"], ]} /> ## Two execution modes <DbTable title=\\"When each mode is used\\" columns={[\\"Mode\\", \\"Trigger\\", \\"Main output\\"]} rows={[ [\\"Planner mode\\", \\"Natural chat request (no direct tool_request)\\", \\"context.mcp.observations + context.mcp.finalAnswer\\"], [\\"Direct mode\\", \\"inputParams.tool_request provided\\", \\"inputParams.tool_result\\"], ]} /> <Highlight type=\\"tip\\" title=\\"Start here for testing\\"> Use planner mode first for real chat behavior. Use direct mode only for deterministic tool testing. </Highlight> ## Read next - [MCP Advanced Guide](/docs/v2/consumer/mcp/advanced) - [MCP HTTP Tool](/docs/v2/consumer/mcp/http-tool) - [MCP Example 1 (Mockey + Demo)](/docs/v2/consumer/mcp/example1) - [MCP Example 2 - Loan Application](/docs/v2/consumer/mcp/example2)","excerpt":"MCP Basics This page is the simple mental model for MCP in ConvEngine. What MCP does MCP lets the engine decide and call tools during a chat turn. Basic flow: 1. user asks a question 2. planner chooses CALL_TOOL or ANSWE\u2026"},{"id":"consumer/mcp/deep-dive.mdx","version":"v2","title":"deep dive","permalink":"/docs/v2/consumer/mcp/deep-dive","content":"}, }, }, }, }, }, }, }, } ]; , , , , , , , ]; u: , i: , p1: , t1: , p2: , r1: , r2: , rr: , o: }; MCP Deep Dive (v2.0.7) This page shows the exact MCP execution order using the Loan Application flow. Exact phase order after MCP planner finishes 1. POST_AGENT_MCP rules run first. 2. PRE_RESPONSE_RESOLUTION rules run next (RulesStep pre response pass). 3. ResponseResolutionStep runs after both rule passes. So yes, both rule passes execute for MCP turns. Guardrail blocked path For MCP_STATUS=GUARDRAIL_BLOCKED_NEXT_TOOL : 1. McpToolStep writes McpConstants.FALLBACK_GUARDRAIL_BLOCKED to context.mcp.finalAnswer . 2. POST_AGENT_MCP rules run. 3. PRE_RESPONSE_RESOLUTION rules run. 4. ce_response + ce_prompt_template still shape final user text. End to end walkthrough (Loan Application) fraud debt submit chain.\\" json= \\" }, \\" }, \\" }, \\" } ], lifecycle: } }} tables= info= / COMPLETED using JSON_PATH on context.mcp.finalAnswer.\\", \\"PRE_RESPONSE_RESOLUTION runs after that and can still apply final state/context adjustments.\\" ]} / POST_AGENT_MCP PRE_RESPONSE_RESOLUTION response\\" nodes= edges= detailsById= defaultSelectedId=\\"p1\\" / } } } Rule ready JSON_PATH recipes text $[?(@.context.mcp.lifecycle.finished == true && @.context.mcp.lifecycle.outcome == \'BLOCKED\')] $[?(@.context.mcp.lifecycle.error == true)] $[?(@.context.mcp.toolExecution.phase == \'POST_TOOL_EXECUTION\' && @.context.mcp.toolExecution.status == \'SUCCESS\')] $[?(@.context.mcp.toolExecution.scopeMismatch == true)] Use ce_rule for deterministic transitions and keep final wording in ce_response / ce_prompt_template . Use context.mcp. as rule evidence, then let response resolution produce final output.","rawContent":"{ id: \\"u\\", data: { label: \\"User input\\" } }, { id: \\"i\\", data: { label: \\"Intent + State\\" } }, { id: \\"p1\\", data: { label: \\"Planner loop\\" } }, { id: \\"t1\\", data: { label: \\"Tool calls\\" } }, { id: \\"p2\\", data: { label: \\"Planner ANSWER\\" } }, { id: \\"r1\\", data: { label: \\"POST_AGENT_MCP rules\\" } }, { id: \\"r2\\", data: { label: \\"PRE_RESPONSE_RESOLUTION rules\\" } }, { id: \\"rr\\", data: { label: \\"ResponseResolutionStep\\" } }, { id: \\"o\\", data: { label: \\"Assistant output\\" } } ]; { id: \\"e1\\", source: \\"u\\", target: \\"i\\" }, { id: \\"e2\\", source: \\"i\\", target: \\"p1\\" }, { id: \\"e3\\", source: \\"p1\\", target: \\"t1\\" }, { id: \\"e4\\", source: \\"t1\\", target: \\"p2\\" }, { id: \\"e5\\", source: \\"p2\\", target: \\"r1\\" }, { id: \\"e6\\", source: \\"r1\\", target: \\"r2\\" }, { id: \\"e7\\", source: \\"r2\\", target: \\"rr\\" }, { id: \\"e8\\", source: \\"rr\\", target: \\"o\\" } ]; u: { title: \\"User input\\", stage: \\"REQUEST\\", summary: \\"Loan application request enters the engine.\\", session: [\\"userText\\"], tables: [\\"ce_audit (W)\\"] }, i: { title: \\"Intent + State\\", stage: \\"INTENT\\", summary: \\"Classifier resolves LOAN_APPLICATION, state transitions into ELIGIBILITY_GATE.\\", session: [\\"intent=LOAN_APPLICATION\\", \\"state=ELIGIBILITY_GATE\\"], tables: [\\"ce_intent (R)\\", \\"ce_intent_classifier (R)\\", \\"ce_rule (R)\\"] }, p1: { title: \\"Planner loop\\", stage: \\"MCP_PLAN_LLM_OUTPUT\\", summary: \\"Planner selects next action CALL_TOOL/ANSWER from scoped tools and planner prompt.\\", session: [\\"mcp_action\\", \\"mcp_tool_code\\", \\"mcp_tool_args\\"], tables: [\\"ce_mcp_tool (R)\\", \\"ce_mcp_planner (R)\\", \\"ce_audit (W)\\"] }, t1: { title: \\"Tool calls\\", stage: \\"MCP_TOOL_RESULT\\", summary: \\"Loan chain runs: rating -> fraud -> debt -> submit (conditionally).\\", session: [\\"context.mcp.observations[]\\"], tables: [\\"ce_audit (W)\\"] }, p2: { title: \\"Planner ANSWER\\", stage: \\"MCP_FINAL_ANSWER\\", summary: \\"Planner writes final result into context.mcp.finalAnswer.\\", session: [\\"mcp_final_answer\\", \\"context.mcp.lifecycle.*\\"], tables: [\\"ce_audit (W)\\"] }, r1: { title: \\"POST_AGENT_MCP rules\\", stage: \\"RULES\\", summary: \\"Post-MCP rules react to context.mcp.finalAnswer and MCP metadata.\\", session: [\\"state mutation candidates\\"], tables: [\\"ce_rule (R)\\", \\"ce_audit (W)\\"] }, r2: { title: \\"PRE_RESPONSE_RESOLUTION rules\\", stage: \\"RULES\\", summary: \\"General pre-response rule pass runs after POST_AGENT_MCP.\\", session: [\\"final state/context before resolution\\"], tables: [\\"ce_rule (R)\\", \\"ce_audit (W)\\"] }, rr: { title: \\"ResponseResolutionStep\\", stage: \\"RESOLVE_RESPONSE\\", summary: \\"Resolves ce_response + ce_prompt_template from final intent/state/context.\\", session: [\\"payload\\"], tables: [\\"ce_response (R)\\", \\"ce_prompt_template (R)\\"] }, o: { title: \\"Assistant output\\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Final response is returned and conversation/audit persisted.\\", session: [\\"finalResult\\"], tables: [\\"ce_conversation (W)\\", \\"ce_conversation_history (W async)\\", \\"ce_audit (W)\\"] } }; # MCP Deep Dive (v2.0.7) This page shows the exact MCP execution order using the Loan Application flow. ## Exact phase order after MCP planner finishes 1. POST_AGENT_MCP rules run first. 2. PRE_RESPONSE_RESOLUTION rules run next (RulesStep pre-response pass). 3. ResponseResolutionStep runs after both rule passes. So yes, both rule passes execute for MCP turns. ## Guardrail blocked path For MCP_STATUS=GUARDRAIL_BLOCKED_NEXT_TOOL : 1. McpToolStep writes McpConstants.FALLBACK_GUARDRAIL_BLOCKED to context.mcp.finalAnswer . 2. POST_AGENT_MCP rules run. 3. PRE_RESPONSE_RESOLUTION rules run. 4. ce_response + ce_prompt_template still shape final user text. ## End-to-end walkthrough (Loan Application) <Tabs groupId=\\"mcp-deep-dive-main\\"> <TabItem value=\\"chat\\" label=\\"Chat + Internal Trace\\" default> <ChatContainer> <TraceChatBubble role=\\"user\\" name=\\"Turn 1 - User\\" message=\\"Apply loan for customer CUST-1001, amount 350000, tenure 36 months.\\" info={[\\"Intent resolves to LOAN_APPLICATION.\\", \\"State enters ELIGIBILITY_GATE.\\"]} /> <TraceChatBubble role=\\"assistant\\" name=\\"Turn 1 - Internal MCP Loop\\" message=\\"Planner executes rating -> fraud -> debt -> submit chain.\\" json={{ mcp: { observations: [ { toolCode: \\"loan.credit.rating.check\\", json: \\"{\\\\\\"creditRating\\\\\\":782}\\" }, { toolCode: \\"loan.credit.fraud.check\\", json: \\"{\\\\\\"flagged\\\\\\":false}\\" }, { toolCode: \\"loan.debt.credit.summary\\", json: \\"{\\\\\\"dti\\\\\\":0.31,\\\\\\"availableCredit\\\\\\":220000}\\" }, { toolCode: \\"loan.application.submit\\", json: \\"{\\\\\\"applicationId\\\\\\":\\\\\\"LA-90311\\\\\\",\\\\\\"status\\\\\\":\\\\\\"SUBMITTED\\\\\\"}\\" } ], lifecycle: { phase: \\"POST_AGENT_MCP\\", status: \\"TOOL_RESULT\\", outcome: \\"IN_PROGRESS\\", finished: false, toolExecuted: true, lastToolCode: \\"loan.application.submit\\" } } }} tables={[\\"ce_mcp_tool (R)\\", \\"ce_mcp_planner (R)\\", \\"ce_audit (W)\\"]} info={[\\"Tool results append to context.mcp.observations.\\"]} /> <TraceChatBubble role=\\"assistant\\" name=\\"Turn 1 - Rules + Final\\" message=\\"Loan application submitted. Application ID LA-90311.\\" json={{ mcp: { finalAnswer: \\"Loan approved and submitted with applicationId LA-90311.\\", lifecycle: { phase: \\"POST_AGENT_MCP\\", status: \\"ANSWER\\", outcome: \\"ANSWERED\\", finished: true, blocked: false, error: false } } }} tables={[\\"ce_rule (R)\\", \\"ce_response (R)\\", \\"ce_prompt_template (R)\\", \\"ce_conversation (W)\\"]} info={[ \\"POST_AGENT_MCP can move ELIGIBILITY_GATE -> COMPLETED using JSON_PATH on context.mcp.finalAnswer.\\", \\"PRE_RESPONSE_RESOLUTION runs after that and can still apply final state/context adjustments.\\" ]} /> </ChatContainer> </TabItem> <TabItem value=\\"flow\\" label=\\"Step Graph\\"> <EngineDebugFlow title=\\"Loan MCP flow\\" subtitle=\\"Planner/tool loop -> POST_AGENT_MCP -> PRE_RESPONSE_RESOLUTION -> response\\" nodes={mcpDeepNodes} edges={mcpDeepEdges} detailsById={mcpDeepDetails} defaultSelectedId=\\"p1\\" /> </TabItem> <TabItem value=\\"table\\" label=\\"Turn Table\\"> <DbTable title=\\"Table impact by stage\\" columns={[\\"Stage\\", \\"Reads\\", \\"Writes\\", \\"Context impact\\"]} rows={[ [\\"Intent/State\\", \\"ce_intent, ce_intent_classifier, ce_rule\\", \\"ce_audit\\", \\"session.intent/session.state\\"], [\\"MCP planner\\", \\"ce_mcp_tool, ce_mcp_planner\\", \\"ce_audit\\", \\"mcp_action/mcp_tool_code\\"], [\\"Tool execution\\", \\"(tool-specific)\\", \\"ce_audit\\", \\"context.mcp.observations[]\\"], [\\"Planner ANSWER\\", \\"ce_mcp_planner\\", \\"ce_audit\\", \\"context.mcp.finalAnswer + lifecycle\\"], [\\"POST_AGENT_MCP\\", \\"ce_rule\\", \\"ce_audit\\", \\"MCP-driven transition\\"], [\\"PRE_RESPONSE_RESOLUTION\\", \\"ce_rule\\", \\"ce_audit\\", \\"Final pre-response transition\\"], [\\"Response resolution\\", \\"ce_response, ce_prompt_template\\", \\"ce_audit, ce_conversation\\", \\"assistant payload\\"] ]} /> </TabItem> <TabItem value=\\"direct\\" label=\\"Direct Tool Mode\\"> <CodeBlockToggle title=\\"Direct tool request\\" language=\\"json\\"> { { \\"tool_request\\": { \\"tool_code\\": \\"loan.credit.rating.check\\", \\"tool_group\\": \\"HTTP_API\\", \\"args\\": { \\"customerId\\": \\"CUST-1001\\" } } } } </CodeBlockToggle> <DbTable title=\\" POST_TOOL_EXECUTION sequence\\" columns={[\\"Step\\", \\"What happens\\"]} rows={[ [\\"ToolOrchestrationStep\\", \\"Executes exactly one tool and writes inputParams.tool_result.\\"], [\\"Context metadata\\", \\"Writes context.mcp.toolExecution with status/outcome/meta/result.\\"], [\\"Rules\\", \\"Runs POST_TOOL_EXECUTION rules for direct-tool mode.\\"], [\\"RulesStep\\", \\"Runs PRE_RESPONSE_RESOLUTION rules before response resolution.\\"], [\\"Response\\", \\"ResponseResolutionStep uses final state/context.\\"] ]} /> </TabItem> </Tabs> ## Rule-ready JSON_PATH recipes text $[?(@.context.mcp.lifecycle.finished == true && @.context.mcp.lifecycle.outcome == \'BLOCKED\')] $[?(@.context.mcp.lifecycle.error == true)] $[?(@.context.mcp.toolExecution.phase == \'POST_TOOL_EXECUTION\' && @.context.mcp.toolExecution.status == \'SUCCESS\')] $[?(@.context.mcp.toolExecution.scopeMismatch == true)] <Highlight type=\\"tip\\" title=\\"Recommended production pattern\\"> Use ce_rule for deterministic transitions and keep final wording in ce_response / ce_prompt_template . Use context.mcp.* as rule evidence, then let response resolution produce final output. </Highlight>","excerpt":"}, }, }, }, }, }, }, }, } ]; , , , , , , , ]; u: , i: , p1: , t1: , p2: , r1: , r2: , rr: , o: }; MCP Deep Dive (v2.0.7) This page shows the exact MCP execution order using the Loan Application flow. Exact phase order af\u2026"},{"id":"consumer/mcp/example1.mdx","version":"v2","title":"example1","permalink":"/docs/v2/consumer/mcp/example1","content":"}, }, }, }, }, }, }, }, }, }, ]; , , , , , , , , , ]; u1: , i1: , m1: , t1: , m2: , t2: , m3: , r2: , r1: , out: }; MCP Example 1 (ConvEngine Demo + Mockey) This guide shows a complete local test of ConvEngine 2.0.7 advanced MCP HTTP tools using convengine demo and . It covers: 1. starting mock APIs in 2. wiring demo MCP tools to endpoints 3. seeding ce_mcp_tool and planner prompts 4. testing via SQL panel + chat requests Prerequisites repo available locally convengine demo repo available locally Postgres running for convengine demo ConvEngine dependency 2.0.7 What is already wired in demo convengine demo now includes four HttpApiRequestingToolHandler mappings: mock.order.submit POST /api/mock/order/submit mock.order.status GET /api/mock/order/status mock.order.async.trace GET /api/mock/order/async/trace mock.customer.profile GET /api/mock/customer/profile Base URL is configured by: yaml convengine: demo: mockey: base url: http://localhost:31333 api key: demo live key Step 1: Start From root: bash npm install npm start Expected log: text listening to 31333 Step 2: Quick endpoint smoke tests bash curl s \\"http://localhost:31333/api/mock/order/status?orderId=ORD 7017\\" curl s \\"http://localhost:31333/api/mock/order/async/trace?orderId=ORD 7017\\" curl s \\"http://localhost:31333/api/mock/customer/profile?customerId=CUST 1001\\" curl s X POST \\"http://localhost:31333/api/mock/order/submit\\" H \\"Content Type: application/json\\" d \' \' Step 3: Start convengine demo From convengine demo root: bash ./mvnw spring boot:run Step 4: Seed MCP tools and planner prompts (SQL panel) Run convengine demo/src/main/resources/sql/seed.sql . That seed includes the live MCP tools and ORDER_DIAGNOSTICS response/rule wiring (ANALYZE COMPLETED via POST_AGENT_MCP when context.mcp.finalAnswer exists): sql INSERT INTO ce_mcp_tool (tool_id, tool_code, tool_group, intent_code, state_code, enabled, description) VALUES (3, \'mock.order.submit\', \'HTTP_API\', \'ORDER_DIAGNOSTICS\', \'ANALYZE\', true, \'Submit order through mockey live API\'), (4, \'mock.order.status\', \'HTTP_API\', \'ORDER_DIAGNOSTICS\', \'ANALYZE\', true, \'Fetch order status from mockey live API\'), (5, \'mock.order.async.trace\', \'HTTP_API\', \'ORDER_DIAGNOSTICS\', \'ANALYZE\', true, \'Fetch async callback trace from mockey live API\'), (6, \'mock.customer.profile\', \'HTTP_API\', \'ORDER_DIAGNOSTICS\', \'ANALYZE\', true, \'Fetch customer profile from mockey live API\'); Then seed planner prompts (framework seed) if your environment uses scoped MCP planner rows: Postgres: convengine/src/main/resources/sql/mcp_planner_seed.sql (or mcp_planner_seed_postgres.sql ) SQLite: convengine/src/main/resources/sql/mcp_planner_seed_sqlite.sql Step 5: Run as chat style walkthrough mock.order.async.trace\\" json= }\\" }, }\\" } ] } }} tables= info= / COMPLETED when context.mcp.finalAnswer exists.\\", \\"ResponseResolutionStep uses context + derivation_hint.\\"]} / json \\", \\"inputParams\\": } Direct deterministic tool payload (optional): json \\", \\"inputParams\\": } } } Step 6: Validate advanced HTTP behavior HttpApiRequestingToolHandler calls are executed by framework HttpApiToolInvoker . Observation payload will include: status attempt latencyMs mapped Expected shape: json } Step 7: Verify MCP audit stages Check audit timeline in audit APIs for: TOOL_ORCHESTRATION_REQUEST TOOL_ORCHESTRATION_RESULT MCP_TOOL_CALL MCP_TOOL_RESULT MCP Output to Final Response (Deep Dive) This is the exact handoff path from MCP tools to response text/json in the same request turn: 1. McpToolStep clears stale context.mcp. at start of turn. 2. Planner ( McpPlanner ) receives user_input , context , mcp_tools , and current mcp_observations . 3. Each CALL_TOOL result is appended into context.mcp.observations[] as . 4. When planner returns ANSWER , step writes: context.mcp.finalAnswer input param mcp_final_answer 5. RulesStep runs POST_AGENT_MCP phase; when context.mcp.finalAnswer exists, rule transitions ANALYZE COMPLETED. 6. ResponseResolutionStep selects ce_response for current intent/state. 7. If selected response is DERIVED , resolver selects matching ce_prompt_template and invokes LLM with: rendered prompt derivation_hint from ce_response session.contextDict() as context (includes the MCP block) 8. Final assistant output is audited ( ASSISTANT_OUTPUT ) and persisted. Even if your template does not explicitly reference mcp_final_answer , it still receives full context JSON. If context.mcp.observations and context.mcp.finalAnswer exist, response derivation can use them. Turn by Turn E2E (Tab View) Example 1: Explicit prompt wiring (recommended) Keep it simple: direct tool_request path uses inputParams.tool_result planner path uses context.mcp.observations and context.mcp.finalAnswer Use these SQL updates so prompt behavior is explicit: sql Direct tool_request path (ToolOrchestrationStep output) UPDATE ce_prompt_template SET user_prompt = \'User input: }\\\\nTool result: }\\\\nContext: }\\\\nSummarize status and next action.\' WHERE intent_code = \'FAQ\' AND state_code = \'IDLE\' AND response_type = \'JSON\'; Planner path (McpToolStep output) UPDATE ce_prompt_template SET user_prompt = \'Context JSON:\\\\n }\\\\n\\\\nRead context.mcp.observations and context.mcp.finalAnswer. Produce a concise diagnostic summary.\' WHERE intent_code = \'ORDER_DIAGNOSTICS\' AND state_code = \'COMPLETED\' AND response_type = \'TEXT\'; ORDER_DIAGNOSTICS is now included in demo seed with POST_AGENT_MCP completion and DERIVED final response from context.mcp.finalAnswer. ReactFlow View Optional planner driven test After deterministic tool_request tests pass, ask natural prompts without tool_request , for example: Order ORD 7017 was submitted by admin but async callback is null. Check status and trace. Planner should choose one or more mock. tools based on descriptions and context. Troubleshooting No HttpApiToolHandler... : ensure convengine demo depends on ConvEngine 2.0.7 ensure handler toolCode() matches DB ce_mcp_tool.tool_code API not called: confirm running on 31333 confirm convengine.demo.mockey.base url tool not found: re run seed.sql verify ce_mcp_tool.enabled=true Related pages","rawContent":"{ id: \\"u1\\", data: { label: \\"User Input\\" } }, { id: \\"i1\\", data: { label: \\"Intent + State Resolution\\" } }, { id: \\"m1\\", data: { label: \\"McpToolStep: plan #1\\" } }, { id: \\"t1\\", data: { label: \\"Tool call: mock.order.status\\" } }, { id: \\"m2\\", data: { label: \\"McpToolStep: plan #2\\" } }, { id: \\"t2\\", data: { label: \\"Tool call: mock.order.async.trace\\" } }, { id: \\"m3\\", data: { label: \\"McpToolStep: ANSWER\\" } }, { id: \\"r2\\", data: { label: \\"Rule: ANALYZE -> COMPLETED (POST_AGENT_MCP)\\" } }, { id: \\"r1\\", data: { label: \\"ResponseResolutionStep\\" } }, { id: \\"out\\", data: { label: \\"Assistant Output\\" } }, ]; { id: \\"e1\\", source: \\"u1\\", target: \\"i1\\" }, { id: \\"e2\\", source: \\"i1\\", target: \\"m1\\" }, { id: \\"e3\\", source: \\"m1\\", target: \\"t1\\" }, { id: \\"e4\\", source: \\"t1\\", target: \\"m2\\" }, { id: \\"e5\\", source: \\"m2\\", target: \\"t2\\" }, { id: \\"e6\\", source: \\"t2\\", target: \\"m3\\" }, { id: \\"e7\\", source: \\"m3\\", target: \\"r2\\" }, { id: \\"e8\\", source: \\"r2\\", target: \\"r1\\" }, { id: \\"e9\\", source: \\"r1\\", target: \\"out\\" }, ]; u1: { title: \\"User Input\\", stage: \\"REQUEST\\", summary: \\"User asks order status/callback question.\\", session: [\\"userText captured\\"], tables: [\\"ce_audit (W)\\"] }, i1: { title: \\"Intent + State Resolution\\", stage: \\"INTENT\\", summary: \\"Classifier and rules set runtime intent/state for tool eligibility.\\", session: [\\"intent/state resolved\\"], tables: [\\"ce_intent (R)\\", \\"ce_intent_classifier (R)\\", \\"ce_rule (R)\\", \\"ce_audit (W)\\"] }, m1: { title: \\"McpToolStep plan #1\\", stage: \\"MCP_PLAN_LLM_OUTPUT\\", summary: \\"Planner selects first tool based on prompt and available tools.\\", session: [\\"mcp_action=CALL_TOOL\\", \\"mcp_tool_code=mock.order.status\\"], tables: [\\"ce_mcp_tool (R)\\", \\"ce_mcp_planner (R)\\", \\"ce_audit (W)\\"] }, t1: { title: \\"Tool call: mock.order.status\\", stage: \\"MCP_TOOL_RESULT\\", summary: \\"HTTP tool executes via HttpApiToolInvoker and returns mapped payload.\\", session: [\\"mcp.observations[0] written\\"], tables: [\\"ce_audit (W)\\"] }, m2: { title: \\"McpToolStep plan #2\\", stage: \\"MCP_PLAN_LLM_OUTPUT\\", summary: \\"Planner sees first observation and requests async trace tool.\\", session: [\\"mcp_tool_code=mock.order.async.trace\\"], tables: [\\"ce_mcp_tool (R)\\", \\"ce_mcp_planner (R)\\", \\"ce_audit (W)\\"] }, t2: { title: \\"Tool call: mock.order.async.trace\\", stage: \\"MCP_TOOL_RESULT\\", summary: \\"Second observation appended to context.mcp.observations.\\", session: [\\"mcp.observations[1] written\\"], tables: [\\"ce_audit (W)\\"] }, m3: { title: \\"McpToolStep ANSWER\\", stage: \\"MCP_FINAL_ANSWER\\", summary: \\"Planner returns final answer and it is stored in context.mcp.finalAnswer.\\", session: [\\"mcp_final_answer set\\", \\"mcp_status=ANSWER\\"], tables: [\\"ce_audit (W)\\"] }, r2: { title: \\"Post-MCP transition\\", stage: \\"POST_AGENT_MCP\\", summary: \\"If context.mcp.finalAnswer exists, rule moves ORDER_DIAGNOSTICS from ANALYZE to COMPLETED.\\", session: [\\"state=COMPLETED\\"], tables: [\\"ce_rule (R)\\", \\"ce_audit (W)\\"] }, r1: { title: \\"ResponseResolutionStep\\", stage: \\"RESOLVE_RESPONSE\\", summary: \\"Resolves ce_response + ce_prompt_template for ORDER_DIAGNOSTICS+COMPLETED using MCP-enriched context.\\", session: [\\"payload generated\\"], tables: [\\"ce_response (R)\\", \\"ce_prompt_template (R)\\", \\"ce_audit (W)\\"] }, out: { title: \\"Assistant Output\\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Resolved output is returned and persisted.\\", session: [\\"finalResult returned\\"], tables: [\\"ce_conversation (W)\\", \\"ce_conversation_history (W async)\\", \\"ce_audit (W)\\"] } }; # MCP Example 1 (ConvEngine Demo + Mockey) This guide shows a complete local test of ConvEngine 2.0.7 advanced MCP HTTP tools using convengine-demo and [mockey](https://github.com/salilvnair/mockey). It covers: 1. starting mock APIs in [mockey](https://github.com/salilvnair/mockey) 2. wiring demo MCP tools to [mockey](https://github.com/salilvnair/mockey) endpoints 3. seeding ce_mcp_tool and planner prompts 4. testing via SQL panel + chat requests ## Prerequisites - [mockey](https://github.com/salilvnair/mockey) repo available locally - convengine-demo repo available locally - Postgres running for convengine-demo - ConvEngine dependency 2.0.7 ## What is already wired in demo convengine-demo now includes four HttpApiRequestingToolHandler mappings: - mock.order.submit -> POST /api/mock/order/submit - mock.order.status -> GET /api/mock/order/status - mock.order.async.trace -> GET /api/mock/order/async/trace - mock.customer.profile -> GET /api/mock/customer/profile Base URL is configured by: yaml convengine: demo: mockey: base-url: http://localhost:31333 api-key: demo-live-key ## Step 1: Start [mockey](https://github.com/salilvnair/mockey) From [mockey](https://github.com/salilvnair/mockey) root: bash npm install npm start Expected log: text listening to 31333 ## Step 2: Quick endpoint smoke tests bash curl -s \\"http://localhost:31333/api/mock/order/status?orderId=ORD-7017\\" curl -s \\"http://localhost:31333/api/mock/order/async/trace?orderId=ORD-7017\\" curl -s \\"http://localhost:31333/api/mock/customer/profile?customerId=CUST-1001\\" curl -s -X POST \\"http://localhost:31333/api/mock/order/submit\\" -H \\"Content-Type: application/json\\" -d \'{\\"orderId\\":\\"ORD-7017\\",\\"customerId\\":\\"CUST-1001\\",\\"submittedByRole\\":\\"ADMIN\\"}\' ## Step 3: Start convengine-demo From convengine-demo root: bash ./mvnw spring-boot:run ## Step 4: Seed MCP tools and planner prompts (SQL panel) Run convengine-demo/src/main/resources/sql/seed.sql . That seed includes the live MCP tools and ORDER_DIAGNOSTICS response/rule wiring (ANALYZE -> COMPLETED via POST_AGENT_MCP when context.mcp.finalAnswer exists): sql INSERT INTO ce_mcp_tool (tool_id, tool_code, tool_group, intent_code, state_code, enabled, description) VALUES (3, \'mock.order.submit\', \'HTTP_API\', \'ORDER_DIAGNOSTICS\', \'ANALYZE\', true, \'Submit order through mockey live API\'), (4, \'mock.order.status\', \'HTTP_API\', \'ORDER_DIAGNOSTICS\', \'ANALYZE\', true, \'Fetch order status from mockey live API\'), (5, \'mock.order.async.trace\', \'HTTP_API\', \'ORDER_DIAGNOSTICS\', \'ANALYZE\', true, \'Fetch async callback trace from mockey live API\'), (6, \'mock.customer.profile\', \'HTTP_API\', \'ORDER_DIAGNOSTICS\', \'ANALYZE\', true, \'Fetch customer profile from mockey live API\'); Then seed planner prompts (framework seed) if your environment uses scoped MCP planner rows: - Postgres: convengine/src/main/resources/sql/mcp_planner_seed.sql (or mcp_planner_seed_postgres.sql ) - SQLite: convengine/src/main/resources/sql/mcp_planner_seed_sqlite.sql ## Step 5: Run as chat-style walkthrough <Tabs groupId=\\"example1-chat-flow\\"> <TabItem value=\\"chat\\" label=\\"Conversation\\" default> <ChatContainer> <TraceChatBubble role=\\"user\\" name=\\"Turn 1 - User\\" message=\\"Order ORD-7017 was submitted by admin, callback is still null. Can you check status and trace?\\" info={[\\"Intent resolves to diagnostics scope.\\", \\"Planner mode starts.\\"]} /> <TraceChatBubble role=\\"assistant\\" name=\\"Turn 1 - Assistant (internal MCP)\\" message=\\"Calling tools: mock.order.status -> mock.order.async.trace\\" json={{ mcp: { observations: [ { toolCode: \\"mock.order.status\\", json: \\"{\\\\\\"mapped\\\\\\":{\\\\\\"orderId\\\\\\":\\\\\\"ORD-7017\\\\\\",\\\\\\"status\\\\\\":\\\\\\"SUBMITTED\\\\\\"}}\\" }, { toolCode: \\"mock.order.async.trace\\", json: \\"{\\\\\\"mapped\\\\\\":{\\\\\\"orderId\\\\\\":\\\\\\"ORD-7017\\\\\\",\\\\\\"callbackAt\\\\\\":null}}\\" } ] } }} tables={[\\"ce_mcp_tool (R)\\", \\"ce_mcp_planner (R)\\", \\"ce_audit (W)\\"]} info={[\\"MCP loop runs until planner returns ANSWER.\\", \\"Observations are written in context.mcp.observations.\\"]} /> <TraceChatBubble role=\\"assistant\\" name=\\"Turn 1 - Final Assistant Output\\" message=\\"Order ORD-7017 is submitted. Async callback is pending/missing, so no callback timestamp is available yet.\\" json={{ mcp: { finalAnswer: \\"Order submitted, callback pending.\\" } }} tables={[\\"ce_rule (R)\\", \\"ce_response (R)\\", \\"ce_prompt_template (R)\\", \\"ce_conversation (W)\\"]} info={[\\"POST_AGENT_MCP moves ANALYZE -> COMPLETED when context.mcp.finalAnswer exists.\\", \\"ResponseResolutionStep uses context + derivation_hint.\\"]} /> </ChatContainer> </TabItem> <TabItem value=\\"turn-table\\" label=\\"Turn Table\\"> <DbTable title=\\"Turn-by-turn summary\\" columns={[\\"Turn/Phase\\", \\"What happens\\", \\"Tables touched\\", \\"Output\\"]} rows={[ [\\"Turn 1 / Planner loop\\", \\"Planner selects status then async-trace tool.\\", \\"ce_mcp_tool(R), ce_mcp_planner(R), ce_audit(W)\\", \\"context.mcp.observations[]\\"], [\\"Turn 1 / Planner answer\\", \\"Planner writes final MCP answer.\\", \\"ce_audit(W)\\", \\"context.mcp.finalAnswer\\"], [\\"Turn 1 / Post-MCP rule\\", \\"POST_AGENT_MCP checks context.mcp.finalAnswer and moves state to COMPLETED.\\", \\"ce_rule(R), ce_audit(W)\\", \\"state=COMPLETED\\"], [\\"Turn 1 / Response resolution\\", \\"DERIVED response rendered from context for COMPLETED state.\\", \\"ce_response(R), ce_prompt_template(R), ce_audit(W)\\", \\"assistant text\\"], ]} /> </TabItem> <TabItem value=\\"api\\" label=\\"Request Payloads\\"> json { \\"userInput\\": \\"Order ORD-7017 was submitted by admin, callback is still null. Can you check status and trace?\\", \\"contextJson\\": \\"{}\\", \\"inputParams\\": {} } Direct deterministic tool payload (optional): json { \\"userInput\\": \\"Check order status\\", \\"contextJson\\": \\"{}\\", \\"inputParams\\": { \\"tool_request\\": { \\"tool_code\\": \\"mock.order.status\\", \\"tool_group\\": \\"HTTP_API\\", \\"args\\": { \\"orderId\\": \\"ORD-7017\\" } } } } </TabItem> </Tabs> ## Step 6: Validate advanced HTTP behavior HttpApiRequestingToolHandler calls are executed by framework HttpApiToolInvoker . Observation payload will include: - status - attempt - latencyMs - mapped Expected shape: json { \\"status\\": 200, \\"attempt\\": 1, \\"latencyMs\\": 40, \\"mapped\\": { \\"orderId\\": \\"ORD-7017\\", \\"status\\": \\"SUBMITTED\\", \\"api4AsyncStatus\\": null } } ## Step 7: Verify MCP audit stages Check audit timeline in audit APIs for: - TOOL_ORCHESTRATION_REQUEST - TOOL_ORCHESTRATION_RESULT - MCP_TOOL_CALL - MCP_TOOL_RESULT ## MCP Output to Final Response (Deep Dive) This is the exact handoff path from MCP tools to response text/json in the same request turn: 1. McpToolStep clears stale context.mcp.* at start of turn. 2. Planner ( McpPlanner ) receives user_input , context , mcp_tools , and current mcp_observations . 3. Each CALL_TOOL result is appended into context.mcp.observations[] as {toolCode, json} . 4. When planner returns ANSWER , step writes: - context.mcp.finalAnswer - input param mcp_final_answer 5. RulesStep runs POST_AGENT_MCP phase; when context.mcp.finalAnswer exists, rule transitions ANALYZE -> COMPLETED. 6. ResponseResolutionStep selects ce_response for current intent/state. 7. If selected response is DERIVED , resolver selects matching ce_prompt_template and invokes LLM with: - rendered prompt - derivation_hint from ce_response - session.contextDict() as context (includes the MCP block) 8. Final assistant output is audited ( ASSISTANT_OUTPUT ) and persisted. <Highlight type=\\"tip\\" title=\\"Why this works\\"> Even if your template does not explicitly reference mcp_final_answer , it still receives full context JSON. If context.mcp.observations and context.mcp.finalAnswer exist, response derivation can use them. </Highlight> ## Turn-by-Turn E2E (Tab View) <Tabs groupId=\\"mcp-live-e2e\\"> <TabItem value=\\"planner-path\\" label=\\"Planner Path\\" default> <DbTable title=\\"Natural language planner path (single request turn)\\" columns={[\\"Loop/Step\\", \\"What LLM deduces\\", \\"Tables touched\\", \\"Artifact produced\\"]} rows={[ [\\"Intent+state phase\\", \\"Question is an order diagnostics request in tool-eligible scope.\\", \\"ce_intent(R), ce_intent_classifier(R), ce_rule(R), ce_audit(W)\\", \\"resolved intent/state\\"], [\\"MCP loop #1\\", \\"Need order status first.\\", \\"ce_mcp_tool(R), ce_mcp_planner(R), ce_audit(W)\\", \\"CALL_TOOL mock.order.status\\"], [\\"Tool exec #1\\", \\"HTTP mapped status payload available.\\", \\"ce_audit(W)\\", \\"context.mcp.observations[0]\\"], [\\"MCP loop #2\\", \\"Need callback trace to confirm async issue.\\", \\"ce_mcp_tool(R), ce_mcp_planner(R), ce_audit(W)\\", \\"CALL_TOOL mock.order.async.trace\\"], [\\"Tool exec #2\\", \\"Trace confirms callback missing/pending.\\", \\"ce_audit(W)\\", \\"context.mcp.observations[1]\\"], [\\"MCP loop #3\\", \\"Enough evidence; produce conclusion.\\", \\"ce_mcp_planner(R), ce_audit(W)\\", \\"context.mcp.finalAnswer + mcp_final_answer\\"], [\\"Post-MCP rule\\", \\"When context.mcp.finalAnswer exists, move ANALYZE to COMPLETED.\\", \\"ce_rule(R), ce_audit(W)\\", \\"state=COMPLETED\\"], [\\"Response resolution\\", \\"Render user-facing answer with MCP evidence.\\", \\"ce_response(R), ce_prompt_template(R), ce_audit(W)\\", \\"final payload\\"] ]} /> </TabItem> <TabItem value=\\"direct-tool\\" label=\\"Direct tool_request\\"> <DbTable title=\\"Deterministic direct tool path\\" columns={[\\"Step\\", \\"What happens\\", \\"Tables touched\\", \\"Output source\\"]} rows={[ [\\"ToolOrchestrationStep\\", \\"Executes exactly the requested tool without planner loop.\\", \\"ce_mcp_tool(R), ce_audit(W)\\", \\"inputParams.tool_request\\"], [\\"HTTP execution\\", \\"Handler + HttpApiToolInvoker returns mapped response.\\", \\"ce_audit(W)\\", \\"tool_result\\"], [\\"Response resolution\\", \\"Depending on response mapping, output may be EXACT or DERIVED.\\", \\"ce_response(R), ce_prompt_template(R), ce_audit(W)\\", \\"tool_result + context\\"], ]} /> </TabItem> <TabItem value=\\"response-internals\\" label=\\"Response Internals\\"> <DbTable title=\\"How response derivation consumes MCP data\\" columns={[\\"Resolver input\\", \\"Source\\", \\"Example\\"]} rows={[ [\\"context\\", \\"session.contextJson (includes mcp.observations and mcp.finalAnswer)\\", \\"{\\\\\\"mcp\\\\\\":{\\\\\\"observations\\\\\\":[...],\\\\\\"finalAnswer\\\\\\":\\\\\\"...\\\\\\"}}\\"], [\\"user_input\\", \\"current request text\\", \\"Order ORD-7017 was submitted by admin...\\"], [\\"derivation_hint\\", \\"ce_response.derivation_hint\\", \\"Use MCP observations to explain status and callback condition.\\"], [\\"prompt template\\", \\"ce_prompt_template by intent/state/output format\\", \\"TEXT template for ORDER_DIAGNOSTICS + COMPLETED\\"], [\\"LLM output\\", \\"TextOutputFormatResolver / JsonOutputFormatResolver\\", \\"final assistant payload\\"], ]} /> </TabItem> </Tabs> ## Example 1: Explicit prompt wiring (recommended) Keep it simple: - direct tool_request path uses inputParams.tool_result - planner path uses context.mcp.observations and context.mcp.finalAnswer Use these SQL updates so prompt behavior is explicit: sql -- Direct tool_request path (ToolOrchestrationStep output) UPDATE ce_prompt_template SET user_prompt = \'User input: {{user_input}}\\\\nTool result: {{tool_result}}\\\\nContext: {{context}}\\\\nSummarize status and next action.\' WHERE intent_code = \'FAQ\' AND state_code = \'IDLE\' AND response_type = \'JSON\'; -- Planner path (McpToolStep output) UPDATE ce_prompt_template SET user_prompt = \'Context JSON:\\\\n{{context}}\\\\n\\\\nRead context.mcp.observations and context.mcp.finalAnswer. Produce a concise diagnostic summary.\' WHERE intent_code = \'ORDER_DIAGNOSTICS\' AND state_code = \'COMPLETED\' AND response_type = \'TEXT\'; ORDER_DIAGNOSTICS is now included in demo seed with POST_AGENT_MCP completion and DERIVED final response from context.mcp.finalAnswer. ## ReactFlow View <EngineDebugFlow title=\\"MCP Live Request Execution\\" subtitle=\\"Planner loop, tool observations, and response resolution handoff.\\" nodes={liveExampleNodes} edges={liveExampleEdges} detailsById={liveExampleDetails} defaultSelectedId=\\"m1\\" /> ## Optional planner-driven test After deterministic tool_request tests pass, ask natural prompts without tool_request , for example: - Order ORD-7017 was submitted by admin but async callback is null. Check status and trace. Planner should choose one or more mock.* tools based on descriptions and context. ## Troubleshooting - No HttpApiToolHandler... : - ensure convengine-demo depends on ConvEngine 2.0.7 - ensure handler toolCode() matches DB ce_mcp_tool.tool_code - API not called: - confirm [mockey](https://github.com/salilvnair/mockey) running on 31333 - confirm convengine.demo.mockey.base-url - tool not found: - re-run seed.sql - verify ce_mcp_tool.enabled=true ## Related pages - [MCP Basics](/docs/v2/consumer/mcp/basics) - [MCP Advanced Guide](/docs/v2/consumer/mcp/advanced) - [MCP Example 2 - Loan Application](/docs/v2/consumer/mcp/example2) - [Caching & Persistence](/docs/v2/consumer/caching-and-persistence)","excerpt":"}, }, }, }, }, }, }, }, }, }, ]; , , , , , , , , , ]; u1: , i1: , m1: , t1: , m2: , t2: , m3: , r2: , r1: , out: }; MCP Example 1 (ConvEngine Demo + Mockey) This guide shows a complete local test of ConvEngine 2.0.7 adva\u2026"},{"id":"consumer/mcp/example2.mdx","version":"v2","title":"example2","permalink":"/docs/v2/consumer/mcp/example2","content":"}, }, }, }, }, }, }, }, }, }, }, }, }, }, }, ]; , , , , , , , , , , , , , , ]; u1: , s1: , r1: , r2: , m1: , t1: , m2: , t2: , m3: , t3: , m4: , t4: , m5: , resp: , out: }; MCP Example 2 Loan Application (Conditional API Chain) This example demonstrates a real world conditional MCP chain: 1. call Credit Union Rating API 2. if creditRating 750 , call Credit Card Fraud API 3. if not flagged, call Debt/Credit Summary API 4. if debt profile is acceptable, call Loan Submit API All APIs are mocked through with response delays to simulate real external systems. Repos and files used Mock APIs ( ) GET /api/mock/loan/credit union/rating GET /api/mock/loan/credit card/fraud check GET /api/mock/loan/debt credit/summary POST /api/mock/loan/application/submit Key files: mockey/src/resolver/provider/live api.resolver.js mockey/src/resolver/core/resolver.registry.js mockey/src/route/mockey route.json mockey/src/response/loan/ .json (includes delay via responseDelayInMillis ) Demo MCP handlers ( convengine demo ) loan.credit.rating.check loan.credit.fraud.check loan.debt.credit.summary loan.application.submit Handler files: convengine demo/.../LoanCreditRatingToolHandler.java convengine demo/.../LoanFraudCheckToolHandler.java convengine demo/.../LoanDebtSummaryToolHandler.java convengine demo/.../LoanApplicationSubmitToolHandler.java Seed packs Postgres: convengine demo/src/main/resources/sql/example2_seed.sql SQLite: convengine demo/src/main/resources/sql/example2_sqlite_seed.sql These seed files include all required DML: ce_intent ce_intent_classifier ce_output_schema ce_prompt_template ce_response ce_rule ce_mcp_tool (with intent_code + state_code ) ce_mcp_planner scoped prompt rows (default + LOAN_APPLICATION/ELIGIBILITY_GATE) Required rule/response rows for this flow Use these key rows so classifier + MCP + response resolution line up correctly: sql 1) Bootstrap state after classifier picks LOAN_APPLICATION INSERT INTO ce_rule (intent_code, state_code, rule_type, match_pattern, action, action_value, phase, priority, enabled, description) VALUES (\'LOAN_APPLICATION\', \'UNKNOWN\', \'REGEX\', \'. \', \'SET_STATE\', \'ELIGIBILITY_GATE\', \'POST_AGENT_INTENT\', 20, true, \'Move LOAN_APPLICATION from UNKNOWN into ELIGIBILITY_GATE.\'); 2) After MCP planner returns ANSWER, close state for final response mapping INSERT INTO ce_rule (intent_code, state_code, rule_type, match_pattern, action, action_value, phase, priority, enabled, description) VALUES (\'LOAN_APPLICATION\', \'ELIGIBILITY_GATE\', \'JSON_PATH\', \'$[?(@.context.mcp.finalAnswer != null && @.context.mcp.finalAnswer != \'\'\'\')]\', \'SET_STATE\', \'COMPLETED\', \'POST_AGENT_MCP\', 30, true, \'Move loan flow to COMPLETED only when context.mcp.finalAnswer exists.\'); 3) Final response row should target COMPLETED and derive from MCP context INSERT INTO ce_response (intent_code, state_code, output_format, response_type, derivation_hint, priority, enabled, description) VALUES (\'LOAN_APPLICATION\', \'COMPLETED\', \'TEXT\', \'DERIVED\', \'Use context.mcp.finalAnswer as primary summary. Validate with context.mcp.observations (rating/fraud/debt/submit). Do not invent values.\', 20, true, \'Loan decision derived from MCP outputs.\'); 4) Prompt template should explicitly read context.mcp. INSERT INTO ce_prompt_template (intent_code, state_code, response_type, system_prompt, user_prompt, enabled) VALUES (\'LOAN_APPLICATION\', \'COMPLETED\', \'TEXT\', \'You are a precise loan workflow summarizer. Use only MCP evidence from context JSON.\', \'Context JSON:\\\\n }\\\\n\\\\nRead context.mcp.observations and context.mcp.finalAnswer. Return a concise final loan decision.\', true); Step by step test 1) Start bash cd /Users/salilvnair/workspace/git/salilvnair/mockey npm install npm start Expected: text listening to 31333 2) Optional quick mock checks bash curl s \\"http://localhost:31333/api/mock/loan/credit union/rating?customerId=CUST 1001\\" curl s \\"http://localhost:31333/api/mock/loan/credit card/fraud check?customerId=CUST 1001\\" curl s \\"http://localhost:31333/api/mock/loan/debt credit/summary?customerId=CUST 1001\\" curl s X POST \\"http://localhost:31333/api/mock/loan/application/submit\\" H \\"Content Type: application/json\\" d \' \' 3) Start convengine demo bash cd /Users/salilvnair/workspace/git/salilvnair/convengine demo ./mvnw spring boot:run 4) Seed Example 2 DML For Postgres run: convengine demo/src/main/resources/sql/example2_seed.sql For SQLite run: convengine demo/src/main/resources/sql/example2_sqlite_seed.sql 5) Run as chat style walkthrough fraud debt summary submit.\\" json= }\\" }, }\\" }, }\\" }, }\\" } ] } }} tables= info= / Planner mode payload: json \\", \\"inputParams\\": } Direct branch payload (low rating): json \\", \\"inputParams\\": } } } Direct branch payload (fraud): json \\", \\"inputParams\\": } } } 6) Verify audit stages Look for: MCP_PLAN_LLM_INPUT MCP_PLAN_LLM_OUTPUT MCP_TOOL_CALL MCP_TOOL_RESULT MCP_FINAL_ANSWER Also for direct tool requests: TOOL_ORCHESTRATION_REQUEST TOOL_ORCHESTRATION_RESULT 7) Verify advanced HTTP execution metadata Mapped output includes framework execution details: json } The latency reflects mock delays ( responseDelayInMillis ) configured in responses. How MCP Tool Output Is Used in Response Resolution (Step by Step) For this example, the final assistant text is not hardcoded. It is derived from MCP evidence in runtime context: 1. McpToolStep starts and clears stale context.mcp.finalAnswer and context.mcp.observations . 2. Every successful tool call appends one entry into context.mcp.observations : toolCode json (stringified mapped payload) 3. When planner returns ANSWER , McpToolStep writes: context.mcp.finalAnswer input param mcp_final_answer 4. RulesStep runs POST_AGENT_MCP phase and matches rule only when context.mcp.finalAnswer is present, then sets state to COMPLETED . 5. ResponseResolutionStep selects ce_response for: intent_code=LOAN_APPLICATION state_code=COMPLETED response type DERIVED , output format TEXT 6. It then selects matching ce_prompt_template ( TEXT ) for the same intent/state. 7. TextOutputFormatResolver invokes LLM with: rendered system/user prompt ce_response.derivation_hint context payload ( session.contextDict() ), which includes MCP observations/finalAnswer 8. LLM produces final summary text. Engine audits RESOLVE_RESPONSE_LLM_OUTPUT and ASSISTANT_OUTPUT , then persists conversation. In this setup, the response LLM is grounded by two things together: derivation_hint policy from ce_response and MCP evidence from context.mcp. . That is why the final answer reflects rating/fraud/debt/applicationId consistently. The provided Example 2 seed now makes this explicit in SQL as well: ce_prompt_template.user_prompt explicitly instructs reading context.mcp.observations and context.mcp.finalAnswer ce_response.derivation_hint explicitly references context.mcp. E2E Turn by Turn (Tab View) 750.\\", \\"ce_audit(W)\\", \\"obs[0]=creditRating\\"], [\\"MCP 2\\", \\"Proceed to fraud check.\\", \\"ce_mcp_planner(R), ce_audit(W)\\", \\"CALL_TOOL fraud\\"], [\\"Tool 2\\", \\"Fraud clear.\\", \\"ce_audit(W)\\", \\"obs[1]=flagged:false\\"], [\\"MCP 3\\", \\"Need affordability metrics.\\", \\"ce_mcp_planner(R), ce_audit(W)\\", \\"CALL_TOOL debt summary\\"], [\\"Tool 3\\", \\"DTI acceptable and credit sufficient.\\", \\"ce_audit(W)\\", \\"obs[2]=dti/availableCredit\\"], [\\"MCP 4\\", \\"Submit application now.\\", \\"ce_mcp_planner(R), ce_audit(W)\\", \\"CALL_TOOL submit\\"], [\\"Tool 4\\", \\"Submission succeeded.\\", \\"ce_audit(W)\\", \\"obs[3]=applicationId/status\\"], [\\"MCP ANSWER\\", \\"Enough evidence for final decision.\\", \\"ce_audit(W)\\", \\"context.mcp.finalAnswer\\"], [\\"ResponseResolutionStep\\", \\"Generate final user facing summary.\\", \\"ce_response(R), ce_prompt_template(R), ce_audit(W)\\", \\"assistant text payload\\"] ]} / ReactFlow Execution Map Response Field Provenance Notes on state and scope ce_mcp_tool rows in example2 are scoped as: intent_code = LOAN_APPLICATION state_code = ELIGIBILITY_GATE This ensures tools are visible only in the loan decision state. Troubleshooting Tool not resolved: verify tool_code in DB matches handler toolCode() exactly No tool call in planner path: check McpPlanner prompt rows in ce_mcp_planner confirm active intent is LOAN_APPLICATION Timeouts/retries unexpected: inspect handler specific HttpApiExecutionPolicy inspect mock delay values in mockey/src/response/loan/ .json Related docs","rawContent":"{ id: \\"u1\\", data: { label: \\"User Input: apply loan\\" } }, { id: \\"s1\\", data: { label: \\"SchemaExtractionStep\\" } }, { id: \\"r1\\", data: { label: \\"Rule: UNKNOWN/IDLE -> ELIGIBILITY_GATE\\" } }, { id: \\"m1\\", data: { label: \\"MCP plan #1\\" } }, { id: \\"t1\\", data: { label: \\"loan.credit.rating.check\\" } }, { id: \\"m2\\", data: { label: \\"MCP plan #2\\" } }, { id: \\"t2\\", data: { label: \\"loan.credit.fraud.check\\" } }, { id: \\"m3\\", data: { label: \\"MCP plan #3\\" } }, { id: \\"t3\\", data: { label: \\"loan.debt.credit.summary\\" } }, { id: \\"m4\\", data: { label: \\"MCP plan #4\\" } }, { id: \\"t4\\", data: { label: \\"loan.application.submit\\" } }, { id: \\"m5\\", data: { label: \\"MCP ANSWER\\" } }, { id: \\"r2\\", data: { label: \\"Rule: ELIGIBILITY_GATE -> COMPLETED (POST_AGENT_MCP)\\" } }, { id: \\"resp\\", data: { label: \\"ResponseResolutionStep (DERIVED TEXT)\\" } }, { id: \\"out\\", data: { label: \\"Assistant Output\\" } }, ]; { id: \\"e1\\", source: \\"u1\\", target: \\"s1\\" }, { id: \\"e2\\", source: \\"s1\\", target: \\"r1\\" }, { id: \\"e3\\", source: \\"r1\\", target: \\"m1\\" }, { id: \\"e4\\", source: \\"m1\\", target: \\"t1\\" }, { id: \\"e5\\", source: \\"t1\\", target: \\"m2\\" }, { id: \\"e6\\", source: \\"m2\\", target: \\"t2\\" }, { id: \\"e7\\", source: \\"t2\\", target: \\"m3\\" }, { id: \\"e8\\", source: \\"m3\\", target: \\"t3\\" }, { id: \\"e9\\", source: \\"t3\\", target: \\"m4\\" }, { id: \\"e10\\", source: \\"m4\\", target: \\"t4\\" }, { id: \\"e11\\", source: \\"t4\\", target: \\"m5\\" }, { id: \\"e12\\", source: \\"m5\\", target: \\"r2\\" }, { id: \\"e13\\", source: \\"r2\\", target: \\"resp\\" }, { id: \\"e14\\", source: \\"resp\\", target: \\"out\\" }, ]; u1: { title: \\"User Input\\", stage: \\"REQUEST\\", summary: \\"User asks to apply for loan with customer and amount details.\\", session: [\\"userText set\\", \\"inputParams initialized\\"], tables: [\\"ce_audit (W)\\"] }, s1: { title: \\"SchemaExtractionStep\\", stage: \\"SCHEMA\\", summary: \\"Extracts customerId, requestedAmount, tenureMonths from user text.\\", session: [\\"context updated with extracted schema fields\\"], tables: [\\"ce_output_schema (R)\\", \\"ce_prompt_template (R)\\", \\"ce_audit (W)\\"] }, r1: { title: \\"Rule transition\\", stage: \\"POST_AGENT_INTENT\\", summary: \\"Rule moves LOAN_APPLICATION from UNKNOWN or IDLE into ELIGIBILITY_GATE.\\", session: [\\"state=ELIGIBILITY_GATE -> COMPLETED\\"], tables: [\\"ce_rule (R)\\", \\"ce_audit (W)\\"] }, r2: { title: \\"Post-MCP transition\\", stage: \\"POST_AGENT_MCP\\", summary: \\"After planner ANSWER, POST_AGENT_MCP rule checks context.mcp.finalAnswer and moves state from ELIGIBILITY_GATE to COMPLETED.\\", session: [\\"state=COMPLETED\\"], tables: [\\"ce_rule (R)\\", \\"ce_audit (W)\\"] }, m1: { title: \\"MCP plan #1\\", stage: \\"MCP_PLAN_LLM_OUTPUT\\", summary: \\"Planner decides first check must be credit rating.\\", session: [\\"CALL_TOOL loan.credit.rating.check\\"], tables: [\\"ce_mcp_tool (R)\\", \\"ce_mcp_planner (R)\\", \\"ce_audit (W)\\"] }, t1: { title: \\"loan.credit.rating.check\\", stage: \\"MCP_TOOL_RESULT\\", summary: \\"Mapped rating response appended to context.mcp.observations.\\", session: [\\"observation[0]=rating\\"], tables: [\\"ce_audit (W)\\"] }, m2: { title: \\"MCP plan #2\\", stage: \\"MCP_PLAN_LLM_OUTPUT\\", summary: \\"If rating > 750 planner proceeds to fraud check.\\", session: [\\"CALL_TOOL loan.credit.fraud.check\\"], tables: [\\"ce_mcp_planner (R)\\", \\"ce_audit (W)\\"] }, t2: { title: \\"loan.credit.fraud.check\\", stage: \\"MCP_TOOL_RESULT\\", summary: \\"Fraud result stored as second observation.\\", session: [\\"observation[1]=fraud\\"], tables: [\\"ce_audit (W)\\"] }, m3: { title: \\"MCP plan #3\\", stage: \\"MCP_PLAN_LLM_OUTPUT\\", summary: \\"If fraud false planner asks debt/credit summary.\\", session: [\\"CALL_TOOL loan.debt.credit.summary\\"], tables: [\\"ce_mcp_planner (R)\\", \\"ce_audit (W)\\"] }, t3: { title: \\"loan.debt.credit.summary\\", stage: \\"MCP_TOOL_RESULT\\", summary: \\"Debt metrics (dti, availableCredit) added to observations.\\", session: [\\"observation[2]=debt\\"], tables: [\\"ce_audit (W)\\"] }, m4: { title: \\"MCP plan #4\\", stage: \\"MCP_PLAN_LLM_OUTPUT\\", summary: \\"If affordability passes, planner triggers submit API.\\", session: [\\"CALL_TOOL loan.application.submit\\"], tables: [\\"ce_mcp_planner (R)\\", \\"ce_audit (W)\\"] }, t4: { title: \\"loan.application.submit\\", stage: \\"MCP_TOOL_RESULT\\", summary: \\"Submission response includes applicationId and status.\\", session: [\\"observation[3]=submit result\\"], tables: [\\"ce_audit (W)\\"] }, m5: { title: \\"MCP ANSWER\\", stage: \\"MCP_FINAL_ANSWER\\", summary: \\"Planner synthesizes final decision and stores context.mcp.finalAnswer.\\", session: [\\"mcp_final_answer set\\", \\"mcp_status=ANSWER\\"], tables: [\\"ce_audit (W)\\"] }, resp: { title: \\"ResponseResolutionStep\\", stage: \\"RESOLVE_RESPONSE\\", summary: \\"Selects LOAN_APPLICATION+COMPLETED DERIVED response and renders final text from MCP-enriched context.\\", session: [\\"payload generated via TextOutputFormatResolver\\"], tables: [\\"ce_response (R)\\", \\"ce_prompt_template (R)\\", \\"ce_audit (W)\\"] }, out: { title: \\"Assistant Output\\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Final decision text returned and persisted.\\", session: [\\"final payload returned\\"], tables: [\\"ce_conversation (W)\\", \\"ce_conversation_history (W async)\\", \\"ce_audit (W)\\"] } }; # MCP Example 2 - Loan Application (Conditional API Chain) This example demonstrates a real-world conditional MCP chain: 1. call Credit Union Rating API 2. if creditRating > 750 , call Credit Card Fraud API 3. if not flagged, call Debt/Credit Summary API 4. if debt profile is acceptable, call Loan Submit API All APIs are mocked through [mockey](https://github.com/salilvnair/mockey) with response delays to simulate real external systems. ## Repos and files used ## Mock APIs ([mockey](https://github.com/salilvnair/mockey)) - GET /api/mock/loan/credit-union/rating - GET /api/mock/loan/credit-card/fraud-check - GET /api/mock/loan/debt-credit/summary - POST /api/mock/loan/application/submit Key files: - mockey/src/resolver/provider/live-api.resolver.js - mockey/src/resolver/core/resolver.registry.js - mockey/src/route/mockey-route.json - mockey/src/response/loan/*.json (includes delay via responseDelayInMillis ) ## Demo MCP handlers ( convengine-demo ) - loan.credit.rating.check - loan.credit.fraud.check - loan.debt.credit.summary - loan.application.submit Handler files: - convengine-demo/.../LoanCreditRatingToolHandler.java - convengine-demo/.../LoanFraudCheckToolHandler.java - convengine-demo/.../LoanDebtSummaryToolHandler.java - convengine-demo/.../LoanApplicationSubmitToolHandler.java ## Seed packs - Postgres: convengine-demo/src/main/resources/sql/example2_seed.sql - SQLite: convengine-demo/src/main/resources/sql/example2_sqlite_seed.sql These seed files include all required DML: - ce_intent - ce_intent_classifier - ce_output_schema - ce_prompt_template - ce_response - ce_rule - ce_mcp_tool (with intent_code + state_code ) - ce_mcp_planner scoped prompt rows (default + LOAN_APPLICATION/ELIGIBILITY_GATE) ## Required rule/response rows for this flow Use these key rows so classifier + MCP + response resolution line up correctly: sql -- 1) Bootstrap state after classifier picks LOAN_APPLICATION INSERT INTO ce_rule (intent_code, state_code, rule_type, match_pattern, action, action_value, phase, priority, enabled, description) VALUES (\'LOAN_APPLICATION\', \'UNKNOWN\', \'REGEX\', \'.*\', \'SET_STATE\', \'ELIGIBILITY_GATE\', \'POST_AGENT_INTENT\', 20, true, \'Move LOAN_APPLICATION from UNKNOWN into ELIGIBILITY_GATE.\'); -- 2) After MCP planner returns ANSWER, close state for final response mapping INSERT INTO ce_rule (intent_code, state_code, rule_type, match_pattern, action, action_value, phase, priority, enabled, description) VALUES (\'LOAN_APPLICATION\', \'ELIGIBILITY_GATE\', \'JSON_PATH\', \'$[?(@.context.mcp.finalAnswer != null && @.context.mcp.finalAnswer != \'\'\'\')]\', \'SET_STATE\', \'COMPLETED\', \'POST_AGENT_MCP\', 30, true, \'Move loan flow to COMPLETED only when context.mcp.finalAnswer exists.\'); -- 3) Final response row should target COMPLETED and derive from MCP context INSERT INTO ce_response (intent_code, state_code, output_format, response_type, derivation_hint, priority, enabled, description) VALUES (\'LOAN_APPLICATION\', \'COMPLETED\', \'TEXT\', \'DERIVED\', \'Use context.mcp.finalAnswer as primary summary. Validate with context.mcp.observations (rating/fraud/debt/submit). Do not invent values.\', 20, true, \'Loan decision derived from MCP outputs.\'); -- 4) Prompt template should explicitly read context.mcp.* INSERT INTO ce_prompt_template (intent_code, state_code, response_type, system_prompt, user_prompt, enabled) VALUES (\'LOAN_APPLICATION\', \'COMPLETED\', \'TEXT\', \'You are a precise loan workflow summarizer. Use only MCP evidence from context JSON.\', \'Context JSON:\\\\n{{context}}\\\\n\\\\nRead context.mcp.observations and context.mcp.finalAnswer. Return a concise final loan decision.\', true); ## Step-by-step test ## 1) Start [mockey](https://github.com/salilvnair/mockey) bash cd /Users/salilvnair/workspace/git/salilvnair/mockey npm install npm start Expected: text listening to 31333 ## 2) Optional quick mock checks bash curl -s \\"http://localhost:31333/api/mock/loan/credit-union/rating?customerId=CUST-1001\\" curl -s \\"http://localhost:31333/api/mock/loan/credit-card/fraud-check?customerId=CUST-1001\\" curl -s \\"http://localhost:31333/api/mock/loan/debt-credit/summary?customerId=CUST-1001\\" curl -s -X POST \\"http://localhost:31333/api/mock/loan/application/submit\\" -H \\"Content-Type: application/json\\" -d \'{\\"customerId\\":\\"CUST-1001\\",\\"requestedAmount\\":350000,\\"tenureMonths\\":36}\' ## 3) Start convengine-demo bash cd /Users/salilvnair/workspace/git/salilvnair/convengine-demo ./mvnw spring-boot:run ## 4) Seed Example 2 DML For Postgres run: - convengine-demo/src/main/resources/sql/example2_seed.sql For SQLite run: - convengine-demo/src/main/resources/sql/example2_sqlite_seed.sql ## 5) Run as chat-style walkthrough <Tabs groupId=\\"example2-chat-flow\\"> <TabItem value=\\"chat\\" label=\\"Conversation\\" default> <ChatContainer> <TraceChatBubble role=\\"user\\" name=\\"Turn 1 - User\\" message=\\"Apply loan for customer CUST-1001, amount 350000 for 36 months.\\" info={[\\"SchemaExtractionStep pulls customerId, amount, tenure.\\", \\"Rule moves state to ELIGIBILITY_GATE.\\"]} /> <TraceChatBubble role=\\"assistant\\" name=\\"Turn 1 - Assistant (internal MCP)\\" message=\\"Running eligibility chain: rating -> fraud -> debt summary -> submit.\\" json={{ mcp: { observations: [ { toolCode: \\"loan.credit.rating.check\\", json: \\"{\\\\\\"mapped\\\\\\":{\\\\\\"customerId\\\\\\":\\\\\\"CUST-1001\\\\\\",\\\\\\"creditRating\\\\\\":782}}\\" }, { toolCode: \\"loan.credit.fraud.check\\", json: \\"{\\\\\\"mapped\\\\\\":{\\\\\\"customerId\\\\\\":\\\\\\"CUST-1001\\\\\\",\\\\\\"flagged\\\\\\":false}}\\" }, { toolCode: \\"loan.debt.credit.summary\\", json: \\"{\\\\\\"mapped\\\\\\":{\\\\\\"dti\\\\\\":0.31,\\\\\\"availableCredit\\\\\\":220000}}\\" }, { toolCode: \\"loan.application.submit\\", json: \\"{\\\\\\"mapped\\\\\\":{\\\\\\"applicationId\\\\\\":\\\\\\"LA-90311\\\\\\",\\\\\\"status\\\\\\":\\\\\\"SUBMITTED\\\\\\"}}\\" } ] } }} tables={[\\"ce_mcp_tool (R)\\", \\"ce_mcp_planner (R)\\", \\"ce_audit (W)\\"]} info={[\\"Planner decides each next tool from previous observation.\\", \\"Observations are persisted in context.mcp.observations.\\"]} /> <TraceChatBubble role=\\"assistant\\" name=\\"Turn 1 - Final Assistant Output\\" message=\\"Loan application submitted successfully. Application ID: LA-90311. Credit and fraud checks passed; debt profile is within threshold.\\" json={{ mcp: { finalAnswer: \\"Approved and submitted with applicationId LA-90311.\\" } }} tables={[\\"ce_response (R)\\", \\"ce_prompt_template (R)\\", \\"ce_conversation (W)\\"]} info={[\\"Response is DERIVED TEXT for LOAN_APPLICATION + COMPLETED.\\", \\"TextOutputFormatResolver uses context + derivation_hint.\\"]} /> </ChatContainer> </TabItem> <TabItem value=\\"turn-table\\" label=\\"Turn Table\\"> <DbTable title=\\"Loan flow summary\\" columns={[\\"Phase\\", \\"What happens\\", \\"Tables touched\\", \\"Output\\"]} rows={[ [\\"Schema + state\\", \\"Extract fields and switch to ELIGIBILITY_GATE.\\", \\"ce_output_schema(R), ce_rule(R), ce_audit(W)\\", \\"context fields + state\\"], [\\"Post-MCP transition\\", \\"POST_AGENT_MCP rule moves state to COMPLETED only when context.mcp.finalAnswer is present.\\", \\"ce_rule(R), ce_audit(W)\\", \\"state=COMPLETED\\"], [\\"MCP tool chain\\", \\"Rating, fraud, debt, submit executed conditionally.\\", \\"ce_mcp_tool(R), ce_mcp_planner(R), ce_audit(W)\\", \\"context.mcp.observations[]\\"], [\\"MCP final answer\\", \\"Planner writes final decision text.\\", \\"ce_audit(W)\\", \\"context.mcp.finalAnswer\\"], [\\"Response resolution\\", \\"DERIVED TEXT generated for user.\\", \\"ce_response(R), ce_prompt_template(R), ce_audit(W)\\", \\"assistant payload\\"], ]} /> </TabItem> <TabItem value=\\"api\\" label=\\"Request Payloads\\"> Planner mode payload: json { \\"userInput\\": \\"Apply loan for customer CUST-1001, amount 350000 for 36 months\\", \\"contextJson\\": \\"{}\\", \\"inputParams\\": {} } Direct branch payload (low rating): json { \\"userInput\\": \\"Apply loan\\", \\"contextJson\\": \\"{}\\", \\"inputParams\\": { \\"tool_request\\": { \\"tool_code\\": \\"loan.credit.rating.check\\", \\"tool_group\\": \\"HTTP_API\\", \\"args\\": { \\"customerId\\": \\"CUST-LOW\\" } } } } Direct branch payload (fraud): json { \\"userInput\\": \\"Apply loan\\", \\"contextJson\\": \\"{}\\", \\"inputParams\\": { \\"tool_request\\": { \\"tool_code\\": \\"loan.credit.fraud.check\\", \\"tool_group\\": \\"HTTP_API\\", \\"args\\": { \\"customerId\\": \\"CUST-FRAUD\\" } } } } </TabItem> </Tabs> ## 6) Verify audit stages Look for: - MCP_PLAN_LLM_INPUT - MCP_PLAN_LLM_OUTPUT - MCP_TOOL_CALL - MCP_TOOL_RESULT - MCP_FINAL_ANSWER Also for direct tool requests: - TOOL_ORCHESTRATION_REQUEST - TOOL_ORCHESTRATION_RESULT ## 7) Verify advanced HTTP execution metadata Mapped output includes framework execution details: json { \\"status\\": 200, \\"attempt\\": 1, \\"latencyMs\\": 1205, \\"mapped\\": { \\"customerId\\": \\"CUST-1001\\", \\"creditRating\\": 782 } } The latency reflects mock delays ( responseDelayInMillis ) configured in [mockey](https://github.com/salilvnair/mockey) responses. ## How MCP Tool Output Is Used in Response Resolution (Step-by-Step) For this example, the final assistant text is not hardcoded. It is derived from MCP evidence in runtime context: 1. McpToolStep starts and clears stale context.mcp.finalAnswer and context.mcp.observations . 2. Every successful tool call appends one entry into context.mcp.observations : - toolCode - json (stringified mapped payload) 3. When planner returns ANSWER , McpToolStep writes: - context.mcp.finalAnswer - input param mcp_final_answer 4. RulesStep runs POST_AGENT_MCP phase and matches rule only when context.mcp.finalAnswer is present, then sets state to COMPLETED . 5. ResponseResolutionStep selects ce_response for: - intent_code=LOAN_APPLICATION - state_code=COMPLETED - response type DERIVED , output format TEXT 6. It then selects matching ce_prompt_template ( TEXT ) for the same intent/state. 7. TextOutputFormatResolver invokes LLM with: - rendered system/user prompt - ce_response.derivation_hint - context payload ( session.contextDict() ), which includes MCP observations/finalAnswer 8. LLM produces final summary text. Engine audits RESOLVE_RESPONSE_LLM_OUTPUT and ASSISTANT_OUTPUT , then persists conversation. <Highlight type=\\"info\\" title=\\"Practical implication\\"> In this setup, the response LLM is grounded by two things together: derivation_hint policy from ce_response and MCP evidence from context.mcp.* . That is why the final answer reflects rating/fraud/debt/applicationId consistently. </Highlight> The provided Example 2 seed now makes this explicit in SQL as well: - ce_prompt_template.user_prompt explicitly instructs reading context.mcp.observations and context.mcp.finalAnswer - ce_response.derivation_hint explicitly references context.mcp.* ## E2E Turn-by-Turn (Tab View) <Tabs groupId=\\"loan-example-e2e\\"> <TabItem value=\\"approved\\" label=\\"Approved Path\\" default> <DbTable title=\\"Single request turn (approved branch)\\" columns={[\\"Loop/Step\\", \\"LLM deduction\\", \\"Tables touched\\", \\"Produced state/data\\"]} rows={[ [\\"Schema extraction\\", \\"customerId/requestedAmount/tenure extracted.\\", \\"ce_output_schema(R), ce_prompt_template(R), ce_audit(W)\\", \\"context fields set\\"], [\\"State rule\\", \\"loan flow evaluates in ELIGIBILITY_GATE (pre-MCP), then POST_AGENT_MCP moves to COMPLETED only when finalAnswer exists.\\", \\"ce_rule(R), ce_audit(W)\\", \\"state=ELIGIBILITY_GATE\\"], [\\"MCP #1\\", \\"Need credit rating first.\\", \\"ce_mcp_tool(R), ce_mcp_planner(R), ce_audit(W)\\", \\"CALL_TOOL rating\\"], [\\"Tool #1\\", \\"Rating available and > 750.\\", \\"ce_audit(W)\\", \\"obs[0]=creditRating\\"], [\\"MCP #2\\", \\"Proceed to fraud check.\\", \\"ce_mcp_planner(R), ce_audit(W)\\", \\"CALL_TOOL fraud\\"], [\\"Tool #2\\", \\"Fraud clear.\\", \\"ce_audit(W)\\", \\"obs[1]=flagged:false\\"], [\\"MCP #3\\", \\"Need affordability metrics.\\", \\"ce_mcp_planner(R), ce_audit(W)\\", \\"CALL_TOOL debt summary\\"], [\\"Tool #3\\", \\"DTI acceptable and credit sufficient.\\", \\"ce_audit(W)\\", \\"obs[2]=dti/availableCredit\\"], [\\"MCP #4\\", \\"Submit application now.\\", \\"ce_mcp_planner(R), ce_audit(W)\\", \\"CALL_TOOL submit\\"], [\\"Tool #4\\", \\"Submission succeeded.\\", \\"ce_audit(W)\\", \\"obs[3]=applicationId/status\\"], [\\"MCP ANSWER\\", \\"Enough evidence for final decision.\\", \\"ce_audit(W)\\", \\"context.mcp.finalAnswer\\"], [\\"ResponseResolutionStep\\", \\"Generate final user-facing summary.\\", \\"ce_response(R), ce_prompt_template(R), ce_audit(W)\\", \\"assistant text payload\\"] ]} /> </TabItem> <TabItem value=\\"low-rating\\" label=\\"Low Rating\\"> <DbTable title=\\"Early-stop branch: low credit score\\" columns={[\\"Loop/Step\\", \\"LLM deduction\\", \\"Tables touched\\", \\"Produced state/data\\"]} rows={[ [\\"MCP #1\\", \\"Call rating check.\\", \\"ce_mcp_tool(R), ce_mcp_planner(R), ce_audit(W)\\", \\"CALL_TOOL rating\\"], [\\"Tool #1\\", \\"creditRating <= 750.\\", \\"ce_audit(W)\\", \\"obs[0]=low rating\\"], [\\"MCP ANSWER\\", \\"Stop chain; reject without fraud/debt/submit.\\", \\"ce_mcp_planner(R), ce_audit(W)\\", \\"context.mcp.finalAnswer (rejection)\\"], [\\"ResponseResolutionStep\\", \\"Render low-score rejection summary.\\", \\"ce_response(R), ce_prompt_template(R), ce_audit(W)\\", \\"assistant text payload\\"] ]} /> </TabItem> <TabItem value=\\"fraud\\" label=\\"Fraud Flagged\\"> <DbTable title=\\"Branch: fraud hit after good rating\\" columns={[\\"Loop/Step\\", \\"LLM deduction\\", \\"Tables touched\\", \\"Produced state/data\\"]} rows={[ [\\"MCP #1 + Tool #1\\", \\"Rating is high enough to continue.\\", \\"ce_mcp_tool(R), ce_mcp_planner(R), ce_audit(W)\\", \\"obs[0]=rating\\"], [\\"MCP #2 + Tool #2\\", \\"Fraud flagged=true.\\", \\"ce_mcp_planner(R), ce_audit(W)\\", \\"obs[1]=fraud flagged\\"], [\\"MCP ANSWER\\", \\"Stop chain immediately; reject.\\", \\"ce_mcp_planner(R), ce_audit(W)\\", \\"context.mcp.finalAnswer (fraud rejection)\\"], [\\"ResponseResolutionStep\\", \\"Produce fraud-specific final text.\\", \\"ce_response(R), ce_prompt_template(R), ce_audit(W)\\", \\"assistant text payload\\"] ]} /> </TabItem> <TabItem value=\\"high-debt\\" label=\\"High Debt\\"> <DbTable title=\\"Branch: affordability fails after fraud clears\\" columns={[\\"Loop/Step\\", \\"LLM deduction\\", \\"Tables touched\\", \\"Produced state/data\\"]} rows={[ [\\"MCP #1 + Tool #1\\", \\"Rating allows continuation.\\", \\"ce_mcp_tool(R), ce_mcp_planner(R), ce_audit(W)\\", \\"obs[0]=rating\\"], [\\"MCP #2 + Tool #2\\", \\"Fraud clear.\\", \\"ce_mcp_planner(R), ce_audit(W)\\", \\"obs[1]=fraud false\\"], [\\"MCP #3 + Tool #3\\", \\"DTI too high or available credit too low.\\", \\"ce_mcp_planner(R), ce_audit(W)\\", \\"obs[2]=poor affordability\\"], [\\"MCP ANSWER\\", \\"Reject or mark manual review; skip submit.\\", \\"ce_mcp_planner(R), ce_audit(W)\\", \\"context.mcp.finalAnswer\\"], [\\"ResponseResolutionStep\\", \\"Generate debt/affordability explanation.\\", \\"ce_response(R), ce_prompt_template(R), ce_audit(W)\\", \\"assistant text payload\\"] ]} /> </TabItem> </Tabs> ## ReactFlow Execution Map <EngineDebugFlow title=\\"Example 2 End-to-End Execution\\" subtitle=\\"Conditional MCP chain from eligibility checks to final response resolution.\\" nodes={loanExampleNodes} edges={loanExampleEdges} detailsById={loanExampleDetails} defaultSelectedId=\\"m1\\" /> ## Response Field Provenance <DbTable title=\\"Where final response facts come from\\" columns={[\\"Response fact\\", \\"Primary source\\", \\"Stage where it enters context\\"]} rows={[ [\\"creditRating\\", \\"loan.credit.rating.check mapped payload\\", \\"MCP_TOOL_RESULT #1\\"], [\\"fraudFlag\\", \\"loan.credit.fraud.check mapped payload\\", \\"MCP_TOOL_RESULT #2\\"], [\\"dti / availableCredit\\", \\"loan.debt.credit.summary mapped payload\\", \\"MCP_TOOL_RESULT #3\\"], [\\"applicationId / submitStatus\\", \\"loan.application.submit mapped payload\\", \\"MCP_TOOL_RESULT #4 (approved path)\\"], [\\"Final decision sentence\\", \\"planner answer + response derivation\\", \\"MCP_FINAL_ANSWER + RESOLVE_RESPONSE_LLM_OUTPUT\\"], ]} /> ## Notes on state and scope ce_mcp_tool rows in example2 are scoped as: - intent_code = LOAN_APPLICATION - state_code = ELIGIBILITY_GATE This ensures tools are visible only in the loan decision state. ## Troubleshooting - Tool not resolved: - verify tool_code in DB matches handler toolCode() exactly - No tool call in planner path: - check McpPlanner prompt rows in ce_mcp_planner - confirm active intent is LOAN_APPLICATION - Timeouts/retries unexpected: - inspect handler-specific HttpApiExecutionPolicy - inspect mock delay values in mockey/src/response/loan/*.json ## Related docs - [MCP Basics](/docs/v2/consumer/mcp/basics) - [MCP Advanced Guide](/docs/v2/consumer/mcp/advanced) - [MCP Example 1 (Mockey + Demo)](/docs/v2/consumer/mcp/example1)","excerpt":"}, }, }, }, }, }, }, }, }, }, }, }, }, }, }, ]; , , , , , , , , , , , , , , ]; u1: , s1: , r1: , r2: , m1: , t1: , m2: , t2: , m3: , t3: , m4: , t4: , m5: , resp: , out: }; MCP Example 2 Loan Application (Conditional API\u2026"},{"id":"consumer/mcp/http-tool.mdx","version":"v2","title":"http tool","permalink":"/docs/v2/consumer/mcp/http-tool","content":"MCP HTTP Tool ConvEngine supports two HTTP MCP integration models. Two ways delegate.invoke processResponse\\"], ]} / Related libraries: Model A: HttpApiRequestingToolHandler Flow 1. Handler returns HttpApiRequestSpec 2. Framework executes HTTP call 3. Mapping mode resolves output 4. MCP observation is stored Supported mapping modes: RAW_JSON JSON_PATH FIELD_TEMPLATE MAPPER_CLASS TEXT MAPPER_CLASS example: java new HttpApiResponseMapping( HttpApiResponseMappingMode.MAPPER_CLASS, null, Map.of(), \\"com.acme.api.OrderStatusResponse\\"); Model B: HttpApiApiProcessorToolHandler Flow 1. wsContext(...) builds tool context 2. wsHandler(...) returns RestWebServiceHandler 3. Framework calls RestWebServiceFacade.initiate(...) 4. prepareRequest(...) runs 5. delegate invoke(...) runs 6. processResponse(...) maps output 7. framework calls extractResponse(...) and stores MCP observation convengine demo package convention In demo we now keep each MCP tool in its own folder tree with dedicated handler/delegate: mcp/handler/loan/credit/rating/... mcp/handler/loan/credit/fraud/... mcp/handler/loan/application/submit/... mcp/handler/mock/customer/profile/... mcp/handler/mock/order/status/... mcp/handler/mock/order/async/trace/... mcp/handler/mock/order/submit/... Each tool folder contains: ToolHandler (MCP SPI class) handler/ WsHandler delegate/ WsDelegate Shared lightweight helper types are in: mcp/handler/common/... As requested, LoanDebtSummaryToolHandler remains HttpApiRequestingToolHandler to demonstrate the framework managed HTTP model side by side with mode. What MockOrderAsyncTraceToolHandler does mock.order.async.trace fetches async callback trace details for an order: traceId api4AsyncStatus callbackReceivedAt message It is used in order diagnostics flow to explain why an order can be submitted while async callback is still pending or null. Related","rawContent":"# MCP HTTP Tool ConvEngine supports two HTTP MCP integration models. ## Two ways <DbTable title=\\"HTTP MCP models\\" columns={[\\"Model\\", \\"Use when\\", \\"How it executes\\"]} rows={[ [\\"HttpApiRequestingToolHandler\\", \\"You want framework-managed retries/timeouts/circuit/auth/mapping\\", \\"HttpApiToolInvoker (framework HttpClient)\\"], [\\"HttpApiApiProcessorToolHandler\\", \\"You already use [api-processor](https://github.com/salilvnair/api-processor) in your app\\", \\"RestWebServiceFacade -> delegate.invoke -> processResponse\\"], ]} /> Related libraries: - [api-processor](https://github.com/salilvnair/api-processor) - [ccf-core](https://github.com/salilvnair/ccf-core) ## Model A: HttpApiRequestingToolHandler ### Flow 1. Handler returns HttpApiRequestSpec 2. Framework executes HTTP call 3. Mapping mode resolves output 4. MCP observation is stored Supported mapping modes: - RAW_JSON - JSON_PATH - FIELD_TEMPLATE - MAPPER_CLASS - TEXT MAPPER_CLASS example: java new HttpApiResponseMapping( HttpApiResponseMappingMode.MAPPER_CLASS, null, Map.of(), \\"com.acme.api.OrderStatusResponse\\"); ## Model B: HttpApiApiProcessorToolHandler ### Flow 1. wsContext(...) builds tool context 2. wsHandler(...) returns RestWebServiceHandler 3. Framework calls RestWebServiceFacade.initiate(...) 4. prepareRequest(...) runs 5. delegate invoke(...) runs 6. processResponse(...) maps output 7. framework calls extractResponse(...) and stores MCP observation ## convengine-demo package convention In demo we now keep each [api-processor](https://github.com/salilvnair/api-processor) MCP tool in its own folder tree with dedicated handler/delegate: - mcp/handler/loan/credit/rating/... - mcp/handler/loan/credit/fraud/... - mcp/handler/loan/application/submit/... - mcp/handler/mock/customer/profile/... - mcp/handler/mock/order/status/... - mcp/handler/mock/order/async/trace/... - mcp/handler/mock/order/submit/... Each tool folder contains: - <Tool>ToolHandler (MCP SPI class) - handler/<Tool>WsHandler - delegate/<Tool>WsDelegate Shared lightweight helper types are in: - mcp/handler/common/... <Highlight type=\\"tip\\" title=\\"Debt tool intentionally unchanged\\"> As requested, LoanDebtSummaryToolHandler remains HttpApiRequestingToolHandler to demonstrate the framework-managed HTTP model side-by-side with [api-processor](https://github.com/salilvnair/api-processor) mode. </Highlight> ## What MockOrderAsyncTraceToolHandler does mock.order.async.trace fetches async callback trace details for an order: - traceId - api4AsyncStatus - callbackReceivedAt - message It is used in order diagnostics flow to explain why an order can be submitted while async callback is still pending or null. ## Related - [MCP Basics](/docs/v2/consumer/mcp/basics) - [MCP Advanced Guide](/docs/v2/consumer/mcp/advanced) - [MCP Example 1](/docs/v2/consumer/mcp/example1) - [MCP Example 2](/docs/v2/consumer/mcp/example2)","excerpt":"MCP HTTP Tool ConvEngine supports two HTTP MCP integration models. Two ways delegate.invoke processResponse\\"], ]} / Related libraries: Model A: HttpApiRequestingToolHandler Flow 1. Handler returns HttpApiRequestSpec 2. F\u2026"},{"id":"consumer/new-consumer-onboarding.mdx","version":"v2","title":"new consumer onboarding","permalink":"/docs/v2/consumer/new-consumer-onboarding","content":"New Consumer Onboarding This is the practical playbook for teams integrating ConvEngine for the first time. The framework introduces a completely revamped interaction pipeline featuring Dialogue Act detection, orchestration graphs, internal guardrails, and automated pending action pipelines. What a new consumer must decide first Step by step onboarding Add ConvEngine 2.0.0 dependencies. Enable @EnableConvEngine and provide one production grade LlmClient bean with strict timeout and retry policy. Seed minimum rows for intents, classifiers, responses, prompt templates, schemas, and pending tasks. Apply conservative defaults for reset behavior, rules logic, MCP safety, and enable Guardrails via convengine.flow.guardrail.enabled: true . Validate multi turn transitions, pending action AFFIRM / NEGATE semantics, tool invocation, and missing field loops. Move from non prod to prod only after all correctness/security/scalability gates pass. Minimum integration checklist 1. Start a Spring Boot project (v2.0.0) } } Recommended baseline config (new consumers) Correctness focused test pack (required) Common new consumer mistakes After this page, continue with for a complete table level breakdown of the Flow setup, and dive into the for extension integration.","rawContent":"# New Consumer Onboarding This is the practical playbook for teams integrating ConvEngine for the first time. The framework introduces a completely revamped interaction pipeline featuring Dialogue Act detection, orchestration graphs, internal guardrails, and automated pending-action pipelines. ## What a new consumer must decide first <DbTable title=\\"Day-0 decisions\\" columns={[\\"Decision\\", \\"Why it matters\\", \\"Recommended default\\"]} rows={[ [\\"Transport\\", \\"Determines runtime event delivery and operational complexity.\\", \\"Start with SSE only; enable STOMP relay later.\\"], [\\"Intent continuity\\", \\"Controls whether intent re-resolves each turn.\\", \\"The engine manages intent lifecycle fluidly; enable convengine.flow.state-graph to build strict path boundaries.\\"], [\\"Action Orchestration\\", \\"Safely execute programmatic actions vs pure dialogue.\\", \\"Leverage convengine.flow.action-lifecycle and PENDING_ACTION states for secure operations.\\"], [\\"Concurrency policy\\", \\"Prevents same-conversation race corruption.\\", \\"Serialize by conversationId at API layer from day one.\\"], [\\"Prompt exposure policy\\", \\"Controls data leakage and prompt contamination risk.\\", \\"Use allowlist of prompt vars; do not expose raw input maps.\\"], ]} /> ## Step-by-step onboarding <FlowStep step=\\"1\\" title=\\"Bootstrap framework and LLM adapter\\"> Add ConvEngine 2.0.0 dependencies. Enable <MethodRef>@EnableConvEngine</MethodRef> and provide one production-grade <MethodRef>LlmClient</MethodRef> bean with strict timeout and retry policy. </FlowStep> <FlowStep step=\\"2\\" title=\\"Create baseline control-plane data\\"> Seed minimum rows for intents, classifiers, responses, prompt templates, schemas, and pending tasks. </FlowStep> <FlowStep step=\\"3\\" title=\\"Lock down safety defaults\\"> Apply conservative defaults for reset behavior, rules logic, MCP safety, and enable Guardrails via convengine.flow.guardrail.enabled: true . </FlowStep> <FlowStep step=\\"4\\" title=\\"Run correctness tests before UI rollout\\"> Validate multi-turn transitions, pending action AFFIRM / NEGATE semantics, tool invocation, and missing-field loops. </FlowStep> <FlowStep step=\\"5\\" title=\\"Promote with release gates\\"> Move from non-prod to prod only after all correctness/security/scalability gates pass. </FlowStep> ## Minimum integration checklist <DbTable title=\\"Must-have implementation tasks\\" columns={[\\"Area\\", \\"Task\\", \\"Done when\\"]} rows={[ [\\"Spring wiring\\", \\"Add POM Dependency, Enable ConvEngine + define LlmClient bean.\\", \\" /message works and returns payload for seeded FAQ intent.\\"], [\\"Schema\\", \\"Apply DDL and create indexes from ConvEngine schema.\\", \\"All ce_* tables present and writable.\\"], [\\"Seed data\\", \\"Insert minimal rows for one end-to-end intent.\\", \\"One deterministic turn passes with expected intent/state.\\"], [\\"Audit usage\\", \\"Wire audit API/stream into debugging workflow.\\", \\"Every test case is verified against trace timeline.\\"], [\\"Concurrency guard\\", \\"Prevent parallel writes for same conversation.\\", \\"Load test shows no state drift under concurrent same-ID requests.\\"], [\\"Prompt hygiene\\", \\"Allowlist exposed template vars.\\", \\"No sensitive/internal keys appear in rendered prompts.\\"], ]} /> ## 1. Start a Spring Boot project (v2.0.0) <Tabs groupId=\\"bootstrap\\"> <TabItem value=\\"maven\\" label=\\"pom.xml\\" default> <CodeBlockToggle title=\\"Maven dependency\\" language=\\"xml\\" packagePath=\\"project build\\"> { <dependency> <groupId>com.github.salilvnair</groupId> <artifactId>convengine</artifactId> <version>2.0.0</version> </dependency> } </CodeBlockToggle> </TabItem> <TabItem value=\\"gradle\\" label=\\"build.gradle.kts\\"> <CodeBlockToggle title=\\"Gradle dependency\\" language=\\"kotlin\\" packagePath=\\"project build\\"> { implementation(\\"com.github.salilvnair:convengine:2.0.0\\") } </CodeBlockToggle> </TabItem> <TabItem value=\\"app\\" label=\\"Application class\\"> <CodeBlockToggle title=\\"Enable ConvEngine\\" language=\\"java\\" packagePath=\\"com.zapper.demo\\" filePath=\\"src/main/java/com/acme/demo/DemoApplication.java\\"> { @SpringBootApplication @EnableConvEngine(stream = true) @EnableConvEngineCaching @EnableConvEngineAsyncConversation public class DemoApplication { public static void main(String[] args) { SpringApplication.run(DemoApplication.class, args); } } } </CodeBlockToggle> </TabItem> </Tabs> ## Recommended baseline config (new consumers) <CodeBlockToggle title=\\"Safe starter config (convengine.flow.*)\\" language=\\"yaml\\"> { convengine: # Flow tuning flow: dialogue-act: resolute: REGEX_THEN_LLM llm-threshold: 0.90 conversation-history: max-turns: 10 interaction-policy: execute-pending-on-affirm: true reject-pending-on-negate: true fill-pending-slot-on-non-new-request: true require-resolved-intent-and-state: true matrix: \\"PENDING_ACTION:AFFIRM\\": EXECUTE_PENDING_ACTION \\"PENDING_ACTION:NEGATE\\": REJECT_PENDING_ACTION \\"PENDING_SLOT:QUESTION\\": FILL_PENDING_SLOT action-lifecycle: enabled: true ttl-turns: 3 ttl-minutes: 30 guardrail: enabled: true sanitize-input: true require-approval-for-sensitive-actions: false approval-gate-fail-closed: true sensitive-patterns: [] state-graph: enabled: true soft-block-on-violation: false transport: sse: enabled: true stomp: enabled: false audit: enabled: true persist-meta: true level: ALL tables: AUDIT: CE_AUDIT CONTAINER_CONFIG: CE_CONTAINER_CONFIG CONVERSATION: CE_CONVERSATION INTENT: CE_INTENT INTENT_CLASSIFIER: CE_INTENT_CLASSIFIER LLM_CALL_LOG: CE_LLM_CALL_LOG MCP_DB_TOOL: CE_MCP_DB_TOOL MCP_PLANNER: CE_MCP_PLANNER MCP_TOOL: CE_MCP_TOOL OUTPUT_SCHEMA: CE_OUTPUT_SCHEMA PROMPT_TEMPLATE: CE_PROMPT_TEMPLATE RESPONSE: CE_RESPONSE RULE: CE_RULE } </CodeBlockToggle> ## Correctness-focused test pack (required) <DbTable title=\\"Pre-production test scenarios\\" columns={[\\"Scenario\\", \\"What to verify\\", \\"Failure signal\\"]} rows={[ [\\"Pending action semantics\\", \\"System properly executes mapped tasks or cancels when the user affirms or negates.\\", \\"State gets stuck, or action executes prematurely without active confirmation.\\"], [\\"Sticky intent shift\\", \\"New-topic user input triggers expected re-resolution/switch behavior.\\", \\"Repeated wrong-intent responses with skip stages.\\"], [\\"Guardrail bounds\\", \\"Malicious or off-topic prompts fallback gracefully and log the event.\\", \\"Engine returns out-of-bounds topic data or leaked configuration.\\"], [\\"Schema loop\\", \\"Missing fields converge in bounded turns.\\", \\"Infinite clarification or inconsistent required field set.\\"], [\\"Concurrent same ID\\", \\"No last-write-wins drift under parallel requests.\\", \\"Contradictory final state for same conversation timeline.\\"], ]} /> ## Common new-consumer mistakes <DbTable title=\\"Avoid these early mistakes\\" columns={[\\"Mistake\\", \\"Impact\\", \\"Fix\\"]} rows={[ [\\"Disabling interaction policies\\", \\"Losing all built-in logic for handling \'yes\', \'no\', and slot-filling inputs.\\", \\"Leave \\\\ convengine.flow.interaction-policy\\\\ active and matrix populated.\\"], [\\"No conversation-level concurrency control\\", \\"State drift and non-deterministic results.\\", \\"Serialize by conversation ID or add optimistic locking.\\"], [\\"Relying purely on LLM Dialogue Acts\\", \\"Expensive token usage and slow intent determination.\\", \\"Always implement \\\\ REGEX_THEN_LLM\\\\ resolutes for core deterministic paths.\\"], [\\"Shipping config changes without tests\\", \\"Production regressions from rule/template misconfig.\\", \\"Introduce lint + fixture tests + staged promotion.\\"], ]} /> <Highlight type=\\"info\\" title=\\"Where to read next\\"> After this page, continue with [Configuration](/docs/v2/consumer/configuration) for a complete table-level breakdown of the Flow setup, and dive into the [Developer Guide](/docs/v2/deep-dive/developer-guide) for extension integration. </Highlight>","excerpt":"New Consumer Onboarding This is the practical playbook for teams integrating ConvEngine for the first time. The framework introduces a completely revamped interaction pipeline featuring Dialogue Act detection, orchestrat\u2026"},{"id":"consumer/session-reset-and-continuity.mdx","version":"v2","title":"session reset and continuity","permalink":"/docs/v2/consumer/session-reset-and-continuity","content":"Session, Reset, and Continuity What is restored per turn From ce_conversation , session restores: intent_code state_code context_json input_params_json From context branch values, session also restores cross turn values such as clarification and intent lock metadata. Intent lock lifecycle Intent lock is used for incomplete schema collection to avoid drift. lock set when required schema fields are still missing intent resolver skip logic respects lock lock removed when schema is complete or schema path is absent Sticky intent lifecycle ( ce_config ) IntentResolutionStep.STICKY_INTENT applies during active incomplete schema collection to keep intent stable while required fields are still missing. when enabled, IntentResolutionStep skips re resolution only while incomplete schema collection is active skip emits audit stage: INTENT_RESOLVE_SKIPPED_STICKY_INTENT re resolution runs once schema collection is complete, and still runs for explicit switch/reset/force signals Force re resolution signals: reset commands: reset , restart , /reset , /restart switch phrases: switch to ... , switch intent , change intent/flow/mode input params: force_intent_resolution=true , resolve_intent=true , switch_intent=true , switch_flow=true , switch_mode=true active clarification flow Reset triggers request body reset=true input params reset , restart , conversation_reset text commands reset , restart , /reset , /restart intent based reset via ResetResolvedIntentStep ( ce_config ) Practical advice Keep reset intent names explicit and reserved ( RESET_SESSION style) Avoid mixing business intents with reset intents Audit CONVERSATION_RESET stages in pre production tests If reset logic is custom coded only in controller, multi turn state may still leak from existing conversation context. Use pipeline reset steps, not ad hoc request branching.","rawContent":"# Session, Reset, and Continuity ## What is restored per turn From ce_conversation , session restores: - intent_code - state_code - context_json - input_params_json From context branch values, session also restores cross-turn values such as clarification and intent lock metadata. ## Intent lock lifecycle Intent lock is used for incomplete schema collection to avoid drift. - lock set when required schema fields are still missing - intent resolver skip logic respects lock - lock removed when schema is complete or schema path is absent ## Sticky intent lifecycle ( ce_config ) IntentResolutionStep.STICKY_INTENT applies during active incomplete schema collection to keep intent stable while required fields are still missing. - when enabled, IntentResolutionStep skips re-resolution only while incomplete schema collection is active - skip emits audit stage: INTENT_RESOLVE_SKIPPED_STICKY_INTENT - re-resolution runs once schema collection is complete, and still runs for explicit switch/reset/force signals <CodeBlockToggle title=\\"Sticky intent config\\" language=\\"sql\\"> { INSERT INTO ce_config (config_type, config_key, config_value, enabled) VALUES (\'IntentResolutionStep\', \'STICKY_INTENT\', \'true\', true); } </CodeBlockToggle> Force re-resolution signals: - reset commands: reset , restart , /reset , /restart - switch phrases: switch to ... , switch intent , change intent/flow/mode - input params: force_intent_resolution=true , resolve_intent=true , switch_intent=true , switch_flow=true , switch_mode=true - active clarification flow ## Reset triggers - request body reset=true - input params reset , restart , conversation_reset - text commands reset , restart , /reset , /restart - intent-based reset via ResetResolvedIntentStep ( ce_config ) <CodeBlockToggle title=\\"Reset intent config\\" language=\\"sql\\"> { INSERT INTO ce_config (config_type, config_key, config_value, enabled) VALUES (\'ResetResolvedIntentStep\', \'RESET_INTENT_CODES\', \'RESET_SESSION,START_OVER\', true); } </CodeBlockToggle> ## Practical advice - Keep reset intent names explicit and reserved ( RESET_SESSION style) - Avoid mixing business intents with reset intents - Audit CONVERSATION_RESET stages in pre-production tests <Highlight type=\\"warning\\" title=\\"Common failure mode\\"> If reset logic is custom-coded only in controller, multi-turn state may still leak from existing conversation context. Use pipeline reset steps, not ad-hoc request branching. </Highlight>","excerpt":"Session, Reset, and Continuity What is restored per turn From ce_conversation , session restores: intent_code state_code context_json input_params_json From context branch values, session also restores cross turn values \u2026"},{"id":"consumer/ui-integration.mdx","version":"v2","title":"ui integration","permalink":"/docs/v2/consumer/ui-integration","content":"UI Integration This page shows end to end UI wiring with: React (Vite) in JS + TS Angular (standalone) in TS SSE now + STOMP commented for later switch POST to /api/v1/conversation/message using conversationId and message . Use EventSource on /api/v1/conversation/stream/ \'} . On each stream event, refresh /audit/ \'} or trace endpoint. React Vite (JavaScript) , body: JSON.stringify( ), }); if (!res.ok) throw new Error(\\"Backend error: \\" + res.status); return res.json(); } const res = await fetch(API_BASE + \\"/audit/\\" + conversationId); if (!res.ok) throw new Error(\\"Backend error: \\" + res.status); return res.json(); } const source = new EventSource(API_BASE + \\"/stream/\\" + conversationId); source.onopen = () = handlers.onConnected?.(); source.onerror = (error) = handlers.onError?.(error); [\\"CONNECTED\\", \\"USER_INPUT\\", \\"STEP_ENTER\\", \\"STEP_EXIT\\", \\"STEP_ERROR\\", \\"ASSISTANT_OUTPUT\\", \\"ENGINE_RETURN\\"] .forEach((stage) = catch handlers.onEvent?.( ); }); }); return }; } // STOMP scaffold (optional) // npm install @stomp/stompjs sockjs client // import from \\"@stomp/stompjs\\"; // import SockJS from \\"sockjs client\\"; // export function subscribeConversationStomp(conversationId, handlers = ) // catch // }); // }, // onStompError: (frame) = handlers.onError?.(frame), // }); // client.activate(); // return }; // } } from \\"react\\"; const [conversationId] = useState(crypto.randomUUID()); const [auditVersion, setAuditVersion] = useState(0); useEffect(() = ); // STOMP alternate: // const stream = subscribeConversationStomp(conversationId, ); return () = stream.close(); }, [conversationId]); return conversationId= auditVersion= ; } } React Vite (TypeScript) onConnected?: () = void; onEvent?: (event: StreamEvent ) = void; onError?: (event: Event) = void; onClosed?: () = void; } conversationId: string, message: string, inputParams: Record = , reset = false ) , body: JSON.stringify( ), }); if (!res.ok) throw new Error(\\"Backend error: \\" + res.status); return res.json(); } conversationId: string, handlers: StreamHandlers = ) catch handlers.onEvent?.( ); }); }); return }; } } from \\"react\\"; const [conversationId] = useState (crypto.randomUUID()); const [auditVersion, setAuditVersion] = useState (0); useEffect(() = , }); return () = stream.close(); }, [conversationId]); return auditVersion= ; } } Angular Integration (authored sample) from \'@angular/core\'; stage: string; data: T | null; raw: MessageEvent; } @Injectable( ) private readonly apiBase = \'http://localhost:8080/api/v1/conversation\'; constructor(private readonly http: HttpClient) sendMessage(payload: ): Observable fetchAudits(conversationId: string): Observable subscribeConversationSse( conversationId: string, handlers: = ) catch handlers.onEvent?.( ); }); }); return }; } // STOMP scaffold (optional) // npm i @stomp/stompjs sockjs client // connect ws://localhost:8080/ws convengine // subscribe /topic/convengine/audit/ } } from \'@angular/core\'; @Component( ) conversationId = crypto.randomUUID(); message = \'\'; messages: Array = []; typing = false; private streamCloser: | null = null; constructor(private readonly api: ConvengineApiService) ngOnInit(): void }); } send(): void ); this.message = \'\'; this.typing = true; this.api.sendMessage( ).subscribe( ); this.typing = false; }, error: () = }); } ngOnDestroy(): void } } } Agent is typing... Send } Keep one shared backend contract for conversationId , payload.type , and audit stage names. Only transport/client wrappers should differ per framework.","rawContent":"# UI Integration This page shows end-to-end UI wiring with: - React (Vite) in JS + TS - Angular (standalone) in TS - SSE now + STOMP commented for later switch <FlowStep step=\\"1\\" title=\\"Call message API\\"> POST to <FileRef>/api/v1/conversation/message</FileRef> using <MethodRef>conversationId</MethodRef> and <MethodRef>message</MethodRef>. </FlowStep> <FlowStep step=\\"2\\" title=\\"Subscribe to stream\\"> Use <MethodRef>EventSource</MethodRef> on <FileRef>/api/v1/conversation/stream/{\'{conversationId}\'}</FileRef>. </FlowStep> <FlowStep step=\\"3\\" title=\\"Refresh timeline\\"> On each stream event, refresh <FileRef>/audit/{\'{conversationId}\'}</FileRef> or trace endpoint. </FlowStep> ## React Vite (JavaScript) <CodeBlockToggle title=\\"convengine.api.js\\" language=\\"js\\" packagePath=\\"src/api\\" filePath=\\"src/api/convengine.api.js\\" > { const API_BASE = \\"http://localhost:8080/api/v1/conversation\\"; const res = await fetch(API_BASE + \\"/message\\", { method: \\"POST\\", headers: { \\"Content-Type\\": \\"application/json\\" }, body: JSON.stringify({ conversationId, message, reset, inputParams }), }); if (!res.ok) throw new Error(\\"Backend error: \\" + res.status); return res.json(); } const res = await fetch(API_BASE + \\"/audit/\\" + conversationId); if (!res.ok) throw new Error(\\"Backend error: \\" + res.status); return res.json(); } const source = new EventSource(API_BASE + \\"/stream/\\" + conversationId); source.onopen = () => handlers.onConnected?.(); source.onerror = (error) => handlers.onError?.(error); [\\"CONNECTED\\", \\"USER_INPUT\\", \\"STEP_ENTER\\", \\"STEP_EXIT\\", \\"STEP_ERROR\\", \\"ASSISTANT_OUTPUT\\", \\"ENGINE_RETURN\\"] .forEach((stage) => { source.addEventListener(stage, (event) => { let data = null; try { data = event.data ? JSON.parse(event.data) : null; } catch {} handlers.onEvent?.({ stage, data, raw: event }); }); }); return { close() { source.close(); handlers.onClosed?.(); } }; } // STOMP scaffold (optional) // npm install @stomp/stompjs sockjs-client // import { Client } from \\"@stomp/stompjs\\"; // import SockJS from \\"sockjs-client\\"; // export function subscribeConversationStomp(conversationId, handlers = {}) { // const client = new Client({ // webSocketFactory: () => new SockJS(\\"http://localhost:8080/ws-convengine\\"), // reconnectDelay: 5000, // onConnect: () => { // handlers.onConnected?.(); // client.subscribe(\\"/topic/convengine/audit/\\" + conversationId, (msg) => { // try { handlers.onEvent?.(JSON.parse(msg.body)); } // catch { handlers.onEvent?.(msg.body); } // }); // }, // onStompError: (frame) => handlers.onError?.(frame), // }); // client.activate(); // return { close() { client.deactivate(); handlers.onClosed?.(); } }; // } } </CodeBlockToggle> <CodeBlockToggle title=\\"App.jsx\\" language=\\"jsx\\" packagePath=\\"src\\" filePath=\\"src/App.jsx\\" > { import { useEffect, useState } from \\"react\\"; const [conversationId] = useState(crypto.randomUUID()); const [auditVersion, setAuditVersion] = useState(0); useEffect(() => { const stream = subscribeConversationSse(conversationId, { onConnected: () => setAuditVersion((v) => v + 1), onEvent: () => setAuditVersion((v) => v + 1), }); // STOMP alternate: // const stream = subscribeConversationStomp(conversationId, { ... }); return () => stream.close(); }, [conversationId]); return <div>conversationId={conversationId} auditVersion={auditVersion}</div>; } } </CodeBlockToggle> ## React Vite (TypeScript) <CodeBlockToggle title=\\"convengine.api.ts\\" language=\\"ts\\" packagePath=\\"src/api\\" filePath=\\"src/api/convengine.api.ts\\" > { const API_BASE = \\"http://localhost:8080/api/v1/conversation\\"; | \\"CONNECTED\\" | \\"USER_INPUT\\" | \\"STEP_ENTER\\" | \\"STEP_EXIT\\" | \\"STEP_ERROR\\" | \\"ASSISTANT_OUTPUT\\" | \\"ENGINE_RETURN\\" | \\"MESSAGE\\"; stage: SseStage; data: T | null; raw: MessageEvent; } onConnected?: () => void; onEvent?: (event: StreamEvent<T>) => void; onError?: (event: Event) => void; onClosed?: () => void; } conversationId: string, message: string, inputParams: Record<string, unknown> = {}, reset = false ) { const res = await fetch(API_BASE + \\"/message\\", { method: \\"POST\\", headers: { \\"Content-Type\\": \\"application/json\\" }, body: JSON.stringify({ conversationId, message, inputParams, reset }), }); if (!res.ok) throw new Error(\\"Backend error: \\" + res.status); return res.json(); } conversationId: string, handlers: StreamHandlers<T> = {} ) { const source = new EventSource(API_BASE + \\"/stream/\\" + conversationId); source.onopen = () => handlers.onConnected?.(); source.onerror = (event) => handlers.onError?.(event); [\\"CONNECTED\\", \\"USER_INPUT\\", \\"STEP_ENTER\\", \\"STEP_EXIT\\", \\"STEP_ERROR\\", \\"ASSISTANT_OUTPUT\\", \\"ENGINE_RETURN\\"] .forEach((stage) => { source.addEventListener(stage, (event) => { let data: T | null = null; try { data = (event as MessageEvent).data ? JSON.parse((event as MessageEvent).data) as T : null; } catch { data = null; } handlers.onEvent?.({ stage: stage as SseStage, data, raw: event as MessageEvent }); }); }); return { close() { source.close(); handlers.onClosed?.(); } }; } } </CodeBlockToggle> <CodeBlockToggle title=\\"App.tsx\\" language=\\"tsx\\" packagePath=\\"src\\" filePath=\\"src/App.tsx\\" > { import { useEffect, useState } from \\"react\\"; const [conversationId] = useState<string>(crypto.randomUUID()); const [auditVersion, setAuditVersion] = useState<number>(0); useEffect(() => { const stream = subscribeConversationSse(conversationId, { onConnected: () => setAuditVersion((v) => v + 1), onEvent: () => setAuditVersion((v) => v + 1), onError: () => {}, }); return () => stream.close(); }, [conversationId]); return <main>auditVersion={auditVersion}</main>; } } </CodeBlockToggle> ## Angular Integration (authored sample) <CodeBlockToggle title=\\"convengine-api.service.ts\\" language=\\"ts\\" packagePath=\\"src/app/core\\" filePath=\\"src/app/core/convengine-api.service.ts\\" > { import { Injectable } from \'@angular/core\'; stage: string; data: T | null; raw: MessageEvent; } @Injectable({ providedIn: \'root\' }) private readonly apiBase = \'http://localhost:8080/api/v1/conversation\'; constructor(private readonly http: HttpClient) {} sendMessage(payload: { conversationId: string; message: string; reset?: boolean; inputParams?: Record<string, unknown>; }): Observable<any> { return this.http.post(this.apiBase + \'/message\', payload); } fetchAudits(conversationId: string): Observable<any[]> { return this.http.get<any[]>(this.apiBase + \'/audit/\' + conversationId); } subscribeConversationSse( conversationId: string, handlers: { onConnected?: () => void; onEvent?: (event: ConversationEvent) => void; onError?: (event: Event) => void; onClosed?: () => void; } = {} ) { const source = new EventSource(this.apiBase + \'/stream/\' + conversationId); source.onopen = () => handlers.onConnected?.(); source.onerror = (event) => handlers.onError?.(event); [\\"CONNECTED\\", \\"USER_INPUT\\", \\"STEP_ENTER\\", \\"STEP_EXIT\\", \\"STEP_ERROR\\", \\"ASSISTANT_OUTPUT\\", \\"ENGINE_RETURN\\"] .forEach((stage) => { source.addEventListener(stage, (event) => { let data: unknown = null; try { data = (event as MessageEvent).data ? JSON.parse((event as MessageEvent).data) : null; } catch { data = null; } handlers.onEvent?.({ stage, data, raw: event as MessageEvent }); }); }); return { close: () => { source.close(); handlers.onClosed?.(); } }; } // STOMP scaffold (optional) // npm i @stomp/stompjs sockjs-client // connect ws://localhost:8080/ws-convengine // subscribe /topic/convengine/audit/{conversationId} } } </CodeBlockToggle> <CodeBlockToggle title=\\"chat.component.ts\\" language=\\"ts\\" packagePath=\\"src/app/features/chat\\" filePath=\\"src/app/features/chat/chat.component.ts\\" > { import { Component, OnDestroy, OnInit } from \'@angular/core\'; @Component({ standalone: true, selector: \'app-chat\', imports: [CommonModule, FormsModule], templateUrl: \'./chat.component.html\' }) conversationId = crypto.randomUUID(); message = \'\'; messages: Array<{ role: \'user\' | \'assistant\'; text: string }> = []; typing = false; private streamCloser: { close: () => void } | null = null; constructor(private readonly api: ConvengineApiService) {} ngOnInit(): void { this.streamCloser = this.api.subscribeConversationSse(this.conversationId, { onEvent: () => { // optionally refresh audit panel } }); } send(): void { const text = this.message.trim(); if (!text || this.typing) return; this.messages.push({ role: \'user\', text }); this.message = \'\'; this.typing = true; this.api.sendMessage({ conversationId: this.conversationId, message: text }).subscribe({ next: (res) => { const value = res?.payload?.value ?? \'\'; this.messages.push({ role: \'assistant\', text: String(value) }); this.typing = false; }, error: () => { this.typing = false; } }); } ngOnDestroy(): void { this.streamCloser?.close(); } } } </CodeBlockToggle> <CodeBlockToggle title=\\"chat.component.html\\" language=\\"html\\" packagePath=\\"src/app/features/chat\\" filePath=\\"src/app/features/chat/chat.component.html\\" > { <section class=\\"chat-shell\\"> <div class=\\"messages\\"> <div *ngFor=\\"let m of messages\\" [class.user]=\\"m.role === \'user\'\\" [class.assistant]=\\"m.role === \'assistant\'\\"> {{ m.text }} </div> <div *ngIf=\\"typing\\" class=\\"assistant typing\\">Agent is typing...</div> </div> <div class=\\"composer\\"> <input [(ngModel)]=\\"message\\" placeholder=\\"Type message\\" /> <button (click)=\\"send()\\" [disabled]=\\"typing\\">Send</button> </div> </section> } </CodeBlockToggle> <Highlight type=\\"tip\\" title=\\"React + Angular parity\\"> Keep one shared backend contract for <MethodRef>conversationId</MethodRef>, <MethodRef>payload.type</MethodRef>, and audit stage names. Only transport/client wrappers should differ per framework. </Highlight>","excerpt":"UI Integration This page shows end to end UI wiring with: React (Vite) in JS + TS Angular (standalone) in TS SSE now + STOMP commented for later switch POST to /api/v1/conversation/message using conversationId and messag\u2026"},{"id":"deep-dive/data-model.mdx","version":"v2","title":"data model","permalink":"/docs/v2/deep-dive/data-model","content":"Data Model ConvEngine relies entirely on configuration over code. State, relationships, and execution boundaries are encoded in the schema. Control plane tables ce_config ce_container_config ce_intent ce_intent_classifier ce_output_schema ce_prompt_template ce_response ce_rule ce_policy ce_mcp_tool ce_mcp_db_tool ce_mcp_planner ce_pending_action Runtime tables ce_conversation ce_audit ce_conversation_history ce_llm_call_log ce_conversation_history Introduced to store chronological multi turn array states strictly decoupled from internal ce_audit tracking. Key columns: history_id conversation_id user_input assistant_output created_at modified_at ce_pending_action Introduced for confirm before run logic and unambiguous multi action resolution. Purpose: declarative catalog for executable pending actions by intent/state/action key Key columns: pending_action_id intent_code state_code action_key bean_name method_names priority enabled description created_at Lookup index: (enabled, action_key, intent_code, state_code, priority) Important: runtime status ( OPEN/IN_PROGRESS/EXECUTED/REJECTED/EXPIRED ) is not stored in this table runtime status is stored in context.pending_action_runtime Rule phase compatibility ce_rule.phase includes phases: PRE_EVAL EVAL POST_EVAL PRE_RESPONSE_RESOLUTION POST_AGENT_INTENT POST_AGENT_MCP POST_TOOL_EXECUTION Tool group compatibility ce_mcp_tool.tool_group normalizes to: DB HTTP_API WORKFLOW_ACTION DOCUMENT_RETRIEVAL CALCULATOR_TRANSFORM NOTIFICATION FILES MCP tool scope columns ce_mcp_tool also supports optional scope columns: intent_code (nullable) state_code (nullable) Behavior: if both are NULL , the tool is globally eligible if set, tool eligibility is constrained to matching runtime session.intent and session.state non matching scoped tools are skipped from MCP planning/execution MCP planner scope columns ce_mcp_planner supports scoped planner prompts: intent_code (nullable) state_code (nullable) system_prompt user_prompt enabled Behavior: exact intent/state row wins intent only row is next global default row ( NULL/NULL ) is fallback if not found, planner uses legacy ce_config prompts","rawContent":"# Data Model ConvEngine relies entirely on configuration over code. State, relationships, and execution boundaries are encoded in the schema. ## Control-plane tables - ce_config - ce_container_config - ce_intent - ce_intent_classifier - ce_output_schema - ce_prompt_template - ce_response - ce_rule - ce_policy - ce_mcp_tool - ce_mcp_db_tool - ce_mcp_planner - ce_pending_action ## Runtime tables - ce_conversation - ce_audit - ce_conversation_history - ce_llm_call_log ## ce_conversation_history Introduced to store chronological multi-turn array states strictly decoupled from internal ce_audit tracking. Key columns: - history_id - conversation_id - user_input - assistant_output - created_at - modified_at ## ce_pending_action Introduced for confirm-before-run logic and unambiguous multi-action resolution. Purpose: - declarative catalog for executable pending actions by intent/state/action key Key columns: - pending_action_id - intent_code - state_code - action_key - bean_name - method_names - priority - enabled - description - created_at Lookup index: - (enabled, action_key, intent_code, state_code, priority) Important: - runtime status ( OPEN/IN_PROGRESS/EXECUTED/REJECTED/EXPIRED ) is not stored in this table - runtime status is stored in context.pending_action_runtime ## Rule phase compatibility ce_rule.phase includes phases: - PRE_EVAL - EVAL - POST_EVAL - PRE_RESPONSE_RESOLUTION - POST_AGENT_INTENT - POST_AGENT_MCP - POST_TOOL_EXECUTION ## Tool-group compatibility ce_mcp_tool.tool_group normalizes to: - DB - HTTP_API - WORKFLOW_ACTION - DOCUMENT_RETRIEVAL - CALCULATOR_TRANSFORM - NOTIFICATION - FILES ## MCP tool scope columns ce_mcp_tool also supports optional scope columns: - intent_code (nullable) - state_code (nullable) Behavior: - if both are NULL , the tool is globally eligible - if set, tool eligibility is constrained to matching runtime session.intent and session.state - non-matching scoped tools are skipped from MCP planning/execution ## MCP planner scope columns ce_mcp_planner supports scoped planner prompts: - intent_code (nullable) - state_code (nullable) - system_prompt - user_prompt - enabled Behavior: - exact intent/state row wins - intent-only row is next - global default row ( NULL/NULL ) is fallback - if not found, planner uses legacy ce_config prompts","excerpt":"Data Model ConvEngine relies entirely on configuration over code. State, relationships, and execution boundaries are encoded in the schema. Control plane tables ce_config ce_container_config ce_intent ce_intent_classifie\u2026"},{"id":"deep-dive/developer-guide.mdx","version":"v2","title":"developer guide","permalink":"/docs/v2/deep-dive/developer-guide","content":", data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , , , ]; v2x1: , v2x2: , v2x3: , v2x4: , v2x5: , v2x6: , v2x7: , v2x8: , }; Developer Guide This page is the full implementation starter for consumers building flows on top of ConvEngine. Build order for a new flow 1. Define intent/state and response rows in ce_intent and ce_response . 2. Define schema row (if slot collection needed). 3. Define rule transitions by phase ( ce_rule ). 4. Define pending actions in ce_pending_action for explicit AFFIRM/NEGATE confirmation flows. 5. Configure convengine.flow. namespaces (e.g. state graph restrictions, disambiguation limits). 6. Add tool rows and adapters to the orchestration library if external execution is needed via McpToolExecutor . 7. Replay test with expected intent/state/dialogue act assertions. Review: convengine.flow. features Use your application.yml to tune the pipeline without writing Java extension components. Extension points } } return ToolExecutionResult.skipped(); } } } } } Operational safety checklist Configure Fallbacks : Configure fallback response rows for UNKNOWN / ANY . Phase Targeting : Do not depend on one rule only; cleanly separate constraints into PRE_EVAL , EVAL , and POST_EVAL rule phases. Priority Bounds : Verify pending action catalog priorities to avoid ambiguous execution hooks during interaction policy overlaps. Guardrails : Monitor the ce_audit log for GUARDRAIL_VIOLATION to track potential malicious end user prompt injection. Strict Bounds : Enable state graph validation before promoting a new flow to production. Regression strategy Use ConversationReplayService to replay scripted turns and assert the expected variables at each turn. }","rawContent":"{ id: \\"v2x1\\", position: { x: 20, y: 60 }, data: { label: \\"DialogueActStep\\" } }, { id: \\"v2x2\\", position: { x: 260, y: 60 }, data: { label: \\"InteractionPolicyStep\\" } }, { id: \\"v2x3\\", position: { x: 500, y: 60 }, data: { label: \\"PendingActionStep\\" } }, { id: \\"v2x4\\", position: { x: 740, y: 60 }, data: { label: \\"ToolOrchestrationStep\\" } }, { id: \\"v2x5\\", position: { x: 20, y: 230 }, data: { label: \\"GuardrailStep\\" } }, { id: \\"v2x6\\", position: { x: 260, y: 230 }, data: { label: \\"StateGraphStep\\" } }, { id: \\"v2x7\\", position: { x: 500, y: 230 }, data: { label: \\"DisambiguationStep\\" } }, { id: \\"v2x8\\", position: { x: 740, y: 230 }, data: { label: \\"CeTaskExecutor\\" } }, ]; { id: \\"v2xe1\\", source: \\"v2x1\\", target: \\"v2x2\\" }, { id: \\"v2xe2\\", source: \\"v2x2\\", target: \\"v2x3\\" }, { id: \\"v2xe3\\", source: \\"v2x3\\", target: \\"v2x4\\" }, { id: \\"v2xe4\\", source: \\"v2x4\\", target: \\"v2x5\\" }, { id: \\"v2xe5\\", source: \\"v2x5\\", target: \\"v2x6\\" }, { id: \\"v2xe6\\", source: \\"v2x6\\", target: \\"v2x7\\" }, { id: \\"v2xe7\\", source: \\"v2x7\\", target: \\"v2x8\\" }, ]; v2x1: { title: \\"Dialogue Act\\", file: \\"engine/steps/DialogueActStep.java\\", method: \\"execute(...) \\", stage: \\"DIALOGUE_ACT_RESOLVED\\", summary: \\"Resolves abstract acts like AFFIRM, NEGATE, EDIT.\\", session: [\\"dialogueAct attached to session\\"], tables: [\\"none\\"] }, v2x2: { title: \\"Policy Engine\\", file: \\"engine/steps/InteractionPolicyStep.java\\", method: \\"execute(...) \\", stage: \\"POLICY_APPLIED\\", summary: \\"Maps dialogue acts to system functions using interaction matrix.\\", session: [\\"systemAction triggered (e.g. EXECUTE_PENDING_ACTION)\\"], tables: [\\"none\\"] }, v2x3: { title: \\"Pending Actions\\", file: \\"engine/steps/PendingActionStep.java\\", method: \\"execute(...) \\", stage: \\"ACTION_LIFECYCLE\\", summary: \\"Runs deferred confirmation tasks via CeTaskExecutor.\\", session: [\\"task result stored\\"], tables: [\\"ce_pending_action\\"] }, v2x4: { title: \\"Tool Runner\\", file: \\"engine/steps/ToolOrchestrationStep.java\\", method: \\"execute(...) \\", stage: \\"TOOL_EXECUTED\\", summary: \\"Calls external downstream logic.\\", session: [\\"tool_status and result merged\\"], tables: [\\"ce_mcp_tool, ce_mcp_db_tool\\"] }, v2x5: { title: \\"Guardrails\\", file: \\"engine/steps/GuardrailStep.java\\", method: \\"execute(...) \\", stage: \\"GUARDRAIL_VIOLATION\\", summary: \\"Proactively redacts or fails-closed unsafe user text.\\", session: [\\"redacted input / pipeline stop\\"], tables: [\\"none\\"] }, v2x6: { title: \\"State Graph\\", file: \\"engine/steps/StateGraphStep.java\\", method: \\"execute(...) \\", stage: \\"INVALID_STATE_TRANSITION\\", summary: \\"Enforces statically bounded turn transitions.\\", session: [\\"state transition audited\\"], tables: [\\"none\\"] }, v2x7: { title: \\"Disambiguation\\", file: \\"engine/steps/DisambiguationStep.java\\", method: \\"execute(...) \\", stage: \\"CLARIFICATION_REQUIRED\\", summary: \\"Detects intent collisions and asks user to choose.\\", session: [\\"clarification list prepped\\"], tables: [\\"none\\"] }, v2x8: { title: \\"Task Extension\\", file: \\"api/tasks/CeTaskExecutor.java\\", method: \\"executeTask(...) \\", stage: \\"TASK_RUNNING\\", summary: \\"Consumer-injected Java component logic.\\", session: [\\"consumer mutates map state\\"], tables: [\\"none\\"] }, }; # Developer Guide This page is the full implementation starter for consumers building flows on top of ConvEngine. <EngineDebugFlow title=\\"Pipeline Extension Map\\" subtitle=\\"Click each node to inspect the components.\\" nodes={v2ExtNodes} edges={v2ExtEdges} detailsById={v2ExtDetails} defaultSelectedId=\\"v2x2\\" /> ## Build order for a new flow 1. Define intent/state and response rows in ce_intent and ce_response . 2. Define schema row (if slot collection needed). 3. Define rule transitions by phase ( ce_rule ). 4. Define pending actions in ce_pending_action for explicit AFFIRM/NEGATE confirmation flows. 5. Configure convengine.flow.* namespaces (e.g. state graph restrictions, disambiguation limits). 6. Add tool rows and adapters to the orchestration library if external execution is needed via McpToolExecutor . 7. Replay test with expected intent/state/dialogue-act assertions. ## Review: convengine.flow.* features Use your application.yml to tune the pipeline without writing Java extension components. <DbTable title=\\"Flow Features\\" columns={[\\"Subsystem\\", \\"Purpose\\", \\"Example Property\\"]} rows={[ [\\"dialogue-act.*\\", \\"Detect foundational speech acts (AFFIRM, NEGATE) instead of strict intents.\\", \\"resolute: REGEX_THEN_LLM\\"], [\\"query-rewrite.*\\", \\"Automatically rewrite user input before intent resolution.\\", \\"enabled: true\\"], [\\"conversation-history.*\\", \\"Manage conversation history size and summarization.\\", \\"max-turns: 10\\"], [\\"interaction-policy.*\\", \\"Map dialogue acts to system actions like EXECUTE_PENDING_ACTION.\\", \\"execute-pending-on-affirm: true\\"], [\\"action-lifecycle.*\\", \\"Automatically expire pending actions after N turns.\\", \\"ttl-turns: 3\\"], [\\"disambiguation.*\\", \\"Configure thresholds for triggering user clarifications.\\", \\"max-options: 5\\"], [\\"guardrail.*\\", \\"Set up proactive redaction and fail-closed policies.\\", \\"approval-gate-fail-closed: true\\"], [\\"state-graph.*\\", \\"Enforce strict state transition rules for better predictability.\\", \\"soft-block-on-violation: false\\"] ]} /> ## Extension points <Tabs groupId=\\"extensions\\"> <TabItem value=\\"tasks\\" label=\\"CeTask\\" default> <CodeBlockToggle title=\\"Creating a Pending Action Task\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.tasks\\"> { @Component(\\"shippingConfirmationTask\\") public class ShippingConfirmationTask implements CeTask { @Override public TaskResult execute(EngineSession session, CePendingAction action) { String trackingId = (String) session.getInputParams().get(\\"trackingId\\"); // Call downstream API session.putInputParam(\\"shippingStatus\\", \\"DISPATCHED\\"); return TaskResult.success(); } } } </CodeBlockToggle> </TabItem> <TabItem value=\\"tools\\" label=\\"McpToolExecutor\\"> <CodeBlockToggle title=\\"Tool execution adapter\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.tools\\"> { @Component(\\"billingToolAdapter\\") public class BillingToolAdapter implements McpToolExecutor { @Override public ToolExecutionResult invoke(ToolRequest request, EngineSession session) { if (request.getToolGroup().equals(\\"BILLING\\")) { return ToolExecutionResult.success(Map.of(\\"balance\\", 0.00)); } return ToolExecutionResult.skipped(); } } } </CodeBlockToggle> </TabItem> <TabItem value=\\"memory\\" label=\\"Memory Store\\"> <CodeBlockToggle title=\\"Custom Session Snapshotting\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.stores\\"> { @Component public class CustomMemoryStore implements ConversationMemoryStore { @Override public String summarize(List<TurnSnapshot> turns) { // Use LLM to compress 20 turns into a 100 character context injection return llmClient.summarizeWithLimits(turns, 100); } } } </CodeBlockToggle> </TabItem> </Tabs> ## Operational safety checklist - **Configure Fallbacks**: Configure fallback response rows for UNKNOWN / ANY . - **Phase Targeting**: Do not depend on one rule only; cleanly separate constraints into PRE_EVAL , EVAL , and POST_EVAL rule phases. - **Priority Bounds**: Verify pending-action catalog priorities to avoid ambiguous execution hooks during interaction policy overlaps. - **Guardrails**: Monitor the ce_audit log for GUARDRAIL_VIOLATION to track potential malicious end-user prompt injection. - **Strict Bounds**: Enable state-graph validation before promoting a new flow to production. ## Regression strategy Use ConversationReplayService to replay scripted turns and assert the expected variables at each turn. <CodeBlockToggle title=\\"ConversationReplayService assertion\\" language=\\"java\\" filePath=\\"src/test/java/com/zapper/RegressionTests.java\\"> { @Test public void testShippingFlow() { ReplayResult finalTurn = replayService.runScript(\\"shipping_confirmation_script.json\\"); assertEquals(\\"SHIPPING_CONFIRMED\\", finalTurn.getFinalIntent()); assertEquals(\\"EXECUTE_PENDING_ACTION\\", finalTurn.getAuditStages().getLastSystemAction()); } } </CodeBlockToggle>","excerpt":", data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , , , ]; v2x1: , v2x2: , v2x3: , v2x4: , v2x5: , v2x6: , v2x7: , v2x8: , }; Developer Guide This page is the full impleme\u2026"},{"id":"deep-dive/examples.mdx","version":"v2","title":"examples","permalink":"/docs/v2/deep-dive/examples","content":"Real World Examples This page is intentionally dense. Each flow is shown as: 1. Chat transcript 2. Per turn step trace (what executed and why) 3. Required control plane rows ( ce_ ) 4. Audit timeline with payload level checkpoints Example 1: FAQ (informational path) How do I transfer my electricity connection? Share customerId, phone, email, source city, and target city. Then confirm to submit transfer. InteractionPolicyStep sees no pending_action signal and does not produce EXECUTE_PENDING_ACTION . The turn continues as a regular intent resolution flow. }\\\\\\\\nFAQ context: }\\\\\\\\nReturn short helpful answer.\', 0.10, true); INSERT INTO ce_response (intent_code, state_code, output_format, response_type, derivation_hint, priority, enabled) VALUES (\'FAQ\', \'IDLE\', \'TEXT\', \'DERIVED\', \'Answer FAQ using available context and user question.\', 10, true); } , \\"userText\\": \\"How do I transfer my electricity connection?\\", \\"dialogueAct\\": \\"QUESTION\\", \\"dialogueActConfidence\\": 0.70, \\"dialogueActSource\\": \\"REGEX\\" } } , \\"dialogueAct\\": \\"QUESTION\\", \\"policyDecision\\": \\"RECLASSIFY_INTENT\\", \\"skipIntentResolution\\": false, \\"hasPendingAction\\": false, \\"hasPendingSlot\\": false } } Example 2: CONNECTION_TRANSFER (multi turn + confirmation + pending action) Move my electricity connection from City1 to City2. Please provide customerId, phone, email, sourceCity, and targetCity. customerId 9912, phone 9988776655, email user@zapper.com, sourceCity City1, targetCity City2 Do you want to move this connection right away? yes please Connection transfer request submitted successfully. COLLECT_INPUTS\\", \\"Bootstrap collection state\\"], [\\"ResponseResolutionStep\\", \\"ask for required fields\\", \\"Prompt user for missing slots\\"], ]} / AWAITING_CONFIRMATION\\", \\"User must confirm execution\\"], [\\"ResponseResolutionStep\\", \\"confirmation prompt\\", \\"\\"], ]} / IN_PROGRESS\\", \\"Runtime status tracked in context\\"], [\\"4\\", \\"DisambiguationStep\\", \\"not required\\", \\"Single eligible action\\"], [\\"5\\", \\"GuardrailStep\\", \\"ALLOW\\", \\"No sensitive/approval block\\"], [\\"6\\", \\"PendingActionStep\\", \\"EXECUTED\\", \\"Task bean/method invoked from ce_pending_action\\"], [\\"7\\", \\"RulesStep\\", \\"AWAITING_CONFIRMATION COMPLETED\\", \\"Final state transition\\"], [\\"8\\", \\"ResponseResolutionStep\\", \\"success response\\", \\"User receives completion\\"], ]} / , \\"policyDecision\\": \\"EXECUTE_PENDING_ACTION\\", \\"pendingActionRef\\": \\"faqRuleTask:injectContainerData\\", \\"pendingActionResult\\": \\"EXECUTED\\", \\"intent\\": \\"CONNECTION_TRANSFER\\", \\"state\\": \\"AWAITING_CONFIRMATION\\" } } , \\"rulePhase\\": \\"PRE_RESPONSE_RESOLUTION\\", \\"intent\\": \\"CONNECTION_TRANSFER\\", \\"ruleStateCode\\": \\"AWAITING_CONFIRMATION\\", \\"action\\": \\"SET_STATE\\", \\"actionValue\\": \\"COMPLETED\\" } } If user says \\"yes\\" but flow loops back to confirmation, check in order: 1) DIALOGUE_ACT_CLASSIFIED must be AFFIRM 2) INTERACTION_POLICY_DECIDED must be EXECUTE_PENDING_ACTION 3) PENDING_ACTION_EXECUTED must exist 4) RULE_APPLIED must transition state from AWAITING_CONFIRMATION to terminal state. Example 3: ORDER_CANCELLATION (multi turn with interaction policy) Cancel my shoe order. I can help you cancel your order. What is your order number? It\'s 48392. Are you sure you want to cancel order 48392? This action is irreversible. Yes please do that. Order 48392 has been completely cancelled. },\\"required\\":[\\"orderNumber\\"]}\', true); INSERT INTO ce_prompt_template (intent_code, response_type, system_prompt, enabled) VALUES (\'CANCEL_ORDER\', \'SCHEMA_COLLECTION\', \'Extract JSON schema fields.\', true); INSERT INTO ce_rule (phase, intent_code, rule_type, action, priority, enabled) VALUES (\'POST_EVAL\', \'CANCEL_ORDER\', \'CONDITION\', \'TRANSITION_STATE:CONFIRM_CANCEL\', 10, true); INSERT INTO ce_response (intent_code, state_code, response_type, exact_text, enabled) VALUES (\'CANCEL_ORDER\', \'IDLE\', \'EXACT\', \'I can help you cancel your order. What is your order number?\', true); INSERT INTO ce_prompt_template (intent_code, response_type, system_prompt, user_prompt, template_id, enabled) VALUES (\'CANCEL_ORDER\', \'DERIVED\', \'Format order number cleanly.\', \'Are you sure you want to cancel order }? This action is irreversible.\', \'tmpl_confirm_cancel\', true); INSERT INTO ce_response (intent_code, state_code, response_type, template_id, enabled) VALUES (\'CANCEL_ORDER\', \'CONFIRM_CANCEL\', \'DERIVED\', \'tmpl_confirm_cancel\', true); INSERT INTO ce_pending_action (intent_code, state_code, action_name, expiration_turns, priority, enabled) VALUES (\'CANCEL_ORDER\', \'CONFIRM_CANCEL\', \'stripeCancelTask\', 3, 10, true); INSERT INTO ce_rule (phase, intent_code, rule_type, action, priority, enabled) VALUES (\'POST_EVAL\', \'CANCEL_ORDER\', \'CONDITION\', \'TRANSITION_STATE:CANCELLED\', 10, true); INSERT INTO ce_prompt_template (intent_code, response_type, system_prompt, user_prompt, template_id, enabled) VALUES (\'CANCEL_ORDER\', \'DERIVED\', \'Format cleanly.\', \'Order } has been completely cancelled.\', \'tmpl_cancelled\', true); INSERT INTO ce_response (intent_code, state_code, response_type, template_id, enabled) VALUES (\'CANCEL_ORDER\', \'CANCELLED\', \'DERIVED\', \'tmpl_cancelled\', true); } , \\"policyDecision\\": \\"EXECUTE_PENDING_ACTION\\", \\"pendingActionRef\\": \\"stripeCancelTask\\", \\"pendingActionResult\\": \\"EXECUTED\\", \\"intent\\": \\"CANCEL_ORDER\\", \\"state\\": \\"CONFIRM_CANCEL\\" } } Example 4: INVENTORY_LOOKUP (Tool Orchestration) How many running shoes are left in warehouse B? Checking the inventory database... [System delay executing Tool] We currently have 421 units of running shoes allocated to warehouse B. }\', \'tmpl_inventory_gen\', true); INSERT INTO ce_response (intent_code, state_code, response_type, template_id, priority, enabled) VALUES (\'DATABASE_QUERY\', \'IDLE\', \'DERIVED\', \'tmpl_inventory_gen\', 10, true); } Example 5: SUPPORT_DIAGNOSTIC (Memory Summarization) My router is broken. Let\'s check the lights. Are they green? [12 more dialogue turns testing different cables and lights] I suggest performing a factory reset via http://router.local/admin_reset with PIN 1234. [User is quiet for minutes] [Turn 15]: Wait, what link did you tell me to use for the firmware reset again? Based on our previous troubleshooting, you should use http://router.local/admin_reset with the default PIN 1234.","rawContent":"# Real World Examples This page is intentionally dense. Each flow is shown as: 1. Chat transcript 2. Per-turn step trace (what executed and why) 3. Required control-plane rows ( ce_* ) 4. Audit timeline with payload-level checkpoints ## Example 1: FAQ (informational path) <Tabs groupId=\\"v2-faq-deep\\"> <TabItem value=\\"chat\\" label=\\"Chat Transcript\\" default> <Conversation title=\\"FAQ conversation\\"> <User info={[\\"Informational FAQ request.\\", \\"No pending action path required.\\"]}>How do I transfer my electricity connection?</User> <Assistant tables={[\\"ce_intent\\", \\"ce_intent_classifier\\", \\"ce_response\\"]} info={[\\"Intent=FAQ.\\", \\"FAQ response returned from configured mapping.\\"]}>Share customerId, phone, email, source city, and target city. Then confirm to submit transfer.</Assistant> </Conversation> <DbTable title=\\"Intent and state outcome\\" columns={[\\"Field\\", \\"Expected value\\", \\"Why\\"]} rows={[ [\\"intent\\", \\"FAQ\\", \\"Classifier matches informational query language\\"], [\\"state\\", \\"IDLE\\", \\"No slot collection / no pending action required\\"], [\\"responseType\\", \\"DERIVED (TEXT)\\", \\"FAQ answer generated from prompt/context\\"], ]} /> </TabItem> <TabItem value=\\"trace\\" label=\\"Per-turn Step Trace\\"> <DbTable title=\\"Turn T1 runtime trace\\" columns={[\\"Order\\", \\"Step\\", \\"Input facts\\", \\"Output facts\\"]} rows={[ [\\"1\\", \\"LoadOrCreateConversationStep\\", \\"conversationId present or new\\", \\"session opened/hydrated\\"], [\\"1a\\", \\"CacheInspectAuditStep\\", \\"cache-inspector enabled\\", \\"CACHE_INSPECTION audit row (conditional)\\"], [\\"2\\", \\"AuditUserInputStep\\", \\"raw user text\\", \\"USER_INPUT audit row\\"], [\\"3\\", \\"DialogueActStep\\", \\"question sentence\\", \\"dialogue_act=QUESTION\\"], [\\"4\\", \\"InteractionPolicyStep\\", \\"no pending_action, no pending_slot\\", \\"policy_decision=RECLASSIFY_INTENT\\"], [\\"5\\", \\"IntentResolutionStep\\", \\"classifiers + agent hints\\", \\"intent=FAQ, state=IDLE\\"], [\\"6\\", \\"SchemaExtractionStep\\", \\"FAQ schema (light)\\", \\"schema facts available\\"], [\\"7\\", \\"RulesStep\\", \\"no FAQ rule action\\", \\"RULE_NO_MATCH or no mutation\\"], [\\"8\\", \\"ResponseResolutionStep\\", \\"FAQ response row + prompt\\", \\"assistant output prepared\\"], [\\"9\\", \\"MemoryStep\\", \\"recent turn context\\", \\"memory_session_summary\\"], [\\"10\\", \\"PersistConversationStep\\", \\"final session\\", \\"conversation/audit persisted\\"], ]} /> <Highlight type=\\"info\\" title=\\"Why no pending-action path here\\"> InteractionPolicyStep sees no pending_action signal and does not produce EXECUTE_PENDING_ACTION . The turn continues as a regular intent-resolution flow. </Highlight> </TabItem> <TabItem value=\\"db\\" label=\\"Required ce_* Rows\\"> <DbTable title=\\"Minimum rows required for FAQ flow\\" columns={[\\"Table\\", \\"Required row shape\\", \\"Used by\\"]} rows={[ [\\"ce_intent\\", \\"intent_code=FAQ\\", \\"IntentResolutionStep\\"], [\\"ce_intent_classifier\\", \\"intent_code=FAQ, rule_type=REGEX\\", \\"IntentResolutionStep\\"], [\\"ce_prompt_template\\", \\"intent_code=FAQ, response_type=TEXT\\", \\"ResponseResolutionStep (DERIVED)\\"], [\\"ce_response\\", \\"intent_code=FAQ, state_code=IDLE\\", \\"ResponseResolutionStep\\"], [\\"ce_container_config\\", \\"intent_code=FAQ (optional context source)\\", \\"AddContainerDataStep\\"], [\\"ce_config\\", \\"AgentIntentResolver + SchemaExtractionStep prompt keys\\", \\"Intent/Schema steps\\"], ]} /> <CodeBlockToggle title=\\"FAQ seed snippet\\" language=\\"sql\\"> { INSERT INTO ce_intent (intent_code, description, priority, enabled) VALUES (\'FAQ\', \'Answer informational questions from FAQ knowledge base\', 10, true); INSERT INTO ce_intent_classifier (intent_code, rule_type, pattern, priority, enabled) VALUES (\'FAQ\', \'REGEX\', \'(?i)\\\\\\\\b(what|how|help|faq|information|details|explain)\\\\\\\\b\', 10, true); INSERT INTO ce_prompt_template (intent_code, state_code, response_type, system_prompt, user_prompt, temperature, enabled) VALUES (\'FAQ\', \'IDLE\', \'TEXT\', \'You are a concise FAQ assistant. Answer directly and clearly.\', \'User question: {{user_input}}\\\\\\\\nFAQ context: {{container_data}}\\\\\\\\nReturn short helpful answer.\', 0.10, true); INSERT INTO ce_response (intent_code, state_code, output_format, response_type, derivation_hint, priority, enabled) VALUES (\'FAQ\', \'IDLE\', \'TEXT\', \'DERIVED\', \'Answer FAQ using available context and user question.\', 10, true); } </CodeBlockToggle> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit + Payload Postmortem\\"> <DbTable title=\\"Expected audit stages (ordered)\\" columns={[\\"Order\\", \\"Stage\\", \\"Must contain\\"]} rows={[ [\\"1\\", \\"USER_INPUT\\", \\"original user message\\"], [\\"2\\", \\"DIALOGUE_ACT_CLASSIFIED\\", \\"dialogueAct=QUESTION\\"], [\\"3\\", \\"INTERACTION_POLICY_DECIDED\\", \\"policyDecision=RECLASSIFY_INTENT\\"], [\\"4\\", \\"INTENT_RESOLVED_BY_*\\", \\"intent=FAQ\\"], [\\"5\\", \\"RESOLVE_RESPONSE_SELECTED\\", \\"responseType=DERIVED\\"], [\\"6\\", \\"ASSISTANT_OUTPUT\\", \\"output text or json payload\\"], [\\"7\\", \\"MEMORY_UPDATED\\", \\"summaryChars/recalled flags\\"], ]} /> <CodeBlockToggle title=\\"Audit payload checkpoint: DIALOGUE_ACT_CLASSIFIED\\" language=\\"json\\"> { { \\"_meta\\": { \\"stage\\": \\"DIALOGUE_ACT_CLASSIFIED\\" }, \\"userText\\": \\"How do I transfer my electricity connection?\\", \\"dialogueAct\\": \\"QUESTION\\", \\"dialogueActConfidence\\": 0.70, \\"dialogueActSource\\": \\"REGEX\\" } } </CodeBlockToggle> <CodeBlockToggle title=\\"Audit payload checkpoint: INTERACTION_POLICY_DECIDED\\" language=\\"json\\"> { { \\"_meta\\": { \\"stage\\": \\"INTERACTION_POLICY_DECIDED\\" }, \\"dialogueAct\\": \\"QUESTION\\", \\"policyDecision\\": \\"RECLASSIFY_INTENT\\", \\"skipIntentResolution\\": false, \\"hasPendingAction\\": false, \\"hasPendingSlot\\": false } } </CodeBlockToggle> </TabItem> </Tabs> ## Example 2: CONNECTION_TRANSFER (multi-turn + confirmation + pending action) <Tabs groupId=\\"v2-transfer-deep\\"> <TabItem value=\\"chat\\" label=\\"Chat Transcript\\" default> <Conversation title=\\"Connection transfer conversation\\"> <User info={[\\"Initial transfer request.\\", \\"State expected to move to collection mode.\\"]}>Move my electricity connection from City1 to City2.</User> <Assistant tables={[\\"ce_output_schema\\"]} info={[\\"Required fields are missing.\\", \\"Assistant prompts for slots.\\"]}>Please provide customerId, phone, email, sourceCity, and targetCity.</Assistant> <User info={[\\"All required fields provided.\\", \\"Schema should become complete.\\"]}>customerId 9912, phone 9988776655, email user@zapper.com, sourceCity City1, targetCity City2</User> <Assistant tables={[\\"ce_rule\\", \\"ce_pending_action\\"]} info={[\\"Transition to AWAITING_CONFIRMATION.\\", \\"Pending action staged.\\"]}>Do you want to move this connection right away?</Assistant> <User info={[\\"AFFIRM dialogue act.\\", \\"Policy should execute pending action.\\"]}>yes please</User> <Assistant tables={[\\"ce_audit\\", \\"ce_response\\"]} info={[\\"Pending action executed.\\", \\"Final completion response emitted.\\"]}>Connection transfer request submitted successfully.</Assistant> </Conversation> </TabItem> <TabItem value=\\"trace\\" label=\\"Per-turn Step Trace\\"> <DbTable title=\\"Turn T1 (initial request)\\" columns={[\\"Step\\", \\"Key output\\", \\"Notes\\"]} rows={[ [\\"IntentResolutionStep\\", \\"intent=CONNECTION_TRANSFER\\", \\"Classifier picks transfer intent\\"], [\\"SchemaExtractionStep\\", \\"missing fields computed\\", \\"Required slots are incomplete\\"], [\\"RulesStep\\", \\"state -> COLLECT_INPUTS\\", \\"Bootstrap collection state\\"], [\\"ResponseResolutionStep\\", \\"ask for required fields\\", \\"Prompt user for missing slots\\"], ]} /> <DbTable title=\\"Turn T2 (slot fill)\\" columns={[\\"Step\\", \\"Key output\\", \\"Notes\\"]} rows={[ [\\"SchemaExtractionStep\\", \\"customerId/phone/email/sourceCity/targetCity extracted\\", \\"Schema complete\\"], [\\"RulesStep\\", \\"COLLECT_INPUTS -> AWAITING_CONFIRMATION\\", \\"User must confirm execution\\"], [\\"ResponseResolutionStep\\", \\"confirmation prompt\\", \\"\\"], ]} /> <DbTable title=\\"Turn T3 (affirm)\\" columns={[\\"Order\\", \\"Step\\", \\"Key output\\", \\"Why it matters\\"]} rows={[ [\\"1\\", \\"DialogueActStep\\", \\"AFFIRM\\", \\"Converts \'yes please\' into execution signal\\"], [\\"2\\", \\"InteractionPolicyStep\\", \\"EXECUTE_PENDING_ACTION\\", \\"Policy routes to pending action\\"], [\\"3\\", \\"ActionLifecycleStep\\", \\"OPEN -> IN_PROGRESS\\", \\"Runtime status tracked in context\\"], [\\"4\\", \\"DisambiguationStep\\", \\"not required\\", \\"Single eligible action\\"], [\\"5\\", \\"GuardrailStep\\", \\"ALLOW\\", \\"No sensitive/approval block\\"], [\\"6\\", \\"PendingActionStep\\", \\"EXECUTED\\", \\"Task bean/method invoked from ce_pending_action\\"], [\\"7\\", \\"RulesStep\\", \\"AWAITING_CONFIRMATION -> COMPLETED\\", \\"Final state transition\\"], [\\"8\\", \\"ResponseResolutionStep\\", \\"success response\\", \\"User receives completion\\"], ]} /> </TabItem> <TabItem value=\\"db\\" label=\\"Required ce_* Rows\\"> <DbTable title=\\"Control-plane requirements\\" columns={[\\"Table\\", \\"Must have\\", \\"Consumed by\\"]} rows={[ [\\"ce_intent\\", \\"CONNECTION_TRANSFER\\", \\"IntentResolutionStep\\"], [\\"ce_intent_classifier\\", \\"transfer/move regex\\", \\"IntentResolutionStep\\"], [\\"ce_output_schema\\", \\"required slots for transfer\\", \\"SchemaExtractionStep\\"], [\\"ce_rule\\", \\"state bootstrap + completeness + completion rules\\", \\"RulesStep\\"], [\\"ce_pending_action\\", \\"action_key + bean_name + method_names\\", \\"ActionLifecycleStep/PendingActionStep\\"], [\\"ce_response\\", \\"COLLECT_INPUTS, AWAITING_CONFIRMATION, COMPLETED responses\\", \\"ResponseResolutionStep\\"], [\\"ce_config\\", \\"dialogue/prompt keys\\", \\"DialogueActStep/Schema steps\\"], [\\"ce_policy\\", \\"optional policy blocks\\", \\"PolicyEnforcementStep\\"], ]} /> <CodeBlockToggle title=\\"Seed snippet: pending action + rules\\" language=\\"sql\\"> { INSERT INTO ce_pending_action (intent_code, state_code, action_key, bean_name, method_names, priority, enabled, description) VALUES (\'CONNECTION_TRANSFER\', \'AWAITING_CONFIRMATION\', \'FINALIZE_CONNECTION_TRANSFER\', \'faqRuleTask\', \'injectContainerData\', 1, true, \'Demo finalize action for connection transfer\'); INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, \\"action\\", action_value, priority, enabled) VALUES (\'PRE_RESPONSE_RESOLUTION\', \'CONNECTION_TRANSFER\', \'IDLE\', \'REGEX\', \'.*\', \'SET_STATE\', \'COLLECT_INPUTS\', 10, true), (\'PRE_RESPONSE_RESOLUTION\', \'CONNECTION_TRANSFER\', \'COLLECT_INPUTS\', \'JSON_PATH\', \'$[?(@.state == \'\'COLLECT_INPUTS\'\' && @.customerId && @.phone && @.email && @.sourceCity && @.targetCity)]\', \'SET_STATE\', \'AWAITING_CONFIRMATION\', 100, true), (\'PRE_RESPONSE_RESOLUTION\', \'CONNECTION_TRANSFER\', \'AWAITING_CONFIRMATION\', \'JSON_PATH\', \'$[?(@.state == \'\'AWAITING_CONFIRMATION\'\' && (@.pending_action_result == \'\'EXECUTED\'\' || @.inputParams.pending_action_result == \'\'EXECUTED\'\'))]\', \'SET_STATE\', \'COMPLETED\', 200, true); } </CodeBlockToggle> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit + Payload Postmortem\\"> <DbTable title=\\"Confirmation turn audit chain (must appear in order)\\" columns={[\\"Order\\", \\"Stage\\", \\"Payload keys to verify\\"]} rows={[ [\\"1\\", \\"DIALOGUE_ACT_CLASSIFIED\\", \\"dialogueAct=AFFIRM, confidence, source\\"], [\\"2\\", \\"INTERACTION_POLICY_DECIDED\\", \\"policyDecision=EXECUTE_PENDING_ACTION\\"], [\\"3\\", \\"PENDING_ACTION_LIFECYCLE\\", \\"status=IN_PROGRESS\\"], [\\"4\\", \\"GUARDRAIL_ALLOW\\", \\"result=ALLOW\\"], [\\"5\\", \\"PENDING_ACTION_EXECUTED\\", \\"pendingActionResult=EXECUTED\\"], [\\"6\\", \\"RULE_APPLIED\\", \\"state transition to COMPLETED\\"], [\\"7\\", \\"ASSISTANT_OUTPUT\\", \\"final completion response\\"], [\\"8\\", \\"MEMORY_UPDATED\\", \\"summary updated\\"], ]} /> <CodeBlockToggle title=\\"Audit payload checkpoint: PENDING_ACTION_EXECUTED\\" language=\\"json\\"> { { \\"_meta\\": { \\"stage\\": \\"PENDING_ACTION_EXECUTED\\" }, \\"policyDecision\\": \\"EXECUTE_PENDING_ACTION\\", \\"pendingActionRef\\": \\"faqRuleTask:injectContainerData\\", \\"pendingActionResult\\": \\"EXECUTED\\", \\"intent\\": \\"CONNECTION_TRANSFER\\", \\"state\\": \\"AWAITING_CONFIRMATION\\" } } </CodeBlockToggle> <CodeBlockToggle title=\\"Audit payload checkpoint: RULE_APPLIED after execution\\" language=\\"json\\"> { { \\"_meta\\": { \\"stage\\": \\"RULE_APPLIED\\" }, \\"rulePhase\\": \\"PRE_RESPONSE_RESOLUTION\\", \\"intent\\": \\"CONNECTION_TRANSFER\\", \\"ruleStateCode\\": \\"AWAITING_CONFIRMATION\\", \\"action\\": \\"SET_STATE\\", \\"actionValue\\": \\"COMPLETED\\" } } </CodeBlockToggle> <Highlight type=\\"success\\" title=\\"Fast failure triage\\"> If user says \\"yes\\" but flow loops back to confirmation, check in order: 1) DIALOGUE_ACT_CLASSIFIED must be AFFIRM 2) INTERACTION_POLICY_DECIDED must be EXECUTE_PENDING_ACTION 3) PENDING_ACTION_EXECUTED must exist 4) RULE_APPLIED must transition state from AWAITING_CONFIRMATION to terminal state. </Highlight> </TabItem> </Tabs> ## Example 3: ORDER_CANCELLATION (multi-turn with interaction policy) <Tabs groupId=\\"v2-cancel-deep\\"> <TabItem value=\\"chat\\" label=\\"Chat Transcript\\" default> <Conversation title=\\"Protected Order Cancellation\\"> <User info={[\\"Cancellation intent request.\\", \\"Order number not yet present.\\"]}>Cancel my shoe order.</User> <Assistant tables={[\\"ce_output_schema\\", \\"ce_response\\"]} info={[\\"Missing field follow-up.\\", \\"Collect orderNumber before confirm step.\\"]}>I can help you cancel your order. What is your order number?</Assistant> <User info={[\\"Provides required orderNumber.\\", \\"Unlocks confirmation stage.\\"]}>It\'s 48392.</User> <Assistant tables={[\\"ce_rule\\", \\"ce_pending_action\\"]} info={[\\"Awaiting explicit confirmation.\\", \\"Pending action in OPEN/IN_PROGRESS path.\\"]}>Are you sure you want to cancel order 48392? This action is irreversible.</Assistant> <User info={[\\"AFFIRM turn.\\", \\"Interaction policy decides EXECUTE_PENDING_ACTION.\\"]}>Yes please do that.</User> <Assistant tables={[\\"ce_audit\\", \\"ce_response\\"]} info={[\\"Action executed and state transitioned.\\", \\"Cancellation response returned.\\"]}>Order 48392 has been completely cancelled.</Assistant> </Conversation> </TabItem> <TabItem value=\\"trace\\" label=\\"Per-turn Step Trace\\"> <DbTable title=\\"Action Policy Trace\\" columns={[\\"Turn\\", \\"Pipeline Step\\", \\"Internal Engine Action\\"]} rows={[ [\\"Turn 1\\", \\"SchemaExtractionStep\\", \\"Detects CANCEL_ORDER . Fails to extract orderNumber . State remains IDLE .\\"], [\\"Turn 1\\", \\"ResponseResolutionStep\\", \\"Outputs IDLE message asking for order number.\\"], [\\"Turn 2\\", \\"SchemaExtractionStep\\", \\"Engine extracts orderNumber: 48392 . Flags schemaComplete=true .\\"], [\\"Turn 2\\", \\"RulesStep\\", \\"Auto-advance rule fires, transitioning state to CONFIRM_CANCEL .\\"], [\\"Turn 2\\", \\"ActionLifecycleStep\\", \\"Stages stripeCancelTask into pending_action_runtime context with OPEN status.\\"], [\\"Turn 2\\", \\"ResponseResolutionStep\\", \\"Generates derived string parsing the memory context orderNumber .\\"], [\\"Turn 3\\", \\"DialogueActStep\\", \\"User says \'Yes\'. Act classifier marks input as AFFIRM .\\"], [\\"Turn 3\\", \\"InteractionPolicyStep\\", \\"Matrix outputs EXECUTE_PENDING_ACTION . Locks classifier logic.\\"], [\\"Turn 3\\", \\"GuardrailStep\\", \\"Checks patterns for malicious prompt. Trace output: GUARDRAIL_ALLOW .\\"], [\\"Turn 3\\", \\"PendingActionStep\\", \\"Execution triggered. External API drops order. Status updated to EXECUTED .\\"], [\\"Turn 3\\", \\"RulesStep\\", \\"Rule sees EXECUTED task status and triggers state transition to CANCELLED .\\"], [\\"Turn 3\\", \\"ResponseResolutionStep\\", \\"Resolves final derived string using historical orderNumber .\\"] ]} /> </TabItem> <TabItem value=\\"db\\" label=\\"Required ce_* Rows\\"> <CodeBlockToggle title=\\"Dynamic Slot & Task DML\\" language=\\"sql\\" defaultOpen={true}> { INSERT INTO ce_intent (intent_code, enabled) VALUES (\'CANCEL_ORDER\', true); INSERT INTO ce_output_schema (intent_code, format_type, schema_json, enabled) VALUES (\'CANCEL_ORDER\', \'JSON\', \'{\\"type\\":\\"object\\",\\"properties\\":{\\"orderNumber\\":{\\"type\\":\\"string\\"}},\\"required\\":[\\"orderNumber\\"]}\', true); INSERT INTO ce_prompt_template (intent_code, response_type, system_prompt, enabled) VALUES (\'CANCEL_ORDER\', \'SCHEMA_COLLECTION\', \'Extract JSON schema fields.\', true); INSERT INTO ce_rule (phase, intent_code, rule_type, action, priority, enabled) VALUES (\'POST_EVAL\', \'CANCEL_ORDER\', \'CONDITION\', \'TRANSITION_STATE:CONFIRM_CANCEL\', 10, true); INSERT INTO ce_response (intent_code, state_code, response_type, exact_text, enabled) VALUES (\'CANCEL_ORDER\', \'IDLE\', \'EXACT\', \'I can help you cancel your order. What is your order number?\', true); INSERT INTO ce_prompt_template (intent_code, response_type, system_prompt, user_prompt, template_id, enabled) VALUES (\'CANCEL_ORDER\', \'DERIVED\', \'Format order number cleanly.\', \'Are you sure you want to cancel order {{context.orderNumber}}? This action is irreversible.\', \'tmpl_confirm_cancel\', true); INSERT INTO ce_response (intent_code, state_code, response_type, template_id, enabled) VALUES (\'CANCEL_ORDER\', \'CONFIRM_CANCEL\', \'DERIVED\', \'tmpl_confirm_cancel\', true); INSERT INTO ce_pending_action (intent_code, state_code, action_name, expiration_turns, priority, enabled) VALUES (\'CANCEL_ORDER\', \'CONFIRM_CANCEL\', \'stripeCancelTask\', 3, 10, true); INSERT INTO ce_rule (phase, intent_code, rule_type, action, priority, enabled) VALUES (\'POST_EVAL\', \'CANCEL_ORDER\', \'CONDITION\', \'TRANSITION_STATE:CANCELLED\', 10, true); INSERT INTO ce_prompt_template (intent_code, response_type, system_prompt, user_prompt, template_id, enabled) VALUES (\'CANCEL_ORDER\', \'DERIVED\', \'Format cleanly.\', \'Order {{context.orderNumber}} has been completely cancelled.\', \'tmpl_cancelled\', true); INSERT INTO ce_response (intent_code, state_code, response_type, template_id, enabled) VALUES (\'CANCEL_ORDER\', \'CANCELLED\', \'DERIVED\', \'tmpl_cancelled\', true); } </CodeBlockToggle> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit + Payload Postmortem\\"> <DbTable title=\\"Confirmation turn audit chain\\" columns={[\\"Order\\", \\"Stage\\", \\"Must contain\\"]} rows={[ [\\"1\\", \\"DIALOGUE_ACT_CLASSIFIED\\", \\"dialogueAct=AFFIRM\\"], [\\"2\\", \\"INTERACTION_POLICY_DECIDED\\", \\"policyDecision=EXECUTE_PENDING_ACTION\\"], [\\"3\\", \\"GUARDRAIL_ALLOW\\", \\"result=ALLOW\\"], [\\"4\\", \\"PENDING_ACTION_EXECUTED\\", \\"pendingActionResult=EXECUTED\\"], [\\"5\\", \\"RULE_APPLIED\\", \\"state transition to CANCELLED\\"], [\\"6\\", \\"ASSISTANT_OUTPUT\\", \\"final response\\"] ]} /> <CodeBlockToggle title=\\"Audit payload checkpoint: PENDING_ACTION_EXECUTED\\" language=\\"json\\"> { { \\"_meta\\": { \\"stage\\": \\"PENDING_ACTION_EXECUTED\\" }, \\"policyDecision\\": \\"EXECUTE_PENDING_ACTION\\", \\"pendingActionRef\\": \\"stripeCancelTask\\", \\"pendingActionResult\\": \\"EXECUTED\\", \\"intent\\": \\"CANCEL_ORDER\\", \\"state\\": \\"CONFIRM_CANCEL\\" } } </CodeBlockToggle> </TabItem> </Tabs> ## Example 4: INVENTORY_LOOKUP (Tool Orchestration) <Tabs groupId=\\"v2-inventory-deep\\"> <TabItem value=\\"chat\\" label=\\"Chat Transcript\\" default> <Conversation title=\\"DB Orchestration Flow\\"> <User info={[\\"Inventory question needing tool/data call.\\", \\"Intent resolves to DATABASE_QUERY flow.\\"]}>How many running shoes are left in warehouse B?</User> <Assistant tables={[\\"ce_mcp_tool\\"]} info={[\\"Tool dispatch started.\\", \\"Waiting for adapter/tool result.\\"]}>Checking the inventory database...</Assistant> <User info={[\\"Represents in-flight tool call latency.\\", \\"No state mutation by user here.\\"]}>*[System delay executing Tool]*</User> <Assistant tables={[\\"ce_audit\\", \\"ce_response\\"]} info={[\\"tool_result consumed by response derivation.\\", \\"Final count rendered for user.\\"]}>We currently have 421 units of running shoes allocated to warehouse B.</Assistant> </Conversation> </TabItem> <TabItem value=\\"trace\\" label=\\"Per-turn Step Trace\\"> <DbTable title=\\"Tool Dispatch Trace\\" columns={[\\"Pipeline Step\\", \\"Internal Engine Action\\"]} rows={[ [\\"IntentResolutionStep\\", \\"Detects DATABASE_QUERY intent. State= IDLE .\\"], [\\"ToolOrchestrationStep\\", \\"Identifies INVENTORY_DB mapping. Routes payload to connected Java component adapting McpToolExecutor .\\"], [\\"Tool Execution (Java Adapter)\\", \\"Adapter processes input, runs SELECT count FROM inventory . Returns JSON payload {\'count\': 421} .\\"], [\\"ToolOrchestrationStep\\", \\"Writes returned JSON into engine session variable tool_result.dbList . Traces TOOL_ORCHESTRATION_RESULT .\\"], [\\"RulesStep\\", \\"Evaluates optional POST_TOOL_EXECUTION rules.\\"], [\\"ResponseResolutionStep\\", \\"Injects the 421 count into the derived template context and calls LLM.\\"] ]} /> </TabItem> <TabItem value=\\"db\\" label=\\"Required ce_* Rows\\"> <CodeBlockToggle title=\\"Tool Orchestration DML\\" language=\\"sql\\" defaultOpen={true}> { INSERT INTO ce_intent (intent_code, enabled) VALUES (\'DATABASE_QUERY\', true); INSERT INTO ce_mcp_tool (intent_code, tool_group, required_params_json, execution_timeout_ms, enabled) VALUES (\'DATABASE_QUERY\', \'INVENTORY_DB\', \'[\\"itemType\\", \\"warehouseId\\"]\', 5000, true); INSERT INTO ce_prompt_template (intent_code, response_type, system_prompt, user_prompt, template_id, enabled) VALUES (\'DATABASE_QUERY\', \'DERIVED\', \'You are an inventory assistant.\', \'Answer from these database results: {{tool_result.dbList}}\', \'tmpl_inventory_gen\', true); INSERT INTO ce_response (intent_code, state_code, response_type, template_id, priority, enabled) VALUES (\'DATABASE_QUERY\', \'IDLE\', \'DERIVED\', \'tmpl_inventory_gen\', 10, true); } </CodeBlockToggle> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit + Payload Postmortem\\"> <DbTable title=\\"Tool Orchestration Checkpoints\\" columns={[\\"Order\\", \\"Stage\\", \\"Payload details\\"]} rows={[ [\\"1\\", \\"TOOL_ORCHESTRATION_DISPATCH\\", \\"toolGroup=INVENTORY_DB, toolParams\\"], [\\"2\\", \\"TOOL_ORCHESTRATION_RESULT\\", \\"toolResult={\'count\': 421}, executionMs\\"], [\\"3\\", \\"ASSISTANT_OUTPUT\\", \\"final response interpolation\\"] ]} /> </TabItem> </Tabs> ## Example 5: SUPPORT_DIAGNOSTIC (Memory Summarization) <Tabs groupId=\\"v2-support-deep\\"> <TabItem value=\\"chat\\" label=\\"Chat Transcript\\" default> <Conversation title=\\"Long Context Support Thread\\"> <User info={[\\"Initial problem statement.\\", \\"Starts long troubleshooting flow.\\"]}>My router is broken.</User> <Assistant info={[\\"Assistant begins diagnostic questions.\\", \\"No tool/action execution yet.\\"]}>Let\'s check the lights. Are they green?</Assistant> <User info={[\\"Represents many intermediate turns.\\", \\"Conversation memory grows significantly.\\"]}>*[12 more dialogue turns testing different cables and lights]*</User> <Assistant tables={[\\"ce_conversation_history\\"]} info={[\\"Assistant gives reset URL and PIN.\\", \\"Critical details should be retained in memory summary.\\"]}>I suggest performing a factory reset via http://router.local/admin_reset with PIN 1234.</Assistant> <User info={[\\"Time gap before follow-up.\\", \\"Memory recall scenario.\\"]}>*[User is quiet for minutes]*</User> <User info={[\\"Late-turn recall question.\\", \\"Requires memory-assisted response.\\"]}>[Turn 15]: Wait, what link did you tell me to use for the firmware reset again?</User> <Assistant tables={[\\"ce_audit\\", \\"ce_conversation_history\\"]} info={[\\"Memory summary injected.\\", \\"Assistant recalls prior URL and PIN correctly.\\"]}>Based on our previous troubleshooting, you should use http://router.local/admin_reset with the default PIN 1234.</Assistant> </Conversation> </TabItem> <TabItem value=\\"trace\\" label=\\"Per-turn Step Trace\\"> <DbTable title=\\"Memory Compression Trace (Turn 15)\\" columns={[\\"Pipeline Step\\", \\"Internal Engine Action\\"]} rows={[ [\\"MemoryStep (Background)\\", \\"Fetches raw history and asks LLM to re-summarize it into a tight timeline snapshot. Persists to ce_memory .\\"], [\\"DialogueActStep\\", \\"User asks \'what link did you tell me to use?\'. Abstracted act= QUESTION .\\"], [\\"MemoryStep (Injection)\\", \\"Injects the compressed memory.session_summary variable directly into current Turn 15 context.\\"], [\\"IntentResolutionStep\\", \\"Resolves exact SUPPORT_DIAGNOSTIC intent leveraging memory context.\\"], [\\"ResponseResolutionStep\\", \\"Template retrieves the exact http://router.local string generated 10 turns ago.\\"] ]} /> </TabItem> <TabItem value=\\"db\\" label=\\"Required Configuration\\"> <CodeBlockToggle title=\\"Memory Auto-Summarization Config\\" language=\\"yaml\\" defaultOpen={true}> { convengine: flow: memory: enabled: true # Max token size for the compressed summary string summary-max-chars: 1200 # Number of turns to trigger a new summary compression cycle recent-turns-for-summary: 3 } </CodeBlockToggle> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit + Payload Postmortem\\"> <DbTable title=\\"Memory Checkpoints\\" columns={[\\"Order\\", \\"Stage\\", \\"Payload details\\"]} rows={[ [\\"1\\", \\"MEMORY_EVALUATED\\", \\"evaluatedTurns, previousSummaryLen\\"], [\\"2\\", \\"MEMORY_UPDATED\\", \\"newSummary generated and injected\\"], [\\"3\\", \\"INTENT_RESOLVED\\", \\"context aware resolution\\"] ]} /> </TabItem> </Tabs>","excerpt":"Real World Examples This page is intentionally dense. Each flow is shown as: 1. Chat transcript 2. Per turn step trace (what executed and why) 3. Required control plane rows ( ce_ ) 4. Audit timeline with payload level c\u2026"},{"id":"deep-dive/failure-gotchas.mdx","version":"v2","title":"failure gotchas","permalink":"/docs/v2/deep-dive/failure-gotchas","content":"Data Correctness Gotchas This page documents where ConvEngine can produce incorrect, stale, or misleading output without necessarily crashing. It also lists framework constraints and a concrete roadmap to make the system safer, easier to operate, and more scalable. High risk improper data scenarios Additional correctness traps Framework limitations (current behavior) Improvement roadmap Phase 1: Correctness hardening (highest priority) Phase 2: Convenience and developer experience Phase 3: Scalability and throughput Confirmed from repository code: state overrides from JSON output, sticky intent skip behavior, rule pass mutation loops, context merge semantics, broad prompt var exposure, no optimistic lock field on conversation entity, and findAll() hot path scans. Inferred (consumer dependent): ingress concurrency controls, infra level ordering guarantees, and custom LlmClient timeout/retry strategy.","rawContent":"# Data Correctness Gotchas This page documents where ConvEngine can produce **incorrect, stale, or misleading output** without necessarily crashing. It also lists framework constraints and a concrete roadmap to make the system safer, easier to operate, and more scalable. ## High-risk improper data scenarios <DbTable title=\\"Top correctness failure modes\\" columns={[ \\"Gotcha\\", \\"Trigger\\", \\"Bad output pattern\\", \\"Fast detection\\", \\"Practical mitigation\\" ]} rows={[ [ \\"LLM JSON overrides engine intent/state\\", \\"Response JSON includes intent or state ; resolver applies those fields directly.\\", \\"Flow silently jumps to wrong state/intent on next turn.\\", \\"Compare pre/post state around RESOLVE_RESPONSE_LLM_OUTPUT and final persisted conversation row.\\", \\"Allowlist transitions, reject unknown states, and gate model-driven state changes behind validator hooks.\\" ], [ \\"Sticky intent routes new question to old flow\\", \\" STICKY_INTENT=true + active incomplete schema collection + no explicit switch/reset signal.\\", \\"User asks new intent but gets response from previous intent templates/rules.\\", \\"Frequent INTENT_RESOLVE_SKIPPED_STICKY_INTENT on semantically new user text.\\", \\"Force re-resolve on low confidence turns, topic-shift heuristics, and explicit UI switch-intent controls.\\" ], [ \\"Rule chain side effects create wrong final state\\", \\"Multiple matching rules mutate intent/state across passes.\\", \\"Technically valid response, semantically wrong transition path.\\", \\"Inspect ordered RULE_MATCH / RULE_NO_MATCH events by pass and phase.\\", \\"Constrain rule ownership, cap cross-intent actions, and add collision regression tests for rule priority.\\" ], [ \\"Context merge preserves stale fields\\", \\"Schema extraction merges partial JSON into existing context and does not clear incompatible prior fields.\\", \\"Old values leak into later prompts and responses.\\", \\"Diff context pre/post schema extraction and check unchanged keys across intent/state changes.\\", \\"Add per-intent field reset policy and explicit stale-key eviction on transition boundaries.\\" ], [ \\"Concurrent writes race on same conversation\\", \\"Parallel requests share same conversationId with no optimistic version check.\\", \\"Last-write-wins overwrites can produce drifted context/intent/state.\\", \\"Look for overlapping timestamps and contradictory stage order for one conversation.\\", \\"Serialize by conversation key at API boundary or add optimistic locking ( @Version ).\\" ] ]} /> ## Additional correctness traps <DbTable title=\\"Less obvious but important\\" columns={[\\"Area\\", \\"What happens\\", \\"Why it matters\\", \\"Recommended guardrail\\"]} rows={[ [ \\"Prompt variable exposure\\", \\"All inputParams are exposed as prompt vars ( promptTemplateVars path).\\", \\"Unexpected/sensitive params can influence model behavior or leak into prompts.\\", \\"Move to explicit allowlist of exposable keys and redact secret-like fields.\\" ], [ \\"LLM invocation ThreadLocal lifecycle\\", \\" LlmInvocationContext.set(...) is used in several flows without matching clear in same path.\\", \\"Pooled-thread reuse can cause wrong attribution/context bleed in custom LlmClient logging.\\", \\"Wrap set/clear in try/finally in every LLM call site.\\" ], [ \\"Silent exception swallowing\\", \\"Several context/container merge failures are ignored to keep pipeline running.\\", \\"Turn completes with partial enrichment, giving plausible but incorrect output.\\", \\"Emit warning stages with structured reason and defaulted fields when fallback path is taken.\\" ], [ \\"History reconstruction quality\\", \\"Conversation history is reconstructed from audit stages (not canonical turn table).\\", \\"Missing or filtered audit events can distort LLM context history.\\", \\"Persist normalized user/assistant turn table and use that as primary history source.\\" ], [ \\"MCP tool safety assumptions\\", \\" safe_mode exists on DB tool config but execution path does not enforce separate safe-mode logic.\\", \\"Risk of over-trusting tool configuration for sensitive data queries.\\", \\"Enforce explicit read-only policy, SQL allowlist checks, and per-tool security policy validation.\\" ] ]} /> ## Framework limitations (current behavior) <DbTable title=\\"Design constraints to plan around\\" columns={[\\"Limitation\\", \\"Current behavior\\", \\"Consumer impact\\", \\"Better direction\\"]} rows={[ [ \\"No full-turn ACID boundary\\", \\"Turn state is updated across multiple independent saves/steps.\\", \\"Partial turn artifacts can persist after mid-pipeline failures.\\", \\"Introduce transactional turn boundary or compensating state machine.\\" ], [ \\"No built-in optimistic concurrency for conversation row\\", \\" ce_conversation entity has no versioned conflict detection.\\", \\"Racing requests overwrite each other nondeterministically.\\", \\"Add version column + conflict retry/merge strategy.\\" ], [ \\"Heavy dynamic config with mixed refresh model\\", \\"Some configs are read at startup; others queried per turn from DB.\\", \\"Operational behavior can be hard to reason about after config updates.\\", \\"Document refresh semantics per config and add explicit reload controls.\\" ], [ \\"In-memory scan selection paths\\", \\" findAll().stream() used in response/template/schema selection in hot path.\\", \\"Larger config tables increase latency and raise variability.\\", \\"Replace with indexed targeted queries + bounded caches.\\" ], [ \\"Single-process assumptions for ordering\\", \\"Conversation ordering and mutation safety are mostly local-process concerns.\\", \\"Horizontal scale can amplify race and ordering ambiguity.\\", \\"Adopt distributed per-conversation lock/queue semantics.\\" ] ]} /> ## Improvement roadmap ### Phase 1: Correctness hardening (highest priority) <DbTable title=\\"Immediate improvements\\" columns={[\\"Change\\", \\"Value\\", \\"Effort\\", \\"Notes\\"]} rows={[ [ \\"Add response state-transition validator\\", \\"Prevents invalid model-driven intent/state jumps.\\", \\"Low-Medium\\", \\"Apply before PersistConversationStep ; reject or quarantine invalid transitions.\\" ], [ \\"Add optimistic locking on ce_conversation \\", \\"Eliminates silent last-write-wins corruption.\\", \\"Medium\\", \\"Introduce version field + retry policy for conflict cases.\\" ], [ \\"Guarantee LlmInvocationContext.clear() \\", \\"Prevents cross-request attribution bleed.\\", \\"Low\\", \\"Wrap all LLM call sites with try/finally .\\" ], [ \\"Prompt-var allowlist + redaction\\", \\"Reduces prompt contamination and secret leakage risk.\\", \\"Low-Medium\\", \\"Replace current expose-all behavior with explicit allowlist.\\" ], [ \\"Emit structured fallback warnings\\", \\"Makes silent degradations diagnosable.\\", \\"Low\\", \\"When a catch-ignore path is hit, emit a dedicated stage with cause metadata.\\" ] ]} /> ### Phase 2: Convenience and developer experience <DbTable title=\\"Make ConvEngine easier to run\\" columns={[\\"Enhancement\\", \\"Why it helps\\", \\"Suggested shape\\"]} rows={[ [ \\"Config lint + dry-run validator\\", \\"Catches broken rules/templates before production impact.\\", \\"CLI/admin endpoint validating response mappings, rule loops, unresolved template vars, and MCP tool safety.\\" ], [ \\"State transition map visualization\\", \\"Helps teams reason about intent/state flows and side effects.\\", \\"Generate graph from rules + responses + schema transitions with dead-end and collision markers.\\" ], [ \\"Deterministic replay mode\\", \\"Simplifies debugging wrong-output incidents.\\", \\"Replay one conversation against snapshot config and compare expected vs actual transitions.\\" ], [ \\"Scenario test harness\\", \\"Moves quality from ad-hoc manual checks to repeatable tests.\\", \\"YAML/JSON test fixtures for input turn sequences, expected intent/state, payload assertions.\\" ] ]} /> ### Phase 3: Scalability and throughput <DbTable title=\\"Scale safely\\" columns={[\\"Scalability upgrade\\", \\"Benefit\\", \\"Implementation direction\\"]} rows={[ [ \\"Targeted repository queries\\", \\"Cuts CPU and DB transfer overhead in hot path.\\", \\"Replace findAll().stream() with indexed query methods for intent/state/priority.\\" ], [ \\"Hot config cache with version invalidation\\", \\"Stabilizes latency under high QPS.\\", \\"Cache rules/templates/schemas per intent-state; invalidate on config change event.\\" ], [ \\"Per-conversation serialized execution\\", \\"Removes race conditions while scaling horizontally.\\", \\"Route by conversation key to queue/partition; process one active turn per key.\\" ], [ \\"Async/parallelizable non-critical enrichments\\", \\"Reduces end-to-end response time.\\", \\"Move optional container/MCP enrichments off critical path with explicit timeout budget.\\" ], [ \\"Canonical turn store\\", \\"Improves history quality and replay reliability.\\", \\"Persist normalized user/assistant turns instead of reconstructing from audit stream.\\" ] ]} /> <Highlight type=\\"info\\" title=\\"Confirmed vs inferred\\"> Confirmed from repository code: state overrides from JSON output, sticky-intent skip behavior, rule pass mutation loops, context merge semantics, broad prompt-var exposure, no optimistic lock field on conversation entity, and findAll() hot-path scans. Inferred (consumer-dependent): ingress concurrency controls, infra-level ordering guarantees, and custom LlmClient timeout/retry strategy. </Highlight>","excerpt":"Data Correctness Gotchas This page documents where ConvEngine can produce incorrect, stale, or misleading output without necessarily crashing. It also lists framework constraints and a concrete roadmap to make the system\u2026"},{"id":"deep-dive/file-map.mdx","version":"v2","title":"file map","permalink":"/docs/v2/deep-dive/file-map","content":"File Map Core runtime engine/provider/DefaultConversationalEngine.java engine/factory/EnginePipelineFactory.java engine/pipeline/EnginePipeline.java engine/session/EngineSession.java New flow config config/ConvEngineFlowConfig.java New steps engine/steps/DialogueActStep.java engine/steps/InteractionPolicyStep.java engine/steps/ActionLifecycleStep.java engine/steps/DisambiguationStep.java engine/steps/GuardrailStep.java engine/steps/PendingActionStep.java (enhanced behavior) engine/steps/ToolOrchestrationStep.java engine/steps/StateGraphStep.java engine/steps/MemoryStep.java Intent/schema/rules/response engine/steps/IntentResolutionStep.java engine/steps/SchemaExtractionStep.java engine/steps/RulesStep.java engine/steps/ResponseResolutionStep.java MCP + tool execution engine/steps/McpToolStep.java engine/mcp/McpPlanner.java engine/mcp/McpToolRegistry.java engine/mcp/executor/McpToolExecutor.java engine/mcp/executor/ (group specific executors) engine/mcp/executor/adapter/ (consumer adapter contracts) Data + repositories entity/CePendingAction.java repo/PendingActionRepository.java entity/CeRule.java repo/RuleRepository.java SQL DDL files in src/main/resources/sql/ Memory + eval engine/memory/ConversationMemoryStore.java engine/eval/ConversationReplayService.java engine/eval/model/","rawContent":"# File Map ## Core runtime - engine/provider/DefaultConversationalEngine.java - engine/factory/EnginePipelineFactory.java - engine/pipeline/EnginePipeline.java - engine/session/EngineSession.java ## New flow config - config/ConvEngineFlowConfig.java ## New steps - engine/steps/DialogueActStep.java - engine/steps/InteractionPolicyStep.java - engine/steps/ActionLifecycleStep.java - engine/steps/DisambiguationStep.java - engine/steps/GuardrailStep.java - engine/steps/PendingActionStep.java (enhanced behavior) - engine/steps/ToolOrchestrationStep.java - engine/steps/StateGraphStep.java - engine/steps/MemoryStep.java ## Intent/schema/rules/response - engine/steps/IntentResolutionStep.java - engine/steps/SchemaExtractionStep.java - engine/steps/RulesStep.java - engine/steps/ResponseResolutionStep.java ## MCP + tool execution - engine/steps/McpToolStep.java - engine/mcp/McpPlanner.java - engine/mcp/McpToolRegistry.java - engine/mcp/executor/McpToolExecutor.java - engine/mcp/executor/* (group-specific executors) - engine/mcp/executor/adapter/* (consumer adapter contracts) ## Data + repositories - entity/CePendingAction.java - repo/PendingActionRepository.java - entity/CeRule.java - repo/RuleRepository.java - SQL DDL files in src/main/resources/sql/* ## Memory + eval - engine/memory/ConversationMemoryStore.java - engine/eval/ConversationReplayService.java - engine/eval/model/*","excerpt":"File Map Core runtime engine/provider/DefaultConversationalEngine.java engine/factory/EnginePipelineFactory.java engine/pipeline/EnginePipeline.java engine/session/EngineSession.java New flow config config/ConvEngineFlow\u2026"},{"id":"deep-dive/improvement-backlog.mdx","version":"v2","title":"improvement backlog","permalink":"/docs/v2/deep-dive/improvement-backlog","content":"Improvement Backlog Current direction: richer policy DSL for interaction matrix built in conflict resolution strategies for pending actions audit replay assertions as first class CI utility docs automation from code/DDL contracts","rawContent":"# Improvement Backlog Current direction: - richer policy DSL for interaction matrix - built-in conflict resolution strategies for pending actions - audit replay assertions as first-class CI utility - docs automation from code/DDL contracts","excerpt":"Improvement Backlog Current direction: richer policy DSL for interaction matrix built in conflict resolution strategies for pending actions audit replay assertions as first class CI utility docs automation from code/DDL \u2026"},{"id":"deep-dive/index.mdx","version":"v2","title":"index","permalink":"/docs/v2/deep-dive","content":"Deep Dive This section documents the actual runtime behavior from code and schema, including step contracts, rule phases, audit traces, and control plane tables. Sections : End to end turn lifecycle and branch points. : Turn by turn chat, DB contracts, and audit timeline walkthroughs. : ce_ table contracts and runtime/control plane split. : Consumer implementation and extension strategy. : Source level map of key classes by responsibility. : Full step by step pipeline with exact stage purpose. : Intent resolution + schema extraction internals. : Rule phases, match/action behavior, response resolution. : MCP planner/tool orchestration and audit stages. : Detailed breakdown of newly introduced capabilities. : Common failure/correctness risks and mitigations.","rawContent":"# Deep Dive This section documents the actual runtime behavior from code and schema, including step contracts, rule phases, audit traces, and control-plane tables. ## Sections - [Lifecycle](/docs/v2/deep-dive/lifecycle): End-to-end turn lifecycle and branch points. - [Real World Examples](/docs/v2/deep-dive/examples): Turn-by-turn chat, DB contracts, and audit timeline walkthroughs. - [Data Model](/docs/v2/deep-dive/data-model): ce_* table contracts and runtime/control-plane split. - [Developer Guide](/docs/v2/deep-dive/developer-guide): Consumer implementation and extension strategy. - [File Map](/docs/v2/deep-dive/file-map): Source-level map of key classes by responsibility. - [Pipeline Steps](/docs/v2/deep-dive/pipeline-steps): Full step-by-step pipeline with exact stage purpose. - [Intent & Schema](/docs/v2/deep-dive/intent-and-schema): Intent resolution + schema extraction internals. - [Rules & Responses](/docs/v2/deep-dive/rules-responses): Rule phases, match/action behavior, response resolution. - [MCP and Audit](/docs/v2/deep-dive/mcp-audit): MCP planner/tool orchestration and audit stages. - [v2 Features](/docs/v2/deep-dive/v2-features): Detailed breakdown of newly introduced capabilities. - [Failure Gotchas](/docs/v2/deep-dive/failure-gotchas): Common failure/correctness risks and mitigations.","excerpt":"Deep Dive This section documents the actual runtime behavior from code and schema, including step contracts, rule phases, audit traces, and control plane tables. Sections : End to end turn lifecycle and branch points. : \u2026"},{"id":"deep-dive/intent-and-schema.mdx","version":"v2","title":"intent and schema","permalink":"/docs/v2/deep-dive/intent-and-schema","content":"Intent and Schema Internals Dialogue act resolution DialogueActStep handles linguistic classification before intent resolution even begins. It supports three configuration modes via convengine.flow.dialogue act.resolute : REGEX_ONLY REGEX_THEN_LLM LLM_ONLY When the LLM path is engaged (confidence below llm threshold ), it must return a strict JSON payload containing the act and confidence to be parsed by the engine. Interaction policy decision InteractionPolicyStep derives the routing policy for the current turn based on existing context. Intent resolver behavior The pipeline resolves intent in order of priority via CompositeIntentResolver . The engine prevents intent drift during active schema collection automatically. You will see these audit signals in the trace when intent resolution is intentionally bypassed: INTENT_RESOLVE_SKIPPED_POLICY INTENT_RESOLVE_SKIPPED_SCHEMA_COLLECTION INTENT_RESOLVE_SKIPPED_STICKY_INTENT Schema extraction SchemaExtractionStep drives missing field follow up flows and automatically formats prompt templates utilizing ce_prompt_template . , \\"email\\": } } } Runtime facts are evaluated and written into the EngineSession context by AutoAdvanceStep , making them available for ce_rule evaluation: missing_fields missing_field_options schema_json schema_complete Use schema extraction for required slot collection, and use dialogue acts + interaction policies for short confirmations (like replying \\"yes\\" to \\"Are you sure?\\"). This ensures intent reclassification does not disrupt your active multi turn flows.","rawContent":"# Intent and Schema Internals ## Dialogue act resolution DialogueActStep handles linguistic classification before intent resolution even begins. It supports three configuration modes via convengine.flow.dialogue-act.resolute : - REGEX_ONLY - REGEX_THEN_LLM - LLM_ONLY <DbTable title=\\"Core Dialogue Acts\\" columns={[\\"Act\\", \\"Meaning\\", \\"Regex Sample\\"]} rows={[ [\\"AFFIRM\\", \\"User agrees or confirms\\", \\"(?i)^\\\\\\\\\\\\\\\\s*(yes|yep|yeah|sure)\\\\\\\\\\\\\\\\s*$\\"], [\\"NEGATE\\", \\"User disagrees or cancels\\", \\"(?i)^\\\\\\\\\\\\\\\\s*(no|nope|cancel)\\\\\\\\\\\\\\\\s*$\\"], [\\"EDIT\\", \\"User requests a correction\\", \\"(?i)^\\\\\\\\\\\\\\\\s*(edit|change|modify)\\\\\\\\\\\\\\\\s*$\\"], [\\"RESET\\", \\"User requests a fresh start\\", \\"(?i)^\\\\\\\\\\\\\\\\s*(reset|start over)\\\\\\\\\\\\\\\\s*$\\"], [\\"QUESTION\\", \\"User asks a clarifying question\\", \\"text ending in \'?\'\\"], [\\"NEW_REQUEST\\", \\"(Fallback) User begins a new topic\\", \\"default fallback\\"], ]} /> When the LLM path is engaged (confidence below llm-threshold ), it must return a strict JSON payload containing the act and confidence to be parsed by the engine. ## Interaction policy decision InteractionPolicyStep derives the routing policy for the current turn based on existing context. <DbTable title=\\"Engine Routing Policies\\" columns={[\\"Policy Decision\\", \\"Trigger Context\\", \\"Pipeline Impact\\"]} rows={[ [\\"EXECUTE_PENDING_ACTION\\", \\"DialogueAct=AFFIRM + hasPendingAction\\", \\"Triggers PendingActionStep; Skips Intent Resolution\\"], [\\"REJECT_PENDING_ACTION\\", \\"DialogueAct=NEGATE + hasPendingAction\\", \\"Marks Pending task REJECTED; Skips Intent Resolution\\"], [\\"FILL_PENDING_SLOT\\", \\"DialogueAct!=NEW_REQUEST + hasPendingSlot\\", \\"Passes input to SchemaExtractionStep; Skips Intent Resolution\\"], [\\"RECLASSIFY_INTENT\\", \\"DialogueAct=NEW_REQUEST (or no pending state)\\", \\"Forces standard Intent Resolution\\"], ]} /> ## Intent resolver behavior The pipeline resolves intent in order of priority via CompositeIntentResolver . <Highlight type=\\"info\\" title=\\"Lock and Skip Behaviors\\"> The engine prevents intent drift during active schema collection automatically. You will see these audit signals in the trace when intent resolution is intentionally bypassed: - INTENT_RESOLVE_SKIPPED_POLICY - INTENT_RESOLVE_SKIPPED_SCHEMA_COLLECTION - INTENT_RESOLVE_SKIPPED_STICKY_INTENT </Highlight> ## Schema extraction SchemaExtractionStep drives missing-field follow-up flows and automatically formats prompt templates utilizing ce_prompt_template . <CodeBlockToggle title=\\"Schema LLM Injection Template\\" language=\\"json\\" defaultOpen={false} > { { \\"type\\": \\"object\\", \\"required\\": [\\"customerId\\", \\"email\\"], \\"properties\\": { \\"customerId\\": {\\"type\\": \\"string\\"}, \\"email\\": {\\"type\\": \\"string\\"} } } } </CodeBlockToggle> Runtime facts are evaluated and written into the EngineSession context by AutoAdvanceStep , making them available for ce_rule evaluation: - missing_fields - missing_field_options - schema_json - schema_complete <Highlight type=\\"success\\" title=\\"Practical design rule\\"> Use **schema extraction** for required slot collection, and use **dialogue acts + interaction policies** for short confirmations (like replying \\"yes\\" to \\"Are you sure?\\"). This ensures intent reclassification does not disrupt your active multi-turn flows. </Highlight>","excerpt":"Intent and Schema Internals Dialogue act resolution DialogueActStep handles linguistic classification before intent resolution even begins. It supports three configuration modes via convengine.flow.dialogue act.resolute \u2026"},{"id":"deep-dive/lifecycle.mdx","version":"v2","title":"lifecycle","permalink":"/docs/v2/deep-dive/lifecycle","content":", , , , , , , , , , , , , , , , , , , , , , , , , , ]; Request Lifecycle This page is the quick lifecycle view. For the full interactive debug tree, open /docs/v2/deep dive/request lifecycle . 1. API Entry Point The journey begins when a client sends a POST request to /api/v1/conversation/message . } 2. Engine Processing } 3. The Pipeline (Step by Step) DialogueActStep , InteractionPolicyStep , ActionLifecycleStep , DisambiguationStep , PendingActionStep , ToolOrchestrationStep , McpToolStep , StateGraphStep , and MemoryStep are route conditional and execute only when their prerequisites are met. Every step emits audit events. Use /audit/ /trace , then open /docs/v2/deep dive/request lifecycle and /docs/v2/deep dive/examples to compare turn by turn real world traces.","rawContent":"{ name: \\"LoadOrCreateConversationStep\\", description: \\"Hydrates existing conversation or creates new conversation shell.\\" }, { name: \\"CacheInspectAuditStep\\", description: \\"Conditionally audits cache snapshot when cache-inspector enabled.\\" }, { name: \\"ResetConversationStep\\", description: \\"Applies reset/start-over command handling.\\" }, { name: \\"PersistConversationBootstrapStep\\", description: \\"Persists conversation bootstrap row before persisted-required steps.\\" }, { name: \\"AuditUserInputStep\\", description: \\"Writes raw user input audit event.\\" }, { name: \\"PolicyEnforcementStep\\", description: \\"Applies pre-intent policy checks and safe short-circuit when required.\\" }, { name: \\"DialogueActStep\\", description: \\"Classifies turn as AFFIRM/NEGATE/EDIT/RESET/QUESTION/NEW_REQUEST.\\" }, { name: \\"InteractionPolicyStep\\", description: \\"Decides EXECUTE_PENDING_ACTION / REJECT_PENDING_ACTION / FILL_PENDING_SLOT / RECLASSIFY_INTENT.\\" }, { name: \\"ActionLifecycleStep\\", description: \\"Maintains pending_action_runtime status with TTL semantics.\\" }, { name: \\"DisambiguationStep\\", description: \\"When multiple actions are eligible, asks targeted clarification and pauses execution.\\" }, { name: \\"GuardrailStep\\", description: \\"Sanitization + sensitive checks + approval gate hooks.\\" }, { name: \\"IntentResolutionStep\\", description: \\"Resolves intent unless policy says skip_intent_resolution.\\" }, { name: \\"ResetResolvedIntentStep\\", description: \\"Applies post-intent reset mapping.\\" }, { name: \\"FallbackIntentStateStep\\", description: \\"Assigns fallback UNKNOWN flow when intent/state unresolved.\\" }, { name: \\"AddContainerDataStep\\", description: \\"Merges configured container data into runtime context.\\" }, { name: \\"PendingActionStep\\", description: \\"Executes or rejects pending action task via CeTaskExecutor.\\" }, { name: \\"ToolOrchestrationStep\\", description: \\"Unified tool request->execute->result contract by tool_group.\\" }, { name: \\"McpToolStep\\", description: \\"Planner loop for CALL_TOOL/ANSWER with MCP observations.\\" }, { name: \\"SchemaExtractionStep\\", description: \\"Parses/extracts structured schema fields.\\" }, { name: \\"AutoAdvanceStep\\", description: \\"Advances state when schema/task facts satisfy conditions.\\" }, { name: \\"RulesStep\\", description: \\"Runs phase-scoped rules and actions with cascade passes.\\" }, { name: \\"StateGraphStep\\", description: \\"Validate-only transition check, no forced state mutation.\\" }, { name: \\"ResponseResolutionStep\\", description: \\"Resolves EXACT/DERIVED response output.\\" }, { name: \\"MemoryStep\\", description: \\"Writes session summary and optional recall memory.\\" }, { name: \\"PersistConversationStep\\", description: \\"Persists conversation/result/audit metadata.\\" }, { name: \\"PipelineEndGuardStep\\", description: \\"Final guard and timing closure.\\" }, ]; # Request Lifecycle This page is the quick lifecycle view. For the full interactive debug tree, open <FileRef>/docs/v2/deep-dive/request-lifecycle</FileRef>. ## 1. API Entry Point The journey begins when a client sends a POST request to /api/v1/conversation/message . <CodeBlockToggle title=\\"ConversationController.message\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.api.controller\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/api/controller/ConversationController.java\\" > { @PostMapping(\\"/message\\") public ConversationResponse message(@RequestBody ConversationRequest request) { EngineContext engineContext = EngineContext.builder() .conversationId(request.getConversationId()) .userText(request.getMessage()) .inputParams(request.getInputParams()) .build(); EngineResult result = engine.process(engineContext); return mapToResponse(result); } } </CodeBlockToggle> ## 2. Engine Processing <CodeBlockToggle title=\\"DefaultConversationalEngine.process\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.provider\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/provider/DefaultConversationalEngine.java\\" > { @Override public EngineResult process(EngineContext engineContext) { EngineSession session = sessionFactory.open(engineContext); session.setConversationHistory(historyProvider.lastTurns(session.getConversationId(), 10)); EnginePipeline pipeline = pipelineFactory.create(); return pipeline.execute(session); } } </CodeBlockToggle> ## 3. The Pipeline (Step-by-Step) <PipelineStepList ariaLabel=\\"Pipeline step-by-step (v2)\\" steps={v2PipelineSteps} /> <Highlight type=\\"info\\" title=\\"Core path vs conditional steps\\"> DialogueActStep , InteractionPolicyStep , ActionLifecycleStep , DisambiguationStep , PendingActionStep , ToolOrchestrationStep , McpToolStep , StateGraphStep , and MemoryStep are route-conditional and execute only when their prerequisites are met. </Highlight> <Highlight type=\\"success\\" title=\\"Audit Trail + Real-world trace\\"> Every step emits audit events. Use /audit/{id}/trace , then open <FileRef>/docs/v2/deep-dive/request-lifecycle</FileRef> and <FileRef>/docs/v2/deep-dive/examples</FileRef> to compare turn-by-turn real-world traces. </Highlight>","excerpt":", , , , , , , , , , , , , , , , , , , , , , , , , , ]; Request Lifecycle This page is the quick lifecycle view. For the full interactive debug tree, open /docs/v2/deep dive/request lifecycle . 1. API Entry Point The jour\u2026"},{"id":"deep-dive/mcp-audit.mdx","version":"v2","title":"mcp audit","permalink":"/docs/v2/deep-dive/mcp-audit","content":"MCP, Tool Orchestration, and Audit (v2) Two tool paths 1. ToolOrchestrationStep (direct tool mode) request driven via tool_request executes one tool runs POST_TOOL_EXECUTION rules writes context.mcp.toolExecution. 2. McpToolStep (planner loop mode) planner loop ( CALL_TOOL / ANSWER ) writes context.mcp.observations[] and context.mcp.finalAnswer runs POST_AGENT_MCP rules writes context.mcp.lifecycle. Guardrail blocked branch If planner proposes a blocked next tool: mcp_status=GUARDRAIL_BLOCKED_NEXT_TOOL fallback final text is written to context.mcp.finalAnswer POST_AGENT_MCP rules still run response is still finalized by ce_response resolution Rule ready MCP metadata context.mcp.lifecycle includes: phase , status , outcome , finished blocked , error , errorMessage lastAction , lastToolCode , lastToolGroup , lastToolArgs toolExecuted context.mcp.toolExecution includes: phase , status , outcome , finished error , scopeMismatch , toolExecuted toolCode , toolGroup , meta , result , errorMessage JSON_PATH examples for ce_rule.match_pattern text $[?(@.context.mcp.lifecycle.finished == true && @.context.mcp.lifecycle.outcome == \'BLOCKED\')] $[?(@.context.mcp.lifecycle.error == true)] $[?(@.context.mcp.toolExecution.phase == \'POST_TOOL_EXECUTION\' && @.context.mcp.toolExecution.status == \'SUCCESS\')] $[?(@.context.mcp.toolExecution.scopeMismatch == true)] Audit stages to watch Tool orchestration path: TOOL_ORCHESTRATION_REQUEST TOOL_ORCHESTRATION_RESULT TOOL_ORCHESTRATION_ERROR Planner MCP path: MCP_PLAN_LLM_INPUT MCP_PLAN_LLM_OUTPUT MCP_TOOL_CALL MCP_TOOL_RESULT MCP_TOOL_ERROR MCP_FINAL_ANSWER Rule phases around these paths: RULE_MATCH (McpToolStep) / RULE_NO_MATCH (McpToolStep) RULE_MATCH (ToolOrchestrationStep PostTool) / RULE_NO_MATCH (ToolOrchestrationStep PostTool) RULE_MATCH (AgentIntentResolver) / RULE_NO_MATCH (AgentIntentResolver) RULE_MATCH (RulesStep) / RULE_NO_MATCH (RulesStep) Scope enforcement ce_mcp_tool and ce_mcp_planner are scope validated at startup: null/blank scope rows are rejected intent_code must be ANY , UNKNOWN , or defined in ce_intent state_code must be ANY , UNKNOWN , or present in ce_rule.state_code","rawContent":"# MCP, Tool Orchestration, and Audit (v2) ## Two tool paths 1. ToolOrchestrationStep (direct tool mode) - request-driven via tool_request - executes one tool - runs POST_TOOL_EXECUTION rules - writes context.mcp.toolExecution.* 2. McpToolStep (planner loop mode) - planner loop ( CALL_TOOL / ANSWER ) - writes context.mcp.observations[] and context.mcp.finalAnswer - runs POST_AGENT_MCP rules - writes context.mcp.lifecycle.* ## Guardrail blocked branch If planner proposes a blocked next tool: - mcp_status=GUARDRAIL_BLOCKED_NEXT_TOOL - fallback final text is written to context.mcp.finalAnswer - POST_AGENT_MCP rules still run - response is still finalized by ce_response resolution ## Rule-ready MCP metadata context.mcp.lifecycle includes: - phase , status , outcome , finished - blocked , error , errorMessage - lastAction , lastToolCode , lastToolGroup , lastToolArgs - toolExecuted context.mcp.toolExecution includes: - phase , status , outcome , finished - error , scopeMismatch , toolExecuted - toolCode , toolGroup , meta , result , errorMessage ## JSON_PATH examples for ce_rule.match_pattern text $[?(@.context.mcp.lifecycle.finished == true && @.context.mcp.lifecycle.outcome == \'BLOCKED\')] $[?(@.context.mcp.lifecycle.error == true)] $[?(@.context.mcp.toolExecution.phase == \'POST_TOOL_EXECUTION\' && @.context.mcp.toolExecution.status == \'SUCCESS\')] $[?(@.context.mcp.toolExecution.scopeMismatch == true)] ## Audit stages to watch Tool orchestration path: - TOOL_ORCHESTRATION_REQUEST - TOOL_ORCHESTRATION_RESULT - TOOL_ORCHESTRATION_ERROR Planner MCP path: - MCP_PLAN_LLM_INPUT - MCP_PLAN_LLM_OUTPUT - MCP_TOOL_CALL - MCP_TOOL_RESULT - MCP_TOOL_ERROR - MCP_FINAL_ANSWER Rule phases around these paths: - RULE_MATCH (McpToolStep) / RULE_NO_MATCH (McpToolStep) - RULE_MATCH (ToolOrchestrationStep PostTool) / RULE_NO_MATCH (ToolOrchestrationStep PostTool) - RULE_MATCH (AgentIntentResolver) / RULE_NO_MATCH (AgentIntentResolver) - RULE_MATCH (RulesStep) / RULE_NO_MATCH (RulesStep) ## Scope enforcement ce_mcp_tool and ce_mcp_planner are scope-validated at startup: - null/blank scope rows are rejected - intent_code must be ANY , UNKNOWN , or defined in ce_intent - state_code must be ANY , UNKNOWN , or present in ce_rule.state_code","excerpt":"MCP, Tool Orchestration, and Audit (v2) Two tool paths 1. ToolOrchestrationStep (direct tool mode) request driven via tool_request executes one tool runs POST_TOOL_EXECUTION rules writes context.mcp.toolExecution. 2. Mcp\u2026"},{"id":"deep-dive/pipeline-steps.mdx","version":"v2","title":"pipeline steps","permalink":"/docs/v2/deep-dive/pipeline-steps","content":"Pipeline Steps (what each step does) :::tip Hook where you need precision Before schema extraction: normalize inputs After rules: inspect intent/state transition correctness Before response resolution: inject display hints ::: Rules execute by phase. Available native phases include PRE_RESPONSE_RESOLUTION , POST_AGENT_INTENT , POST_AGENT_MCP , and POST_TOOL_EXECUTION . Prefer transitions in ce_rule unless absolutely framework level behavior is required. This keeps domain behavior data driven and testable via audit traces. 1 LoadOrCreateConversationStep Responsibility: Fetch or bootstrap conversation row Session Mutations: conversation, intent/state/context sync Config/Table Dependencies: ce_conversation Detailed Execution Logic This is the initial bootstrap step of the runtime engine. It uses the conversationId provided in the HTTP request to lookup an existing CeConversation row in the Postgres database. If the conversation exists: The context JSON is hydrated into the runtime EngineSession . Previous intent and state codes are restored. All stored memory summaries and pending actions are fetched from the database and loaded into memory. If the conversation is new: A new CeConversation entity is instantiated. The intent and state default to UNKNOWN . This ensures that regardless of scale, the API is entirely stateless and can route requests to any pod. } 2 CacheInspectAuditStep Responsibility: Conditionally audit cache snapshot Session Mutations: none Config/Table Dependencies: convengine.audit.cache inspector property Detailed Execution Logic Dynamically runs if convengine.audit.cache inspector is true. It takes a complete JSON snapshot of the hydrated EngineSession conversation cache tree and logs it under the CACHE_INSPECTION priority stage before explicit user input audits are finalized. } 3 ResetConversationStep Responsibility: Early explicit reset Session Mutations: intent/state/context/input params reset Config/Table Dependencies: input flags, command text Detailed Execution Logic Checks EngineSession properties to see if an explicit reset has been triggered by the invoking consumer (this is usually passed as a param like _reset=true ). When triggered, it clears: The intent and state trackers. The contextJson (wiping all extracted schema facts). The inputParamsJson . The session is marked as \\\\ RUNNING\\\\ again, but completely fresh. An audit event CONVERSATION_RESET is logged. String reason = resetReason(session); session.resetForConversationRestart(); session.getConversation().setStatus(\\"RUNNING\\"); session.getConversation().setIntentCode(\\"UNKNOWN\\"); session.getConversation().setStateCode(\\"UNKNOWN\\"); session.getConversation().setContextJson(\\" \\"); session.getConversation().setInputParamsJson(\\" \\"); session.getConversation().setLastAssistantJson(null); session.getConversation().setUpdatedAt(OffsetDateTime.now()); conversationRepository.save(session.getConversation()); Map payload = new LinkedHashMap< (); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.REASON, reason); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.CONTEXT, session.getContextJson()); audit.audit(ConvEngineAuditStage.CONVERSATION_RESET, session.getConversationId(), payload); return new StepResult.Continue(); } } 4 PersistConversationBootstrapStep Responsibility: Ensure conversation row persisted Session Mutations: none/metadata Config/Table Dependencies: ce_conversation Detailed Execution Logic A simple lifecycle checkpoint to ensure the conversation has a createdAt timestamp. If the user session just started in LoadOrCreateConversationStep , this step performs the initial INSERT (ce_conversation) to the database to ensure foreign key dependencies (like audit logs) don\'t fail later in the loop. return new StepResult.Continue(); } } 5 AuditUserInputStep Responsibility: Persist user input audit Session Mutations: none Config/Table Dependencies: ce_audit Detailed Execution Logic Records the raw text query the user typed on this turn into the ce_audit table. This is purely for debug tracing and business analytics. It binds the USER_INPUT audit stage with the conversation ID and the text payload. } 6 PolicyEnforcementStep Responsibility: Policy block and stop Session Mutations: payload + stop result on block Config/Table Dependencies: ce_policy Detailed Execution Logic Secures the pipeline against prohibited input using ce_policy . It reads all active rows from ce_policy , executing either REGEX , EXACT , or LLM rules against the user\'s raw text. If a match occurs: The conversation is forced to a \\\\ BLOCKED\\\\ status. A StepResult.Stop() is returned immediately, skipping all remaining NLP and intent steps. The ce_policy.response_text is loaded as the final payload shipped back to the consumer. } return new StepResult.Continue(); } } 7 DialogueActStep Responsibility: Classify user turn action type Session Mutations: dialogue_act in input params Config/Table Dependencies: ce_config (dialogue act mode), ce_audit Detailed Execution Logic This step attempts to classify the raw user text into an explicit conversational \\"act\\" through Regex, and optionally as fallback, a LLM request depending on the strictness of convengine.flow.dialogue act.resolute (e.g., REGEX_THEN_LLM ). If convengine.flow.queryRewrite.enabled=true and the conversionHistory is present, the step morphs its LLM request into a dual Classifier & RAG Context Optimizer . It supplies the ongoing conversation to the LLM to rewrite ambiguous pronouns into an explicit standalone search query, returning it as \\"standaloneQuery\\" . The core parameters for these prompts are dynamically loaded from ce_config , allowing administrators to Hot Swap classifier behaviors in production without recompiling Java arrays. Supported Dialogue Acts | Enum Name | Purpose | | | | | AFFIRM | The user expressed agreement or confirmation (e.g., \\"yes\\", \\"go ahead\\"). Can override Guardrails or execute Pending Actions. | | NEGATE | The user expressed rejection or cancellation (e.g., \\"no\\", \\"stop\\"). Can cancel active Interaction Policies. | | EDIT | The user wants to change previously supplied context or entity slots. | | RESET | The user wants to clear memory and start completely fresh. | | QUESTION | The user is asking a direct conversational question (triggers fallback intent workflows). | | NEW_REQUEST | The baseline generic classification. Engine routes normally. | | GREETING | The user issued a pleasantry (\\"Hi\\", \\"Hello\\"). Typically bypassed by downstream Orchestrators to prevent expensive RAG queries. | Source Execution Profile Notice in the source that if the LLM predicts an EDIT or RESET act, but the user\'s text did not match the explicit EDIT or RESET regex, the engine overrides the LLM prediction down to a REGEX_GUARD fallback. This prevents the LLM from hallucinating an edit on a brand new, complex sentence. \\"\\"\\"); // Loads the query rewrite variant QUERY_REWRITE_SYSTEM_PROMPT = configResolver.resolveString(this, \\"QUERY_REWRITE_SYSTEM_PROMPT\\", \\"\\"\\" You are a dialogue act classifier and intelligent query search rewriter. Using the conversation history, rewrite the user\'s text into an explicit, standalone query that perfectly describes their intent without needing the conversation history context. Also classify their dialogue act. Return JSON only matching the exact schema. \\"\\"\\"); } @Override public StepResult execute(EngineSession session) return new StepResult.Continue(); } } } 8 InteractionPolicyStep Responsibility: Decide runtime policy before intent Session Mutations: policy_decision, skip_intent_resolution Config/Table Dependencies: ce_config, session pending state Detailed Execution Logic Uses the identified DialogueAct to decide how the engine should route the turn. This step prevents the system from confusing follow up answers (like saying \\"yes\\") with new intents. The output maps to the InteractionPolicyDecision enum: EXECUTE_PENDING_ACTION : If the DialogueAct is AFFIRM and there\'s a background API task waiting. REJECT_PENDING_ACTION : If NEGATE and an action is waiting. FILL_PENDING_SLOT : If the user is currently answering a schema extraction question. RECLASSIFY_INTENT : If this is a NEW_REQUEST . Evaluation Matrix Flow: 1. Checks for context hints: hasPendingAction , hasPendingSlot , hasResolvedIntent , hasResolvedState . 2. First, it attempts a lookup using the resolveFromMatrix() method against any custom configurations in your YAML properties. 3. If no custom matrix decision applies, it checks boolean flags from the config. isExecutePendingOnAffirm() : If true, AFFIRM + hasPendingAction EXECUTE_PENDING_ACTION isRejectPendingOnNegate() : If true, NEGATE + hasPendingAction REJECT_PENDING_ACTION isFillPendingSlotOnNonNewRequest() : If true, != NEW_REQUEST && != GREETING + hasPendingSlot FILL_PENDING_SLOT 4. Most crucially, if any of these policy decisions trigger, it sets skipIntentResolution = true . This stops Step 11 ( IntentResolutionStep ) from overriding the sticky intent. The payload is attached with POLICY_DECISION . else if (flowConfig.getInteractionPolicy().isExecutePendingOnAffirm() && hasPendingAction && dialogueAct == DialogueAct.AFFIRM) else if (flowConfig.getInteractionPolicy().isRejectPendingOnNegate() && hasPendingAction && dialogueAct == DialogueAct.NEGATE) else if (flowConfig.getInteractionPolicy().isFillPendingSlotOnNonNewRequest() && hasPendingSlot && dialogueAct != DialogueAct.NEW_REQUEST) } session.putInputParam(ConvEngineInputParamKey.POLICY_DECISION, decision.name()); session.putInputParam(ConvEngineInputParamKey.SKIP_INTENT_RESOLUTION, skipIntentResolution); Map payload = new LinkedHashMap< (); payload.put(ConvEnginePayloadKey.DIALOGUE_ACT, dialogueAct.name()); payload.put(ConvEnginePayloadKey.POLICY_DECISION, decision.name()); payload.put(ConvEnginePayloadKey.SKIP_INTENT_RESOLUTION, skipIntentResolution); payload.put(\\"hasPendingAction\\", hasPendingAction); payload.put(\\"hasPendingSlot\\", hasPendingSlot); payload.put(ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(ConvEnginePayloadKey.STATE, session.getState()); audit.audit(ConvEngineAuditStage.INTERACTION_POLICY_DECIDED, session.getConversationId(), payload); return new StepResult.Continue(); } } 9 ActionLifecycleStep Responsibility: Maintain pending action runtime TTL/status Session Mutations: pending_action_runtime context Config/Table Dependencies: ce_pending_action, ce_audit Detailed Execution Logic Tracks time to live (TTL) for CePendingAction rows. If the user was asked \\"Are you sure you want to cancel?\\" 3 turns ago, but started talking about the weather instead, this step will mark the pending_action_runtime as EXPIRED . Status transitions (Enum PendingActionStatus ): OPEN : Task is created but waiting for user confirmation. IN_PROGRESS : The user affirmed, and the task is ready to execute. REJECTED : The user negated. EXPIRED : The TTL turn limit was reached before the user confirmed. ObjectNode root = contextHelper.readRoot(session); ObjectNode runtime = contextHelper.ensureObject(root, RUNTIME_NODE); int currentTurn = session.conversionHistory().size() + 1; long now = Instant.now().toEpochMilli(); PendingActionStatus currentStatus = PendingActionStatus.from(runtime.path(\\"status\\").asText(null), null); if (isExpired(runtime, currentTurn, now) && (currentStatus == PendingActionStatus.OPEN || currentStatus == PendingActionStatus.IN_PROGRESS)) String actionKey = resolveActionKey(session); String actionRef = resolveActionReferenceFromTable(session, actionKey); if (actionRef == null || actionRef.isBlank()) boolean isNewRuntime = isRuntimeNew(runtime, actionKey, actionRef); if (isNewRuntime) InteractionPolicyDecision decision = parseDecision(session.inputParamAsString(ConvEngineInputParamKey.POLICY_DECISION)); if (decision == InteractionPolicyDecision.EXECUTE_PENDING_ACTION) else if (decision == InteractionPolicyDecision.REJECT_PENDING_ACTION) contextHelper.writeRoot(session, root); return new StepResult.Continue(); } } 10 DisambiguationStep Responsibility: Ask question when multiple actions fit Session Mutations: pending_clarification question/context Config/Table Dependencies: ce_pending_action, ce_config, ce_audit Detailed Execution Logic A smart conversational router. If multiple pending actions apply to the current context (e.g., \\"Cancel flight\\" vs \\"Cancel hotel\\" both valid), it pauses the pipeline. It dynamically builds a multiple choice prompt (or LLM synthesis) asking the user to clarify which action they meant. It emits an ASSISTANT_OUTPUT step, stalling the pipeline until the user clarifies. InteractionPolicyDecision decision = parseDecision(session.inputParamAsString(ConvEngineInputParamKey.POLICY_DECISION)); if (decision != InteractionPolicyDecision.EXECUTE_PENDING_ACTION) String explicitActionKey = session.inputParamAsString(ConvEngineInputParamKey.PENDING_ACTION_KEY); if (explicitActionKey != null && !explicitActionKey.isBlank()) List candidates = pendingActionRepository.findEligibleByIntentAndStateOrderByPriorityAsc( session.getIntent(), session.getState() ); if (candidates == null || candidates.size() top = candidates.stream() .filter(c (c.getPriority() == null ? Integer.MAX_VALUE : c.getPriority()) == bestPriority) .toList(); if (top.size() options = new LinkedHashSet< (); for (CePendingAction row : top) String option = row.getActionKey().trim(); if (row.getDescription() != null && !row.getDescription().isBlank()) options.add(option); if (options.size() = Math.max(1, flowConfig.getDisambiguation().getMaxOptions())) } if (options.isEmpty()) QuestionResult questionResult = buildQuestion(session, top, options); String question = questionResult.question(); session.setPendingClarificationQuestion(question); session.setPendingClarificationReason(\\"PENDING_ACTION_DISAMBIGUATION\\"); session.putInputParam(ConvEngineInputParamKey.POLICY_DECISION, InteractionPolicyDecision.RECLASSIFY_INTENT.name()); session.putInputParam(ConvEngineInputParamKey.PENDING_ACTION_DISAMBIGUATION_REQUIRED, true); Map payload = new LinkedHashMap< (); payload.put(ConvEnginePayloadKey.REASON, \\"MULTIPLE_PENDING_ACTIONS\\"); payload.put(ConvEnginePayloadKey.QUESTION, question); payload.put(ConvEnginePayloadKey.CANDIDATE_COUNT, top.size()); payload.put(ConvEnginePayloadKey.OPTIONS, new ArrayList< (options)); payload.put(ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(ConvEnginePayloadKey.STATE, session.getState()); payload.put(ConvEnginePayloadKey.QUESTION_SOURCE, questionResult.source()); audit.audit(ConvEngineAuditStage.DISAMBIGUATION_REQUIRED, session.getConversationId(), payload); return new StepResult.Continue(); } } 11 GuardrailStep Responsibility: Apply guardrails and approval rules Session Mutations: guardrail flags/sanitized text Config/Table Dependencies: ce_config, ce_audit Detailed Execution Logic The last line of defense before intent triggers. Reads the ce_config guardrail thresholds and sanitize instructions. If a command is flagged as \\"sensitive\\" (e.g., destructive actions like closing an account), it can force an explicit SENSITIVE_ACTION_APPROVAL_REQUIRED pause, blocking the pipeline from executing tasks until MFA or explicit user verification is acquired. String originalUserText = session.getUserText() == null ? \\"\\" : session.getUserText(); String sanitizedUserText = sanitize(originalUserText); if (flowConfig.getGuardrail().isSanitizeInput()) boolean sensitive = matchesSensitivePattern(sanitizedUserText); boolean approvalRequired = flowConfig.getGuardrail().isRequireApprovalForSensitiveActions() && sensitive; boolean approvalGranted = isApprovalGranted(session); boolean failClosed = flowConfig.getGuardrail().isApprovalGateFailClosed(); boolean denied = approvalRequired && (!approvalGranted || failClosed && !approvalGranted); if (denied) session.putInputParam(ConvEngineInputParamKey.GUARDRAIL_BLOCKED, false); Map payload = new LinkedHashMap< (); payload.put(\\"result\\", \\"ALLOW\\"); payload.put(\\"sensitive\\", sensitive); payload.put(\\"approvalRequired\\", approvalRequired); payload.put(\\"approvalGranted\\", approvalGranted); payload.put(\\"intent\\", session.getIntent()); payload.put(\\"state\\", session.getState()); audit.audit(ConvEngineAuditStage.GUARDRAIL_ALLOW, session.getConversationId(), payload); return new StepResult.Continue(); } } 12 IntentResolutionStep Responsibility: Resolve intent with classifier+agent Session Mutations: intent/state/clarification fields Config/Table Dependencies: ce_intent, ce_intent_classifier, ce_config Detailed Execution Logic The primary intent matching gateway. Uses the CompositeIntentResolver (which merges Regex, Semantic Search, and LLM classifiers based off ce_intent_classifier ). If the interaction policy decided we are in FILL_PENDING_SLOT mode, this step is bypassed entirely (referred to as a \\"Locked Intent\\"). Otherwise: Queries ce_intent_classifier for matches. Uses INTENT_RESOLVED audit logs to map the intentCode . Sets the context state to IDLE (or whatever the initial configuration demands). session.clearClarification(); if (session.getConversation() != null) Map payload = new LinkedHashMap< (); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT_LOCKED, session.isIntentLocked()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT_LOCK_REASON, session.getIntentLockReason()); audit.audit(ConvEngineAuditStage.INTENT_RESOLVE_SKIPPED_SCHEMA_COLLECTION, session.getConversationId(), payload); return new StepResult.Continue(); } if (shouldSkipResolutionForPolicy(session)) Map payload = new LinkedHashMap< (); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.DIALOGUE_ACT, session.inputParamAsString(ConvEngineInputParamKey.DIALOGUE_ACT)); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.POLICY_DECISION, session.inputParamAsString(ConvEngineInputParamKey.POLICY_DECISION)); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.SKIP_INTENT_RESOLUTION, true); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.REASON, \\"policy decision retained existing intent/state\\"); audit.audit(ConvEngineAuditStage.INTENT_RESOLVE_SKIPPED_POLICY, session.getConversationId(), payload); return new StepResult.Continue(); } if (shouldSkipResolutionForStickyIntent(session)) Map payload = existingIntentRetainedAuditPayload(session); audit.audit(ConvEngineAuditStage.INTENT_RESOLVE_SKIPPED_STICKY_INTENT, session.getConversationId(), payload); return new StepResult.Continue(); } CompositeIntentResolver.IntentResolutionResult result = intentResolver.resolveWithTrace(session); if (result == null || result.resolvedIntent() == null) if (!result.resolvedIntent().equals(previousIntent)) session.getConversation().setIntentCode(session.getIntent()); session.getConversation().setStateCode(session.getState()); audit.audit( ConvEngineAuditStage.intentResolvedBy(result.source().name()), session.getConversationId(), result ); return new StepResult.Continue(); } } 13 ResetResolvedIntentStep Responsibility: Reset on configured reset intent Session Mutations: full reset Config/Table Dependencies: ce_config RESET_INTENT_CODES Detailed Execution Logic A quality of life check. If the resolved intent matches one of the RESET_INTENT_CODES configured in Spring configuration (e.g. START_OVER , RESET ), this step immediately executes a session wipe akin to ResetConversationStep , returning the conversation to a clean slate. session.resetForConversationRestart(); session.getConversation().setStatus(\\"RUNNING\\"); session.getConversation().setIntentCode(\\"UNKNOWN\\"); session.getConversation().setStateCode(\\"UNKNOWN\\"); session.getConversation().setContextJson(\\" \\"); session.getConversation().setInputParamsJson(\\" \\"); session.getConversation().setLastAssistantJson(null); session.getConversation().setUpdatedAt(OffsetDateTime.now()); conversationRepository.save(session.getConversation()); Map payload = new LinkedHashMap< (); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.REASON, \\"INTENT_RESOLVED_RESET\\"); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.MATCHED_RESET_INTENT_CODES, resetIntentCodes); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.CONTEXT, session.getContextJson()); audit.audit(ConvEngineAuditStage.CONVERSATION_RESET, session.getConversationId(), payload); return new StepResult.Continue(); } } 14 FallbackIntentStateStep Responsibility: Fill missing intent/state defaults Session Mutations: intent/state Config/Table Dependencies: none Detailed Execution Logic A safety net. If the classifier fails to return any confidence, or an exception occurred, this step forcibly binds the native engine defaults to UNKNOWN intent and UNKNOWN state so that ce_rule and ce_response tables can still define fallback messaging (e.g., \\"I didn\'t understand that\\"). if (session.getState() == null) session.getConversation().setIntentCode(session.getIntent()); session.getConversation().setStateCode(session.getState()); return new StepResult.Continue(); } } 15 AddContainerDataStep Responsibility: Fetch and attach container data Session Mutations: containerData/context merge Config/Table Dependencies: ce_container_config Detailed Execution Logic Bridges static tenant/consumer configurations. Evaluates ce_container_config to pull any global JSON context relevant to the intent and merges it directly into session.contextJson . This allows things like \\"Store Hours\\" or \\"Region Policies\\" to be globally attached to all LLM contexts without hardcoding. if (configs.isEmpty()) if (configs.isEmpty()) ObjectNode containerRoot = mapper.createObjectNode(); for (CeContainerConfig cfg : configs) inputParams.put(key, value); if (session.getInputParams() != null) if (session.getEngineContext().getInputParams() != null) PageInfoRequest pageInfo = PageInfoRequest.builder() .userId(\\"convengine\\") .loggedInUserId(\\"convengine\\") .pageId(cfg.getPageId()) .sectionId(cfg.getSectionId()) .containerId(cfg.getContainerId()) .inputParams(inputParams) .build(); ContainerComponentRequest req = new ContainerComponentRequest(); req.setPageInfo(List.of(pageInfo)); req.setRequestTypes(List.of(RequestType.CONTAINER)); interceptorExecutor.beforeExecute(req, session); ContainerComponentResponse resp = ccfCoreService.execute(req); resp = interceptorExecutor.afterExecute(resp, session); // find classes with @ContainerDataTransformer(state, intent) to transform resp if needed Map transformedData = transformerService.transformIfApplicable(resp, session, inputParams); JsonNode responseNode = transformedData == null ? mapper.valueToTree(resp) : mapper.valueToTree(transformedData); session.setContainerData(responseNode); containerRoot.set(cfg.getInputParamName(), responseNode); Map jsonMap = Map.of( \\"containerId\\", cfg.getContainerId(), \\"pageId\\", cfg.getPageId(), \\"sectionId\\", cfg.getSectionId(), \\"inputParam\\", cfg.getInputParamName(), \\"requestInput\\", inputParams, \\"response\\", responseNode ); audit.audit( \\"CONTAINER_DATA_EXECUTED\\", session.getConversationId(), jsonMap ); } catch (Exception e) } if (!containerRoot.isEmpty()) catch (Exception ignore) audit.audit( \\"CONTAINER_DATA_ATTACHED\\", session.getConversationId(), containerRoot.toString() ); } return new StepResult.Continue(); } } 16 PendingActionStep Responsibility: Execute/reject pending action task Session Mutations: pending_action_runtime status/result Config/Table Dependencies: ce_pending_action, CeTaskExecutor, ce_audit Detailed Execution Logic Executes Java code. If the InteractionPolicy is EXECUTE_PENDING_ACTION and the status is IN_PROGRESS , this step resolves the Spring Bean ID attached to the ce_pending_action row. It invokes CeTaskExecutor.execute() , runs the backend transaction (e.g. Stripe Refund), and captures the boolean/json result back into the engine EngineSession context for downstream rules to evaluate. String decisionRaw = session.inputParamAsString(ConvEngineInputParamKey.POLICY_DECISION); InteractionPolicyDecision decision = parseDecision(decisionRaw); if (decision != InteractionPolicyDecision.EXECUTE_PENDING_ACTION && decision != InteractionPolicyDecision.REJECT_PENDING_ACTION) Map context = session.contextDict(); Object pendingAction = context.get(\\"pending_action\\"); if (pendingAction == null) String actionKey = resolveActionKey(session, context, pendingAction); String actionRef = resolveActionReference(session, pendingAction, actionKey); if (actionRef == null || actionRef.isBlank()) if (decision == InteractionPolicyDecision.REJECT_PENDING_ACTION) String[] taskRef = parseTaskReference(actionRef); if (taskRef == null) Object executionResult = ceTaskExecutor.execute(taskRef[0], taskRef[1], session); if (executionResult == null) session.putInputParam(ConvEngineInputParamKey.PENDING_ACTION_RESULT, \\"EXECUTED\\"); updateRuntimeStatus(session, PendingActionStatus.EXECUTED); Map payload = basePayload(session, decision, actionRef); payload.put(ConvEnginePayloadKey.PENDING_ACTION_RESULT, \\"EXECUTED\\"); payload.put(\\"taskBean\\", taskRef[0]); payload.put(\\"taskMethods\\", taskRef[1]); audit.audit(ConvEngineAuditStage.PENDING_ACTION_EXECUTED, session.getConversationId(), payload); return new StepResult.Continue(); } } 17 ToolOrchestrationStep Responsibility: Run tool_group based orchestration Session Mutations: tool_request/tool_result fields Config/Table Dependencies: ce_tool, ce_mcp_tool, ce_audit Detailed Execution Logic The gateway for Model Context Protocol (MCP) tooling. If ce_tool specifies that this intent requires a tool_group , this step binds the request and delegates to an external executor. It pauses the LLM, executes the backend SQL or REST fetch, and dumps the massive JSON result into tool_result dictionary in context. if (Boolean.TRUE.equals(session.getInputParams().get(ConvEngineInputParamKey.SKIP_TOOL_EXECUTION))) ToolRequest request = resolveRequest(session); if (request == null) session.putInputParam(ConvEngineInputParamKey.TOOL_REQUEST, request.toMap()); audit.audit(ConvEngineAuditStage.TOOL_ORCHESTRATION_REQUEST, session.getConversationId(), request.toMap()); try if (group == null || group.isBlank()) McpToolExecutor executor = resolveExecutor(group); String resultJson = executor.execute(tool, request.args(), session); Map result = new LinkedHashMap< (); result.put(\\"status\\", \\"SUCCESS\\"); result.put(\\"tool_code\\", request.toolCode()); result.put(\\"tool_group\\", group); result.put(\\"result\\", parseJsonOrString(resultJson)); session.putInputParam(ConvEngineInputParamKey.TOOL_RESULT, result); session.putInputParam(ConvEngineInputParamKey.TOOL_STATUS, \\"SUCCESS\\"); audit.audit(ConvEngineAuditStage.TOOL_ORCHESTRATION_RESULT, session.getConversationId(), result); rulesStep.applyRules(session, \\"ToolOrchestrationStep PostTool\\", RulePhase.POST_TOOL_EXECUTION.name()); } catch (IllegalStateException e) Map result = new LinkedHashMap< (); result.put(\\"status\\", \\"ERROR\\"); result.put(\\"tool_code\\", request.toolCode()); result.put(\\"tool_group\\", request.toolGroup()); result.put(\\"error\\", String.valueOf(e.getMessage())); session.putInputParam(ConvEngineInputParamKey.TOOL_RESULT, result); session.putInputParam(ConvEngineInputParamKey.TOOL_STATUS, \\"ERROR\\"); audit.audit(ConvEngineAuditStage.TOOL_ORCHESTRATION_ERROR, session.getConversationId(), result); } catch (Exception e) return new StepResult.Continue(); } } 18 McpToolStep Responsibility: MCP planner/tool loop Session Mutations: context_json.mcp. Config/Table Dependencies: ce_mcp_tool, ce_mcp_db_tool, ce_mcp_planner (fallback ce_config) Detailed Execution Logic Specifically iterates over ce_mcp_tool bindings. Instead of static grouped tools, this triggers an agent planner that interprets the input, selects an MCP tool, writes the payload, and executes it. This is the core of dynamic tool use in ConvEngine V2. if (session.hasPendingClarification()) List tools = registry.listEnabledTools(session.getIntent(), session.getState()); if (CollectionUtils.isEmpty(tools)) clearMcpContext(session); List observations = readObservationsFromContext(session); boolean mcpTouched = false; for (int i = 0; i args = (plan.args() == null) ? Map.of() : plan.args(); audit.audit( ConvEngineAuditStage.MCP_TOOL_CALL, session.getConversationId(), mapOf(\\"tool_code\\", toolCode, \\"args\\", args) ); CeMcpTool tool = registry.requireTool(toolCode, session.getIntent(), session.getState()); String toolGroup = registry.normalizeToolGroup(tool.getToolGroup()); session.putInputParam(ConvEngineInputParamKey.MCP_TOOL_GROUP, toolGroup); try catch (Exception e) } if (mcpTouched) session.syncToConversation(); return new StepResult.Continue(); } } 19 SchemaExtractionStep Responsibility: Schema driven extraction and lock handling Session Mutations: schema facts/context/lock Config/Table Dependencies: ce_output_schema, ce_prompt_template Detailed Execution Logic Evaluates ce_output_schema . It injects the missing required slots into an LLM extracting prompt using ce_prompt_template . The LLM returns a structured JSON map. This step merges it with session.contextJson . It then runs missingFieldEvaluator.evaluate() . If fields are missing, it sets session.setSchemaLocked(true) . else session.syncFromConversation(true); return new StepResult.Continue(); } } 20 AutoAdvanceStep Responsibility: Compute schema status facts Session Mutations: schemaComplete/hasAny Config/Table Dependencies: resolved schema + context Detailed Execution Logic In V1, rules had to manually check if schema extraction was done. In V2, this step computes the boolean flags schemaComplete and hasAny and binds them to the session context. This allows ce_rule to simply trigger on schemaComplete == true . String schemaJson = session.getResolvedSchema().getJsonSchema(); String contextJson = session.getContextJson(); boolean hasAnySchemaValue = JsonUtil.hasAnySchemaValue(contextJson, schemaJson); boolean schemaComplete = JsonUtil.isSchemaComplete(schemaJson, contextJson); session.setSchemaHasAnyValue(hasAnySchemaValue); session.setSchemaComplete(schemaComplete); Map payload = new LinkedHashMap< (); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.SCHEMA_COMPLETE, schemaComplete); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.HAS_ANY_SCHEMA_VALUE, hasAnySchemaValue); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); audit.audit(ConvEngineAuditStage.AUTO_ADVANCE_FACTS, session.getConversationId(), payload); return new StepResult.Continue(); } } 21 RulesStep Responsibility: Match and apply transitions/actions Session Mutations: intent/state/input params Config/Table Dependencies: ce_rule Detailed Execution Logic The core state machine driver. It queries ce_rule for the current Intent and State. It evaluates expressions (like JSON_PATH or REGEX ) against the session.contextJson . If a rule matches, it executes the target action (e.g. SET_STATE to CONFIRMATION , or SET_TASK ). It loops until no more rules match, effectively \\"auto advancing\\" state machine nodes. } 22 StateGraphStep Responsibility: Validate state transition path Session Mutations: state_graph_valid/reason Config/Table Dependencies: ce_state_graph, ce_audit Detailed Execution Logic A strict validater. Checks ce_state_graph to see if the transition that just occurred in RulesStep was legally defined by the developer. If a rule jumped from IDLE to CANCELLED but there is no edge in the graph, this step logs an error and optionally reverts the state to prevent invalid transitions. String fromState = session.getConversation() == null ? null : session.getConversation().getStateCode(); String toState = session.getState(); if (fromState == null || fromState.isBlank() || toState == null || toState.isBlank() || fromState.equalsIgnoreCase(toState)) boolean allowed = isAllowedTransition(fromState, toState); Map payload = new LinkedHashMap< (); payload.put(\\"fromState\\", fromState); payload.put(\\"toState\\", toState); payload.put(\\"intent\\", session.getIntent()); payload.put(\\"validateOnly\\", true); if (allowed) payload.put(\\"allowed\\", false); payload.put(\\"softBlock\\", flowConfig.getStateGraph().isSoftBlockOnViolation()); audit.audit(ConvEngineAuditStage.STATE_GRAPH_VIOLATION, session.getConversationId(), payload); session.putInputParam(ConvEngineInputParamKey.STATE_GRAPH_VALID, false); if (flowConfig.getStateGraph().isSoftBlockOnViolation()) return new StepResult.Continue(); } } 23 ResponseResolutionStep Responsibility: Resolve and generate output payload Session Mutations: payload/last assistant json Config/Table Dependencies: ce_response, ce_prompt_template Detailed Execution Logic The final output generator. Queries ce_response for the current intent and state. If TEXT : Returns a hardcoded string. If DERIVED : Loads ce_prompt_template , injects the contextJson , tool_result , and schema , and asks the LLM to write a fluid, contextual response to the user. Sets session.getConversation().setLastAssistantJson() with the payload. Optional responseOptional = resolveResponse(session); if(responseOptional.isEmpty()) CeResponse resp = responseOptional.get(); if (!matches(resp.getStateCode(), session.getState()) && !matches(resp.getStateCode(), \\"ANY\\")) Map responsePayload = new LinkedHashMap< (); responsePayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.RESPONSE_ID, resp.getResponseId()); responsePayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); responsePayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); audit.audit( ConvEngineAuditStage.RESOLVE_RESPONSE, session.getConversationId(), responsePayload ); List conversationTurns = historyProvider.lastTurns(session.getConversationId(), 10); session.setConversationHistory(conversationTurns); CePromptTemplate template = null; if(ResponseType.DERIVED.name().equalsIgnoreCase(resp.getResponseType())) typeFactory .get(resp.getResponseType()) .resolve(session, PromptTemplate.initFrom(template), ResponseTemplate.initFrom(resp)); OutputPayload transformedOutput = responseTransformerService.transformIfApplicable(session.getPayload(), session, session.getInputParams()); session.setPayload(transformedOutput); Object payloadValue = switch (session.getPayload()) ; Map outputPayload = new LinkedHashMap< (); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.OUTPUT, payloadValue); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.OUTPUT_FORMAT, resp.getOutputFormat()); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.RESPONSE_TYPE, resp.getResponseType()); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.RESPONSE_ID, resp.getResponseId()); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.CONTEXT, session.contextDict()); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.SCHEMA_JSON, session.schemaJson()); audit.audit(ConvEngineAuditStage.ASSISTANT_OUTPUT, session.getConversationId(), outputPayload); return new StepResult.Continue(); } } 24 MemoryStep Responsibility: Write memory/session summary Session Mutations: memory.session_summary in context Config/Table Dependencies: ce_memory, ce_audit Detailed Execution Logic Evaluates the rolling history. If ce_memory is configured, and recentTurns exceeds the threshold, this step fires off a summarization prompt to the LLM. It compresses the last N turns into a dense paragraph and saves it as memory.session_summary in the context JSON, enabling infinite context retention without blowing up token limits. String recalled = null; for (ConversationMemoryStore store : memoryStores) } catch (Exception ignored) } if (recalled != null) String summary = buildSummary(session); if (summary.length() flowConfig.getMemory().getSummaryMaxChars()) session.putInputParam(ConvEngineInputParamKey.MEMORY_SESSION_SUMMARY, summary); ObjectNode root = contextHelper.readRoot(session); ObjectNode memoryNode = contextHelper.ensureObject(root, \\"memory\\"); memoryNode.put(\\"session_summary\\", summary); if (recalled != null) contextHelper.writeRoot(session, root); for (ConversationMemoryStore store : memoryStores) catch (Exception ignored) } Map payload = new LinkedHashMap< (); payload.put(\\"summaryChars\\", summary.length()); payload.put(\\"recalled\\", recalled != null); payload.put(\\"stores\\", memoryStores.size()); payload.put(\\"intent\\", session.getIntent()); payload.put(\\"state\\", session.getState()); audit.audit(ConvEngineAuditStage.MEMORY_UPDATED, session.getConversationId(), payload); return new StepResult.Continue(); } } 25 PersistConversationStep Responsibility: Persist final conversation and result Session Mutations: finalResult Config/Table Dependencies: ce_conversation Detailed Execution Logic The database commit step. Writes the CeConversation row, saving the mutated contextJson , inputParams , new intentCode , and stateCode . The step is placed at the end so if an exception occurs mid pipeline, the corrupted context is ignored and rolled back natively. // persist conversation sanitizeConversationForPostgres(session); session.getConversation().setStatus(\\"RUNNING\\"); session.getConversation().setUpdatedAt(OffsetDateTime.now()); session.getConversation().setInputParamsJson(session.ejectInputParamsJson()); conversationRepo.save(session.getConversation()); // build FINAL EngineResult EngineResult result = new EngineResult( session.getIntent(), session.getState(), session.getPayload(), session.getContextJson() ); session.setFinalResult(result); Map payload = new LinkedHashMap< (); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.FINAL_RESULT, result); audit.audit(ConvEngineAuditStage.ENGINE_RETURN, session.getConversationId(), payload); return new StepResult.Continue(); } } 26 PipelineEndGuardStep Responsibility: Timing audit + terminal guard Session Mutations: timings Config/Table Dependencies: ce_audit Detailed Execution Logic Timing and safety metrics. Audits the total millisecond execution time from Step 1 to 25. Fires the PIPELINE_COMPLETE audit log. Verifies that the resulting payload isn\'t null. total= ms [ ]\\", session.getConversationId(), totalMs, timingLine); // Optional audit row (single compact record) String payload = \\" \\"; audit.audit(ConvEngineAuditStage.PIPELINE_TIMING, session.getConversationId(), payload); return new StepResult.Continue(); } }","rawContent":"# Pipeline Steps (what each step does) <DbTable title=\\"Step responsibilities\\" columns={[\\"Step\\", \\"Primary responsibility\\", \\"Main session mutations\\", \\"Config/table dependencies\\"]} rows={[ [\\"LoadOrCreateConversationStep\\", \\"Fetch or bootstrap conversation row\\", \\"conversation, intent/state/context sync\\", \\"ce_conversation\\"], [\\"CacheInspectAuditStep\\", \\"Conditionally audit cache snapshot\\", \\"none\\", \\"convengine.audit.cache-inspector property\\"], [\\"ResetConversationStep\\", \\"Early explicit reset\\", \\"intent/state/context/input params reset\\", \\"input flags, command text\\"], [\\"PersistConversationBootstrapStep\\", \\"Ensure conversation row persisted\\", \\"none/metadata\\", \\"ce_conversation\\"], [\\"AuditUserInputStep\\", \\"Persist user input audit\\", \\"none\\", \\"ce_audit\\"], [\\"PolicyEnforcementStep\\", \\"Policy block and stop\\", \\"payload + stop result on block\\", \\"ce_policy\\"], [\\"DialogueActStep\\", \\"Classify user turn action type\\", \\"dialogue_act in input params\\", \\"ce_config (dialogue act mode), ce_audit\\"], [\\"InteractionPolicyStep\\", \\"Decide runtime policy before intent\\", \\"policy_decision, skip_intent_resolution\\", \\"ce_config, session pending state\\"], [\\"ActionLifecycleStep\\", \\"Maintain pending action runtime TTL/status\\", \\"pending_action_runtime context\\", \\"ce_pending_action, ce_audit\\"], [\\"DisambiguationStep\\", \\"Ask question when multiple actions fit\\", \\"pending_clarification question/context\\", \\"ce_pending_action, ce_config, ce_audit\\"], [\\"GuardrailStep\\", \\"Apply guardrails and approval rules\\", \\"guardrail flags/sanitized text\\", \\"ce_config, ce_audit\\"], [\\"IntentResolutionStep\\", \\"Resolve intent with classifier+agent\\", \\"intent/state/clarification fields\\", \\"ce_intent, ce_intent_classifier, ce_config\\"], [\\"ResetResolvedIntentStep\\", \\"Reset on configured reset intent\\", \\"full reset\\", \\"ce_config RESET_INTENT_CODES\\"], [\\"FallbackIntentStateStep\\", \\"Fill missing intent/state defaults\\", \\"intent/state\\", \\"none\\"], [\\"AddContainerDataStep\\", \\"Fetch and attach container data\\", \\"containerData/context merge\\", \\"ce_container_config\\"], [\\"PendingActionStep\\", \\"Execute/reject pending action task\\", \\"pending_action_runtime status/result\\", \\"ce_pending_action, CeTaskExecutor, ce_audit\\"], [\\"ToolOrchestrationStep\\", \\"Run tool_group based orchestration\\", \\"tool_request/tool_result fields\\", \\"ce_tool, ce_mcp_tool, ce_audit\\"], [\\"McpToolStep\\", \\"MCP planner/tool loop\\", \\"context_json.mcp.*\\", \\"ce_mcp_tool, ce_mcp_db_tool, ce_mcp_planner (fallback ce_config)\\"], [\\"SchemaExtractionStep\\", \\"Schema-driven extraction and lock handling\\", \\"schema facts/context/lock\\", \\"ce_output_schema, ce_prompt_template\\"], [\\"AutoAdvanceStep\\", \\"Compute schema status facts\\", \\"schemaComplete/hasAny\\", \\"resolved schema + context\\"], [\\"RulesStep\\", \\"Match and apply transitions/actions\\", \\"intent/state/input params\\", \\"ce_rule\\"], [\\"StateGraphStep\\", \\"Validate state transition path\\", \\"state_graph_valid/reason\\", \\"ce_state_graph, ce_audit\\"], [\\"ResponseResolutionStep\\", \\"Resolve and generate output payload\\", \\"payload/last assistant json\\", \\"ce_response, ce_prompt_template\\"], [\\"MemoryStep\\", \\"Write memory/session summary\\", \\"memory.session_summary in context\\", \\"ce_memory, ce_audit\\"], [\\"PersistConversationStep\\", \\"Persist final conversation and result\\", \\"finalResult\\", \\"ce_conversation\\"], [\\"PipelineEndGuardStep\\", \\"Timing audit + terminal guard\\", \\"timings\\", \\"ce_audit\\"], ]} /> :::tip Hook where you need precision - Before schema extraction: normalize inputs - After rules: inspect intent/state transition correctness - Before response resolution: inject display hints ::: <Highlight type=\\"info\\" title=\\"Rule phases\\"> Rules execute by phase. Available native phases include PRE_RESPONSE_RESOLUTION , POST_AGENT_INTENT , POST_AGENT_MCP , and POST_TOOL_EXECUTION . </Highlight> <Highlight type=\\"warning\\" title=\\"Don\u2019t hardcode transitions in steps\\"> Prefer transitions in ce_rule unless absolutely framework-level behavior is required. This keeps domain behavior data-driven and testable via audit traces. </Highlight> <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">1</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>LoadOrCreateConversationStep</span> </div> </div> **Responsibility:** Fetch or bootstrap conversation row **Session Mutations:** conversation, intent/state/context sync **Config/Table Dependencies:** ce_conversation <details open> <summary>Detailed Execution Logic</summary> This is the **initial bootstrap step** of the runtime engine. It uses the conversationId provided in the HTTP request to lookup an existing CeConversation row in the Postgres database. If the conversation exists: - The context JSON is hydrated into the runtime EngineSession . - Previous intent and state codes are restored. - All stored memory summaries and pending actions are fetched from the database and loaded into memory. If the conversation is new: - A new CeConversation entity is instantiated. - The intent and state default to UNKNOWN . This ensures that regardless of scale, the API is entirely stateless and can route requests to any pod. <CodeBlockToggle title=\\"LoadOrCreateConversationStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/LoadOrCreateConversationStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { UUID id = session.getConversationId(); CeConversation convo = conversationRepo.findById(id).orElseGet(() -> createNewConversation(id, conversationRepo)); convo.setLastUserText(session.getUserText()); convo.setUpdatedAt(OffsetDateTime.now()); session.setConversation(convo); session.syncFromConversation(); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">2</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>CacheInspectAuditStep</span> </div> </div> **Responsibility:** Conditionally audit cache snapshot **Session Mutations:** none **Config/Table Dependencies:** convengine.audit.cache-inspector property <details open> <summary>Detailed Execution Logic</summary> Dynamically runs if convengine.audit.cache-inspector is true. It takes a complete JSON snapshot of the hydrated EngineSession conversation cache tree and logs it under the CACHE_INSPECTION priority stage before explicit user input audits are finalized. <CodeBlockToggle title=\\"CacheInspectAuditStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/CacheInspectAuditStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { Map<String, Object> payload = new LinkedHashMap<>(); payload.put(\\"cache_snapshot\\", objectMapper.valueToTree(session.getConversation())); auditService.audit(ConvEngineAuditStage.CACHE_INSPECTION, session.getConversationId(), payload); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">3</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>ResetConversationStep</span> </div> </div> **Responsibility:** Early explicit reset **Session Mutations:** intent/state/context/input params reset **Config/Table Dependencies:** input flags, command text <details open> <summary>Detailed Execution Logic</summary> Checks EngineSession properties to see if an explicit reset has been triggered by the invoking consumer (this is usually passed as a param like _reset=true ). When triggered, it clears: - The intent and state trackers. - The contextJson (wiping all extracted schema facts). - The inputParamsJson . The session is marked as \\\\ RUNNING\\\\ again, but completely fresh. An audit event CONVERSATION_RESET is logged. <CodeBlockToggle title=\\"ResetConversationStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/ResetConversationStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { if (!shouldReset(session)) { return new StepResult.Continue(); } String reason = resetReason(session); session.resetForConversationRestart(); session.getConversation().setStatus(\\"RUNNING\\"); session.getConversation().setIntentCode(\\"UNKNOWN\\"); session.getConversation().setStateCode(\\"UNKNOWN\\"); session.getConversation().setContextJson(\\"{}\\"); session.getConversation().setInputParamsJson(\\"{}\\"); session.getConversation().setLastAssistantJson(null); session.getConversation().setUpdatedAt(OffsetDateTime.now()); conversationRepository.save(session.getConversation()); Map<String, Object> payload = new LinkedHashMap<>(); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.REASON, reason); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.CONTEXT, session.getContextJson()); audit.audit(ConvEngineAuditStage.CONVERSATION_RESET, session.getConversationId(), payload); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">4</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>PersistConversationBootstrapStep</span> </div> </div> **Responsibility:** Ensure conversation row persisted **Session Mutations:** none/metadata **Config/Table Dependencies:** ce_conversation <details open> <summary>Detailed Execution Logic</summary> A simple lifecycle checkpoint to ensure the conversation has a createdAt timestamp. If the user session just started in LoadOrCreateConversationStep , this step performs the initial INSERT (ce_conversation) to the database to ensure foreign-key dependencies (like audit logs) don\'t fail later in the loop. <CodeBlockToggle title=\\"PersistConversationBootstrapStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/PersistConversationBootstrapStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { if (session.getConversation().getCreatedAt() == null) { session.getConversation().setCreatedAt(OffsetDateTime.now()); session.getConversation().setUpdatedAt(OffsetDateTime.now()); conversationRepo.save(session.getConversation()); } return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">5</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>AuditUserInputStep</span> </div> </div> **Responsibility:** Persist user input audit **Session Mutations:** none **Config/Table Dependencies:** ce_audit <details open> <summary>Detailed Execution Logic</summary> Records the raw text query the user typed on this turn into the ce_audit table. This is purely for debug tracing and business analytics. It binds the USER_INPUT audit stage with the conversation ID and the text payload. <CodeBlockToggle title=\\"AuditUserInputStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/AuditUserInputStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { Map<String, Object> payload = new LinkedHashMap<>(); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.TEXT, session.getUserText()); audit.audit(ConvEngineAuditStage.USER_INPUT, session.getConversationId(), payload); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">6</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>PolicyEnforcementStep</span> </div> </div> **Responsibility:** Policy block and stop **Session Mutations:** payload + stop result on block **Config/Table Dependencies:** ce_policy <details open> <summary>Detailed Execution Logic</summary> Secures the pipeline against prohibited input using ce_policy . It reads all active rows from ce_policy , executing either REGEX , EXACT , or LLM rules against the user\'s raw text. If a match occurs: - The conversation is forced to a \\\\ BLOCKED\\\\ status. - A StepResult.Stop() is returned immediately, skipping all remaining NLP and intent steps. - The ce_policy.response_text is loaded as the final payload shipped back to the consumer. <CodeBlockToggle title=\\"PolicyEnforcementStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/PolicyEnforcementStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { String userText = session.getUserText(); for (CePolicy policy : policyRepo.findByEnabledTrueOrderByPriorityAsc()) { if (matches(policy.getRuleType(), policy.getPattern(), userText)) { Map<String, Object> payload = new LinkedHashMap<>(); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.POLICY_ID, policy.getPolicyId()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.RULE_TYPE, policy.getRuleType()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.PATTERN, policy.getPattern()); audit.audit(ConvEngineAuditStage.POLICY_BLOCK, session.getConversationId(), payload); session.getConversation().setStatus(\\"BLOCKED\\"); session.getConversation().setLastAssistantJson(jsonText(policy.getResponseText())); session.getConversation().setUpdatedAt(OffsetDateTime.now()); conversationRepo.save(session.getConversation()); EngineResult out = new EngineResult( session.getIntent(), session.getState(), new TextPayload(policy.getResponseText()), session.getContextJson() ); return new StepResult.Stop(out); } } return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">7</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>DialogueActStep</span> </div> </div> **Responsibility:** Classify user turn action type **Session Mutations:** dialogue_act in input params **Config/Table Dependencies:** ce_config (dialogue act mode), ce_audit <details open> <summary>Detailed Execution Logic</summary> This step attempts to classify the raw user text into an explicit conversational \\"act\\" through Regex, and optionally as fallback, a LLM request depending on the strictness of convengine.flow.dialogue-act.resolute (e.g., REGEX_THEN_LLM ). If convengine.flow.queryRewrite.enabled=true and the conversionHistory is present, the step morphs its LLM request into a dual **Classifier & RAG Context Optimizer**. It supplies the ongoing conversation to the LLM to rewrite ambiguous pronouns into an explicit standalone search query, returning it as \\"standaloneQuery\\" . The core parameters for these prompts are dynamically loaded from ce_config , allowing administrators to Hot-Swap classifier behaviors in production without recompiling Java arrays. ### Supported Dialogue Acts | Enum Name | Purpose | |---------------|---------| | AFFIRM | The user expressed agreement or confirmation (e.g., \\"yes\\", \\"go ahead\\"). Can override Guardrails or execute Pending Actions. | | NEGATE | The user expressed rejection or cancellation (e.g., \\"no\\", \\"stop\\"). Can cancel active Interaction Policies. | | EDIT | The user wants to change previously supplied context or entity slots. | | RESET | The user wants to clear memory and start completely fresh. | | QUESTION | The user is asking a direct conversational question (triggers fallback intent workflows). | | NEW_REQUEST | The baseline generic classification. Engine routes normally. | | GREETING | The user issued a pleasantry (\\"Hi\\", \\"Hello\\"). Typically bypassed by downstream Orchestrators to prevent expensive RAG queries. | ### Source Execution Profile <Highlight type=\\"tip\\" title=\\"Regex Guardrails\\"> Notice in the source that if the LLM predicts an EDIT or RESET act, but the user\'s text did not match the explicit EDIT or RESET regex, the engine overrides the LLM prediction down to a REGEX_GUARD fallback. This prevents the LLM from hallucinating an edit on a brand new, complex sentence. </Highlight> <CodeBlockToggle title=\\"DialogueActStep.java (Simplified)\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/DialogueActStep.java\\" defaultOpen={true}> { @MustRunAfter(AuditUserInputStep.class) @MustRunBefore(IntentResolutionStep.class) public class DialogueActStep implements EngineStep { private final ConvEngineFlowConfig flowConfig; private final CeConfigResolver configResolver; // Extracted from ce_config during Application Initialization private Pattern REGEX_GREETING; private Pattern REGEX_AFFIRM; private Pattern REGEX_NEGATE; private String SYSTEM_PROMPT; private String QUERY_REWRITE_SYSTEM_PROMPT; // ... @PostConstruct public void init() { // Core Regex Evaluation Patterns mapped securely in ce_config REGEX_GREETING = Pattern.compile( configResolver.resolveString(this, \\"REGEX_GREETING\\", \\"^(\\\\\\\\s)*(hi|hello|hey|greetings|good morning|...)$\\"), Pattern.CASE_INSENSITIVE ); // Loads from ce_config where config_type=\\"DialogueActStep\\" and config_key=\\"SYSTEM_PROMPT\\". SYSTEM_PROMPT = configResolver.resolveString(this, \\"SYSTEM_PROMPT\\", \\"\\"\\" You are a dialogue-act classifier. Return JSON only with: {\\"dialogueAct\\":\\"AFFIRM|NEGATE|EDIT|RESET|QUESTION|NEW_REQUEST|GREETING\\",\\"confidence\\":0.0} \\"\\"\\"); // Loads the query-rewrite variant QUERY_REWRITE_SYSTEM_PROMPT = configResolver.resolveString(this, \\"QUERY_REWRITE_SYSTEM_PROMPT\\", \\"\\"\\" You are a dialogue-act classifier and intelligent query search rewriter. Using the conversation history, rewrite the user\'s text into an explicit, standalone query that perfectly describes their intent without needing the conversation history context. Also classify their dialogue act. Return JSON only matching the exact schema. \\"\\"\\"); } @Override public StepResult execute(EngineSession session) { String userText = session.getUserText(); // 1. Regex Classification First DialogueActResult regexResult = classifyByRegex(userText); // 2. Resolve final intention DialogueActResult resolved = resolveByMode(session, userText, regexResult); // 3. Mutate Global Session session.putInputParam(ConvEngineInputParamKey.DIALOGUE_ACT, resolved.act().name()); session.putInputParam(ConvEngineInputParamKey.DIALOGUE_ACT_CONFIDENCE, resolved.confidence()); if (resolved.standaloneQuery() != null) { session.putInputParam(ConvEngineInputParamKey.STANDALONE_QUERY, resolved.standaloneQuery()); session.setStandaloneQuery(resolved.standaloneQuery()); } return new StepResult.Continue(); } } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">8</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>InteractionPolicyStep</span> </div> </div> **Responsibility:** Decide runtime policy before intent **Session Mutations:** policy_decision, skip_intent_resolution **Config/Table Dependencies:** ce_config, session pending state <details open> <summary>Detailed Execution Logic</summary> Uses the identified DialogueAct to decide how the engine should route the turn. This step prevents the system from confusing follow-up answers (like saying \\"yes\\") with new intents. The output maps to the InteractionPolicyDecision enum: - ** EXECUTE_PENDING_ACTION **: If the DialogueAct is AFFIRM and there\'s a background API task waiting. - ** REJECT_PENDING_ACTION **: If NEGATE and an action is waiting. - ** FILL_PENDING_SLOT **: If the user is currently answering a schema extraction question. - ** RECLASSIFY_INTENT **: If this is a NEW_REQUEST . **Evaluation Matrix Flow:** 1. Checks for context hints: hasPendingAction , hasPendingSlot , hasResolvedIntent , hasResolvedState . 2. First, it attempts a lookup using the resolveFromMatrix() method against any custom configurations in your YAML properties. 3. If no custom matrix decision applies, it checks boolean flags from the config. - isExecutePendingOnAffirm() : If true, AFFIRM + hasPendingAction -> EXECUTE_PENDING_ACTION - isRejectPendingOnNegate() : If true, NEGATE + hasPendingAction -> REJECT_PENDING_ACTION - isFillPendingSlotOnNonNewRequest() : If true, != NEW_REQUEST && != GREETING + hasPendingSlot -> FILL_PENDING_SLOT 4. Most crucially, if any of these policy decisions trigger, it sets skipIntentResolution = true . This stops Step 11 ( IntentResolutionStep ) from overriding the sticky intent. The payload is attached with POLICY_DECISION . <CodeBlockToggle title=\\"InteractionPolicyStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/InteractionPolicyStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { String dialogueActRaw = session.inputParamAsString(ConvEngineInputParamKey.DIALOGUE_ACT); DialogueAct dialogueAct = parseDialogueAct(dialogueActRaw); Map<String, Object> context = session.contextDict(); Map<String, Object> inputParams = session.getInputParams(); boolean hasPendingAction = hasValue(context.get(\\"pending_action\\")) || hasValue(context.get(\\"pendingAction\\")) || hasValue(inputParams.get(\\"pending_action\\")) || hasValue(inputParams.get(\\"pendingAction\\")) || hasValue(inputParams.get(ConvEngineInputParamKey.PENDING_ACTION_KEY)) || hasValue(inputParams.get(\\"pending_action_task\\")) || hasPendingActionFromRegistry(session); boolean hasPendingSlot = hasValue(context.get(\\"pending_slot\\")) || hasValue(context.get(\\"pendingSlot\\")); boolean hasResolvedIntent = session.getIntent() != null && !session.getIntent().isBlank() && !\\"UNKNOWN\\".equalsIgnoreCase(session.getIntent()); boolean hasResolvedState = session.getState() != null && !session.getState().isBlank() && !\\"UNKNOWN\\".equalsIgnoreCase(session.getState()); boolean requireResolvedIntentAndState = flowConfig.getInteractionPolicy().isRequireResolvedIntentAndState(); boolean hasResolvedContext = !requireResolvedIntentAndState || (hasResolvedIntent && hasResolvedState); InteractionPolicyDecision decision = InteractionPolicyDecision.RECLASSIFY_INTENT; boolean skipIntentResolution = false; if (hasResolvedContext) { InteractionPolicyDecision matrixDecision = resolveFromMatrix(hasPendingAction, hasPendingSlot, dialogueAct); if (matrixDecision != null) { decision = matrixDecision; skipIntentResolution = true; } else if (flowConfig.getInteractionPolicy().isExecutePendingOnAffirm() && hasPendingAction && dialogueAct == DialogueAct.AFFIRM) { decision = InteractionPolicyDecision.EXECUTE_PENDING_ACTION; skipIntentResolution = true; } else if (flowConfig.getInteractionPolicy().isRejectPendingOnNegate() && hasPendingAction && dialogueAct == DialogueAct.NEGATE) { decision = InteractionPolicyDecision.REJECT_PENDING_ACTION; skipIntentResolution = true; } else if (flowConfig.getInteractionPolicy().isFillPendingSlotOnNonNewRequest() && hasPendingSlot && dialogueAct != DialogueAct.NEW_REQUEST) { decision = InteractionPolicyDecision.FILL_PENDING_SLOT; skipIntentResolution = true; } } session.putInputParam(ConvEngineInputParamKey.POLICY_DECISION, decision.name()); session.putInputParam(ConvEngineInputParamKey.SKIP_INTENT_RESOLUTION, skipIntentResolution); Map<String, Object> payload = new LinkedHashMap<>(); payload.put(ConvEnginePayloadKey.DIALOGUE_ACT, dialogueAct.name()); payload.put(ConvEnginePayloadKey.POLICY_DECISION, decision.name()); payload.put(ConvEnginePayloadKey.SKIP_INTENT_RESOLUTION, skipIntentResolution); payload.put(\\"hasPendingAction\\", hasPendingAction); payload.put(\\"hasPendingSlot\\", hasPendingSlot); payload.put(ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(ConvEnginePayloadKey.STATE, session.getState()); audit.audit(ConvEngineAuditStage.INTERACTION_POLICY_DECIDED, session.getConversationId(), payload); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">9</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>ActionLifecycleStep</span> </div> </div> **Responsibility:** Maintain pending action runtime TTL/status **Session Mutations:** pending_action_runtime context **Config/Table Dependencies:** ce_pending_action, ce_audit <details open> <summary>Detailed Execution Logic</summary> Tracks time-to-live (TTL) for CePendingAction rows. If the user was asked \\"Are you sure you want to cancel?\\" 3 turns ago, but started talking about the weather instead, this step will mark the pending_action_runtime as EXPIRED . Status transitions (Enum PendingActionStatus ): - OPEN : Task is created but waiting for user confirmation. - IN_PROGRESS : The user affirmed, and the task is ready to execute. - REJECTED : The user negated. - EXPIRED : The TTL turn limit was reached before the user confirmed. <CodeBlockToggle title=\\"ActionLifecycleStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/ActionLifecycleStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { if (!flowConfig.getActionLifecycle().isEnabled()) { return new StepResult.Continue(); } ObjectNode root = contextHelper.readRoot(session); ObjectNode runtime = contextHelper.ensureObject(root, RUNTIME_NODE); int currentTurn = session.conversionHistory().size() + 1; long now = Instant.now().toEpochMilli(); PendingActionStatus currentStatus = PendingActionStatus.from(runtime.path(\\"status\\").asText(null), null); if (isExpired(runtime, currentTurn, now) && (currentStatus == PendingActionStatus.OPEN || currentStatus == PendingActionStatus.IN_PROGRESS)) { runtime.put(\\"status\\", PendingActionStatus.EXPIRED.name()); runtime.put(\\"expired_turn\\", currentTurn); runtime.put(\\"expired_at_epoch_ms\\", now); session.putInputParam(ConvEngineInputParamKey.PENDING_ACTION_RUNTIME_STATUS, PendingActionStatus.EXPIRED.name()); audit.audit(ConvEngineAuditStage.PENDING_ACTION_LIFECYCLE, session.getConversationId(), mapOf( \\"event\\", \\"EXPIRED\\", \\"status\\", PendingActionStatus.EXPIRED.name(), \\"turn\\", currentTurn )); } String actionKey = resolveActionKey(session); String actionRef = resolveActionReferenceFromTable(session, actionKey); if (actionRef == null || actionRef.isBlank()) { contextHelper.writeRoot(session, root); return new StepResult.Continue(); } boolean isNewRuntime = isRuntimeNew(runtime, actionKey, actionRef); if (isNewRuntime) { runtime.put(\\"action_key\\", actionKey == null ? \\"\\" : actionKey); runtime.put(\\"action_ref\\", actionRef); runtime.put(\\"status\\", PendingActionStatus.OPEN.name()); runtime.put(\\"created_turn\\", currentTurn); runtime.put(\\"created_at_epoch_ms\\", now); runtime.put(\\"expires_turn\\", flowConfig.getActionLifecycle().getTtlTurns() > 0 ? currentTurn + flowConfig.getActionLifecycle().getTtlTurns() : -1); runtime.put(\\"expires_at_epoch_ms\\", flowConfig.getActionLifecycle().getTtlMinutes() > 0 ? now + (flowConfig.getActionLifecycle().getTtlMinutes() * 60_000L) : -1); session.putInputParam(ConvEngineInputParamKey.PENDING_ACTION_RUNTIME_STATUS, PendingActionStatus.OPEN.name()); audit.audit(ConvEngineAuditStage.PENDING_ACTION_LIFECYCLE, session.getConversationId(), mapOf( \\"event\\", \\"OPEN\\", \\"status\\", PendingActionStatus.OPEN.name(), \\"actionKey\\", actionKey, \\"actionRef\\", actionRef )); } InteractionPolicyDecision decision = parseDecision(session.inputParamAsString(ConvEngineInputParamKey.POLICY_DECISION)); if (decision == InteractionPolicyDecision.EXECUTE_PENDING_ACTION) { runtime.put(\\"status\\", PendingActionStatus.IN_PROGRESS.name()); runtime.put(\\"in_progress_turn\\", currentTurn); runtime.put(\\"in_progress_at_epoch_ms\\", now); session.putInputParam(ConvEngineInputParamKey.PENDING_ACTION_RUNTIME_STATUS, PendingActionStatus.IN_PROGRESS.name()); audit.audit(ConvEngineAuditStage.PENDING_ACTION_LIFECYCLE, session.getConversationId(), mapOf( \\"event\\", \\"IN_PROGRESS\\", \\"status\\", PendingActionStatus.IN_PROGRESS.name(), \\"actionKey\\", actionKey, \\"actionRef\\", actionRef )); } else if (decision == InteractionPolicyDecision.REJECT_PENDING_ACTION) { runtime.put(\\"status\\", PendingActionStatus.REJECTED.name()); runtime.put(\\"rejected_turn\\", currentTurn); runtime.put(\\"rejected_at_epoch_ms\\", now); session.putInputParam(ConvEngineInputParamKey.PENDING_ACTION_RUNTIME_STATUS, PendingActionStatus.REJECTED.name()); audit.audit(ConvEngineAuditStage.PENDING_ACTION_LIFECYCLE, session.getConversationId(), mapOf( \\"event\\", \\"REJECTED\\", \\"status\\", PendingActionStatus.REJECTED.name(), \\"actionKey\\", actionKey, \\"actionRef\\", actionRef )); } contextHelper.writeRoot(session, root); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">10</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>DisambiguationStep</span> </div> </div> **Responsibility:** Ask question when multiple actions fit **Session Mutations:** pending_clarification question/context **Config/Table Dependencies:** ce_pending_action, ce_config, ce_audit <details open> <summary>Detailed Execution Logic</summary> A smart conversational router. If multiple pending actions apply to the current context (e.g., \\"Cancel flight\\" vs \\"Cancel hotel\\" both valid), it pauses the pipeline. It dynamically builds a multiple-choice prompt (or LLM synthesis) asking the user to clarify which action they meant. It emits an ASSISTANT_OUTPUT step, stalling the pipeline until the user clarifies. <CodeBlockToggle title=\\"DisambiguationStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/DisambiguationStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { if (!flowConfig.getDisambiguation().isEnabled()) { return new StepResult.Continue(); } InteractionPolicyDecision decision = parseDecision(session.inputParamAsString(ConvEngineInputParamKey.POLICY_DECISION)); if (decision != InteractionPolicyDecision.EXECUTE_PENDING_ACTION) { return new StepResult.Continue(); } String explicitActionKey = session.inputParamAsString(ConvEngineInputParamKey.PENDING_ACTION_KEY); if (explicitActionKey != null && !explicitActionKey.isBlank()) { return new StepResult.Continue(); } List<CePendingAction> candidates = pendingActionRepository.findEligibleByIntentAndStateOrderByPriorityAsc( session.getIntent(), session.getState() ); if (candidates == null || candidates.size() <= 1) { return new StepResult.Continue(); } int bestPriority = candidates.getFirst().getPriority() == null ? Integer.MAX_VALUE : candidates.getFirst().getPriority(); List<CePendingAction> top = candidates.stream() .filter(c -> (c.getPriority() == null ? Integer.MAX_VALUE : c.getPriority()) == bestPriority) .toList(); if (top.size() <= 1) { return new StepResult.Continue(); } Set<String> options = new LinkedHashSet<>(); for (CePendingAction row : top) { if (row.getActionKey() == null || row.getActionKey().isBlank()) { continue; } String option = row.getActionKey().trim(); if (row.getDescription() != null && !row.getDescription().isBlank()) { option = option + \\" (\\" + row.getDescription().trim() + \\")\\"; } options.add(option); if (options.size() >= Math.max(1, flowConfig.getDisambiguation().getMaxOptions())) { break; } } if (options.isEmpty()) { return new StepResult.Continue(); } QuestionResult questionResult = buildQuestion(session, top, options); String question = questionResult.question(); session.setPendingClarificationQuestion(question); session.setPendingClarificationReason(\\"PENDING_ACTION_DISAMBIGUATION\\"); session.putInputParam(ConvEngineInputParamKey.POLICY_DECISION, InteractionPolicyDecision.RECLASSIFY_INTENT.name()); session.putInputParam(ConvEngineInputParamKey.PENDING_ACTION_DISAMBIGUATION_REQUIRED, true); Map<String, Object> payload = new LinkedHashMap<>(); payload.put(ConvEnginePayloadKey.REASON, \\"MULTIPLE_PENDING_ACTIONS\\"); payload.put(ConvEnginePayloadKey.QUESTION, question); payload.put(ConvEnginePayloadKey.CANDIDATE_COUNT, top.size()); payload.put(ConvEnginePayloadKey.OPTIONS, new ArrayList<>(options)); payload.put(ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(ConvEnginePayloadKey.STATE, session.getState()); payload.put(ConvEnginePayloadKey.QUESTION_SOURCE, questionResult.source()); audit.audit(ConvEngineAuditStage.DISAMBIGUATION_REQUIRED, session.getConversationId(), payload); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">11</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>GuardrailStep</span> </div> </div> **Responsibility:** Apply guardrails and approval rules **Session Mutations:** guardrail flags/sanitized text **Config/Table Dependencies:** ce_config, ce_audit <details open> <summary>Detailed Execution Logic</summary> The last line of defense before intent triggers. Reads the ce_config guardrail thresholds and sanitize instructions. If a command is flagged as \\"sensitive\\" (e.g., destructive actions like closing an account), it can force an explicit SENSITIVE_ACTION_APPROVAL_REQUIRED pause, blocking the pipeline from executing tasks until MFA or explicit user verification is acquired. <CodeBlockToggle title=\\"GuardrailStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/GuardrailStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { if (!flowConfig.getGuardrail().isEnabled()) { return new StepResult.Continue(); } String originalUserText = session.getUserText() == null ? \\"\\" : session.getUserText(); String sanitizedUserText = sanitize(originalUserText); if (flowConfig.getGuardrail().isSanitizeInput()) { session.putInputParam(ConvEngineInputParamKey.SANITIZED_USER_TEXT, sanitizedUserText); } boolean sensitive = matchesSensitivePattern(sanitizedUserText); boolean approvalRequired = flowConfig.getGuardrail().isRequireApprovalForSensitiveActions() && sensitive; boolean approvalGranted = isApprovalGranted(session); boolean failClosed = flowConfig.getGuardrail().isApprovalGateFailClosed(); boolean denied = approvalRequired && (!approvalGranted || failClosed && !approvalGranted); if (denied) { session.putInputParam(ConvEngineInputParamKey.GUARDRAIL_BLOCKED, true); session.putInputParam(ConvEngineInputParamKey.GUARDRAIL_REASON, \\"SENSITIVE_ACTION_APPROVAL_REQUIRED\\"); session.putInputParam(ConvEngineInputParamKey.POLICY_DECISION, InteractionPolicyDecision.RECLASSIFY_INTENT.name()); session.putInputParam(ConvEngineInputParamKey.SKIP_TOOL_EXECUTION, true); session.putInputParam(ConvEngineInputParamKey.SKIP_PENDING_ACTION_EXECUTION, true); Map<String, Object> payload = new LinkedHashMap<>(); payload.put(\\"result\\", \\"DENY\\"); payload.put(\\"reason\\", \\"SENSITIVE_ACTION_APPROVAL_REQUIRED\\"); payload.put(\\"sensitive\\", true); payload.put(\\"approvalGranted\\", approvalGranted); payload.put(\\"userText\\", sanitizedUserText); payload.put(\\"intent\\", session.getIntent()); payload.put(\\"state\\", session.getState()); audit.audit(ConvEngineAuditStage.GUARDRAIL_DENY, session.getConversationId(), payload); return new StepResult.Continue(); } session.putInputParam(ConvEngineInputParamKey.GUARDRAIL_BLOCKED, false); Map<String, Object> payload = new LinkedHashMap<>(); payload.put(\\"result\\", \\"ALLOW\\"); payload.put(\\"sensitive\\", sensitive); payload.put(\\"approvalRequired\\", approvalRequired); payload.put(\\"approvalGranted\\", approvalGranted); payload.put(\\"intent\\", session.getIntent()); payload.put(\\"state\\", session.getState()); audit.audit(ConvEngineAuditStage.GUARDRAIL_ALLOW, session.getConversationId(), payload); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">12</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>IntentResolutionStep</span> </div> </div> **Responsibility:** Resolve intent with classifier+agent **Session Mutations:** intent/state/clarification fields **Config/Table Dependencies:** ce_intent, ce_intent_classifier, ce_config <details open> <summary>Detailed Execution Logic</summary> The primary intent matching gateway. Uses the CompositeIntentResolver (which merges Regex, Semantic Search, and LLM classifiers based off ce_intent_classifier ). If the interaction policy decided we are in FILL_PENDING_SLOT mode, this step is bypassed entirely (referred to as a \\"Locked Intent\\"). Otherwise: - Queries ce_intent_classifier for matches. - Uses INTENT_RESOLVED audit logs to map the intentCode . - Sets the context state to IDLE (or whatever the initial configuration demands). <CodeBlockToggle title=\\"IntentResolutionStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/IntentResolutionStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { String previousIntent = session.getIntent(); Map<String, Object> startPayload = new LinkedHashMap<>(); startPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.PREVIOUS_INTENT, previousIntent); startPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT_LOCKED, session.isIntentLocked()); startPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT_LOCK_REASON, session.getIntentLockReason()); audit.audit(ConvEngineAuditStage.INTENT_RESOLVE_START, session.getConversationId(), startPayload); if (session.isIntentLocked() || isActiveSchemaCollection(session)) { if (!session.isIntentLocked()) { session.lockIntent(\\"SCHEMA_INCOMPLETE\\"); } session.clearClarification(); if (session.getConversation() != null) { session.getConversation().setIntentCode(session.getIntent()); session.getConversation().setStateCode(session.getState()); } Map<String, Object> payload = new LinkedHashMap<>(); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT_LOCKED, session.isIntentLocked()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT_LOCK_REASON, session.getIntentLockReason()); audit.audit(ConvEngineAuditStage.INTENT_RESOLVE_SKIPPED_SCHEMA_COLLECTION, session.getConversationId(), payload); return new StepResult.Continue(); } if (shouldSkipResolutionForPolicy(session)) { if (session.getConversation() != null) { session.getConversation().setIntentCode(session.getIntent()); session.getConversation().setStateCode(session.getState()); } Map<String, Object> payload = new LinkedHashMap<>(); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.DIALOGUE_ACT, session.inputParamAsString(ConvEngineInputParamKey.DIALOGUE_ACT)); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.POLICY_DECISION, session.inputParamAsString(ConvEngineInputParamKey.POLICY_DECISION)); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.SKIP_INTENT_RESOLUTION, true); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.REASON, \\"policy decision retained existing intent/state\\"); audit.audit(ConvEngineAuditStage.INTENT_RESOLVE_SKIPPED_POLICY, session.getConversationId(), payload); return new StepResult.Continue(); } if (shouldSkipResolutionForStickyIntent(session)) { if (session.getConversation() != null) { session.getConversation().setIntentCode(session.getIntent()); session.getConversation().setStateCode(session.getState()); } Map<String, Object> payload = existingIntentRetainedAuditPayload(session); audit.audit(ConvEngineAuditStage.INTENT_RESOLVE_SKIPPED_STICKY_INTENT, session.getConversationId(), payload); return new StepResult.Continue(); } CompositeIntentResolver.IntentResolutionResult result = intentResolver.resolveWithTrace(session); if (result == null || result.resolvedIntent() == null) { audit.audit(ConvEngineAuditStage.INTENT_RESOLVE_NO_CHANGE, session.getConversationId(), Map.of()); return new StepResult.Continue(); } if (!result.resolvedIntent().equals(previousIntent)) { session.setIntent(result.resolvedIntent()); } session.getConversation().setIntentCode(session.getIntent()); session.getConversation().setStateCode(session.getState()); audit.audit( ConvEngineAuditStage.intentResolvedBy(result.source().name()), session.getConversationId(), result ); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">13</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>ResetResolvedIntentStep</span> </div> </div> **Responsibility:** Reset on configured reset intent **Session Mutations:** full reset **Config/Table Dependencies:** ce_config RESET_INTENT_CODES <details open> <summary>Detailed Execution Logic</summary> A quality of life check. If the resolved intent matches one of the RESET_INTENT_CODES configured in Spring configuration (e.g. START_OVER , RESET ), this step immediately executes a session wipe akin to ResetConversationStep , returning the conversation to a clean slate. <CodeBlockToggle title=\\"ResetResolvedIntentStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/ResetResolvedIntentStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { String intent = session.getIntent(); if (intent == null || !resetIntentCodes.contains(intent.trim().toUpperCase())) { return new StepResult.Continue(); } session.resetForConversationRestart(); session.getConversation().setStatus(\\"RUNNING\\"); session.getConversation().setIntentCode(\\"UNKNOWN\\"); session.getConversation().setStateCode(\\"UNKNOWN\\"); session.getConversation().setContextJson(\\"{}\\"); session.getConversation().setInputParamsJson(\\"{}\\"); session.getConversation().setLastAssistantJson(null); session.getConversation().setUpdatedAt(OffsetDateTime.now()); conversationRepository.save(session.getConversation()); Map<String, Object> payload = new LinkedHashMap<>(); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.REASON, \\"INTENT_RESOLVED_RESET\\"); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.MATCHED_RESET_INTENT_CODES, resetIntentCodes); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.CONTEXT, session.getContextJson()); audit.audit(ConvEngineAuditStage.CONVERSATION_RESET, session.getConversationId(), payload); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">14</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>FallbackIntentStateStep</span> </div> </div> **Responsibility:** Fill missing intent/state defaults **Session Mutations:** intent/state **Config/Table Dependencies:** none <details open> <summary>Detailed Execution Logic</summary> A safety net. If the classifier fails to return any confidence, or an exception occurred, this step forcibly binds the native engine defaults to UNKNOWN intent and UNKNOWN state so that ce_rule and ce_response tables can still define fallback messaging (e.g., \\"I didn\'t understand that\\"). <CodeBlockToggle title=\\"FallbackIntentStateStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/FallbackIntentStateStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { if (session.getIntent() == null) { Map<String, Object> payload = new LinkedHashMap<>(); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.CONTEXT, session.contextDict()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.USER_TEXT, session.getUserText()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.FALLBACK_INTENT, fallbackIntent); audit.audit(ConvEngineAuditStage.INTENT_MISSING, session.getConversationId(), payload); session.setIntent(fallbackIntent); } if (session.getState() == null) { Map<String, Object> payload = new LinkedHashMap<>(); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.CONTEXT, session.contextDict()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.USER_TEXT, session.getUserText()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.FALLBACK_STATE, fallbackState); audit.audit(ConvEngineAuditStage.STATE_MISSING, session.getConversationId(), payload); session.setState(fallbackState); } session.getConversation().setIntentCode(session.getIntent()); session.getConversation().setStateCode(session.getState()); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">15</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>AddContainerDataStep</span> </div> </div> **Responsibility:** Fetch and attach container data **Session Mutations:** containerData/context merge **Config/Table Dependencies:** ce_container_config <details open> <summary>Detailed Execution Logic</summary> Bridges static tenant/consumer configurations. Evaluates ce_container_config to pull any global JSON context relevant to the intent and merges it directly into session.contextJson . This allows things like \\"Store Hours\\" or \\"Region Policies\\" to be globally attached to all LLM contexts without hardcoding. <CodeBlockToggle title=\\"AddContainerDataStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/AddContainerDataStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { List<CeContainerConfig> configs = containerConfigRepo.findByIntentAndState( session.getIntent(), session.getState() ); if (configs.isEmpty()) { configs = containerConfigRepo.findFallbackByState(session.getState()); } if (configs.isEmpty()) { configs = containerConfigRepo.findGlobalFallback(); } if (configs.isEmpty()) { Map<String, Object> reasonMap = new HashMap<>(); reasonMap.put(\\"reason\\", \\"no container configs for intent/state\\"); reasonMap.put(\\"intent\\", session.getIntent()); reasonMap.put(\\"state\\", session.getState()); audit.audit( \\"CONTAINER_DATA_SKIPPED\\", session.getConversationId(), reasonMap ); return new StepResult.Continue(); } ObjectNode containerRoot = mapper.createObjectNode(); for (CeContainerConfig cfg : configs) { try { Map<String, Object> inputParams = new HashMap<>(); String key = cfg.getInputParamName(); Object value = session.extractValueFromContext(key); if(value == null) { value = session.getUserText(); } inputParams.put(key, value); if (session.getInputParams() != null) { inputParams.putAll(session.getInputParams()); } if (session.getEngineContext().getInputParams() != null) { inputParams.putAll(session.getEngineContext().getInputParams()); } PageInfoRequest pageInfo = PageInfoRequest.builder() .userId(\\"convengine\\") .loggedInUserId(\\"convengine\\") .pageId(cfg.getPageId()) .sectionId(cfg.getSectionId()) .containerId(cfg.getContainerId()) .inputParams(inputParams) .build(); ContainerComponentRequest req = new ContainerComponentRequest(); req.setPageInfo(List.of(pageInfo)); req.setRequestTypes(List.of(RequestType.CONTAINER)); interceptorExecutor.beforeExecute(req, session); ContainerComponentResponse resp = ccfCoreService.execute(req); resp = interceptorExecutor.afterExecute(resp, session); // find classes with @ContainerDataTransformer(state, intent) to transform resp if needed Map<String, Object> transformedData = transformerService.transformIfApplicable(resp, session, inputParams); JsonNode responseNode = transformedData == null ? mapper.valueToTree(resp) : mapper.valueToTree(transformedData); session.setContainerData(responseNode); containerRoot.set(cfg.getInputParamName(), responseNode); Map<String, Object> jsonMap = Map.of( \\"containerId\\", cfg.getContainerId(), \\"pageId\\", cfg.getPageId(), \\"sectionId\\", cfg.getSectionId(), \\"inputParam\\", cfg.getInputParamName(), \\"requestInput\\", inputParams, \\"response\\", responseNode ); audit.audit( \\"CONTAINER_DATA_EXECUTED\\", session.getConversationId(), jsonMap ); } catch (Exception e) { Map<String, Object> errorJsonMap = new HashMap<>(); errorJsonMap.put(\\"containerId\\", cfg.getContainerId()); errorJsonMap.put(\\"error\\", e.getMessage()); audit.audit( \\"CONTAINER_DATA_FAILED\\", session.getConversationId(), errorJsonMap ); } } if (!containerRoot.isEmpty()) { // attach to session session.setContainerDataJson(containerRoot.toString()); session.setHasContainerData(true); // merge into conversation context try { ObjectNode ctx = (ObjectNode) mapper.readTree(session.getContextJson()); ctx.set(\\"container_data\\", containerRoot); session.setContextJson(mapper.writeValueAsString(ctx)); session.getConversation().setContextJson(session.getContextJson()); } catch (Exception ignore) { // context merge failure should not break pipeline } audit.audit( \\"CONTAINER_DATA_ATTACHED\\", session.getConversationId(), containerRoot.toString() ); } return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">16</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>PendingActionStep</span> </div> </div> **Responsibility:** Execute/reject pending action task **Session Mutations:** pending_action_runtime status/result **Config/Table Dependencies:** ce_pending_action, CeTaskExecutor, ce_audit <details open> <summary>Detailed Execution Logic</summary> Executes Java code. If the InteractionPolicy is EXECUTE_PENDING_ACTION and the status is IN_PROGRESS , this step resolves the Spring Bean ID attached to the ce_pending_action row. It invokes CeTaskExecutor.execute() , runs the backend transaction (e.g. Stripe Refund), and captures the boolean/json result back into the engine EngineSession context for downstream rules to evaluate. <CodeBlockToggle title=\\"PendingActionStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/PendingActionStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { if (Boolean.TRUE.equals(session.getInputParams().get(ConvEngineInputParamKey.SKIP_PENDING_ACTION_EXECUTION)) || Boolean.TRUE.equals(session.getInputParams().get(ConvEngineInputParamKey.GUARDRAIL_BLOCKED))) { Map<String, Object> payload = basePayload(session, InteractionPolicyDecision.RECLASSIFY_INTENT, null); payload.put(ConvEnginePayloadKey.REASON, \\"pending action skipped by guardrail\\"); audit.audit(ConvEngineAuditStage.PENDING_ACTION_SKIPPED, session.getConversationId(), payload); return new StepResult.Continue(); } String decisionRaw = session.inputParamAsString(ConvEngineInputParamKey.POLICY_DECISION); InteractionPolicyDecision decision = parseDecision(decisionRaw); if (decision != InteractionPolicyDecision.EXECUTE_PENDING_ACTION && decision != InteractionPolicyDecision.REJECT_PENDING_ACTION) { return new StepResult.Continue(); } Map<String, Object> context = session.contextDict(); Object pendingAction = context.get(\\"pending_action\\"); if (pendingAction == null) { pendingAction = context.get(\\"pendingAction\\"); } String actionKey = resolveActionKey(session, context, pendingAction); String actionRef = resolveActionReference(session, pendingAction, actionKey); if (actionRef == null || actionRef.isBlank()) { Map<String, Object> payload = basePayload(session, decision, null); payload.put(\\"actionKey\\", actionKey); payload.put(ConvEnginePayloadKey.REASON, actionKey == null || actionKey.isBlank() ? \\"pending action reference not found or ambiguous registry mapping\\" : \\"pending action reference not found\\"); audit.audit(ConvEngineAuditStage.PENDING_ACTION_SKIPPED, session.getConversationId(), payload); return new StepResult.Continue(); } if (decision == InteractionPolicyDecision.REJECT_PENDING_ACTION) { session.putInputParam(ConvEngineInputParamKey.PENDING_ACTION_RESULT, \\"REJECTED\\"); updateRuntimeStatus(session, PendingActionStatus.REJECTED); Map<String, Object> payload = basePayload(session, decision, actionRef); payload.put(ConvEnginePayloadKey.PENDING_ACTION_RESULT, \\"REJECTED\\"); audit.audit(ConvEngineAuditStage.PENDING_ACTION_REJECTED, session.getConversationId(), payload); return new StepResult.Continue(); } String[] taskRef = parseTaskReference(actionRef); if (taskRef == null) { session.putInputParam(ConvEngineInputParamKey.PENDING_ACTION_RESULT, \\"FAILED\\"); Map<String, Object> payload = basePayload(session, decision, actionRef); payload.put(ConvEnginePayloadKey.PENDING_ACTION_RESULT, \\"FAILED\\"); payload.put(ConvEnginePayloadKey.REASON, \\"invalid pending action reference\\"); audit.audit(ConvEngineAuditStage.PENDING_ACTION_FAILED, session.getConversationId(), payload); return new StepResult.Continue(); } Object executionResult = ceTaskExecutor.execute(taskRef[0], taskRef[1], session); if (executionResult == null) { session.putInputParam(ConvEngineInputParamKey.PENDING_ACTION_RESULT, \\"FAILED\\"); Map<String, Object> payload = basePayload(session, decision, actionRef); payload.put(ConvEnginePayloadKey.PENDING_ACTION_RESULT, \\"FAILED\\"); payload.put(ConvEnginePayloadKey.REASON, \\"task execution returned null\\"); audit.audit(ConvEngineAuditStage.PENDING_ACTION_FAILED, session.getConversationId(), payload); return new StepResult.Continue(); } session.putInputParam(ConvEngineInputParamKey.PENDING_ACTION_RESULT, \\"EXECUTED\\"); updateRuntimeStatus(session, PendingActionStatus.EXECUTED); Map<String, Object> payload = basePayload(session, decision, actionRef); payload.put(ConvEnginePayloadKey.PENDING_ACTION_RESULT, \\"EXECUTED\\"); payload.put(\\"taskBean\\", taskRef[0]); payload.put(\\"taskMethods\\", taskRef[1]); audit.audit(ConvEngineAuditStage.PENDING_ACTION_EXECUTED, session.getConversationId(), payload); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">17</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>ToolOrchestrationStep</span> </div> </div> **Responsibility:** Run tool_group based orchestration **Session Mutations:** tool_request/tool_result fields **Config/Table Dependencies:** ce_tool, ce_mcp_tool, ce_audit <details open> <summary>Detailed Execution Logic</summary> The gateway for Model Context Protocol (MCP) tooling. If ce_tool specifies that this intent requires a tool_group , this step binds the request and delegates to an external executor. It pauses the LLM, executes the backend SQL or REST fetch, and dumps the massive JSON result into tool_result dictionary in context. <CodeBlockToggle title=\\"ToolOrchestrationStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/ToolOrchestrationStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { if (!flowConfig.getToolOrchestration().isEnabled()) { return new StepResult.Continue(); } if (Boolean.TRUE.equals(session.getInputParams().get(ConvEngineInputParamKey.SKIP_TOOL_EXECUTION))) { return new StepResult.Continue(); } ToolRequest request = resolveRequest(session); if (request == null) { return new StepResult.Continue(); } session.putInputParam(ConvEngineInputParamKey.TOOL_REQUEST, request.toMap()); audit.audit(ConvEngineAuditStage.TOOL_ORCHESTRATION_REQUEST, session.getConversationId(), request.toMap()); try { CeMcpTool tool = request.toolCode() == null || request.toolCode().isBlank() ? null : registry.requireTool(request.toolCode(), session.getIntent(), session.getState()); String group = request.toolGroup(); if ((group == null || group.isBlank()) && tool != null) { group = registry.normalizeToolGroup(tool.getToolGroup()); } if (group == null || group.isBlank()) { throw new IllegalStateException(\\"tool_group is required when tool_code is not resolvable\\"); } McpToolExecutor executor = resolveExecutor(group); String resultJson = executor.execute(tool, request.args(), session); Map<String, Object> result = new LinkedHashMap<>(); result.put(\\"status\\", \\"SUCCESS\\"); result.put(\\"tool_code\\", request.toolCode()); result.put(\\"tool_group\\", group); result.put(\\"result\\", parseJsonOrString(resultJson)); session.putInputParam(ConvEngineInputParamKey.TOOL_RESULT, result); session.putInputParam(ConvEngineInputParamKey.TOOL_STATUS, \\"SUCCESS\\"); audit.audit(ConvEngineAuditStage.TOOL_ORCHESTRATION_RESULT, session.getConversationId(), result); rulesStep.applyRules(session, \\"ToolOrchestrationStep PostTool\\", RulePhase.POST_TOOL_EXECUTION.name()); } catch (IllegalStateException e) { if (e.getMessage() != null && e.getMessage().contains(\\"Missing enabled MCP tool for current intent/state\\")) { Map<String, Object> result = new LinkedHashMap<>(); result.put(\\"status\\", \\"SKIPPED_SCOPE_MISMATCH\\"); result.put(\\"tool_code\\", request.toolCode()); result.put(\\"tool_group\\", request.toolGroup()); result.put(\\"intent\\", session.getIntent()); result.put(\\"state\\", session.getState()); session.putInputParam(ConvEngineInputParamKey.TOOL_RESULT, result); session.putInputParam(ConvEngineInputParamKey.TOOL_STATUS, \\"SKIPPED_SCOPE_MISMATCH\\"); audit.audit(ConvEngineAuditStage.TOOL_ORCHESTRATION_RESULT, session.getConversationId(), result); return new StepResult.Continue(); } Map<String, Object> result = new LinkedHashMap<>(); result.put(\\"status\\", \\"ERROR\\"); result.put(\\"tool_code\\", request.toolCode()); result.put(\\"tool_group\\", request.toolGroup()); result.put(\\"error\\", String.valueOf(e.getMessage())); session.putInputParam(ConvEngineInputParamKey.TOOL_RESULT, result); session.putInputParam(ConvEngineInputParamKey.TOOL_STATUS, \\"ERROR\\"); audit.audit(ConvEngineAuditStage.TOOL_ORCHESTRATION_ERROR, session.getConversationId(), result); } catch (Exception e) { Map<String, Object> result = new LinkedHashMap<>(); result.put(\\"status\\", \\"ERROR\\"); result.put(\\"tool_code\\", request.toolCode()); result.put(\\"tool_group\\", request.toolGroup()); result.put(\\"error\\", String.valueOf(e.getMessage())); session.putInputParam(ConvEngineInputParamKey.TOOL_RESULT, result); session.putInputParam(ConvEngineInputParamKey.TOOL_STATUS, \\"ERROR\\"); audit.audit(ConvEngineAuditStage.TOOL_ORCHESTRATION_ERROR, session.getConversationId(), result); } return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">18</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>McpToolStep</span> </div> </div> **Responsibility:** MCP planner/tool loop **Session Mutations:** context_json.mcp.* **Config/Table Dependencies:** ce_mcp_tool, ce_mcp_db_tool, ce_mcp_planner (fallback ce_config) <details open> <summary>Detailed Execution Logic</summary> Specifically iterates over ce_mcp_tool bindings. Instead of static grouped tools, this triggers an agent planner that interprets the input, selects an MCP tool, writes the payload, and executes it. This is the core of dynamic tool use in ConvEngine V2. <CodeBlockToggle title=\\"McpToolStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/McpToolStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { if (Boolean.TRUE.equals(session.getInputParams().get(ConvEngineInputParamKey.SKIP_TOOL_EXECUTION)) || Boolean.TRUE.equals(session.getInputParams().get(ConvEngineInputParamKey.GUARDRAIL_BLOCKED))) { session.putInputParam(ConvEngineInputParamKey.MCP_STATUS, \\"SKIPPED_BY_GUARDRAIL\\"); return new StepResult.Continue(); } if (session.hasPendingClarification()) { audit.audit( ConvEngineAuditStage.MCP_SKIPPED_PENDING_CLARIFICATION, session.getConversationId(), mapOf( \\"intent\\", session.getIntent(), \\"state\\", session.getState() ) ); return new StepResult.Continue(); } List<CeMcpTool> tools = registry.listEnabledTools(session.getIntent(), session.getState()); if (CollectionUtils.isEmpty(tools)) { session.putInputParam(ConvEngineInputParamKey.MCP_STATUS, \\"NO_TOOLS_FOR_SCOPE\\"); audit.audit(ConvEngineAuditStage.MCP_NO_TOOLS_AVAILABLE, session.getConversationId(), mapOf(\\"intent\\", session.getIntent(), \\"state\\", session.getState())); return new StepResult.Continue(); } clearMcpContext(session); List<McpObservation> observations = readObservationsFromContext(session); boolean mcpTouched = false; for (int i = 0; i < MAX_LOOPS; i++) { McpPlan plan = planner.plan(session, tools, observations); mcpTouched = true; session.putInputParam(ConvEngineInputParamKey.MCP_ACTION, plan.action()); session.putInputParam(ConvEngineInputParamKey.MCP_TOOL_CODE, plan.tool_code()); session.putInputParam(ConvEngineInputParamKey.MCP_TOOL_ARGS, plan.args() == null ? Map.of() : plan.args()); if (\\"ANSWER\\".equalsIgnoreCase(plan.action())) { // store final answer in contextJson; your ResponseResolutionStep can use it via derivation_hint writeFinalAnswerToContext(session, plan.answer()); session.putInputParam(ConvEngineInputParamKey.MCP_FINAL_ANSWER, plan.answer() == null ? \\"\\" : plan.answer()); session.putInputParam(ConvEngineInputParamKey.MCP_STATUS, \\"ANSWER\\"); audit.audit( ConvEngineAuditStage.MCP_FINAL_ANSWER, session.getConversationId(), mapOf(\\"answer\\", plan.answer()) ); break; } if (!\\"CALL_TOOL\\".equalsIgnoreCase(plan.action())) { writeFinalAnswerToContext(session, \\"I couldn\'t decide the next tool step safely.\\"); session.putInputParam(ConvEngineInputParamKey.MCP_FINAL_ANSWER, \\"I couldn\'t decide the next tool step safely.\\"); session.putInputParam(ConvEngineInputParamKey.MCP_STATUS, \\"FALLBACK\\"); break; } String toolCode = plan.tool_code(); Map<String, Object> args = (plan.args() == null) ? Map.of() : plan.args(); audit.audit( ConvEngineAuditStage.MCP_TOOL_CALL, session.getConversationId(), mapOf(\\"tool_code\\", toolCode, \\"args\\", args) ); CeMcpTool tool = registry.requireTool(toolCode, session.getIntent(), session.getState()); String toolGroup = registry.normalizeToolGroup(tool.getToolGroup()); session.putInputParam(ConvEngineInputParamKey.MCP_TOOL_GROUP, toolGroup); try { McpToolExecutor executor = resolveExecutor(toolGroup); String rowsJson = executor.execute(tool, args, session); observations.add(new McpObservation(toolCode, rowsJson)); writeObservationsToContext(session, observations); session.putInputParam(ConvEngineInputParamKey.MCP_OBSERVATIONS, observations); session.putInputParam(ConvEngineInputParamKey.MCP_STATUS, \\"TOOL_RESULT\\"); audit.audit( ConvEngineAuditStage.MCP_TOOL_RESULT, session.getConversationId(), mapOf(\\"tool_code\\", toolCode, \\"tool_group\\", toolGroup, \\"rows\\", rowsJson) ); } catch (Exception e) { audit.audit( ConvEngineAuditStage.MCP_TOOL_ERROR, session.getConversationId(), mapOf(\\"tool_code\\", toolCode, \\"tool_group\\", toolGroup, \\"error\\", String.valueOf(e.getMessage())) ); writeFinalAnswerToContext(session, \\"Tool execution failed safely. Can you narrow the request?\\"); session.putInputParam(ConvEngineInputParamKey.MCP_FINAL_ANSWER, \\"Tool execution failed safely. Can you narrow the request?\\"); session.putInputParam(ConvEngineInputParamKey.MCP_STATUS, \\"TOOL_ERROR\\"); break; } } if (mcpTouched) { rulesStep.applyRules(session, \\"McpToolStep\\", RulePhase.POST_AGENT_MCP.name()); } session.syncToConversation(); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">19</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>SchemaExtractionStep</span> </div> </div> **Responsibility:** Schema-driven extraction and lock handling **Session Mutations:** schema facts/context/lock **Config/Table Dependencies:** ce_output_schema, ce_prompt_template <details open> <summary>Detailed Execution Logic</summary> Evaluates ce_output_schema . It injects the missing required slots into an LLM extracting prompt using ce_prompt_template . The LLM returns a structured JSON map. This step merges it with session.contextJson . It then runs missingFieldEvaluator.evaluate() . If fields are missing, it sets session.setSchemaLocked(true) . <CodeBlockToggle title=\\"SchemaExtractionStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/SchemaExtractionStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { String intent = session.getIntent(); String state = session.getState(); CeOutputSchema schema = outputSchemaRepo.findAll().stream() .filter(s -> Boolean.TRUE.equals(s.getEnabled())) .filter(s -> equalsIgnoreCase(s.getIntentCode(), intent)) .filter(s -> equalsIgnoreCase(s.getStateCode(), state) || equalsIgnoreCase(s.getStateCode(), \\"ANY\\")) .min((a, b) -> Integer.compare(priorityOf(a), priorityOf(b))) .orElse(null); if (schema != null) { runExtraction(session, schema); } else { session.unlockIntent(); session.setResolvedSchema(null); session.setSchemaComplete(false); session.setSchemaHasAnyValue(false); session.setMissingRequiredFields(new ArrayList<>()); session.setMissingFieldOptions(new LinkedHashMap<>()); session.addPromptTemplateVars(); } session.syncFromConversation(true); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">20</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>AutoAdvanceStep</span> </div> </div> **Responsibility:** Compute schema status facts **Session Mutations:** schemaComplete/hasAny **Config/Table Dependencies:** resolved schema + context <details open> <summary>Detailed Execution Logic</summary> In V1, rules had to manually check if schema extraction was done. In V2, this step computes the boolean flags schemaComplete and hasAny and binds them to the session context. This allows ce_rule to simply trigger on schemaComplete == true . <CodeBlockToggle title=\\"AutoAdvanceStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/AutoAdvanceStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { if (session.getResolvedSchema() == null) { Map<String, Object> payload = new LinkedHashMap<>(); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.REASON, \\"no schema resolved\\"); audit.audit(ConvEngineAuditStage.AUTO_ADVANCE_SKIPPED_NO_SCHEMA, session.getConversationId(), payload); return new StepResult.Continue(); } String schemaJson = session.getResolvedSchema().getJsonSchema(); String contextJson = session.getContextJson(); boolean hasAnySchemaValue = JsonUtil.hasAnySchemaValue(contextJson, schemaJson); boolean schemaComplete = JsonUtil.isSchemaComplete(schemaJson, contextJson); session.setSchemaHasAnyValue(hasAnySchemaValue); session.setSchemaComplete(schemaComplete); Map<String, Object> payload = new LinkedHashMap<>(); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.SCHEMA_COMPLETE, schemaComplete); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.HAS_ANY_SCHEMA_VALUE, hasAnySchemaValue); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); audit.audit(ConvEngineAuditStage.AUTO_ADVANCE_FACTS, session.getConversationId(), payload); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">21</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>RulesStep</span> </div> </div> **Responsibility:** Match and apply transitions/actions **Session Mutations:** intent/state/input params **Config/Table Dependencies:** ce_rule <details open> <summary>Detailed Execution Logic</summary> The core state-machine driver. It queries ce_rule for the current Intent and State. It evaluates expressions (like JSON_PATH or REGEX ) against the session.contextJson . If a rule matches, it executes the target action (e.g. SET_STATE to CONFIRMATION , or SET_TASK ). It loops until no more rules match, effectively \\"auto-advancing\\" state machine nodes. <CodeBlockToggle title=\\"RulesStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/RulesStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { applyRules(session, \\"RulesStep\\", RulePhase.PRE_RESPONSE_RESOLUTION.name()); session.syncToConversation(); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">22</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>StateGraphStep</span> </div> </div> **Responsibility:** Validate state transition path **Session Mutations:** state_graph_valid/reason **Config/Table Dependencies:** ce_state_graph, ce_audit <details open> <summary>Detailed Execution Logic</summary> A strict validater. Checks ce_state_graph to see if the transition that just occurred in RulesStep was legally defined by the developer. If a rule jumped from IDLE to CANCELLED but there is no edge in the graph, this step logs an error and optionally reverts the state to prevent invalid transitions. <CodeBlockToggle title=\\"StateGraphStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/StateGraphStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { if (!flowConfig.getStateGraph().isEnabled()) { return new StepResult.Continue(); } String fromState = session.getConversation() == null ? null : session.getConversation().getStateCode(); String toState = session.getState(); if (fromState == null || fromState.isBlank() || toState == null || toState.isBlank() || fromState.equalsIgnoreCase(toState)) { return new StepResult.Continue(); } boolean allowed = isAllowedTransition(fromState, toState); Map<String, Object> payload = new LinkedHashMap<>(); payload.put(\\"fromState\\", fromState); payload.put(\\"toState\\", toState); payload.put(\\"intent\\", session.getIntent()); payload.put(\\"validateOnly\\", true); if (allowed) { session.putInputParam(ConvEngineInputParamKey.STATE_GRAPH_VALID, true); payload.put(\\"allowed\\", true); audit.audit(ConvEngineAuditStage.STATE_GRAPH_VALID, session.getConversationId(), payload); return new StepResult.Continue(); } payload.put(\\"allowed\\", false); payload.put(\\"softBlock\\", flowConfig.getStateGraph().isSoftBlockOnViolation()); audit.audit(ConvEngineAuditStage.STATE_GRAPH_VIOLATION, session.getConversationId(), payload); session.putInputParam(ConvEngineInputParamKey.STATE_GRAPH_VALID, false); if (flowConfig.getStateGraph().isSoftBlockOnViolation()) { session.putInputParam(ConvEngineInputParamKey.STATE_GRAPH_SOFT_BLOCK, true); } return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">23</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>ResponseResolutionStep</span> </div> </div> **Responsibility:** Resolve and generate output payload **Session Mutations:** payload/last assistant json **Config/Table Dependencies:** ce_response, ce_prompt_template <details open> <summary>Detailed Execution Logic</summary> The final output generator. Queries ce_response for the current intent and state. - If TEXT : Returns a hardcoded string. - If DERIVED : Loads ce_prompt_template , injects the contextJson , tool_result , and schema , and asks the LLM to write a fluid, contextual response to the user. Sets session.getConversation().setLastAssistantJson() with the payload. <CodeBlockToggle title=\\"ResponseResolutionStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/ResponseResolutionStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { if(AgentIntentResolver.INTENT_COLLISION_STATE.equals(session.getState())) { Map<String, Object> payload = new LinkedHashMap<>(); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); audit.audit( ConvEngineAuditStage.INTENT_COLLISION_DETECTED, session.getConversationId(), payload ); agentIntentCollisionResolver.resolve(session); return new StepResult.Continue(); } Optional<CeResponse> responseOptional = resolveResponse(session); if(responseOptional.isEmpty()) { Map<String, Object> payload = new LinkedHashMap<>(); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); audit.audit( ConvEngineAuditStage.RESPONSE_MAPPING_NOT_FOUND, session.getConversationId(), payload ); throw new ConversationEngineException( ConversationEngineErrorCode.RESPONSE_MAPPING_NOT_FOUND, \\"No response found for intent=\\" + session.getIntent() + \\", state=\\" + session.getState() ); } CeResponse resp = responseOptional.get(); if (!matches(resp.getStateCode(), session.getState()) && !matches(resp.getStateCode(), \\"ANY\\")) { session.setState(resp.getStateCode()); session.getConversation().setStateCode(resp.getStateCode()); } Map<String, Object> responsePayload = new LinkedHashMap<>(); responsePayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.RESPONSE_ID, resp.getResponseId()); responsePayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); responsePayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); audit.audit( ConvEngineAuditStage.RESOLVE_RESPONSE, session.getConversationId(), responsePayload ); List<ConversationTurn> conversationTurns = historyProvider.lastTurns(session.getConversationId(), 10); session.setConversationHistory(conversationTurns); CePromptTemplate template = null; if(ResponseType.DERIVED.name().equalsIgnoreCase(resp.getResponseType())) { template = promptRepo.findAll().stream() .filter(t -> Boolean.TRUE.equals(t.getEnabled())) .filter(t -> resp.getOutputFormat().equalsIgnoreCase(t.getResponseType())) .filter(t -> matchesOrNull(t.getIntentCode(), session.getIntent())) .filter(t -> matchesOrNull(t.getStateCode(), session.getState()) || matches(t.getStateCode(), \\"ANY\\")) .max(Comparator.comparingInt(t -> score(t, session))) .orElseThrow(() -> new IllegalStateException( \\"No ce_prompt_template found for response_type=\\" + resp.getOutputFormat() + \\", intent=\\" + session.getIntent() + \\", state=\\" + session.getState() ) ); } typeFactory .get(resp.getResponseType()) .resolve(session, PromptTemplate.initFrom(template), ResponseTemplate.initFrom(resp)); OutputPayload transformedOutput = responseTransformerService.transformIfApplicable(session.getPayload(), session, session.getInputParams()); session.setPayload(transformedOutput); Object payloadValue = switch (session.getPayload()) { case TextPayload(String text) -> text; case JsonPayload(String json) -> json; case null -> null; }; Map<String, Object> outputPayload = new LinkedHashMap<>(); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.OUTPUT, payloadValue); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.OUTPUT_FORMAT, resp.getOutputFormat()); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.RESPONSE_TYPE, resp.getResponseType()); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.RESPONSE_ID, resp.getResponseId()); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.CONTEXT, session.contextDict()); outputPayload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.SCHEMA_JSON, session.schemaJson()); audit.audit(ConvEngineAuditStage.ASSISTANT_OUTPUT, session.getConversationId(), outputPayload); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">24</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>MemoryStep</span> </div> </div> **Responsibility:** Write memory/session summary **Session Mutations:** memory.session_summary in context **Config/Table Dependencies:** ce_memory, ce_audit <details open> <summary>Detailed Execution Logic</summary> Evaluates the rolling history. If ce_memory is configured, and recentTurns exceeds the threshold, this step fires off a summarization prompt to the LLM. It compresses the last N turns into a dense paragraph and saves it as memory.session_summary in the context JSON, enabling infinite-context retention without blowing up token limits. <CodeBlockToggle title=\\"MemoryStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/MemoryStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { if (!flowConfig.getMemory().isEnabled()) { return new StepResult.Continue(); } String recalled = null; for (ConversationMemoryStore store : memoryStores) { try { String value = store.read(session); if (value != null && !value.isBlank()) { recalled = value; break; } } catch (Exception ignored) { } } if (recalled != null) { session.putInputParam(ConvEngineInputParamKey.MEMORY_RECALL, recalled); } String summary = buildSummary(session); if (summary.length() > flowConfig.getMemory().getSummaryMaxChars()) { summary = summary.substring(0, flowConfig.getMemory().getSummaryMaxChars()); } session.putInputParam(ConvEngineInputParamKey.MEMORY_SESSION_SUMMARY, summary); ObjectNode root = contextHelper.readRoot(session); ObjectNode memoryNode = contextHelper.ensureObject(root, \\"memory\\"); memoryNode.put(\\"session_summary\\", summary); if (recalled != null) { memoryNode.put(\\"recalled_summary\\", recalled); } contextHelper.writeRoot(session, root); for (ConversationMemoryStore store : memoryStores) { try { store.write(session, summary); } catch (Exception ignored) { } } Map<String, Object> payload = new LinkedHashMap<>(); payload.put(\\"summaryChars\\", summary.length()); payload.put(\\"recalled\\", recalled != null); payload.put(\\"stores\\", memoryStores.size()); payload.put(\\"intent\\", session.getIntent()); payload.put(\\"state\\", session.getState()); audit.audit(ConvEngineAuditStage.MEMORY_UPDATED, session.getConversationId(), payload); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">25</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>PersistConversationStep</span> </div> </div> **Responsibility:** Persist final conversation and result **Session Mutations:** finalResult **Config/Table Dependencies:** ce_conversation <details open> <summary>Detailed Execution Logic</summary> The database commit step. Writes the CeConversation row, saving the mutated contextJson , inputParams , new intentCode , and stateCode . The step is placed at the end so if an exception occurs mid-pipeline, the corrupted context is ignored and rolled back natively. <CodeBlockToggle title=\\"PersistConversationStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/PersistConversationStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { // --- sanity check --- if (session.getPayload() == null) { throw new ConversationEngineException( ConversationEngineErrorCode.PIPELINE_NO_RESPONSE_PAYLOAD, \\"Engine pipeline ended without payload. ResponseResolutionStep did not run.\\" ); } // --- persist conversation --- sanitizeConversationForPostgres(session); session.getConversation().setStatus(\\"RUNNING\\"); session.getConversation().setUpdatedAt(OffsetDateTime.now()); session.getConversation().setInputParamsJson(session.ejectInputParamsJson()); conversationRepo.save(session.getConversation()); // --- build FINAL EngineResult --- EngineResult result = new EngineResult( session.getIntent(), session.getState(), session.getPayload(), session.getContextJson() ); session.setFinalResult(result); Map<String, Object> payload = new LinkedHashMap<>(); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.INTENT, session.getIntent()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.STATE, session.getState()); payload.put(com.github.salilvnair.convengine.engine.constants.ConvEnginePayloadKey.FINAL_RESULT, result); audit.audit(ConvEngineAuditStage.ENGINE_RETURN, session.getConversationId(), payload); return new StepResult.Continue(); } } </CodeBlockToggle> </details> --- <div className=\\"ce-step-badge-list\\" role=\\"list\\" style={{ marginBottom: \'1rem\' }}> <div className=\\"ce-step-badge-item\\"> <span className=\\"ce-step-badge-index\\">26</span> <span className=\\"ce-step-badge-label\\" style={{ fontSize: \'1.2rem\', fontWeight: \'bold\' }}>PipelineEndGuardStep</span> </div> </div> **Responsibility:** Timing audit + terminal guard **Session Mutations:** timings **Config/Table Dependencies:** ce_audit <details open> <summary>Detailed Execution Logic</summary> Timing and safety metrics. Audits the total millisecond execution time from Step 1 to 25. Fires the PIPELINE_COMPLETE audit log. Verifies that the resulting payload isn\'t null. <CodeBlockToggle title=\\"PipelineEndGuardStep.execute()\\" language=\\"java\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/steps/PipelineEndGuardStep.java\\" defaultOpen={true}> { public StepResult execute(EngineSession session) { // Sort by start time just in case session.getStepTimings().sort(Comparator.comparingLong(StepTiming::getStartedAtNs)); long totalMs = session.getStepTimings().stream().mapToLong(StepTiming::getDurationMs).sum(); // Log in app logs String timingLine = session.getStepTimings().stream() .map(t -> t.getStepName() + \\"=\\" + t.getDurationMs() + \\"ms\\" + (t.isSuccess() ? \\"\\" : \\"(ERR)\\")) .reduce((a, b) -> a + \\", \\" + b) .orElse(\\"\\"); log.info(\\"ConvEngine timings convId={} total={}ms [{}]\\", session.getConversationId(), totalMs, timingLine); // Optional audit row (single compact record) String payload = \\"{\\\\\\"totalMs\\\\\\":\\" + totalMs + \\",\\\\\\"steps\\\\\\":\\\\\\"\\" + JsonUtil.escape(timingLine) + \\"\\\\\\"}\\"; audit.audit(ConvEngineAuditStage.PIPELINE_TIMING, session.getConversationId(), payload); return new StepResult.Continue(); } } </CodeBlockToggle> </details> ---","excerpt":"Pipeline Steps (what each step does) :::tip Hook where you need precision Before schema extraction: normalize inputs After rules: inspect intent/state transition correctness Before response resolution: inject display hin\u2026"},{"id":"deep-dive/request-lifecycle.mdx","version":"v2","title":"request lifecycle","permalink":"/docs/v2/deep-dive/request-lifecycle","content":", , , , , , , , , , , , , , , , , , , , , , , , , , ]; , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , , , , , , , , , , , ]; api: , engine: , session: , pipeline: , s1: , s2: , s3: , s4: , s5: , s6: , s7: , s8: , s9: , s10: , out: , }; Request Lifecycle (IDE Debug Mode) This page is the runtime control flow view for one turn. Think of it as stepping through breakpoints from API entry to final persistence. Canonical step inventory (latest) The visual flow highlights the common deterministic runtime path. Conditional/system steps from the list above still execute when their prerequisites are met. Engine\\" default // orderByDag uses @MustRunAfter, @MustRunBefore, @RequiresConversationPersisted // wrapWithTiming adds STEP_ENTER / STEP_EXIT / STEP_ERROR audits + hook callbacks } } return session.getFinalResult(); } default void beforeStep(EngineStep.Name stepName, EngineSession session) default void afterStep(EngineStep.Name stepName, EngineSession session, StepResult result) default void onStepError(EngineStep.Name stepName, EngineSession session, Throwable error) } } @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) } } Table Touch Matrix Start at IntentResolutionStep , then click SchemaExtractionStep and RulesStep in the tree. That path explains most multi turn behavior differences.","rawContent":"{ name: \\"LoadOrCreateConversationStep\\", description: \\"Hydrates existing conversation or creates new conversation shell.\\" }, { name: \\"CacheInspectAuditStep\\", description: \\"Conditionally audits cache snapshot when cache-inspector enabled.\\" }, { name: \\"ResetConversationStep\\", description: \\"Applies reset/start-over command handling.\\" }, { name: \\"PersistConversationBootstrapStep\\", description: \\"Persists conversation bootstrap row before persisted-required steps.\\" }, { name: \\"AuditUserInputStep\\", description: \\"Writes raw user input audit event.\\" }, { name: \\"PolicyEnforcementStep\\", description: \\"Applies pre-intent policy checks and safe short-circuit when required.\\" }, { name: \\"DialogueActStep\\", description: \\"Classifies turn as AFFIRM/NEGATE/EDIT/RESET/QUESTION/NEW_REQUEST.\\" }, { name: \\"InteractionPolicyStep\\", description: \\"Decides EXECUTE_PENDING_ACTION / REJECT_PENDING_ACTION / FILL_PENDING_SLOT / RECLASSIFY_INTENT.\\" }, { name: \\"ActionLifecycleStep\\", description: \\"Maintains pending_action_runtime status with TTL semantics.\\" }, { name: \\"DisambiguationStep\\", description: \\"When multiple actions are eligible, asks targeted clarification and pauses execution.\\" }, { name: \\"GuardrailStep\\", description: \\"Sanitization + sensitive checks + approval gate hooks.\\" }, { name: \\"IntentResolutionStep\\", description: \\"Resolves intent unless policy says skip_intent_resolution.\\" }, { name: \\"ResetResolvedIntentStep\\", description: \\"Applies post-intent reset mapping.\\" }, { name: \\"FallbackIntentStateStep\\", description: \\"Assigns fallback UNKNOWN flow when intent/state unresolved.\\" }, { name: \\"AddContainerDataStep\\", description: \\"Merges configured container data into runtime context.\\" }, { name: \\"PendingActionStep\\", description: \\"Executes or rejects pending action task via CeTaskExecutor.\\" }, { name: \\"ToolOrchestrationStep\\", description: \\"Unified tool request->execute->result contract by tool_group.\\" }, { name: \\"McpToolStep\\", description: \\"Planner loop for CALL_TOOL/ANSWER with MCP observations.\\" }, { name: \\"SchemaExtractionStep\\", description: \\"Parses/extracts structured schema fields.\\" }, { name: \\"AutoAdvanceStep\\", description: \\"Advances state when schema/task facts satisfy conditions.\\" }, { name: \\"RulesStep\\", description: \\"Runs phase-scoped rules and actions with cascade passes.\\" }, { name: \\"StateGraphStep\\", description: \\"Validate-only transition check, no forced state mutation.\\" }, { name: \\"ResponseResolutionStep\\", description: \\"Resolves EXACT/DERIVED response output.\\" }, { name: \\"MemoryStep\\", description: \\"Writes session summary and optional recall memory.\\" }, { name: \\"PersistConversationStep\\", description: \\"Persists conversation/result/audit metadata.\\" }, { name: \\"PipelineEndGuardStep\\", description: \\"Final guard and timing closure.\\" }, ]; { id: \\"api\\", position: { x: 20, y: 40 }, data: { label: \\"API: ConversationController.message\\" } }, { id: \\"engine\\", position: { x: 300, y: 40 }, data: { label: \\"DefaultConversationalEngine.process\\" } }, { id: \\"session\\", position: { x: 580, y: 40 }, data: { label: \\"EngineSessionFactory.open\\" } }, { id: \\"pipeline\\", position: { x: 860, y: 40 }, data: { label: \\"EnginePipelineFactory.create\\" } }, { id: \\"s1\\", position: { x: 20, y: 190 }, data: { label: \\"LoadOrCreateConversationStep\\" } }, { id: \\"s1a\\", position: { x: 140, y: 190 }, data: { label: \\"CacheInspectAuditStep\\" } }, { id: \\"s2\\", position: { x: 260, y: 190 }, data: { label: \\"ResetConversationStep\\" } }, { id: \\"s3\\", position: { x: 500, y: 190 }, data: { label: \\"AuditUserInputStep\\" } }, { id: \\"s4\\", position: { x: 740, y: 190 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"s5\\", position: { x: 980, y: 190 }, data: { label: \\"SchemaExtractionStep\\" } }, { id: \\"s6\\", position: { x: 20, y: 340 }, data: { label: \\"AutoAdvanceStep\\" } }, { id: \\"s7\\", position: { x: 260, y: 340 }, data: { label: \\"RulesStep\\" } }, { id: \\"s8\\", position: { x: 500, y: 340 }, data: { label: \\"ResponseResolutionStep\\" } }, { id: \\"s9\\", position: { x: 740, y: 340 }, data: { label: \\"PersistConversationStep\\" } }, { id: \\"s10\\", position: { x: 980, y: 340 }, data: { label: \\"PipelineEndGuardStep\\" } }, { id: \\"out\\", position: { x: 500, y: 500 }, data: { label: \\"EngineResult -> HTTP Response\\" } }, ]; { id: \\"e1\\", source: \\"api\\", target: \\"engine\\" }, { id: \\"e2\\", source: \\"engine\\", target: \\"session\\" }, { id: \\"e3\\", source: \\"session\\", target: \\"pipeline\\" }, { id: \\"e4\\", source: \\"pipeline\\", target: \\"s1\\" }, { id: \\"e4a\\", source: \\"s1\\", target: \\"s1a\\" }, { id: \\"e4b\\", source: \\"s1a\\", target: \\"s2\\" }, { id: \\"e5\\", source: \\"s2\\", target: \\"s3\\" }, { id: \\"e7\\", source: \\"s3\\", target: \\"s4\\" }, { id: \\"e8\\", source: \\"s4\\", target: \\"s5\\" }, { id: \\"e9\\", source: \\"s5\\", target: \\"s6\\" }, { id: \\"e10\\", source: \\"s6\\", target: \\"s7\\" }, { id: \\"e11\\", source: \\"s7\\", target: \\"s8\\" }, { id: \\"e12\\", source: \\"s8\\", target: \\"s9\\" }, { id: \\"e13\\", source: \\"s9\\", target: \\"s10\\" }, { id: \\"e14\\", source: \\"s10\\", target: \\"out\\" }, ]; api: { title: \\"ConversationController.message\\", file: \\"api/controller/ConversationController.java\\", method: \\"message(...)\\", stage: \\"HTTP_ENTRY\\", summary: \\"Reads request body, normalizes inputParams, injects reset flag when needed, builds EngineContext and delegates to engine.process.\\", session: [\\"conversationId maybe provided or generated\\", \\"userText from request.message\\", \\"inputParams merged\\"], tables: [\\"none\\"], }, engine: { title: \\"DefaultConversationalEngine.process\\", file: \\"engine/provider/DefaultConversationalEngine.java\\", method: \\"process(EngineContext)\\", stage: \\"ENGINE_ENTRY\\", summary: \\"Opens EngineSession, loads conversation history provider data, executes pipeline, returns EngineResult.\\", session: [\\"session created\\", \\"conversationHistory injected\\"], tables: [\\"ce_audit (indirect via steps)\\", \\"ce_conversation (indirect via steps)\\"], }, session: { title: \\"EngineSessionFactory.open\\", file: \\"engine/factory/EngineSessionFactory.java\\", method: \\"open(EngineContext)\\", stage: \\"SESSION_BOOTSTRAP\\", summary: \\"Ensures conversation bootstrap row exists, attaches it into session, syncs state/intent/context/input params.\\", session: [\\"conversation object attached\\", \\"intent/state/context synced from DB\\"], tables: [\\"ce_conversation (R/W bootstrap)\\"], }, pipeline: { title: \\"EnginePipelineFactory.create\\", file: \\"engine/factory/EnginePipelineFactory.java\\", method: \\"orderByDag(...) + wrapWithTiming(...)\\", stage: \\"PIPELINE_BUILD\\", summary: \\"Resolves step DAG by annotations, wraps each step in timing/audit/hook-aware wrapper.\\", session: [\\"none (topology build)\\"], tables: [\\"none\\"], }, s1: { title: \\"LoadOrCreateConversationStep.execute\\", file: \\"engine/steps/LoadOrCreateConversationStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Loads/syncs conversation row into session and keeps runtime state consistent.\\", session: [\\"conversation synchronized\\", \\"state available for next steps\\"], tables: [\\"ce_conversation (R/W)\\"], }, s2: { title: \\"ResetConversationStep.execute\\", file: \\"engine/steps/ResetConversationStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Checks reset controls ( reset , restart , conversation_reset , command text). If triggered, wipes conversation runtime state.\\", session: [\\"intent/state/context reset conditionally\\", \\"input controls filtered\\"], tables: [\\"ce_conversation (W)\\", \\"ce_audit (CONVERSATION_RESET)\\"], }, s3: { title: \\"AuditUserInputStep.execute\\", file: \\"engine/steps/AuditUserInputStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Writes compact user input audit record with session meta intent/state.\\", session: [\\"user input captured\\"], tables: [\\"ce_audit (W)\\"], }, s4: { title: \\"IntentResolutionStep.execute\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Resolves intent using classifier + agent flow, with schema lock checks and collision handling.\\", session: [\\"intent maybe changed\\", \\"state may become INTENT_COLLISION\\"], tables: [\\"ce_intent (R)\\", \\"ce_intent_classifier (R)\\", \\"ce_config (R)\\", \\"ce_audit (W)\\"], }, s5: { title: \\"SchemaExtractionStep.execute\\", file: \\"engine/steps/SchemaExtractionStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Finds schema by intent/state, renders prompt template, calls LLM JSON extraction, merges context, computes missing fields, locks/unlocks intent.\\", session: [\\"contextJson merged\\", \\"schemaComplete/schemaHasAnyValue flags\\", \\"missing fields/options\\"], tables: [\\"ce_output_schema (R)\\", \\"ce_prompt_template (R)\\", \\"ce_audit (W)\\", \\"ce_config (R optional)\\"], }, s6: { title: \\"AutoAdvanceStep.execute\\", file: \\"engine/steps/AutoAdvanceStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Applies deterministic state changes from schema facts before rules run.\\", session: [\\"state may auto-transition\\"], tables: [\\"ce_audit (W)\\"], }, s7: { title: \\"RulesStep.execute\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Runs enabled rules in priority order with multi-pass cascading when intent/state changes.\\", session: [\\"intent/state/context/inputParams may mutate via actions\\"], tables: [\\"ce_rule (R)\\", \\"ce_audit (W)\\"], }, s8: { title: \\"ResponseResolutionStep.execute\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Selects response mapping, executes EXACT/DERIVED strategy, resolves templates for derived output, applies transformers, audits output.\\", session: [\\"payload set\\", \\"finalResult staged\\"], tables: [\\"ce_response (R)\\", \\"ce_prompt_template (R)\\", \\"ce_audit (W)\\"], }, s9: { title: \\"PersistConversationStep.execute\\", file: \\"engine/steps/PersistConversationStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Persists final conversation state and last assistant payload to durable row.\\", session: [\\"conversation row synchronized with runtime\\"], tables: [\\"ce_conversation (W)\\", \\"ce_audit (W optional)\\"], }, s10: { title: \\"PipelineEndGuardStep.execute\\", file: \\"engine/steps/PipelineEndGuardStep.java\\", method: \\"execute(EngineSession)\\", stage: \\"STEP\\", summary: \\"Final guard/timing stage, emits pipeline timing audit and closes execution envelope.\\", session: [\\"step timings finalized\\"], tables: [\\"ce_audit (W)\\"], }, out: { title: \\"EngineResult return\\", file: \\"api/controller/ConversationController.java\\", method: \\"message(...) return\\", stage: \\"HTTP_RESPONSE\\", summary: \\"Controller maps EngineResult to API response payload type (TEXT/JSON) and returns to client.\\", session: [\\"final result exposed\\"], tables: [\\"none\\"], }, }; # Request Lifecycle (IDE Debug Mode) This page is the runtime control-flow view for one turn. Think of it as stepping through breakpoints from API entry to final persistence. ## Canonical step inventory (latest) <PipelineStepList ariaLabel=\\"Canonical step inventory\\" steps={v2PipelineSteps} /> <Highlight type=\\"tip\\" title=\\"Graph below is the common path\\"> The visual flow highlights the common deterministic runtime path. Conditional/system steps from the list above still execute when their prerequisites are met. </Highlight> <EngineDebugFlow title=\\"Request Turn Execution Graph\\" subtitle=\\"Click any node in tree or graph to inspect method-level detail, session snapshots, and table touch points.\\" nodes={lifecycleNodes} edges={lifecycleEdges} detailsById={lifecycleDetails} defaultSelectedId=\\"s4\\" /> <Tabs groupId=\\"lifecycle-code\\"> <TabItem value=\\"entry\\" label=\\"Controller -> Engine\\" default> <CodeBlockToggle title=\\"ConversationController.message\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.api.controller\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/api/controller/ConversationController.java\\" > { EngineContext engineContext = EngineContext.builder() .conversationId(conversationId.toString()) .userText(request.getMessage()) .inputParams(inputParams) .build(); EngineResult result = engine.process(engineContext); } </CodeBlockToggle> <CodeBlockToggle title=\\"DefaultConversationalEngine.process\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.provider\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/provider/DefaultConversationalEngine.java\\" > { EngineSession session = sessionFactory.open(engineContext); session.setConversationHistory(historyProvider.lastTurns(session.getConversationId(), 10)); EnginePipeline pipeline = pipelineFactory.create(); return pipeline.execute(session); } </CodeBlockToggle> </TabItem> <TabItem value=\\"pipeline\\" label=\\"DAG + Step Wrapper\\"> <CodeBlockToggle title=\\"EnginePipelineFactory.orderByDag + wrapWithTiming\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.factory\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/factory/EnginePipelineFactory.java\\" > { @PostConstruct public void init() { List<EngineStep> ordered = orderByDag(discoveredSteps); this.pipeline = new EnginePipeline(wrapWithTiming(ordered)); } // orderByDag uses @MustRunAfter, @MustRunBefore, @RequiresConversationPersisted // wrapWithTiming adds STEP_ENTER / STEP_EXIT / STEP_ERROR audits + hook callbacks } </CodeBlockToggle> <CodeBlockToggle title=\\"EnginePipeline.execute\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.pipeline\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/pipeline/EnginePipeline.java\\" > { for (EngineStep step : steps) { StepResult r = step.execute(session); if (r instanceof StepResult.Stop(EngineResult result)) { return result; } } return session.getFinalResult(); } </CodeBlockToggle> </TabItem> <TabItem value=\\"hooks\\" label=\\"Step Hook Interception\\"> <CodeBlockToggle title=\\"EngineStepHook typed step matching\\" language=\\"java\\" packagePath=\\"com.github.salilvnair.convengine.engine.hook\\" filePath=\\"src/main/java/com/github/salilvnair/convengine/engine/hook/EngineStepHook.java\\" > { public interface EngineStepHook { default boolean supports(EngineStep.Name stepName, EngineSession session) { return true; } default void beforeStep(EngineStep.Name stepName, EngineSession session) {} default void afterStep(EngineStep.Name stepName, EngineSession session, StepResult result) {} default void onStepError(EngineStep.Name stepName, EngineSession session, Throwable error) {} } } </CodeBlockToggle> <CodeBlockToggle title=\\"Consumer hook example\\" language=\\"java\\" packagePath=\\"com.zapper.convengine.hooks\\" > { @Component public class MyHook implements EngineStepHook { @Override public boolean supports(EngineStep.Name stepName, EngineSession session) { return EngineStep.Name.SchemaExtractionStep == stepName; } @Override public void beforeStep(EngineStep.Name stepName, EngineSession session) { session.putInputParam(\\"consumer_hint\\", \\"compact\\"); } } } </CodeBlockToggle> </TabItem> </Tabs> ## Table Touch Matrix <DbTable title=\\"Per-turn table access\\" columns={[\\"Table\\", \\"Read Path\\", \\"Write Path\\"]} rows={[ [\\"ce_conversation\\", \\"LoadOrCreateConversationStep\\", \\"PersistConversationStep / reset steps\\"], [\\"ce_intent\\", \\"IntentResolutionStep\\", \\"-\\"], [\\"ce_intent_classifier\\", \\"IntentResolutionStep\\", \\"-\\"], [\\"ce_output_schema\\", \\"SchemaExtractionStep\\", \\"-\\"], [\\"ce_prompt_template\\", \\"SchemaExtractionStep / ResponseResolutionStep\\", \\"-\\"], [\\"ce_rule\\", \\"RulesStep\\", \\"-\\"], [\\"ce_response\\", \\"ResponseResolutionStep\\", \\"-\\"], [\\"ce_config\\", \\"intent/reset/sql-agent config lookup\\", \\"-\\"], [\\"ce_mcp_planner\\", \\"McpToolStep planner prompt lookup (with ce_config fallback)\\", \\"-\\"], [\\"ce_audit\\", \\"-\\", \\"all stage audits via DbAuditService\\"], ]} /> <Highlight type=\\"info\\" title=\\"How to read this page\\"> Start at IntentResolutionStep , then click SchemaExtractionStep and RulesStep in the tree. That path explains most multi-turn behavior differences. </Highlight>","excerpt":", , , , , , , , , , , , , , , , , , , , , , , , , , ]; , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, \u2026"},{"id":"deep-dive/rules-responses.mdx","version":"v2","title":"rules responses","permalink":"/docs/v2/deep-dive/rules-responses","content":"Rules and Response Resolution Rule phases ce_rule.phase supports: PRE_RESPONSE_RESOLUTION POST_AGENT_INTENT POST_AGENT_MCP POST_TOOL_EXECUTION RulesStep writes phase/source/origin metadata into input params and audit payload for every pass. Rule matching behavior For each pass: 1. fetch by phase + session state 2. check intent ( ANY /blank/null supported) 3. check state ( ANY /blank/null supported) 4. evaluate type resolver ( EXACT , REGEX , JSON_PATH ) 5. execute action resolver 6. rerun pass if intent/state changed (max pass cap) Audit emitted for both outcomes: RULE_MATCH (AgentIntentResolver) RULE_NO_MATCH (AgentIntentResolver) RULE_MATCH (RulesStep) RULE_NO_MATCH (RulesStep) RULE_MATCH (McpToolStep) RULE_NO_MATCH (McpToolStep) RULE_APPLIED (...) is additionally emitted when action execution mutates/executes the matched rule. Response resolution behavior ResponseResolutionStep : 1. selects response template by intent/state/priority 2. resolves output format 3. emits RESOLVE_RESPONSE audit stages 4. writes final payload ( EXACT or DERIVED ) Operational guidance Keep fallback state responses ( ANY / UNKNOWN ) for safety paths. Keep at least one response for each terminal state. Use phase scoped rules instead of overloading one monolithic PRE_RESPONSE_RESOLUTION pass.","rawContent":"# Rules and Response Resolution ## Rule phases ce_rule.phase supports: - PRE_RESPONSE_RESOLUTION - POST_AGENT_INTENT - POST_AGENT_MCP - POST_TOOL_EXECUTION RulesStep writes phase/source/origin metadata into input params and audit payload for every pass. ## Rule matching behavior For each pass: 1. fetch by phase + session state 2. check intent ( ANY /blank/null supported) 3. check state ( ANY /blank/null supported) 4. evaluate type resolver ( EXACT , REGEX , JSON_PATH ) 5. execute action resolver 6. rerun pass if intent/state changed (max pass cap) Audit emitted for both outcomes: - RULE_MATCH (AgentIntentResolver) - RULE_NO_MATCH (AgentIntentResolver) - RULE_MATCH (RulesStep) - RULE_NO_MATCH (RulesStep) - RULE_MATCH (McpToolStep) - RULE_NO_MATCH (McpToolStep) RULE_APPLIED (...) is additionally emitted when action execution mutates/executes the matched rule. ## Response resolution behavior ResponseResolutionStep : 1. selects response template by intent/state/priority 2. resolves output format 3. emits RESOLVE_RESPONSE* audit stages 4. writes final payload ( EXACT or DERIVED ) ## Operational guidance - Keep fallback state responses ( ANY / UNKNOWN ) for safety paths. - Keep at least one response for each terminal state. - Use phase-scoped rules instead of overloading one monolithic PRE_RESPONSE_RESOLUTION pass.","excerpt":"Rules and Response Resolution Rule phases ce_rule.phase supports: PRE_RESPONSE_RESOLUTION POST_AGENT_INTENT POST_AGENT_MCP POST_TOOL_EXECUTION RulesStep writes phase/source/origin metadata into input params and audit pay\u2026"},{"id":"deep-dive/v2-features.mdx","version":"v2","title":"v2 features","permalink":"/docs/v2/deep-dive/v2-features","content":"ConvEngine Detailed Features 1. DialogueActStep Adds configurable resolve mode via convengine.flow.dialogue act.resolute : REGEX_ONLY REGEX_THEN_LLM LLM_ONLY Fast path regex classification remains primary. LLM path used for ambiguity based on configured threshold. Emits: DIALOGUE_ACT_CLASSIFIED audit. 2. InteractionPolicyStep Policy matrix externalized in convengine.flow.interaction policy.matrix . Default safe matrix included. Output remains deterministic enums: EXECUTE_PENDING_ACTION REJECT_PENDING_ACTION FILL_PENDING_SLOT RECLASSIFY_INTENT Emits: INTERACTION_POLICY_DECIDED . 3. ActionLifecycleStep Runtime lifecycle stored in context pending_action_runtime . Status values: OPEN IN_PROGRESS EXECUTED REJECTED EXPIRED TTL by turns/time configurable via convengine.flow.action lifecycle. . Uses ce_pending_action as catalog only. Emits: PENDING_ACTION_LIFECYCLE . 4. ToolOrchestrationStep Unified tool contract: request ( tool_request ) execute result ( tool_result , tool_status ) Keeps DB executor path and adds group dispatch interfaces for: HTTP_API WORKFLOW_ACTION DOCUMENT_RETRIEVAL CALCULATOR_TRANSFORM NOTIFICATION FILES MCP tool eligibility is scoped by optional ce_mcp_tool.intent_code and ce_mcp_tool.state_code (with NULL as wildcard). Executes post tool rules with POST_TOOL_EXECUTION . 5. GuardrailStep Before tool/action execution: input sanitization sensitive action pattern checks approval gate hooks Outputs: allow/deny audit entries ( GUARDRAIL_ALLOW , GUARDRAIL_DENY ) skip flags for tool/pending action execution when denied 6. StateGraphStep (validate mode) Validates transition only, no forced mutation. Emits: STATE_GRAPH_VALID STATE_GRAPH_VIOLATION Can set optional soft block flag for downstream behavior. 7. DisambiguationStep When multiple pending actions eligible at same top priority: asks targeted clarification pauses execution cleanly Emits: DISAMBIGUATION_REQUIRED . 8. MemoryStep Writes session summary in context. Optional recall/write via pluggable ConversationMemoryStore adapter. Emits: MEMORY_UPDATED . 9. Eval/Trace framework ConversationReplayService replays conversations from input messages. Supports expectation assertions for intent/state regressions. 10. Consumer contract docs Consumer should configure behavior with data/config first: ce_rule ce_response ce_pending_action ce_mcp_tool convengine.flow. Avoid hardcoding conversational decisions in controller/service code.","rawContent":"# ConvEngine Detailed Features ## 1. DialogueActStep - Adds configurable resolve mode via convengine.flow.dialogue-act.resolute : - REGEX_ONLY - REGEX_THEN_LLM - LLM_ONLY - Fast-path regex classification remains primary. - LLM path used for ambiguity based on configured threshold. - Emits: DIALOGUE_ACT_CLASSIFIED audit. ## 2. InteractionPolicyStep - Policy matrix externalized in convengine.flow.interaction-policy.matrix . - Default safe matrix included. - Output remains deterministic enums: - EXECUTE_PENDING_ACTION - REJECT_PENDING_ACTION - FILL_PENDING_SLOT - RECLASSIFY_INTENT - Emits: INTERACTION_POLICY_DECIDED . ## 3. ActionLifecycleStep - Runtime lifecycle stored in context pending_action_runtime . - Status values: - OPEN - IN_PROGRESS - EXECUTED - REJECTED - EXPIRED - TTL by turns/time configurable via convengine.flow.action-lifecycle.* . - Uses ce_pending_action as catalog only. - Emits: PENDING_ACTION_LIFECYCLE . ## 4. ToolOrchestrationStep - Unified tool contract: - request ( tool_request ) - execute - result ( tool_result , tool_status ) - Keeps DB executor path and adds group dispatch interfaces for: - HTTP_API - WORKFLOW_ACTION - DOCUMENT_RETRIEVAL - CALCULATOR_TRANSFORM - NOTIFICATION - FILES - MCP tool eligibility is scoped by optional ce_mcp_tool.intent_code and ce_mcp_tool.state_code (with NULL as wildcard). - Executes post-tool rules with POST_TOOL_EXECUTION . ## 5. GuardrailStep Before tool/action execution: - input sanitization - sensitive action pattern checks - approval gate hooks Outputs: - allow/deny audit entries ( GUARDRAIL_ALLOW , GUARDRAIL_DENY ) - skip flags for tool/pending-action execution when denied ## 6. StateGraphStep (validate mode) - Validates transition only, no forced mutation. - Emits: - STATE_GRAPH_VALID - STATE_GRAPH_VIOLATION - Can set optional soft-block flag for downstream behavior. ## 7. DisambiguationStep - When multiple pending actions eligible at same top priority: - asks targeted clarification - pauses execution cleanly - Emits: DISAMBIGUATION_REQUIRED . ## 8. MemoryStep - Writes session summary in context. - Optional recall/write via pluggable ConversationMemoryStore adapter. - Emits: MEMORY_UPDATED . ## 9. Eval/Trace framework - ConversationReplayService replays conversations from input messages. - Supports expectation assertions for intent/state regressions. ## 10. Consumer contract docs Consumer should configure behavior with data/config first: - ce_rule - ce_response - ce_pending_action - ce_mcp_tool - convengine.flow.* Avoid hardcoding conversational decisions in controller/service code.","excerpt":"ConvEngine Detailed Features 1. DialogueActStep Adds configurable resolve mode via convengine.flow.dialogue act.resolute : REGEX_ONLY REGEX_THEN_LLM LLM_ONLY Fast path regex classification remains primary. LLM path used \u2026"},{"id":"examples.mdx","version":"v2","title":"examples","permalink":"/docs/v2/examples","content":", data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , ]; faq_intent: , faq_schema: , faq_rules: , faq_resp: , faq_mem: , }; , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , label: \'Next Turn\' }, , ]; t_intent: , t_schema: , t_rules1: , t_resp1: , t_schema2: , t_rules2: , }; , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , , ]; c_act: , c_policy: , c_guard: , c_pending: , c_rules: , c_resp: , }; , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , ]; i_intent: , i_orch: , i_java: , i_ret: , i_resp: , }; , data: }, , data: }, , data: }, , data: }, ]; , , , ]; s_mem1: , s_intent: , s_resp: , s_mem2: , }; Examples (ReactFlow + DML + Audit) This page is the practical E2E companion to the V2 architecture. Each example shows: conversation UX runtime flow graph (interactive) DML seed rows expected audit stages Canonical V2 Runtime Step Set Step loop invokes each execute(session) . If a step returns Stop , response returns immediately; otherwise loop continues. 1 LoadOrCreateConversationStep 2 ResetConversationStep 3 PersistConversationBootstrapStep 4 AuditUserInputStep 5 PolicyEnforcementStep 6 DialogueActStep 7 InteractionPolicyStep 8 ActionLifecycleStep 9 DisambiguationStep 10 GuardrailStep 11 IntentResolutionStep 12 ResetResolvedIntentStep 13 FallbackIntentStateStep 14 AddContainerDataStep 15 PendingActionStep 16 ToolOrchestrationStep 17 McpToolStep 18 SchemaExtractionStep 19 AutoAdvanceStep 20 RulesStep 21 StateGraphStep 22 ResponseResolutionStep 23 MemoryStep 24 PersistConversationStep 25 PipelineEndGuardStep FAQ How do I transfer my electricity connection? Share customerId, phone, email, source city, and target city. Then confirm to submit transfer. }\\\\nFAQ context: }\\\\nReturn short helpful answer.\', 0.10, true); INSERT INTO ce_response (intent_code, state_code, output_format, response_type, derivation_hint, priority, enabled) VALUES (\'FAQ\', \'IDLE\', \'TEXT\', \'DERIVED\', \'Answer FAQ using available context and user question.\', 10, true); } CONNECTION_TRANSFER Move my electricity connection from City1 to City2. Please provide customerId, phone, email, sourceCity, and targetCity. customerId 9912, phone 9988776655, email user@zapper.com, sourceCity City1, targetCity City2 Do you want to move this connection right away? ,\\"phone\\": ,\\"email\\": ,\\"sourceCity\\": ,\\"targetCity\\": }, \\"required\\":[\\"customerId\\",\\"phone\\",\\"email\\",\\"sourceCity\\",\\"targetCity\\"]}\', true); INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, \\"action\\", action_value, priority, enabled) VALUES (\'PRE_RESPONSE_RESOLUTION\', \'CONNECTION_TRANSFER\', \'IDLE\', \'REGEX\', \'. \', \'SET_STATE\', \'COLLECT_INPUTS\', 10, true), (\'PRE_RESPONSE_RESOLUTION\', \'CONNECTION_TRANSFER\', \'COLLECT_INPUTS\', \'JSON_PATH\', \'$[?(@.state == \'\'COLLECT_INPUTS\'\' && @.customerId && @.phone && @.email && @.sourceCity && @.targetCity)]\', \'SET_STATE\', \'AWAITING_CONFIRMATION\', 100, true); INSERT INTO ce_response (intent_code, state_code, response_type, output_format, enabled) VALUES (\'CONNECTION_TRANSFER\', \'COLLECT_INPUTS\', \'DERIVED\', \'TEXT\', true); INSERT INTO ce_response (intent_code, state_code, response_type, output_format, enabled) VALUES (\'CONNECTION_TRANSFER\', \'AWAITING_CONFIRMATION\', \'DERIVED\', \'TEXT\', true); } COLLECT_INPUTS switch\\"], [\\"ASSISTANT_OUTPUT\\", \\"Prompts for slot filling\\"] ]} / ORDER_CANCELLATION Cancel my shoe order. What is your order number? It\'s 48392. Are you sure you want to cancel order 48392? Yes please do that. Order 48392 has been completely cancelled. } has been completely cancelled.\', \'tmpl_cancelled\', true); } CANCELLED\\"] ]} / INVENTORY_LOOKUP How many running shoes are left in warehouse B? Checking the inventory database... [System delay executing Tool] We currently have 421 units of running shoes allocated to warehouse B. }\', \'tmpl_inventory_gen\', true); INSERT INTO ce_response (intent_code, state_code, response_type, template_id, priority, enabled) VALUES (\'DATABASE_QUERY\', \'IDLE\', \'DERIVED\', \'tmpl_inventory_gen\', 10, true); } SUPPORT_DIAGNOSTIC [Turn 15]: Wait, what link did you tell me to use for the firmware reset again? Based on our previous troubleshooting, you should use http://router.local/admin_reset with the default PIN 1234. For each example run, inspect both /api/v2/conversation/audit/ \'} and /api/v2/conversation/audit/ \'}/trace .","rawContent":"{ id: \\"faq_intent\\", position: { x: 20, y: 60 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"faq_schema\\", position: { x: 300, y: 60 }, data: { label: \\"SchemaExtractionStep\\" } }, { id: \\"faq_rules\\", position: { x: 580, y: 60 }, data: { label: \\"RulesStep\\" } }, { id: \\"faq_resp\\", position: { x: 300, y: 220 }, data: { label: \\"ResponseResolutionStep\\" } }, { id: \\"faq_mem\\", position: { x: 580, y: 220 }, data: { label: \\"MemoryStep\\" } }, ]; { id: \\"faq_e1\\", source: \\"faq_intent\\", target: \\"faq_schema\\" }, { id: \\"faq_e2\\", source: \\"faq_schema\\", target: \\"faq_rules\\" }, { id: \\"faq_e3\\", source: \\"faq_rules\\", target: \\"faq_resp\\" }, { id: \\"faq_e4\\", source: \\"faq_resp\\", target: \\"faq_mem\\" }, ]; faq_intent: { title: \\"Intent resolution\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"INTENT_RESOLVED\\", summary: \\"Classifier resolves FAQ intent.\\", session: [\\"intent=FAQ, state=IDLE\\"] }, faq_schema: { title: \\"Fact extraction\\", file: \\"engine/steps/SchemaExtractionStep.java\\", method: \\"execute(...) \\", stage: \\"SCHEMA_EVALUATED\\", summary: \\"Minimal schema evaluation.\\", session: [\\"schema complete\\"] }, faq_rules: { title: \\"Rules evaluation\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(...) \\", stage: \\"RULE_NO_MATCH\\", summary: \\"No auto-advance transition required.\\", session: [\\"state unchanged\\"] }, faq_resp: { title: \\"Response resolution\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Resolves DERIVED response text.\\", session: [\\"LLM synthesized string\\"] }, faq_mem: { title: \\"Context memory\\", file: \\"engine/steps/MemoryStep.java\\", method: \\"execute(...) \\", stage: \\"MEMORY_UPDATED\\", summary: \\"Records turn for future summaries.\\", session: [\\"memory summary updated\\"] }, }; { id: \\"t_intent\\", position: { x: 20, y: 60 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"t_schema\\", position: { x: 300, y: 60 }, data: { label: \\"SchemaExtractionStep\\" } }, { id: \\"t_rules1\\", position: { x: 580, y: 60 }, data: { label: \\"RulesStep (Turn 1)\\" } }, { id: \\"t_resp1\\", position: { x: 860, y: 60 }, data: { label: \\"Ask for slots\\" } }, { id: \\"t_schema2\\", position: { x: 300, y: 220 }, data: { label: \\"SchemaExtractionStep (Turn 2)\\" } }, { id: \\"t_rules2\\", position: { x: 580, y: 220 }, data: { label: \\"RulesStep -> Confirm\\" } }, ]; { id: \\"t_e1\\", source: \\"t_intent\\", target: \\"t_schema\\" }, { id: \\"t_e2\\", source: \\"t_schema\\", target: \\"t_rules1\\" }, { id: \\"t_e3\\", source: \\"t_rules1\\", target: \\"t_resp1\\" }, { id: \\"t_e4\\", source: \\"t_resp1\\", target: \\"t_schema2\\", style: { strokeDasharray: \'5,5\' }, label: \'Next Turn\' }, { id: \\"t_e5\\", source: \\"t_schema2\\", target: \\"t_rules2\\" }, ]; t_intent: { title: \\"Intent resolution\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"INTENT_RESOLVED\\", summary: \\"CONNECTION_TRANSFER locked.\\", session: [\\"state=IDLE\\"] }, t_schema: { title: \\"Slot extraction\\", file: \\"engine/steps/SchemaExtractionStep.java\\", method: \\"execute(...) \\", stage: \\"SCHEMA_INCOMPLETE\\", summary: \\"Identifies missing slots.\\", session: [\\"missingFields tracked\\"] }, t_rules1: { title: \\"Bootstrap state\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(...) \\", stage: \\"RULE_MATCH\\", summary: \\"Transitions IDLE -> COLLECT_INPUTS.\\", session: [\\"state -> COLLECT_INPUTS\\"] }, t_resp1: { title: \\"Clarification\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Prompts for customerId, email, etc.\\", session: [\\"Prompt sent\\"] }, t_schema2: { title: \\"Fill slots\\", file: \\"engine/steps/SchemaExtractionStep.java\\", method: \\"execute(...) \\", stage: \\"SCHEMA_COMPLETE\\", summary: \\"User provides all missing slots.\\", session: [\\"schema locked\\"] }, t_rules2: { title: \\"Advance\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(...) \\", stage: \\"RULE_MATCH\\", summary: \\"Transitions to AWAITING_CONFIRMATION.\\", session: [\\"state -> AWAITING_CONFIRMATION\\"] }, }; { id: \\"c_act\\", position: { x: 20, y: 60 }, data: { label: \\"DialogueActStep\\" } }, { id: \\"c_policy\\", position: { x: 300, y: 60 }, data: { label: \\"InteractionPolicyStep\\" } }, { id: \\"c_guard\\", position: { x: 580, y: 60 }, data: { label: \\"GuardrailStep\\" } }, { id: \\"c_pending\\", position: { x: 860, y: 60 }, data: { label: \\"PendingActionStep\\" } }, { id: \\"c_rules\\", position: { x: 300, y: 220 }, data: { label: \\"RulesStep\\" } }, { id: \\"c_resp\\", position: { x: 580, y: 220 }, data: { label: \\"Finalizer\\" } }, ]; { id: \\"c_e1\\", source: \\"c_act\\", target: \\"c_policy\\" }, { id: \\"c_e2\\", source: \\"c_policy\\", target: \\"c_guard\\" }, { id: \\"c_e3\\", source: \\"c_guard\\", target: \\"c_pending\\" }, { id: \\"c_e4\\", source: \\"c_pending\\", target: \\"c_rules\\" }, { id: \\"c_e5\\", source: \\"c_rules\\", target: \\"c_resp\\" }, ]; c_act: { title: \\"Act check\\", file: \\"engine/steps/DialogueActStep.java\\", method: \\"execute(...) \\", stage: \\"DIALOGUE_ACT_CLASSIFIED\\", summary: \\"User says \'yes\'. Act=AFFIRM.\\", session: [\\"dialogueAct=AFFIRM\\"] }, c_policy: { title: \\"Policy lock\\", file: \\"engine/steps/InteractionPolicyStep.java\\", method: \\"execute(...) \\", stage: \\"INTERACTION_POLICY_DECIDED\\", summary: \\"Routes to pending task over intent.\\", session: [\\"policyDecision=EXECUTE_PENDING_ACTION\\"] }, c_guard: { title: \\"Safety check\\", file: \\"engine/steps/GuardrailStep.java\\", method: \\"execute(...) \\", stage: \\"GUARDRAIL_ALLOW\\", summary: \\"Ensures benign operation.\\", session: [\\"result=ALLOW\\"] }, c_pending: { title: \\"Task execute\\", file: \\"engine/steps/PendingActionStep.java\\", method: \\"execute(...) \\", stage: \\"PENDING_ACTION_EXECUTED\\", summary: \\"Triggers API cancellation bean.\\", session: [\\"status=EXECUTED\\"] }, c_rules: { title: \\"Completion rule\\", file: \\"engine/steps/RulesStep.java\\", method: \\"execute(...) \\", stage: \\"RULE_MATCH\\", summary: \\"EXECUTED -> CANCELLED state.\\", session: [\\"state -> CANCELLED\\"] }, c_resp: { title: \\"Response\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Completion text.\\", session: [\\"done\\"] }, }; { id: \\"i_intent\\", position: { x: 20, y: 60 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"i_orch\\", position: { x: 300, y: 60 }, data: { label: \\"ToolOrchestrationStep\\" } }, { id: \\"i_java\\", position: { x: 580, y: 60 }, data: { label: \\"Live MCP Tool Call\\" } }, { id: \\"i_ret\\", position: { x: 300, y: 220 }, data: { label: \\"Orchestration Returns\\" } }, { id: \\"i_resp\\", position: { x: 580, y: 220 }, data: { label: \\"ResponseResolutionStep\\" } }, ]; { id: \\"i_e1\\", source: \\"i_intent\\", target: \\"i_orch\\" }, { id: \\"i_e2\\", source: \\"i_orch\\", target: \\"i_java\\" }, { id: \\"i_e3\\", source: \\"i_java\\", target: \\"i_ret\\" }, { id: \\"i_e4\\", source: \\"i_ret\\", target: \\"i_resp\\" }, ]; i_intent: { title: \\"Intent\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"INTENT_RESOLVED\\", summary: \\"DATABASE_QUERY intent.\\", session: [\\"intent=DATABASE_QUERY\\"] }, i_orch: { title: \\"Tool Dispatch\\", file: \\"engine/steps/ToolOrchestrationStep.java\\", method: \\"execute(...) \\", stage: \\"TOOL_ORCHESTRATION_DISPATCH\\", summary: \\"Delegates to MCP runtime.\\", session: [\\"group=INVENTORY_DB\\"] }, i_java: { title: \\"Execution\\", file: \\"external/java/Adapter.java\\", method: \\"execute(...) \\", stage: \\"EXTERNAL\\", summary: \\"Java connector runs backend DB.\\", session: [\\"Fetching rows\\"] }, i_ret: { title: \\"Tool Finish\\", file: \\"engine/steps/ToolOrchestrationStep.java\\", method: \\"execute(...) \\", stage: \\"TOOL_ORCHESTRATION_RESULT\\", summary: \\"Assigns result to session context.\\", session: [\\"tool_result.dbList\\"] }, i_resp: { title: \\"Interpolate\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"LLM uses live tool data in response.\\", session: [\\"Synthesized text\\"] }, }; { id: \\"s_mem1\\", position: { x: 20, y: 60 }, data: { label: \\"MemoryStep (Load)\\" } }, { id: \\"s_intent\\", position: { x: 300, y: 60 }, data: { label: \\"IntentResolutionStep\\" } }, { id: \\"s_resp\\", position: { x: 580, y: 60 }, data: { label: \\"ResponseResolutionStep\\" } }, { id: \\"s_mem2\\", position: { x: 860, y: 60 }, data: { label: \\"MemoryStep (Compute)\\" } }, ]; { id: \\"s_e1\\", source: \\"s_mem1\\", target: \\"s_intent\\" }, { id: \\"s_e2\\", source: \\"s_intent\\", target: \\"s_resp\\" }, { id: \\"s_e3\\", source: \\"s_resp\\", target: \\"s_mem2\\" }, ]; s_mem1: { title: \\"Load summary\\", file: \\"engine/steps/MemoryStep.java\\", method: \\"execute(...) \\", stage: \\"MEMORY_INJECTED\\", summary: \\"Injects context from 14 turns ago.\\", session: [\\"memory.session_summary available\\"] }, s_intent: { title: \\"Guided AI\\", file: \\"engine/steps/IntentResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"INTENT_RESOLVED\\", summary: \\"Resolves meaning over ambiguous input.\\", session: [\\"intent=SUPPORT_DIAGNOSTIC\\"] }, s_resp: { title: \\"Accurate query\\", file: \\"engine/steps/ResponseResolutionStep.java\\", method: \\"execute(...) \\", stage: \\"ASSISTANT_OUTPUT\\", summary: \\"Answers with previous link text.\\", session: [\\"derived text\\"] }, s_mem2: { title: \\"Update Rolling\\", file: \\"engine/steps/MemoryStep.java\\", method: \\"execute(...) \\", stage: \\"MEMORY_UPDATED\\", summary: \\"Compresses latest turns into new summary.\\", session: [\\"re-evaluated summary\\"] }, }; # Examples (ReactFlow + DML + Audit) This page is the practical E2E companion to the V2 architecture. Each example shows: - conversation UX - runtime flow graph (interactive) - DML seed rows - expected audit stages ## Canonical V2 Runtime Step Set <Highlight type=\\"info\\" title=\\"Step loop behavior\\"> Step loop invokes each <MethodRef>execute(session)</MethodRef>. If a step returns <MethodRef>Stop</MethodRef>, response returns immediately; otherwise loop continues. </Highlight> <div className=\\"ce-step-badge-list\\" role=\\"list\\" aria-label=\\"Canonical runtime step set\\"> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">1</span><span className=\\"ce-step-badge-label\\">LoadOrCreateConversationStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">2</span><span className=\\"ce-step-badge-label\\">ResetConversationStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">3</span><span className=\\"ce-step-badge-label\\">PersistConversationBootstrapStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">4</span><span className=\\"ce-step-badge-label\\">AuditUserInputStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">5</span><span className=\\"ce-step-badge-label\\">PolicyEnforcementStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">6</span><span className=\\"ce-step-badge-label\\">DialogueActStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">7</span><span className=\\"ce-step-badge-label\\">InteractionPolicyStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">8</span><span className=\\"ce-step-badge-label\\">ActionLifecycleStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">9</span><span className=\\"ce-step-badge-label\\">DisambiguationStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">10</span><span className=\\"ce-step-badge-label\\">GuardrailStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">11</span><span className=\\"ce-step-badge-label\\">IntentResolutionStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">12</span><span className=\\"ce-step-badge-label\\">ResetResolvedIntentStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">13</span><span className=\\"ce-step-badge-label\\">FallbackIntentStateStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">14</span><span className=\\"ce-step-badge-label\\">AddContainerDataStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">15</span><span className=\\"ce-step-badge-label\\">PendingActionStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">16</span><span className=\\"ce-step-badge-label\\">ToolOrchestrationStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">17</span><span className=\\"ce-step-badge-label\\">McpToolStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">18</span><span className=\\"ce-step-badge-label\\">SchemaExtractionStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">19</span><span className=\\"ce-step-badge-label\\">AutoAdvanceStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">20</span><span className=\\"ce-step-badge-label\\">RulesStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">21</span><span className=\\"ce-step-badge-label\\">StateGraphStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">22</span><span className=\\"ce-step-badge-label\\">ResponseResolutionStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">23</span><span className=\\"ce-step-badge-label\\">MemoryStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">24</span><span className=\\"ce-step-badge-label\\">PersistConversationStep</span></div> <div className=\\"ce-step-badge-item\\"><span className=\\"ce-step-badge-index\\">25</span><span className=\\"ce-step-badge-label\\">PipelineEndGuardStep</span></div> </div> ## FAQ <Tabs groupId=\\"example-faq\\"> <TabItem value=\\"conversation\\" label=\\"Conversation + Flow\\" default> <Conversation title=\\"FAQ\\"> <User info={[\\"FAQ style informational request.\\", \\"Triggers QUESTION dialogue act.\\"]}>How do I transfer my electricity connection?</User> <Assistant tables={[\\"ce_intent\\", \\"ce_intent_classifier\\", \\"ce_response\\"]} info={[\\"Intent resolved as FAQ.\\", \\"Response selected from FAQ mapping.\\"]}>Share customerId, phone, email, source city, and target city. Then confirm to submit transfer.</Assistant> </Conversation> <EngineDebugFlow title=\\"FAQ runtime flow\\" subtitle=\\"Basic Intent + Memory retention\\" nodes={faqNodes} edges={faqEdges} detailsById={faqDetails} defaultSelectedId=\\"faq_intent\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <CodeBlockToggle title=\\"FAQ seed SQL\\" language=\\"sql\\" defaultOpen={true}> { INSERT INTO ce_intent (intent_code, description, priority, enabled) VALUES (\'FAQ\', \'Answer informational questions from FAQ knowledge base\', 10, true); INSERT INTO ce_intent_classifier (intent_code, rule_type, pattern, priority, enabled) VALUES (\'FAQ\', \'REGEX\', \'(?i)\\\\\\\\b(what|how|help|faq|information|details|explain)\\\\\\\\b\', 10, true); INSERT INTO ce_prompt_template (intent_code, state_code, response_type, system_prompt, user_prompt, temperature, enabled) VALUES (\'FAQ\', \'IDLE\', \'TEXT\', \'You are a concise FAQ assistant. Answer directly and clearly.\', \'User question: {{user_input}}\\\\nFAQ context: {{container_data}}\\\\nReturn short helpful answer.\', 0.10, true); INSERT INTO ce_response (intent_code, state_code, output_format, response_type, derivation_hint, priority, enabled) VALUES (\'FAQ\', \'IDLE\', \'TEXT\', \'DERIVED\', \'Answer FAQ using available context and user question.\', 10, true); } </CodeBlockToggle> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"Expected audit stages (ordered)\\" columns={[\\"Order\\", \\"Stage\\", \\"Must contain\\"]} rows={[ [\\"1\\", \\"USER_INPUT\\", \\"original user message\\"], [\\"2\\", \\"DIALOGUE_ACT_CLASSIFIED\\", \\"dialogueAct=QUESTION\\"], [\\"3\\", \\"INTERACTION_POLICY_DECIDED\\", \\"policyDecision=RECLASSIFY_INTENT\\"], [\\"4\\", \\"INTENT_RESOLVED\\", \\"intent=FAQ\\"], [\\"5\\", \\"RESOLVE_RESPONSE_SELECTED\\", \\"responseType=DERIVED\\"], [\\"6\\", \\"ASSISTANT_OUTPUT\\", \\"output text or json payload\\"], [\\"7\\", \\"MEMORY_UPDATED\\", \\"summaryChars/recalled flags\\"], ]} /> </TabItem> </Tabs> ## CONNECTION_TRANSFER <Tabs groupId=\\"example-transfer\\"> <TabItem value=\\"conversation\\" label=\\"Conversation + Flow\\" default> <Conversation title=\\"Connection transfer conversation\\"> <User info={[\\"Initial transfer request.\\", \\"Intent should resolve to CONNECTION_TRANSFER.\\"]}>Move my electricity connection from City1 to City2.</User> <Assistant tables={[\\"ce_output_schema\\", \\"ce_response\\"]} info={[\\"Schema incomplete path.\\", \\"Assistant asks for required fields.\\"]}>Please provide customerId, phone, email, sourceCity, and targetCity.</Assistant> <User info={[\\"User provides all required slots.\\", \\"Schema completeness expected = true.\\"]}>customerId 9912, phone 9988776655, email user@zapper.com, sourceCity City1, targetCity City2</User> <Assistant tables={[\\"ce_rule\\", \\"ce_pending_action\\"]} info={[\\"State moves to AWAITING_CONFIRMATION.\\", \\"Pending action staged for confirmation.\\"]}>Do you want to move this connection right away?</Assistant> </Conversation> <EngineDebugFlow title=\\"Connection Transfer Flow\\" subtitle=\\"Slot fill auto advance\\" nodes={transferNodes} edges={transferEdges} detailsById={transferDetails} defaultSelectedId=\\"t_schema\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <CodeBlockToggle title=\\"Schema & Rules SQL\\" language=\\"sql\\" defaultOpen={true}> { INSERT INTO ce_intent (intent_code, enabled) VALUES (\'CONNECTION_TRANSFER\', true); INSERT INTO ce_output_schema (intent_code, format_type, schema_json, enabled) VALUES (\'CONNECTION_TRANSFER\', \'JSON\', \'{\\"properties\\":{\\"customerId\\":{},\\"phone\\":{},\\"email\\":{},\\"sourceCity\\":{},\\"targetCity\\":{}}, \\"required\\":[\\"customerId\\",\\"phone\\",\\"email\\",\\"sourceCity\\",\\"targetCity\\"]}\', true); INSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, \\"action\\", action_value, priority, enabled) VALUES (\'PRE_RESPONSE_RESOLUTION\', \'CONNECTION_TRANSFER\', \'IDLE\', \'REGEX\', \'.*\', \'SET_STATE\', \'COLLECT_INPUTS\', 10, true), (\'PRE_RESPONSE_RESOLUTION\', \'CONNECTION_TRANSFER\', \'COLLECT_INPUTS\', \'JSON_PATH\', \'$[?(@.state == \'\'COLLECT_INPUTS\'\' && @.customerId && @.phone && @.email && @.sourceCity && @.targetCity)]\', \'SET_STATE\', \'AWAITING_CONFIRMATION\', 100, true); INSERT INTO ce_response (intent_code, state_code, response_type, output_format, enabled) VALUES (\'CONNECTION_TRANSFER\', \'COLLECT_INPUTS\', \'DERIVED\', \'TEXT\', true); INSERT INTO ce_response (intent_code, state_code, response_type, output_format, enabled) VALUES (\'CONNECTION_TRANSFER\', \'AWAITING_CONFIRMATION\', \'DERIVED\', \'TEXT\', true); } </CodeBlockToggle> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"Collection Turn Expected Trace\\" columns={[\\"Stage\\", \\"Meaning\\"]} rows={[ [\\"INTENT_RESOLVED\\", \\"Intent locked to CONNECTION_TRANSFER\\"], [\\"SCHEMA_INCOMPLETE\\", \\"Signals partial JSON payload extraction\\"], [\\"RULE_MATCH\\", \\"Initial IDLE -> COLLECT_INPUTS switch\\"], [\\"ASSISTANT_OUTPUT\\", \\"Prompts for slot filling\\"] ]} /> </TabItem> </Tabs> ## ORDER_CANCELLATION <Tabs groupId=\\"example-cancel\\"> <TabItem value=\\"conversation\\" label=\\"Conversation + Flow\\" default> <Conversation title=\\"Protected Order Cancellation\\"> <User info={[\\"Cancellation intent request.\\", \\"Order id missing in this turn.\\"]}>Cancel my shoe order.</User> <Assistant tables={[\\"ce_output_schema\\", \\"ce_response\\"]} info={[\\"Missing-field follow-up.\\", \\"Collect order number before execution.\\"]}>What is your order number?</Assistant> <User info={[\\"Provides order number.\\", \\"Enables confirmation state transition.\\"]}>It\'s 48392.</User> <Assistant tables={[\\"ce_rule\\", \\"ce_pending_action\\"]} info={[\\"Action moved to confirmation state.\\", \\"Awaiting explicit AFFIRM from user.\\"]}>Are you sure you want to cancel order 48392?</Assistant> <User info={[\\"AFFIRM dialogue act.\\", \\"Interaction policy should execute pending action.\\"]}>Yes please do that.</User> <Assistant tables={[\\"ce_audit\\", \\"ce_response\\"]} info={[\\"Pending action executed.\\", \\"Final cancelled response generated.\\"]}>Order 48392 has been completely cancelled.</Assistant> </Conversation> <EngineDebugFlow title=\\"Action Execution Flow (Turn 3)\\" subtitle=\\"Interaction Policy executing Pending Action\\" nodes={cancelNodes} edges={cancelEdges} detailsById={cancelDetails} defaultSelectedId=\\"c_policy\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <CodeBlockToggle title=\\"Pending Action Assignment SQL\\" language=\\"sql\\" defaultOpen={true}> { INSERT INTO ce_intent (intent_code, enabled) VALUES (\'CANCEL_ORDER\', true); INSERT INTO ce_pending_action (intent_code, state_code, action_name, expiration_turns, priority, enabled) VALUES (\'CANCEL_ORDER\', \'CONFIRM_CANCEL\', \'stripeCancelTask\', 3, 10, true); INSERT INTO ce_rule (phase, intent_code, rule_type, action, priority, enabled) VALUES (\'POST_EVAL\', \'CANCEL_ORDER\', \'CONDITION\', \'TRANSITION_STATE:CANCELLED\', 10, true); INSERT INTO ce_prompt_template (intent_code, response_type, system_prompt, user_prompt, template_id, enabled) VALUES (\'CANCEL_ORDER\', \'DERIVED\', \'Format cleanly.\', \'Order {{context.orderNumber}} has been completely cancelled.\', \'tmpl_cancelled\', true); } </CodeBlockToggle> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"Action Commit Expected Trace\\" columns={[\\"Stage\\", \\"Required Contents\\"]} rows={[ [\\"DIALOGUE_ACT_CLASSIFIED\\", \\"dialogueAct=AFFIRM\\"], [\\"INTERACTION_POLICY_DECIDED\\", \\"policyDecision=EXECUTE_PENDING_ACTION\\"], [\\"PENDING_ACTION_EXECUTED\\", \\"status=EXECUTED, pendingActionRef=stripeCancelTask\\"], [\\"RULE_APPLIED\\", \\"state -> CANCELLED\\"] ]} /> </TabItem> </Tabs> ## INVENTORY_LOOKUP <Tabs groupId=\\"example-inventory\\"> <TabItem value=\\"conversation\\" label=\\"Conversation + Flow\\" default> <Conversation title=\\"DB Orchestration Flow\\"> <User info={[\\"Tool-backed inventory lookup request.\\", \\"Expected tool group: DB/INVENTORY.\\"]}>How many running shoes are left in warehouse B?</User> <Assistant tables={[\\"ce_mcp_tool\\"]} info={[\\"Tool orchestration starts.\\", \\"System preparing DB call.\\"]}>Checking the inventory database...</Assistant> <User info={[\\"Represents async tool latency.\\", \\"No new user data provided.\\"]}>*[System delay executing Tool]*</User> <Assistant tables={[\\"ce_audit\\", \\"ce_response\\"]} info={[\\"tool_result injected into response derivation.\\", \\"Final value rendered from tool output.\\"]}>We currently have 421 units of running shoes allocated to warehouse B.</Assistant> </Conversation> <EngineDebugFlow title=\\"Tool Request Flow\\" subtitle=\\"Tool orchestration injects payload\\" nodes={invNodes} edges={invEdges} detailsById={invDetails} defaultSelectedId=\\"i_orch\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <CodeBlockToggle title=\\"Virtual DB Binding SQL\\" language=\\"sql\\" defaultOpen={true}> { INSERT INTO ce_mcp_tool (intent_code, tool_group, required_params_json, execution_timeout_ms, enabled) VALUES (\'DATABASE_QUERY\', \'INVENTORY_DB\', \'[\\"itemType\\", \\"warehouseId\\"]\', 5000, true); INSERT INTO ce_prompt_template (intent_code, response_type, system_prompt, user_prompt, template_id, enabled) VALUES (\'DATABASE_QUERY\', \'DERIVED\', \'You are an inventory assistant.\', \'Answer from these database results: {{tool_result.dbList}}\', \'tmpl_inventory_gen\', true); INSERT INTO ce_response (intent_code, state_code, response_type, template_id, priority, enabled) VALUES (\'DATABASE_QUERY\', \'IDLE\', \'DERIVED\', \'tmpl_inventory_gen\', 10, true); } </CodeBlockToggle> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"Data Request Trace\\" columns={[\\"Stage\\", \\"Context Checkpoint\\"]} rows={[ [\\"TOOL_ORCHESTRATION_DISPATCH\\", \\"toolGroup=INVENTORY_DB\\"], [\\"TOOL_ORCHESTRATION_RESULT\\", \\"toolResult={\'count\': 421}\\"], [\\"ASSISTANT_OUTPUT\\", \\"Final text uses 421 units output\\"] ]} /> </TabItem> </Tabs> ## SUPPORT_DIAGNOSTIC <Tabs groupId=\\"example-support\\"> <TabItem value=\\"conversation\\" label=\\"Conversation + Flow\\" default> <Conversation title=\\"Long Context Support Thread\\"> <User info={[\\"Late-turn follow-up question.\\", \\"Requires memory/session summary recall.\\"]}>[Turn 15]: Wait, what link did you tell me to use for the firmware reset again?</User> <Assistant tables={[\\"ce_conversation_history\\", \\"ce_audit\\"]} info={[\\"Memory-assisted recall response.\\", \\"References earlier troubleshooting context.\\"]}>Based on our previous troubleshooting, you should use http://router.local/admin_reset with the default PIN 1234.</Assistant> </Conversation> <EngineDebugFlow title=\\"Memory Summary Flow\\" subtitle=\\"Long-context retrieval during turn evaluation\\" nodes={supportNodes} edges={supportEdges} detailsById={supportDetails} defaultSelectedId=\\"s_mem1\\" /> </TabItem> <TabItem value=\\"dml\\" label=\\"DML Entries\\"> <CodeBlockToggle title=\\"Memory Auto-Summarization Config\\" language=\\"yaml\\" defaultOpen={true}> { convengine: flow: memory: enabled: true # Max token size for the compressed summary string summary-max-chars: 1200 # Number of turns to trigger a new summary compression cycle recent-turns-for-summary: 3 } </CodeBlockToggle> </TabItem> <TabItem value=\\"audit\\" label=\\"Audit Trail\\"> <DbTable title=\\"Memory Trace\\" columns={[\\"Stage\\", \\"Context Action\\"]} rows={[ [\\"MEMORY_INJECTED\\", \\"old sequence of facts available to tool_result/intent logic\\"], [\\"INTENT_RESOLVED\\", \\"Supports historical context\\"], [\\"MEMORY_UPDATED\\", \\"newSummary generated and injected\\"] ]} /> </TabItem> </Tabs> <Highlight type=\\"tip\\" title=\\"Fast validation\\"> For each example run, inspect both <FileRef>/api/v2/conversation/audit/{\'{conversationId}\'}</FileRef> and <FileRef>/api/v2/conversation/audit/{\'{conversationId}\'}/trace</FileRef>. </Highlight>","excerpt":", data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , ]; faq_intent: , faq_schema: , faq_rules: , faq_resp: , faq_mem: , }; , data: }, , data: }, , data: }, , data: }, , data: }, , data: }, ]; , , , , label: \u2026"},{"id":"faq.mdx","version":"v2","title":"faq","permalink":"/docs/v2/faq","content":"FAQ Is v1 still available? Yes. v1 docs are still available from the version dropdown. How does the engine understand \\"yes/ok/do that\\"? Using DialogueActStep + InteractionPolicyStep + pending action context, not only intent keyword matching. Does StateGraphStep mutate state? No. The current implementation is validate only; it audits validity and can set a soft block flag. Can I configure behavior without Java changes? Yes. Primary control should be through: ce_rule ce_response ce_pending_action ce_policy convengine.flow. How do we avoid 500s for conversational mismatches? keep fallback UNKNOWN / ANY rows use disambiguation and guardrail paths ensure response mappings exist for reachable states","rawContent":"# FAQ ## Is v1 still available? Yes. v1 docs are still available from the version dropdown. ## How does the engine understand \\"yes/ok/do that\\"? Using DialogueActStep + InteractionPolicyStep + pending-action context, not only intent keyword matching. ## Does StateGraphStep mutate state? No. The current implementation is validate-only; it audits validity and can set a soft-block flag. ## Can I configure behavior without Java changes? Yes. Primary control should be through: - ce_rule - ce_response - ce_pending_action - ce_policy - convengine.flow.* ## How do we avoid 500s for conversational mismatches? - keep fallback UNKNOWN / ANY rows - use disambiguation and guardrail paths - ensure response mappings exist for reachable states","excerpt":"FAQ Is v1 still available? Yes. v1 docs are still available from the version dropdown. How does the engine understand \\"yes/ok/do that\\"? Using DialogueActStep + InteractionPolicyStep + pending action context, not only int\u2026"},{"id":"local-development.mdx","version":"v2","title":"local development","permalink":"/docs/v2/local-development","content":"Local Development Prerequisites Java 21 Spring compatible host app PostgreSQL + ConvEngine ce_ schema LlmClient implementation bean Minimal integration } } Required runtime beans from consumer side LlmClient datasource + JPA config any custom hooks/transformers you need Recommended local test loop 1. Send one turn to /message 2. Read /audit/ \'} 3. Read /audit/ \'}/trace 4. Tune DB rows and rerun same conversation id Transport toggles Keep SSE enabled initially. Use STOMP only when your client architecture needs bidirectional websocket semantics. Optional feature annotations } } With @EnableConvEngine(stream = true) (default), startup fails if both SSE and STOMP are disabled. With @EnableConvEngine(stream = false) , transport flags are ignored and only REST flow is active.","rawContent":"# Local Development ## Prerequisites - Java 21 - Spring-compatible host app - PostgreSQL + ConvEngine <FileRef>ce_*</FileRef> schema - <MethodRef>LlmClient</MethodRef> implementation bean ## Minimal integration <CodeBlockToggle title=\\"Enable ConvEngine\\" language=\\"java\\" packagePath=\\"your.app\\" > { @EnableConvEngine @SpringBootApplication public class MyApplication { public static void main(String[] args) { SpringApplication.run(MyApplication.class, args); } } } </CodeBlockToggle> ## Required runtime beans from consumer side - <MethodRef>LlmClient</MethodRef> - datasource + JPA config - any custom hooks/transformers you need ## Recommended local test loop 1. Send one turn to <FileRef>/message</FileRef> 2. Read <FileRef>/audit/{\'{conversationId}\'}</FileRef> 3. Read <FileRef>/audit/{\'{conversationId}\'}/trace</FileRef> 4. Tune DB rows and rerun same conversation id ## Transport toggles <CodeBlockToggle title=\\"application.yml\\" language=\\"yaml\\"> { server: port: 8080 spring: datasource: url: jdbc:postgresql://localhost:5432/convengine username: convengine_user password: convengine_pwd convengine: transport: sse: enabled: true or false emitter-timeout-ms: 1800000 stomp: enabled: true or false endpoint: /ws-convengine app-destination-prefix: /app topic-prefix: /topic audit-destination-base: /topic/convengine/audit allowed-origin-pattern: \\"*\\" sock-js: true broker: mode: SIMPLE relay-destination-prefixes: /topic,/queue relay-host: localhost relay-port: 61613 client-login: \\"\\" client-passcode: \\"\\" system-login: \\"\\" system-passcode: \\"\\" virtual-host: \\"\\" system-heartbeat-send-interval-ms: 10000 system-heartbeat-receive-interval-ms: 10000 audit: enabled: true level: ALL include-stages: [] exclude-stages: [] persistence: mode: IMMEDIATE jdbc-batch-size: 200 max-buffered-events: 5000 flush-stages: ENGINE_KNOWN_FAILURE,ENGINE_UNKNOWN_FAILURE final-step-names: PipelineEndGuardStep flush-on-stop-outcome: true dispatch: async-enabled: false worker-threads: 2 queue-capacity: 2000 rejection-policy: CALLER_RUNS keep-alive-seconds: 60 rate-limit: enabled: false max-events: 200 window-ms: 1000 per-conversation: true per-stage: true max-tracked-buckets: 20000 experimental: enabled: false } </CodeBlockToggle> <Highlight type=\\"warning\\" title=\\"When enabling STOMP\\"> Keep SSE enabled initially. Use STOMP only when your client architecture needs bidirectional websocket semantics. </Highlight> ## Optional feature annotations <CodeBlockToggle title=\\"Enable optional performance features\\" language=\\"java\\"> { @EnableConvEngine(stream = true) @EnableConvEngineAsyncAuditDispatch @EnableConvEngineStompBrokerRelay @SpringBootApplication public class MyApplication { public static void main(String[] args) { SpringApplication.run(MyApplication.class, args); } } } </CodeBlockToggle> <Highlight type=\\"info\\" title=\\"Stream flag behavior\\"> With <MethodRef>@EnableConvEngine(stream = true)</MethodRef> (default), startup fails if both SSE and STOMP are disabled. With <MethodRef>@EnableConvEngine(stream = false)</MethodRef>, transport flags are ignored and only REST flow is active. </Highlight>","excerpt":"Local Development Prerequisites Java 21 Spring compatible host app PostgreSQL + ConvEngine ce_ schema LlmClient implementation bean Minimal integration } } Required runtime beans from consumer side LlmClient datasource +\u2026"},{"id":"overview.mdx","version":"v2","title":"overview","permalink":"/docs/v2/overview","content":"ConvEngine Overview ConvEngine is a deterministic conversation workflow engine with explicit turn control steps for dialogue act, policy, pending action lifecycle, guardrails, tool orchestration, state graph validation, and memory. Core Features Turn understanding before intent re resolution: DialogueActStep InteractionPolicyStep Pending action runtime control: ActionLifecycleStep DisambiguationStep PendingActionStep Safety controls: GuardrailStep StateGraphStep (validate only) Tool runtime unification: ToolOrchestrationStep McpToolStep with executor per tool group Memory and replay: MemoryStep ConversationReplayService Rule phases expanded with post tool/post mcp execution: POST_AGENT_MCP POST_TOOL_EXECUTION New control table: ce_pending_action Runtime model ConvEngine remains config first: DB control plane: ce_intent , ce_rule , ce_response , ce_prompt_template , ce_pending_action , ce_mcp_ Runtime policy config: convengine.flow. Deterministic pipeline with audited stage output Key outcomes Handles yes / ok / do that against pending context, not standalone intent. Avoids hidden state mutation by validating transitions ( StateGraphStep ) and auditing violations. Supports multiple tool groups ( DB , HTTP_API , WORKFLOW_ACTION , DOCUMENT_RETRIEVAL , CALCULATOR_TRANSFORM , NOTIFICATION , FILES ). Keeps every control decision visible in audit timeline. Next Reads","rawContent":"# ConvEngine Overview ConvEngine is a deterministic conversation workflow engine with explicit turn-control steps for dialogue act, policy, pending-action lifecycle, guardrails, tool orchestration, state-graph validation, and memory. ## Core Features - Turn understanding before intent re-resolution: - DialogueActStep - InteractionPolicyStep - Pending action runtime control: - ActionLifecycleStep - DisambiguationStep - PendingActionStep - Safety controls: - GuardrailStep - StateGraphStep (validate-only) - Tool runtime unification: - ToolOrchestrationStep - McpToolStep with executor-per-tool-group - Memory and replay: - MemoryStep - ConversationReplayService - Rule phases expanded with post-tool/post-mcp execution: - POST_AGENT_MCP - POST_TOOL_EXECUTION - New control table: - ce_pending_action ## Runtime model ConvEngine remains config-first: - DB control plane: ce_intent* , ce_rule , ce_response , ce_prompt_template , ce_pending_action , ce_mcp_* - Runtime policy config: convengine.flow.* - Deterministic pipeline with audited stage output ## Key outcomes - Handles yes / ok / do that against pending context, not standalone intent. - Avoids hidden state mutation by validating transitions ( StateGraphStep ) and auditing violations. - Supports multiple tool groups ( DB , HTTP_API , WORKFLOW_ACTION , DOCUMENT_RETRIEVAL , CALCULATOR_TRANSFORM , NOTIFICATION , FILES ). - Keeps every control decision visible in audit timeline. ## Next Reads - [Architecture](/docs/v2/architecture) - [Pipeline (Step-by-Step)](/docs/v2/deep-dive/pipeline-steps) - [Real World Examples (chat + DB + audit)](/docs/v2/examples) - [Detailed Features](/docs/v2/deep-dive/v2-features) - [Version History](/docs/v2/version-history)","excerpt":"ConvEngine Overview ConvEngine is a deterministic conversation workflow engine with explicit turn control steps for dialogue act, policy, pending action lifecycle, guardrails, tool orchestration, state graph validation, \u2026"},{"id":"version-history.mdx","version":"v2","title":"version history","permalink":"/docs/v2/version-history","content":"2.0.7 2.0.7 is the MCP revamp release line. Compared to 2.0.6, this adds planner scoped prompts, advanced tool execution modes, stricter static scope validation, richer MCP runtime metadata, and renamed rule phases. Advanced MCP execution model: DB handler first path ( DbToolHandler ) with SQL template fallback. HTTP handler models: HttpApiApiProcessorToolHandler ( / RestWebServiceFacade path) HttpApiRequestingToolHandler (framework managed request policy path) classic HttpApiToolHandler . HTTP policy support in framework invoker: timeout, retry/backoff, in memory circuit breaker, auth providers, response mapping. MCP planner scoping table: ce_mcp_planner with intent/state scoped prompt selection. seed support added for Postgres/SQLite planner rows. MCP context metadata model for rule branching: context.mcp.lifecycle. context.mcp.toolExecution. enables deterministic ce_rule.match_pattern JSON_PATH checks. Guardrail behavior clarity: when planner proposes blocked next tool, fallback answer is written to context.mcp.finalAnswer . POST_AGENT_MCP rules still run, then normal response resolution. MCP guardrail + determinism upgrades: planner output is validated against allowed next tool policy before execution. blocked decisions emit deterministic lifecycle metadata for rule branching. Tool execution observability upgrade: direct tool mode writes rich metadata into context.mcp.toolExecution. including toolCode , toolGroup , status/outcome, scope mismatch flags, and tool row metadata. Scope consistency hardening in static config: ce_mcp_tool / ce_mcp_planner scope values are validated at load/startup ( intent_code , state_code ) against allowed forms ( ANY , UNKNOWN , configured values). invalid scope rows fail fast to prevent cross intent tool leakage. ce_intent_classifier enhancement: state_code support (default UNKNOWN ) so classifier can set state directly without extra transition rules. Rule phase naming update: PRE_RESPONSE_RESOLUTION (old PIPELINE_RULES ) POST_AGENT_INTENT (old AGENT_POST_INTENT ) POST_AGENT_MCP (old AGENT_POST_MCP ) POST_TOOL_EXECUTION (old TOOL_POST_EXECUTION ) runtime normalization keeps old phase values compatible during migration. MCP docs expansion: advanced guide updates for metadata and rule patterns. new dedicated with chat by chat flow, table impact, and step graph. 2.0.6 2.0.6 focused on cache reliability and diagnostics to eliminate static table query noise in consumer environments. Proxy hygiene for static caches : StaticConfigurationCacheService helper paths now resolve through the Spring proxied bean so @Cacheable consistently suppresses repeated ce_ static table SQL after warmup. ConvEngineCacheAnalyzer + diagnostics endpoint : Added GET /api/v1/cache/analyze (with optional warmup flag) to expose active CacheManager metadata, Spring cache properties, cache infrastructure beans, runtime AOP proxy/advisor diagnostics, SimpleKey.EMPTY entry visibility, native cache counts, and warmup timing deltas. Operational debugging uplift : Teams can now validate cache hit/miss behavior directly in runtime and quickly detect provider/proxy misconfiguration in enterprise deployments. 2.0.5 Introduces massive execution path optimizations targeting latency removal, background history persistence, and static framework component caching. Static Configurations Cache Loader : All static framework properties ( ce_intent , ce_rule , ce_mcp_tool , etc.) are pre loaded entirely into memory on JVM live via StaticTableCachePreloader , dropping complex query I/O across RulesStep and InteractionPolicyStep to sub millisecond evaluate times. Cache Eviction API : Deployed /api/v1/cache/refresh endpoint natively inside ConvEngineCacheController to allow database administrators to immediately flush and reload RAM without bouncing the application. Async LLM Call Logging : Integrated @Async onto LlmCallLogPersistenceService . Lengthy physical HTTP prompts/completions are recorded in background threads preserving microsecond user facing SLA times. History DDL Revolution : Hard deprecated noisy legacy role & stage ce_conversation_history table arrays. Decoupled history updates away from the core DbAuditService pipeline loop entirely, deploying an explicit user_input + assistant_output monolithic string format that tracks asynchronously inside the final PipelineEndGuardStep . SQLite Timezone Idempotency : Normalized all underlying timestamp extractions across standard JSON mapping using formal JVM jackson datatype jsr310 deployments and rigorous OffsetDateTime string converters preserving micro transaction timezone stability across disparate engine host OS profiles. 2.0.4 Patches internal OffsetDateTime JSON serialization stability when executing audit cache inspection. JavaTimeModule Jackson Integration : Formally added the jackson datatype jsr310 dependency to the core engine pom.xml build matrix. CacheInspectAuditStep Modularization : Refactored the step to insulate itself from potentially unconfigured host Spring application contexts. It now natively spins up and governs a strictly private internal ObjectMapper exclusively pre configured with the JavaTimeModule and ISO 8601 formatting to cleanly convert internal OffsetDateTime objects found inside ce_conversation . 2.0.3 Introduces deep cache auditing utilities and executor level history optimization. Cache Inspection Audit Logging : Added a dedicated CacheInspectAuditStep and the convengine.audit.cache inspector boolean property. When enabled, the engine evaluates a full JSON snapshot of the hydrated EngineSession conversation cache tree and logs it to ce_audit under the CACHE_INSPECTION stage before user input audits finalize. Global Audit Meta Metadata : The DbAuditService now natively intercepts convengine.audit.cache inspector triggers to permanently append a discrete _cache analysis object map inside the _meta root node across all audit phases for continuous memory visibility. Optimized Executor History Provisioning : Refactored the underlying conversational history provisioner array evaluation ( historyProvider.lastTurns(...) ) natively into the root DefaultConversationalEngine.process ingress method. This formally prevents downstream LLM nodes from executing entirely redundant ce_conversation relational database queries across consecutive lifecycle turns. 2.0.2 Introduces deep performance optimizations targeting conversational latency, RAG context injection, and rigid data payloads. Query Rewrite (Contextual RAG) : Added convengine.flow.query rewrite.enabled property. DialogueActStep now natively evaluates conversation history to extract a standaloneQuery into session parameters, allowing downstream RAG tools to receive explicit context without incurring secondary LLM execution penalties. JSON Payload Flattening : Patched EngineSession storage logic to aggressively filter redundant structural blocks ( CONTEXT , SCHEMA_JSON , SESSION ) before database serialization, permanently resolving exponential payload bloat inside ce_conversation.input_params_json . Framework Caching & Async Pipelines Integrated standard Spring @Cacheable and @Async interfaces over all state persistence mutations to entirely decouple zero latency edge delivery from blocking background Relational Database I/O. Introduced explicitly managed @EnableConvEngineCaching and @EnableConvEngineAsyncConversation consumer integration decorators. Automatically intercepts the internal engine pipeline via Spring\'s CacheManager to execute synchronous memory writes while offloading slow I/O Relational DB saves to background asynchronous threads. 2.0.1 Add audit metadata support for prompt rendering and context Introduced new fields in PromptTemplateContext : templateName systemPrompt userPrompt session (EngineSession) Updated all response format resolvers ( JsonOutputFormatResolver , TextOutputFormatResolver ) to build a context that includes the new metadata. Updated intent resolution, disambiguation, schema extraction and MCP planner steps to supply the new metadata when creating PromptTemplateContext . Enhanced PromptTemplateRenderer : Collects metadata (selected prompt, system/user prompts, session dump, and prompt variables) into a map. Throws ConversationEngineException with the metadata via withMetaData . Added a metaData field and withMetaData() method to ConversationEngineException . Updated imports across modified classes. Adjusted the database DDL for SQLite to use strftime(\'%Y %m %d %H:%M:%f\', \'now\') for timestamp defaults. Bumped project version to 2.0.1 in pom.xml . These changes provide richer audit traces for prompt usage and enable better debugging of engine behaviour. 2.0.0 Major runtime engine evolution focused on production grade turn control, tool orchestration, safety, and observability. Major runtime engine evolution focused on production grade turn control, tool orchestration, safety, and observability. Major runtime engine evolution focused on production grade turn control, tool orchestration, safety, and observability. 1. Robust Pending Action & Task Execution Lifecycle Introduction of ce_pending_action : A new core configuration table used to catalog multi turn action candidates by intent, state, and action_key . Features indexed lookups idx_ce_pending_action_lookup across enabled , action_key , intent_code , and state_code . PendingActionRepository : Added Spring Data JPA queries focused on filtering eligible actions by phase, intent ( intentCode IS NULL OR ... ), state ( stateCode IS NULL OR ... ), and enabled status, ordering strictly by integer priority . CePendingAction Entity : A JPA entity mapping to ce_pending_action with bean_name , method_names , priority , intent_code , and state_code enabling highly parameterized late binding invocations. ActionLifecycleStep : A top level orchestration step responsible for managing the state transitions of modular pending actions within the conversation. Actions are stored in the session context as IN_PROGRESS pending definitive confirmation from the user. It evaluates configurable Time To Live parameters ( convengine.flow.action lifecycle.ttl turns and ttl minutes ). PendingActionStep : A core execution step designed to finalize these actions. It routes the action to the corresponding bean_name and method_names if the user successfully confirms the action sequence. CeTaskExecutor : A specialized executor pattern designed to securely evaluate and invoke pending tasks synchronously within the strict temporal limits of the conversational turn. Context Lifecycle Persistence : The engine tracks the holistic lifecycle of these actions ( OPEN , IN_PROGRESS , EXECUTED , REJECTED , EXPIRED ) purely in the stringified JSON memory context map ( pending_action_runtime ), meticulously decoupled from the static table definition. Disambiguation Matrix Controls : Pending actions that are ambiguous or require explicit missing slot inputs before execution dynamically trigger the new disambiguation mechanisms to halt execution, stash the context, and query the user. 2. Deterministic Interaction Policies & Dialogue Acts DialogueActStep : A brand new classification pipeline step heavily augmenting the traditional NLP pass. Instead of relying purely on heavy LLM intent classification for simple operational conversational shifts, this step evaluates the user\'s raw input against fast strict Pattern Regex patterns ( AFFIRM , NEGATE , EDIT , RESET ) before triggering fallback heuristic LLM logic. Dialogue Act Taxonomy : Standardized ENUM classification integrated precisely into ConvEngineInputParamKey.DIALOGUE_ACT including AFFIRM (yes, proceed), NEGATE (no, cancel), EDIT (change something), RESET (start over), QUESTION (inquiry), and NEW_REQUEST (topic switch). DialogueActResolveMode Enum : Explicit execution evaluation modes ( REGEX_ONLY , REGEX_THEN_LLM , LLM_ONLY ) allowing the system to rapidly identify acts using extremely fast regex thresholds prior to paying LLM generation costs. InteractionPolicyStep & InteractionPolicyDecision : The primary \\"brain\\" of the v2 matrix routing implementation. This step evaluates the DialogueAct alongside the current discrete SessionState . For instance, if a pending action is marked IN_PROGRESS in memory, and the new turn evaluates to the act AFFIRM , it makes an instantaneous deterministic policy decision EXECUTE_PENDING_ACTION . If it evaluates to NEGATE , it selects REJECT_PENDING_ACTION . If it\'s QUESTION , it evaluates to FILL_PENDING_SLOT . This massive enhancement completely bypasses stochastic LLM generative behaviors for discrete boolean pathing. 3. Strict MCP Tool Management and Orchestration Scoping CeMcpTool Scope Isolation : The intent_code and state_code columns were physically integrated into the ce_mcp_tool table architecture to formally mandate extreme compartmentalization of tool access limits. Tools are strictly bound to domains and are no longer assumed \\"global by default.\\" McpToolRepository Refactoring : Updated JPQL definitions in the repository ( findEnabledByIntentAndState , findByToolCodeEnabledAndIntentAndState ) leveraging the Spring Data @Param annotation to guarantee tools are flawlessly filtered. The internal McpPlanner is logically isolated from discovering tools sitting externally to the current active conversational domain intent scope. McpToolRegistry Improvements : A hardened centralized registry mechanism uniquely responsible for standardizing tool_group domains and resolving perfectly legal tools for a given conversation cycle loop, mathematically preventing hallucinations where an LLM invokes an unbound tool. McpToolExecutor Interface Expansion : Designed a formalized executor functional contract natively implemented by a vast array of specialized business adapters for standardized output structures. New Executor Adapter Implementations : Delivered fully mocked execution wrappers capable of expanding to live implementations: McpDbToolExecutor : For parsing database querying and modification parameter mapping tools. McpHttpApiToolExecutor : For serializing outbound REST/SOAP API tool integrations. McpWorkflowActionToolExecutor : For complex cross system async workflow pipeline triggers. McpDocumentRetrievalToolExecutor : For executing dynamic RAG (Retrieval Augmented Generation) Knowledge Base queries. McpCalculatorTransformToolExecutor : For executing deterministic programmatic mathematical transformations. McpFileToolExecutor : For OS level file parsing, reading, generation, and file management tools. McpNotificationToolExecutor : For serializing logic aimed at SMS/Email/Push notification gateways. Early Exit Execution Guardrails : ToolOrchestrationStep and McpToolStep logic matrices were fortified to immediately halt and bypass tool discovery planning on simple conversational greetings (e.g., regex checks against hi , hello , good morning ) or explicit internal dialogue acts ( AFFIRM , NEGATE ) to drastically curb overhead computational latency and expensive LLM generative token expenditures. 4. Advanced Pipeline Governance: Memory, Guardrails, and Graphs GuardrailStep Framework : A foundational preventative pipeline step strategically positioned to screen dynamic inputs against hardcoded blocked configuration patterns or sanitize output payload injections before advancing. Generates robust metrics to soft block or strictly hard block the ConvEngineInputParamKey.STATE_GRAPH_VALID control parameter. DisambiguationStep Integration : An autonomous discrete evaluation system boundary. If multiple valid intents or competing multi turn pending actions exhibit mathematically adjacent probabilities (Confidence score collisions), this step halts the internal execution state transitions and forces a deterministic query back to the end user for explicit disambiguation. StateGraphStep Validation : Built an internal compliance enforcement algorithm explicitly assessing whether the current proposed transition route from State A State B functionally complies with the statically mapped topologies inside the convengine.flow.state graph.allowed transitions logic limits. MemoryStep and ConversationMemoryStore Context Modeling : Engineered a long term conversation compression service layer. The orchestration engine dynamically aggregates rolling conversation turns bounded by the recent turns for summary threshold and compresses them into a highly compact ConvEngineInputParamKey.MEMORY_SESSION_SUMMARY . This drastically scales up context capacities, permitting the underlying LLM to seamlessly address sliding window follow up questions without wasting tokens continuously re parsing huge historical payload stacks. 5. Deterministic Evaluation and Replay CI/CD Logics ConversationReplayService Orchestration : Wrote advanced system test capabilities modeled exclusively for deep auditing metrics and automated CI/CD gating strategies. It fundamentally enables developers to parse a target conversation_id string into the service to perfectly replay historical conversational turns sequentially across the precise state parameters to test robustness over time. TraceExpectation Object Structure : Represents the mathematical and contextual logical assertions required during a turn replay scenario (e.g., Assert Intent == X , Assert Dialogue Act == Y ). TraceReplayResult & TraceTurnResult Analytics : Deployed overarching replay evaluation metrics classes designed to empower automated pipelines with the tooling necessary to validate whether newly submitted behavior rules applied directly within ce_rule or ce_policy unexpectedly fractured long standing static historically recorded conversation progression structures. SQL Initialization DDL Enhancements : Segmented and significantly refactored database procedural seeding generation structures intended for clean, error free automated platform tests. Explicitly divided the sprawling monolithic ddl.sql logic into dedicated dialect specific SQL instances ( seed_sqlite.sql , seed_postgres.sql , seed_oracle.sql ). Spliced all auto generated DBeaver boilerplate syntax elements and strategically configured dependency oriented DROP TABLE definitions to ensure identically idempotent and stateless automated unit test deployment loops continuously without breaking consistency schemas. Added new steps DialogueActStep InteractionPolicyStep ActionLifecycleStep DisambiguationStep GuardrailStep ToolOrchestrationStep StateGraphStep MemoryStep PendingActionStep enhanced for robust policy/lifecycle integration Added new flow configuration model ConvEngineFlowConfig ( convengine.flow. ) dialogue act interaction policy matrix action lifecycle TTL disambiguation options guardrail controls state graph settings tool orchestration toggle memory summary settings Added new control table ce_pending_action action catalog for pending action execution indexed by action key/intent/state/priority Added new rule phases POST_AGENT_MCP POST_TOOL_EXECUTION Added tool execution architecture McpToolExecutor interface group executors for: DB HTTP_API WORKFLOW_ACTION DOCUMENT_RETRIEVAL CALCULATOR_TRANSFORM NOTIFICATION FILES adapter interfaces for consumer implementations Added memory and replay scaffolding ConversationMemoryStore ConversationReplayService replay model classes ( Trace ) Added audit stage coverage Expanded audit visibility for: dialogue act and interaction policy pending action lifecycle and execution disambiguation requirements guardrail allow/deny tool orchestration request/result/error state graph validation/violation memory updates post phase rule metadata 1.x line Use the version dropdown to switch to v1 documentation.","rawContent":"## 2.0.7 2.0.7 is the MCP revamp release line. Compared to 2.0.6, this adds planner-scoped prompts, advanced tool execution modes, stricter static scope validation, richer MCP runtime metadata, and renamed rule phases. - Advanced MCP execution model: - DB handler-first path ( DbToolHandler ) with SQL-template fallback. - HTTP handler models: - HttpApiApiProcessorToolHandler ([api-processor](https://github.com/salilvnair/api-processor) / RestWebServiceFacade path) - HttpApiRequestingToolHandler (framework-managed request policy path) - classic HttpApiToolHandler . - HTTP policy support in framework invoker: - timeout, retry/backoff, in-memory circuit breaker, auth providers, response mapping. - MCP planner scoping table: - ce_mcp_planner with intent/state scoped prompt selection. - seed support added for Postgres/SQLite planner rows. - MCP context metadata model for rule branching: - context.mcp.lifecycle.* - context.mcp.toolExecution.* - enables deterministic ce_rule.match_pattern JSON_PATH checks. - Guardrail behavior clarity: - when planner proposes blocked next tool, fallback answer is written to context.mcp.finalAnswer . - POST_AGENT_MCP rules still run, then normal response resolution. - MCP guardrail + determinism upgrades: - planner output is validated against allowed-next-tool policy before execution. - blocked decisions emit deterministic lifecycle metadata for rule branching. - Tool execution observability upgrade: - direct tool mode writes rich metadata into context.mcp.toolExecution.* including toolCode , toolGroup , status/outcome, scope mismatch flags, and tool row metadata. - Scope consistency hardening in static config: - ce_mcp_tool / ce_mcp_planner scope values are validated at load/startup ( intent_code , state_code ) against allowed forms ( ANY , UNKNOWN , configured values). - invalid scope rows fail fast to prevent cross-intent tool leakage. - ce_intent_classifier enhancement: - state_code support (default UNKNOWN ) so classifier can set state directly without extra transition rules. - Rule phase naming update: - PRE_RESPONSE_RESOLUTION (old PIPELINE_RULES ) - POST_AGENT_INTENT (old AGENT_POST_INTENT ) - POST_AGENT_MCP (old AGENT_POST_MCP ) - POST_TOOL_EXECUTION (old TOOL_POST_EXECUTION ) - runtime normalization keeps old phase values compatible during migration. - MCP docs expansion: - advanced guide updates for metadata and rule patterns. - new dedicated [MCP Deep Dive](/docs/v2/consumer/mcp/deep-dive) with chat-by-chat flow, table impact, and step graph. ## 2.0.6 2.0.6 focused on cache reliability and diagnostics to eliminate static-table query noise in consumer environments. - **Proxy hygiene for static caches**: StaticConfigurationCacheService helper paths now resolve through the Spring proxied bean so @Cacheable consistently suppresses repeated ce_* static table SQL after warmup. - ** ConvEngineCacheAnalyzer + diagnostics endpoint**: Added GET /api/v1/cache/analyze (with optional warmup flag) to expose active CacheManager metadata, Spring cache properties, cache infrastructure beans, runtime AOP proxy/advisor diagnostics, SimpleKey.EMPTY entry visibility, native cache counts, and warmup timing deltas. - **Operational debugging uplift**: Teams can now validate cache hit/miss behavior directly in runtime and quickly detect provider/proxy misconfiguration in enterprise deployments. ## 2.0.5 Introduces massive execution path optimizations targeting latency removal, background history persistence, and static framework component caching. - **Static Configurations Cache Loader**: All static framework properties ( ce_intent , ce_rule , ce_mcp_tool , etc.) are pre-loaded entirely into memory on JVM live via StaticTableCachePreloader , dropping complex query I/O across RulesStep and InteractionPolicyStep to sub-millisecond evaluate times. - **Cache Eviction API**: Deployed /api/v1/cache/refresh endpoint natively inside ConvEngineCacheController to allow database administrators to immediately flush and reload RAM without bouncing the application. - **Async LLM Call Logging**: Integrated @Async onto LlmCallLogPersistenceService . Lengthy physical HTTP prompts/completions are recorded in background threads preserving microsecond user-facing SLA times. - **History DDL Revolution**: Hard-deprecated noisy legacy role & stage ce_conversation_history table arrays. Decoupled history updates away from the core DbAuditService pipeline loop entirely, deploying an explicit user_input + assistant_output monolithic string format that tracks asynchronously inside the final PipelineEndGuardStep . - **SQLite Timezone Idempotency**: Normalized all underlying timestamp extractions across standard JSON mapping using formal JVM jackson-datatype-jsr310 deployments and rigorous OffsetDateTime string converters preserving micro-transaction timezone stability across disparate engine host OS profiles. ## 2.0.4 Patches internal OffsetDateTime JSON serialization stability when executing audit cache inspection. - ** JavaTimeModule Jackson Integration**: Formally added the jackson-datatype-jsr310 dependency to the core engine pom.xml build matrix. - ** CacheInspectAuditStep Modularization**: Refactored the step to insulate itself from potentially unconfigured host Spring application contexts. It now natively spins up and governs a strictly private internal ObjectMapper exclusively pre-configured with the JavaTimeModule and ISO-8601 formatting to cleanly convert internal OffsetDateTime objects found inside ce_conversation . ## 2.0.3 Introduces deep cache auditing utilities and executor-level history optimization. - **Cache Inspection Audit Logging**: Added a dedicated CacheInspectAuditStep and the convengine.audit.cache-inspector boolean property. When enabled, the engine evaluates a full JSON snapshot of the hydrated EngineSession conversation cache tree and logs it to ce_audit under the CACHE_INSPECTION stage before user input audits finalize. - **Global Audit Meta Metadata**: The DbAuditService now natively intercepts convengine.audit.cache-inspector triggers to permanently append a discrete _cache analysis object map inside the _meta root node across all audit phases for continuous memory visibility. - **Optimized Executor History Provisioning**: Refactored the underlying conversational history provisioner array evaluation ( historyProvider.lastTurns(...) ) natively into the root DefaultConversationalEngine.process ingress method. This formally prevents downstream LLM nodes from executing entirely redundant ce_conversation relational database queries across consecutive lifecycle turns. ## 2.0.2 Introduces deep performance optimizations targeting conversational latency, RAG context injection, and rigid data payloads. - **Query Rewrite (Contextual RAG)**: Added convengine.flow.query-rewrite.enabled property. DialogueActStep now natively evaluates conversation history to extract a standaloneQuery into session parameters, allowing downstream RAG tools to receive explicit context without incurring secondary LLM execution penalties. - **JSON Payload Flattening**: Patched EngineSession storage logic to aggressively filter redundant structural blocks ( CONTEXT , SCHEMA_JSON , SESSION ) before database serialization, permanently resolving exponential payload bloat inside ce_conversation.input_params_json . - **Framework Caching & Async Pipelines** - Integrated standard Spring @Cacheable and @Async interfaces over all state persistence mutations to entirely decouple zero-latency edge delivery from blocking background Relational Database I/O. - Introduced explicitly managed @EnableConvEngineCaching and @EnableConvEngineAsyncConversation consumer integration decorators. - Automatically intercepts the internal engine pipeline via Spring\'s CacheManager to execute synchronous memory writes while offloading slow I/O Relational DB saves to background asynchronous threads. ## 2.0.1 Add audit metadata support for prompt rendering and context - Introduced new fields in PromptTemplateContext : * templateName * systemPrompt * userPrompt * session (EngineSession) - Updated all response format resolvers ( JsonOutputFormatResolver , TextOutputFormatResolver ) to build a context that includes the new metadata. - Updated intent resolution, disambiguation, schema extraction and MCP planner steps to supply the new metadata when creating PromptTemplateContext . - Enhanced PromptTemplateRenderer : * Collects metadata (selected prompt, system/user prompts, session dump, and prompt variables) into a map. * Throws ConversationEngineException with the metadata via withMetaData . - Added a metaData field and withMetaData() method to ConversationEngineException . - Updated imports across modified classes. - Adjusted the database DDL for SQLite to use strftime(\'%Y-%m-%d %H:%M:%f\', \'now\') for timestamp defaults. - Bumped project version to **2.0.1** in pom.xml . These changes provide richer audit traces for prompt usage and enable better debugging of engine behaviour. ## 2.0.0 Major runtime engine evolution focused on production-grade turn control, tool orchestration, safety, and observability. Major runtime engine evolution focused on production-grade turn control, tool orchestration, safety, and observability. Major runtime engine evolution focused on production-grade turn control, tool orchestration, safety, and observability. ### 1. Robust Pending Action & Task Execution Lifecycle - **Introduction of ce_pending_action **: A new core configuration table used to catalog multi-turn action candidates by intent, state, and action_key . Features indexed lookups idx_ce_pending_action_lookup across enabled , action_key , intent_code , and state_code . - ** PendingActionRepository **: Added Spring Data JPA queries focused on filtering eligible actions by phase, intent ( intentCode IS NULL OR ... ), state ( stateCode IS NULL OR ... ), and enabled status, ordering strictly by integer priority . - ** CePendingAction Entity**: A JPA entity mapping to ce_pending_action with bean_name , method_names , priority , intent_code , and state_code enabling highly parameterized late-binding invocations. - ** ActionLifecycleStep **: A top-level orchestration step responsible for managing the state transitions of modular pending actions within the conversation. Actions are stored in the session context as IN_PROGRESS pending definitive confirmation from the user. It evaluates configurable Time-To-Live parameters ( convengine.flow.action-lifecycle.ttl-turns and ttl-minutes ). - ** PendingActionStep **: A core execution step designed to finalize these actions. It routes the action to the corresponding bean_name and method_names if the user successfully confirms the action sequence. - ** CeTaskExecutor **: A specialized executor pattern designed to securely evaluate and invoke pending tasks synchronously within the strict temporal limits of the conversational turn. - **Context Lifecycle Persistence**: The engine tracks the holistic lifecycle of these actions ( OPEN , IN_PROGRESS , EXECUTED , REJECTED , EXPIRED ) purely in the stringified JSON memory context map ( pending_action_runtime ), meticulously decoupled from the static table definition. - **Disambiguation Matrix Controls**: Pending actions that are ambiguous or require explicit missing slot inputs before execution dynamically trigger the new disambiguation mechanisms to halt execution, stash the context, and query the user. ### 2. Deterministic Interaction Policies & Dialogue Acts - ** DialogueActStep **: A brand new classification pipeline step heavily augmenting the traditional NLP pass. Instead of relying purely on heavy LLM intent classification for simple operational conversational shifts, this step evaluates the user\'s raw input against fast strict Pattern Regex patterns ( AFFIRM , NEGATE , EDIT , RESET ) before triggering fallback heuristic LLM logic. - **Dialogue Act Taxonomy**: Standardized ENUM classification integrated precisely into ConvEngineInputParamKey.DIALOGUE_ACT including AFFIRM (yes, proceed), NEGATE (no, cancel), EDIT (change something), RESET (start over), QUESTION (inquiry), and NEW_REQUEST (topic switch). - ** DialogueActResolveMode Enum**: Explicit execution evaluation modes ( REGEX_ONLY , REGEX_THEN_LLM , LLM_ONLY ) allowing the system to rapidly identify acts using extremely fast regex thresholds prior to paying LLM generation costs. - ** InteractionPolicyStep & InteractionPolicyDecision **: The primary \\"brain\\" of the v2 matrix routing implementation. This step evaluates the DialogueAct alongside the current discrete SessionState . For instance, if a pending action is marked IN_PROGRESS in memory, and the new turn evaluates to the act AFFIRM , it makes an instantaneous deterministic policy decision EXECUTE_PENDING_ACTION . If it evaluates to NEGATE , it selects REJECT_PENDING_ACTION . If it\'s QUESTION , it evaluates to FILL_PENDING_SLOT . This massive enhancement completely bypasses stochastic LLM generative behaviors for discrete boolean pathing. ### 3. Strict MCP Tool Management and Orchestration Scoping - ** CeMcpTool Scope Isolation**: The intent_code and state_code columns were physically integrated into the ce_mcp_tool table architecture to formally mandate extreme compartmentalization of tool access limits. Tools are strictly bound to domains and are no longer assumed \\"global by default.\\" - ** McpToolRepository Refactoring**: Updated JPQL definitions in the repository ( findEnabledByIntentAndState , findByToolCodeEnabledAndIntentAndState ) leveraging the Spring Data @Param annotation to guarantee tools are flawlessly filtered. The internal McpPlanner is logically isolated from discovering tools sitting externally to the current active conversational domain intent scope. - ** McpToolRegistry Improvements**: A hardened centralized registry mechanism uniquely responsible for standardizing tool_group domains and resolving perfectly legal tools for a given conversation cycle loop, mathematically preventing hallucinations where an LLM invokes an unbound tool. - ** McpToolExecutor Interface Expansion**: Designed a formalized executor functional contract natively implemented by a vast array of specialized business adapters for standardized output structures. - **New Executor Adapter Implementations**: Delivered fully mocked execution wrappers capable of expanding to live implementations: - McpDbToolExecutor : For parsing database querying and modification parameter mapping tools. - McpHttpApiToolExecutor : For serializing outbound REST/SOAP API tool integrations. - McpWorkflowActionToolExecutor : For complex cross-system async workflow pipeline triggers. - McpDocumentRetrievalToolExecutor : For executing dynamic RAG (Retrieval-Augmented Generation) Knowledge Base queries. - McpCalculatorTransformToolExecutor : For executing deterministic programmatic mathematical transformations. - McpFileToolExecutor : For OS-level file parsing, reading, generation, and file management tools. - McpNotificationToolExecutor : For serializing logic aimed at SMS/Email/Push notification gateways. - **Early-Exit Execution Guardrails**: ToolOrchestrationStep and McpToolStep logic matrices were fortified to immediately halt and bypass tool discovery planning on simple conversational greetings (e.g., regex checks against hi , hello , good morning ) or explicit internal dialogue acts ( AFFIRM , NEGATE ) to drastically curb overhead computational latency and expensive LLM generative token expenditures. ### 4. Advanced Pipeline Governance: Memory, Guardrails, and Graphs - ** GuardrailStep Framework**: A foundational preventative pipeline step strategically positioned to screen dynamic inputs against hardcoded blocked configuration patterns or sanitize output payload injections before advancing. Generates robust metrics to soft-block or strictly hard-block the ConvEngineInputParamKey.STATE_GRAPH_VALID control parameter. - ** DisambiguationStep Integration**: An autonomous discrete evaluation system boundary. If multiple valid intents or competing multi-turn pending actions exhibit mathematically adjacent probabilities (Confidence score collisions), this step halts the internal execution state transitions and forces a deterministic query back to the end user for explicit disambiguation. - ** StateGraphStep Validation**: Built an internal compliance enforcement algorithm explicitly assessing whether the current proposed transition route from State A -> State B functionally complies with the statically mapped topologies inside the convengine.flow.state-graph.allowed-transitions logic limits. - ** MemoryStep and ConversationMemoryStore Context Modeling**: Engineered a long-term conversation compression service layer. The orchestration engine dynamically aggregates rolling conversation turns bounded by the recent-turns-for-summary threshold and compresses them into a highly compact ConvEngineInputParamKey.MEMORY_SESSION_SUMMARY . This drastically scales up context capacities, permitting the underlying LLM to seamlessly address sliding-window follow-up questions without wasting tokens continuously re-parsing huge historical payload stacks. ### 5. Deterministic Evaluation and Replay CI/CD Logics - ** ConversationReplayService Orchestration**: Wrote advanced system test capabilities modeled exclusively for deep auditing metrics and automated CI/CD gating strategies. It fundamentally enables developers to parse a target conversation_id string into the service to perfectly replay historical conversational turns sequentially across the precise state parameters to test robustness over time. - ** TraceExpectation Object Structure**: Represents the mathematical and contextual logical assertions required during a turn replay scenario (e.g., Assert Intent == X , Assert Dialogue Act == Y ). - ** TraceReplayResult & TraceTurnResult Analytics**: Deployed overarching replay evaluation metrics classes designed to empower automated pipelines with the tooling necessary to validate whether newly submitted behavior rules applied directly within ce_rule or ce_policy unexpectedly fractured long-standing static historically recorded conversation progression structures. - **SQL Initialization DDL Enhancements**: Segmented and significantly refactored database procedural seeding generation structures intended for clean, error-free automated platform tests. Explicitly divided the sprawling monolithic ddl.sql logic into dedicated dialect-specific SQL instances ( seed_sqlite.sql , seed_postgres.sql , seed_oracle.sql ). Spliced all auto-generated DBeaver boilerplate syntax elements and strategically configured dependency-oriented DROP TABLE definitions to ensure identically idempotent and stateless automated unit test deployment loops continuously without breaking consistency schemas. ### Added new steps - DialogueActStep - InteractionPolicyStep - ActionLifecycleStep - DisambiguationStep - GuardrailStep - ToolOrchestrationStep - StateGraphStep - MemoryStep - PendingActionStep enhanced for robust policy/lifecycle integration ### Added new flow configuration model - ConvEngineFlowConfig ( convengine.flow.* ) - dialogue act - interaction policy matrix - action lifecycle TTL - disambiguation options - guardrail controls - state graph settings - tool orchestration toggle - memory summary settings ### Added new control table - ce_pending_action - action catalog for pending-action execution - indexed by action key/intent/state/priority ### Added new rule phases - POST_AGENT_MCP - POST_TOOL_EXECUTION ### Added tool execution architecture - McpToolExecutor interface - group executors for: - DB - HTTP_API - WORKFLOW_ACTION - DOCUMENT_RETRIEVAL - CALCULATOR_TRANSFORM - NOTIFICATION - FILES - adapter interfaces for consumer implementations ### Added memory and replay scaffolding - ConversationMemoryStore - ConversationReplayService - replay model classes ( Trace* ) ### Added audit stage coverage Expanded audit visibility for: - dialogue act and interaction policy - pending action lifecycle and execution - disambiguation requirements - guardrail allow/deny - tool orchestration request/result/error - state graph validation/violation - memory updates - post-phase rule metadata ## 1.x line Use the version dropdown to switch to v1 documentation.","excerpt":"2.0.7 2.0.7 is the MCP revamp release line. Compared to 2.0.6, this adds planner scoped prompts, advanced tool execution modes, stricter static scope validation, richer MCP runtime metadata, and renamed rule phases. Adva\u2026"}]')},7485(e,t,n){"use strict";n.d(t,{$Z:()=>s,Hl:()=>r,aZ:()=>l,jy:()=>c});var o=n(6540),a=n(6347),i=n(9532);function s(e){!function(e){const t=(0,a.W6)(),n=(0,i._q)(e);(0,o.useEffect)(()=>t.block((e,t)=>n(e,t)),[t,n])}((t,n)=>{if("POP"===n)return e(t,n)})}function r(e){const t=(0,a.W6)();return(0,o.useSyncExternalStore)(t.listen,()=>e(t),()=>e({...t,location:{...t.location,search:"",hash:"",state:void 0}}))}function l(e){return r(t=>null===e?null:new URLSearchParams(t.location.search).get(e))}function c(e,t){const n=function(e,t){const n=new URLSearchParams;for(const o of e)for(const[e,a]of o.entries())"append"===t?n.append(e,a):n.set(e,a);return n}(e.map(e=>new URLSearchParams(e??"")),t),o=n.toString();return o?`?${o}`:o}},7489(e,t,n){"use strict";n.d(t,{A:()=>f});var o=n(6540),a=n(8193),i=n(5260),s=n(440),r=n(1656),l=n(3102),c=n(4848);function u({error:e,tryAgain:t}){return(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",minHeight:"100vh",width:"100%",maxWidth:"80ch",fontSize:"20px",margin:"0 auto",padding:"1rem"},children:[(0,c.jsx)("h1",{style:{fontSize:"3rem"},children:"This page crashed"}),(0,c.jsx)("button",{type:"button",onClick:t,style:{margin:"1rem 0",fontSize:"2rem",cursor:"pointer",borderRadius:20,padding:"1rem"},children:"Try again"}),(0,c.jsx)(d,{error:e})]})}function d({error:e}){const t=(0,s.rA)(e).map(e=>e.message).join("\n\nCause:\n");return(0,c.jsx)("p",{style:{whiteSpace:"pre-wrap"},children:t})}function p({children:e}){return(0,c.jsx)(l.W,{value:{plugin:{name:"docusaurus-core-error-boundary",id:"default"}},children:e})}function m({error:e,tryAgain:t}){return(0,c.jsx)(p,{children:(0,c.jsxs)(f,{fallback:()=>(0,c.jsx)(u,{error:e,tryAgain:t}),children:[(0,c.jsx)(i.A,{children:(0,c.jsx)("title",{children:"Page Error"})}),(0,c.jsx)(r.A,{children:(0,c.jsx)(u,{error:e,tryAgain:t})})]})})}const g=e=>(0,c.jsx)(m,{...e});class f extends o.Component{constructor(e){super(e),this.state={error:null}}componentDidCatch(e){a.A.canUseDOM&&this.setState({error:e})}render(){const{children:e}=this.props,{error:t}=this.state;if(t){const e={error:t,tryAgain:()=>this.setState({error:null})};return(this.props.fallback??g)(e)}return e??null}}},7559(e,t,n){"use strict";n.d(t,{G:()=>o});const o={page:{blogListPage:"blog-list-page",blogPostPage:"blog-post-page",blogTagsListPage:"blog-tags-list-page",blogTagPostListPage:"blog-tags-post-list-page",blogAuthorsListPage:"blog-authors-list-page",blogAuthorsPostsPage:"blog-authors-posts-page",docsDocPage:"docs-doc-page",docsTagsListPage:"docs-tags-list-page",docsTagDocListPage:"docs-tags-doc-list-page",mdxPage:"mdx-page"},wrapper:{main:"main-wrapper",blogPages:"blog-wrapper",docsPages:"docs-wrapper",mdxPages:"mdx-wrapper"},common:{editThisPage:"theme-edit-this-page",lastUpdated:"theme-last-updated",backToTopButton:"theme-back-to-top-button",codeBlock:"theme-code-block",admonition:"theme-admonition",unlistedBanner:"theme-unlisted-banner",draftBanner:"theme-draft-banner",admonitionType:e=>`theme-admonition-${e}`},announcementBar:{container:"theme-announcement-bar"},tabs:{container:"theme-tabs-container"},layout:{navbar:{container:"theme-layout-navbar",containerLeft:"theme-layout-navbar-left",containerRight:"theme-layout-navbar-right",mobileSidebar:{container:"theme-layout-navbar-sidebar",panel:"theme-layout-navbar-sidebar-panel"}},main:{container:"theme-layout-main"},footer:{container:"theme-layout-footer",column:"theme-layout-footer-column"}},docs:{docVersionBanner:"theme-doc-version-banner",docVersionBadge:"theme-doc-version-badge",docBreadcrumbs:"theme-doc-breadcrumbs",docMarkdown:"theme-doc-markdown",docTocMobile:"theme-doc-toc-mobile",docTocDesktop:"theme-doc-toc-desktop",docFooter:"theme-doc-footer",docFooterTagsRow:"theme-doc-footer-tags-row",docFooterEditMetaRow:"theme-doc-footer-edit-meta-row",docSidebarContainer:"theme-doc-sidebar-container",docSidebarMenu:"theme-doc-sidebar-menu",docSidebarItemCategory:"theme-doc-sidebar-item-category",docSidebarItemLink:"theme-doc-sidebar-item-link",docSidebarItemCategoryLevel:e=>`theme-doc-sidebar-item-category-level-${e}`,docSidebarItemLinkLevel:e=>`theme-doc-sidebar-item-link-level-${e}`},blog:{blogFooterTagsRow:"theme-blog-footer-tags-row",blogFooterEditMetaRow:"theme-blog-footer-edit-meta-row"},pages:{pageFooterEditMetaRow:"theme-pages-footer-edit-meta-row"}}},8168(e,t,n){"use strict";function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},o.apply(null,arguments)}n.d(t,{A:()=>o})},8193(e,t,n){"use strict";n.d(t,{A:()=>a});const o="undefined"!=typeof window&&"document"in window&&"createElement"in window.document,a={canUseDOM:o,canUseEventListeners:o&&("addEventListener"in window||"attachEvent"in window),canUseIntersectionObserver:o&&"IntersectionObserver"in window,canUseViewport:o&&"screen"in window}},8328(e,t,n){"use strict";n.d(t,{A:()=>p});n(6540);var o=n(3259),a=n.n(o),i=n(4054);const s={"0312e064":[()=>Promise.all([n.e(1869),n.e(2076),n.e(5304)]).then(n.bind(n,8460)),"@site/docs/v2/consumer/mcp/basics.mdx",8460],"0704e49c":[()=>n.e(4863).then(n.t.bind(n,6666,19)),"@generated/docusaurus-plugin-content-docs/v1/p/docs-v-1-2b8.json",6666],"1082ba27":[()=>Promise.all([n.e(1869),n.e(2076),n.e(4)]).then(n.bind(n,6977)),"@site/docs/v2/consumer/caching-and-persistence.mdx",6977],"1442c29a":[()=>Promise.all([n.e(2076),n.e(4087)]).then(n.bind(n,2752)),"@site/docs/v2/faq.mdx",2752],"14941fe8":[()=>Promise.all([n.e(2076),n.e(9921)]).then(n.bind(n,7303)),"@site/docs/v2/deep-dive/index.mdx",7303],17896441:[()=>Promise.all([n.e(1869),n.e(2076),n.e(6666),n.e(8401)]).then(n.bind(n,7606)),"@theme/DocItem",7606],"1a0c881c":[()=>Promise.all([n.e(2076),n.e(1290)]).then(n.bind(n,9579)),"@site/docs/v2/deep-dive/file-map.mdx",9579],"1bcf784f":[()=>Promise.all([n.e(1869),n.e(2076),n.e(5138)]).then(n.bind(n,486)),"@site/docs/v1/deep-dive/rules-responses.mdx",486],"1bd52e39":[()=>Promise.all([n.e(1869),n.e(2076),n.e(5224)]).then(n.bind(n,7817)),"@site/docs/v1/deep-dive/request-lifecycle.mdx",7817],"1f391b9e":[()=>Promise.all([n.e(1869),n.e(2076),n.e(6666),n.e(6061)]).then(n.bind(n,7973)),"@theme/MDXPage",7973],"2396873c":[()=>Promise.all([n.e(2076),n.e(6538)]).then(n.bind(n,4767)),"@site/docs/v2/deep-dive/improvement-backlog.mdx",4767],"25ed139f":[()=>Promise.all([n.e(1869),n.e(2076),n.e(2518)]).then(n.bind(n,6354)),"@site/docs/v2/consumer/mcp/deep-dive.mdx",6354],"27a4ec52":[()=>Promise.all([n.e(1869),n.e(2076),n.e(6304)]).then(n.bind(n,4163)),"@site/docs/v1/deep-dive/developer-guide.mdx",4163],"2f300dfb":[()=>Promise.all([n.e(2076),n.e(2650)]).then(n.bind(n,6578)),"@site/docs/v2/version-history.mdx",6578],"393be207":[()=>Promise.all([n.e(2076),n.e(4134)]).then(n.bind(n,4334)),"@site/src/pages/markdown-page.md",4334],"3b21f5bc":[()=>Promise.all([n.e(1869),n.e(2076),n.e(6057)]).then(n.bind(n,5242)),"@site/docs/v2/consumer/extensions.mdx",5242],"3ebda8dc":[()=>Promise.all([n.e(1869),n.e(2076),n.e(1713)]).then(n.bind(n,4339)),"@site/docs/v2/api/java-api.mdx",4339],"4a749c87":[()=>Promise.all([n.e(1869),n.e(2076),n.e(720)]).then(n.bind(n,6852)),"@site/docs/v2/consumer/mcp/advanced.mdx",6852],"4bf65dbd":[()=>Promise.all([n.e(2076),n.e(1164)]).then(n.bind(n,7506)),"@site/docs/v2/deep-dive/v2-features.mdx",7506],"4c746c58":[()=>Promise.all([n.e(1869),n.e(2076),n.e(7843)]).then(n.bind(n,7954)),"@site/docs/v2/api/stream-api.mdx",7954],"51bc3415":[()=>Promise.all([n.e(1869),n.e(2076),n.e(303)]).then(n.bind(n,3333)),"@site/docs/v1/deep-dive/lifecycle.mdx",3333],"5259eca5":[()=>Promise.all([n.e(2076),n.e(1610)]).then(n.bind(n,8178)),"@site/docs/v1/overview.mdx",8178],"55d9634d":[()=>Promise.all([n.e(1869),n.e(2076),n.e(3089)]).then(n.bind(n,9492)),"@site/docs/v1/api/java-api.mdx",9492],"586ac986":[()=>n.e(9633).then(n.t.bind(n,8877,19)),"@generated/docusaurus-plugin-content-docs/v1/__plugin.json",8877],"5d38660f":[()=>Promise.all([n.e(1869),n.e(2076),n.e(8363)]).then(n.bind(n,2453)),"@site/docs/v2/consumer/new-consumer-onboarding.mdx",2453],"5e95c892":[()=>n.e(9647).then(n.bind(n,7121)),"@theme/DocsRoot",7121],"5e9f5e1a":[()=>Promise.resolve().then(n.bind(n,4784)),"@generated/docusaurus.config",4784],"617e4c86":[()=>Promise.all([n.e(2076),n.e(9993)]).then(n.bind(n,3650)),"@site/docs/v2/deep-dive/rules-responses.mdx",3650],"6acfdb62":[()=>n.e(533).then(n.t.bind(n,8868,19)),"@generated/docusaurus-plugin-content-docs/v2/p/docs-v-2-592.json",8868],"7268a1d7":[()=>Promise.all([n.e(1869),n.e(2076),n.e(6859)]).then(n.bind(n,7974)),"@site/docs/v2/deep-dive/request-lifecycle.mdx",7974],"77efaed7":[()=>Promise.all([n.e(1869),n.e(2076),n.e(9113)]).then(n.bind(n,9861)),"@site/docs/v1/deep-dive/intent-and-schema.mdx",9861],"7ed18201":[()=>Promise.all([n.e(1869),n.e(2076),n.e(3509)]).then(n.bind(n,3744)),"@site/docs/v2/consumer/mcp/example1.mdx",3744],"7f42d669":[()=>Promise.all([n.e(1869),n.e(2076),n.e(6039)]).then(n.bind(n,4475)),"@site/docs/v1/api/rest-api.mdx",4475],"7f68cf2c":[()=>Promise.all([n.e(1869),n.e(2076),n.e(80)]).then(n.bind(n,2389)),"@site/docs/v1/consumer/annotations-reference.mdx",2389],"80ffc973":[()=>Promise.all([n.e(1869),n.e(2076),n.e(7505)]).then(n.bind(n,370)),"@site/docs/v1/deep-dive/index.mdx",370],"82a8309b":[()=>Promise.all([n.e(1869),n.e(2076),n.e(958)]).then(n.bind(n,5420)),"@site/docs/v2/deep-dive/pipeline-steps.mdx",5420],"83e26d28":[()=>Promise.all([n.e(1869),n.e(2076),n.e(1649)]).then(n.bind(n,7429)),"@site/docs/v1/consumer/session-reset-and-continuity.mdx",7429],85216760:[()=>Promise.all([n.e(1869),n.e(2076),n.e(5742)]).then(n.bind(n,5455)),"@site/docs/v1/api/audit-trace.mdx",5455],"8bf4086b":[()=>Promise.all([n.e(1869),n.e(2076),n.e(1547)]).then(n.bind(n,8494)),"@site/docs/v1/examples.mdx",8494],"8e38d733":[()=>Promise.all([n.e(1869),n.e(2076),n.e(9022)]).then(n.bind(n,3643)),"@site/docs/v1/deep-dive/failure-gotchas.mdx",3643],"8f9485e8":[()=>Promise.all([n.e(1869),n.e(2076),n.e(6008)]).then(n.bind(n,6489)),"@site/docs/v2/architecture.mdx",6489],"947805b2":[()=>Promise.all([n.e(1869),n.e(2076),n.e(2644)]).then(n.bind(n,4063)),"@site/docs/v1/consumer/extensions.mdx",4063],"98300e78":[()=>Promise.all([n.e(1869),n.e(2076),n.e(8141)]).then(n.bind(n,7529)),"@site/docs/v1/consumer/new-consumer-onboarding.mdx",7529],"98fa3606":[()=>Promise.all([n.e(1869),n.e(2076),n.e(8962)]).then(n.bind(n,7496)),"@site/docs/v1/deep-dive/pipeline-steps.mdx",7496],"9aedba33":[()=>Promise.all([n.e(2076),n.e(4367)]).then(n.bind(n,9098)),"@site/docs/v2/deep-dive/mcp-audit.mdx",9098],"9ca8e147":[()=>Promise.all([n.e(1869),n.e(2076),n.e(6257)]).then(n.bind(n,6850)),"@site/docs/v2/local-development.mdx",6850],"9da55969":[()=>Promise.all([n.e(1869),n.e(2076),n.e(247)]).then(n.bind(n,3502)),"@site/docs/v1/deep-dive/improvement-backlog.mdx",3502],"9e073b48":[()=>Promise.all([n.e(1869),n.e(2076),n.e(7501)]).then(n.bind(n,8317)),"@site/docs/v1/consumer/index.mdx",8317],"9e83c9cc":[()=>Promise.all([n.e(1869),n.e(2076),n.e(7744)]).then(n.bind(n,2970)),"@site/docs/v1/consumer/ui-integration.mdx",2970],a241b271:[()=>Promise.all([n.e(1869),n.e(2076),n.e(9643)]).then(n.bind(n,3887)),"@site/docs/v1/architecture.mdx",3887],a70918c9:[()=>Promise.all([n.e(2076),n.e(629)]).then(n.bind(n,9893)),"@site/docs/v2/consumer/index.mdx",9893],a7456010:[()=>n.e(1235).then(n.t.bind(n,8552,19)),"@generated/docusaurus-plugin-content-pages/default/__plugin.json",8552],a7bd4aaa:[()=>n.e(7098).then(n.bind(n,1723)),"@theme/DocVersionRoot",1723],a94703ab:[()=>Promise.all([n.e(1869),n.e(9048)]).then(n.bind(n,307)),"@theme/DocRoot",307],aa51eb9c:[()=>Promise.all([n.e(1869),n.e(2076),n.e(9182)]).then(n.bind(n,8176)),"@site/docs/v2/consumer/mcp/example2.mdx",8176],ae205812:[()=>Promise.all([n.e(1869),n.e(2076),n.e(6301)]).then(n.bind(n,1793)),"@site/docs/v1/deep-dive/file-map.mdx",1793],b0362358:[()=>Promise.all([n.e(2076),n.e(7856)]).then(n.bind(n,2958)),"@site/docs/v2/overview.mdx",2958],b5676ef2:[()=>Promise.all([n.e(1869),n.e(2076),n.e(6726)]).then(n.bind(n,1941)),"@site/docs/v2/api/audit-trace.mdx",1941],bdd58070:[()=>Promise.all([n.e(1869),n.e(2076),n.e(1461)]).then(n.bind(n,3986)),"@site/docs/v2/consumer/mcp/http-tool.mdx",3986],be6500c0:[()=>Promise.all([n.e(1869),n.e(2076),n.e(122)]).then(n.bind(n,7950)),"@site/docs/v2/consumer/backend-integration.mdx",7950],c3ba5c0f:[()=>Promise.all([n.e(1869),n.e(2076),n.e(2220)]).then(n.bind(n,1300)),"@site/docs/v2/examples.mdx",1300],c42527f6:[()=>Promise.all([n.e(1869),n.e(2076),n.e(3700)]).then(n.bind(n,7472)),"@site/docs/v1/api/stream-api.mdx",7472],c4f5d8e4:[()=>Promise.all([n.e(1869),n.e(2634)]).then(n.bind(n,1459)),"@site/src/pages/index.js",1459],c71f4ab2:[()=>Promise.all([n.e(1869),n.e(2076),n.e(4201)]).then(n.bind(n,3916)),"@site/docs/v2/deep-dive/examples.mdx",3916],c96f7375:[()=>Promise.all([n.e(1869),n.e(2076),n.e(7289)]).then(n.bind(n,4558)),"@site/docs/v1/deep-dive/data-model.mdx",4558],d37b6ad6:[()=>Promise.all([n.e(1869),n.e(2076),n.e(6818)]).then(n.bind(n,4046)),"@site/docs/v1/consumer/configuration.mdx",4046],d56c8658:[()=>Promise.all([n.e(1869),n.e(2076),n.e(3074)]).then(n.bind(n,7597)),"@site/docs/v1/deep-dive/examples.mdx",7597],d9156863:[()=>Promise.all([n.e(1869),n.e(2076),n.e(7307)]).then(n.bind(n,5771)),"@site/docs/v1/version-history.mdx",5771],dc029a89:[()=>Promise.all([n.e(1869),n.e(2076),n.e(4261)]).then(n.bind(n,9494)),"@site/docs/v2/api/rest-api.mdx",9494],dd0e6d67:[()=>Promise.all([n.e(1869),n.e(2076),n.e(7065)]).then(n.bind(n,8049)),"@site/docs/v2/consumer/configuration.mdx",8049],dec5a43c:[()=>Promise.all([n.e(1869),n.e(2076),n.e(8599)]).then(n.bind(n,3173)),"@site/docs/v2/deep-dive/failure-gotchas.mdx",3173],e6179d5e:[()=>Promise.all([n.e(2076),n.e(1803)]).then(n.bind(n,4483)),"@site/docs/v2/deep-dive/data-model.mdx",4483],e82d54d3:[()=>Promise.all([n.e(1869),n.e(2076),n.e(1298)]).then(n.bind(n,1628)),"@site/docs/v1/deep-dive/mcp-audit.mdx",1628],ea48d3b4:[()=>Promise.all([n.e(1869),n.e(2076),n.e(8352)]).then(n.bind(n,1630)),"@site/docs/v1/consumer/backend-integration.mdx",1630],ed731a92:[()=>Promise.all([n.e(1869),n.e(2076),n.e(6597)]).then(n.bind(n,6263)),"@site/docs/v2/consumer/session-reset-and-continuity.mdx",6263],ef425a30:[()=>Promise.all([n.e(1869),n.e(2076),n.e(7603)]).then(n.bind(n,3367)),"@site/docs/v2/consumer/ui-integration.mdx",3367],f4397bd6:[()=>Promise.all([n.e(1869),n.e(2076),n.e(2408)]).then(n.bind(n,1987)),"@site/docs/v2/consumer/annotations-reference.mdx",1987],f47f1c71:[()=>Promise.all([n.e(1869),n.e(2076),n.e(3674)]).then(n.bind(n,5007)),"@site/docs/v2/deep-dive/developer-guide.mdx",5007],f618ef7d:[()=>Promise.all([n.e(1869),n.e(2076),n.e(7548)]).then(n.bind(n,484)),"@site/docs/v2/deep-dive/lifecycle.mdx",484],fd276725:[()=>n.e(6010).then(n.t.bind(n,5078,19)),"@generated/docusaurus-plugin-content-docs/v2/__plugin.json",5078],fd2f5e0a:[()=>Promise.all([n.e(1869),n.e(2076),n.e(2294)]).then(n.bind(n,2851)),"@site/docs/v2/deep-dive/intent-and-schema.mdx",2851],fe6d72a3:[()=>Promise.all([n.e(1869),n.e(2076),n.e(4653)]).then(n.bind(n,9471)),"@site/docs/v1/local-development.mdx",9471]};var r=n(4848);function l({error:e,retry:t,pastDelay:n}){return e?(0,r.jsxs)("div",{style:{textAlign:"center",color:"#fff",backgroundColor:"#fa383e",borderColor:"#fa383e",borderStyle:"solid",borderRadius:"0.25rem",borderWidth:"1px",boxSizing:"border-box",display:"block",padding:"1rem",flex:"0 0 50%",marginLeft:"25%",marginRight:"25%",marginTop:"5rem",maxWidth:"50%",width:"100%"},children:[(0,r.jsx)("p",{children:String(e)}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"button",onClick:t,children:"Retry"})})]}):n?(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,r.jsx)("svg",{id:"loader",style:{width:128,height:110,position:"absolute",top:"calc(100vh - 64%)"},viewBox:"0 0 45 45",xmlns:"http://www.w3.org/2000/svg",stroke:"#61dafb",children:(0,r.jsxs)("g",{fill:"none",fillRule:"evenodd",transform:"translate(1 1)",strokeWidth:"2",children:[(0,r.jsxs)("circle",{cx:"22",cy:"22",r:"6",strokeOpacity:"0",children:[(0,r.jsx)("animate",{attributeName:"r",begin:"1.5s",dur:"3s",values:"6;22",calcMode:"linear",repeatCount:"indefinite"}),(0,r.jsx)("animate",{attributeName:"stroke-opacity",begin:"1.5s",dur:"3s",values:"1;0",calcMode:"linear",repeatCount:"indefinite"}),(0,r.jsx)("animate",{attributeName:"stroke-width",begin:"1.5s",dur:"3s",values:"2;0",calcMode:"linear",repeatCount:"indefinite"})]}),(0,r.jsxs)("circle",{cx:"22",cy:"22",r:"6",strokeOpacity:"0",children:[(0,r.jsx)("animate",{attributeName:"r",begin:"3s",dur:"3s",values:"6;22",calcMode:"linear",repeatCount:"indefinite"}),(0,r.jsx)("animate",{attributeName:"stroke-opacity",begin:"3s",dur:"3s",values:"1;0",calcMode:"linear",repeatCount:"indefinite"}),(0,r.jsx)("animate",{attributeName:"stroke-width",begin:"3s",dur:"3s",values:"2;0",calcMode:"linear",repeatCount:"indefinite"})]}),(0,r.jsx)("circle",{cx:"22",cy:"22",r:"8",children:(0,r.jsx)("animate",{attributeName:"r",begin:"0s",dur:"1.5s",values:"6;1;2;3;4;5;6",calcMode:"linear",repeatCount:"indefinite"})})]})})}):null}var c=n(6921),u=n(3102);function d(e,t){if("*"===e)return a()({loading:l,loader:()=>n.e(2237).then(n.bind(n,2237)),modules:["@theme/NotFound"],webpack:()=>[2237],render(e,t){const n=e.default;return(0,r.jsx)(u.W,{value:{plugin:{name:"native",id:"default"}},children:(0,r.jsx)(n,{...t})})}});const o=i[`${e}-${t}`],d={},p=[],m=[],g=(0,c.A)(o);return Object.entries(g).forEach(([e,t])=>{const n=s[t];n&&(d[e]=n[0],p.push(n[1]),m.push(n[2]))}),a().Map({loading:l,loader:d,modules:p,webpack:()=>m,render(t,n){const a=JSON.parse(JSON.stringify(o));Object.entries(t).forEach(([t,n])=>{const o=n.default;if(!o)throw new Error(`The page component at ${e} doesn't have a default export. This makes it impossible to render anything. Consider default-exporting a React component.`);"object"!=typeof o&&"function"!=typeof o||Object.keys(n).filter(e=>"default"!==e).forEach(e=>{o[e]=n[e]});let i=a;const s=t.split(".");s.slice(0,-1).forEach(e=>{i=i[e]}),i[s[s.length-1]]=o});const i=a.__comp;delete a.__comp;const s=a.__context;delete a.__context;const l=a.__props;return delete a.__props,(0,r.jsx)(u.W,{value:s,children:(0,r.jsx)(i,{...a,...l,...n})})}})}const p=[{path:"/markdown-page",component:d("/markdown-page","3d7"),exact:!0},{path:"/docs/v1",component:d("/docs/v1","b1e"),routes:[{path:"/docs/v1",component:d("/docs/v1","f1e"),routes:[{path:"/docs/v1",component:d("/docs/v1","38e"),routes:[{path:"/docs/v1/api/audit-trace",component:d("/docs/v1/api/audit-trace","331"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/api/java-api",component:d("/docs/v1/api/java-api","98f"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/api/rest-api",component:d("/docs/v1/api/rest-api","432"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/api/stream-api",component:d("/docs/v1/api/stream-api","db6"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/architecture",component:d("/docs/v1/architecture","425"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/consumer",component:d("/docs/v1/consumer","723"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/consumer/annotations-reference",component:d("/docs/v1/consumer/annotations-reference","64b"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/consumer/backend-integration",component:d("/docs/v1/consumer/backend-integration","c4f"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/consumer/configuration",component:d("/docs/v1/consumer/configuration","e2d"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/consumer/extensions",component:d("/docs/v1/consumer/extensions","241"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/consumer/new-consumer-onboarding",component:d("/docs/v1/consumer/new-consumer-onboarding","576"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/consumer/session-reset-and-continuity",component:d("/docs/v1/consumer/session-reset-and-continuity","63c"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/consumer/ui-integration",component:d("/docs/v1/consumer/ui-integration","430"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/deep-dive",component:d("/docs/v1/deep-dive","8e0"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/deep-dive/data-model",component:d("/docs/v1/deep-dive/data-model","254"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/deep-dive/developer-guide",component:d("/docs/v1/deep-dive/developer-guide","46a"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/deep-dive/examples",component:d("/docs/v1/deep-dive/examples","866"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/deep-dive/failure-gotchas",component:d("/docs/v1/deep-dive/failure-gotchas","14d"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/deep-dive/file-map",component:d("/docs/v1/deep-dive/file-map","54f"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/deep-dive/improvement-backlog",component:d("/docs/v1/deep-dive/improvement-backlog","f35"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/deep-dive/intent-and-schema",component:d("/docs/v1/deep-dive/intent-and-schema","6b8"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/deep-dive/lifecycle",component:d("/docs/v1/deep-dive/lifecycle","a72"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/deep-dive/mcp-audit",component:d("/docs/v1/deep-dive/mcp-audit","d53"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/deep-dive/pipeline-steps",component:d("/docs/v1/deep-dive/pipeline-steps","27f"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/deep-dive/request-lifecycle",component:d("/docs/v1/deep-dive/request-lifecycle","dde"),exact:!0},{path:"/docs/v1/deep-dive/rules-responses",component:d("/docs/v1/deep-dive/rules-responses","217"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/examples",component:d("/docs/v1/examples","c2e"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/local-development",component:d("/docs/v1/local-development","93d"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/overview",component:d("/docs/v1/overview","55c"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v1/version-history",component:d("/docs/v1/version-history","28e"),exact:!0,sidebar:"docSidebar"}]}]}]},{path:"/docs/v2",component:d("/docs/v2","8b7"),routes:[{path:"/docs/v2",component:d("/docs/v2","72c"),routes:[{path:"/docs/v2",component:d("/docs/v2","c78"),routes:[{path:"/docs/v2/api/audit-trace",component:d("/docs/v2/api/audit-trace","52f"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/api/java-api",component:d("/docs/v2/api/java-api","6b9"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/api/rest-api",component:d("/docs/v2/api/rest-api","8d8"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/api/stream-api",component:d("/docs/v2/api/stream-api","df2"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/architecture",component:d("/docs/v2/architecture","03d"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer",component:d("/docs/v2/consumer","684"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/annotations-reference",component:d("/docs/v2/consumer/annotations-reference","fe5"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/backend-integration",component:d("/docs/v2/consumer/backend-integration","740"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/caching-and-persistence",component:d("/docs/v2/consumer/caching-and-persistence","aef"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/configuration",component:d("/docs/v2/consumer/configuration","025"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/extensions",component:d("/docs/v2/consumer/extensions","171"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/mcp/advanced",component:d("/docs/v2/consumer/mcp/advanced","b9c"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/mcp/basics",component:d("/docs/v2/consumer/mcp/basics","b22"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/mcp/deep-dive",component:d("/docs/v2/consumer/mcp/deep-dive","8ef"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/mcp/example1",component:d("/docs/v2/consumer/mcp/example1","0a5"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/mcp/example2",component:d("/docs/v2/consumer/mcp/example2","a65"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/mcp/http-tool",component:d("/docs/v2/consumer/mcp/http-tool","8fc"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/new-consumer-onboarding",component:d("/docs/v2/consumer/new-consumer-onboarding","7ae"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/session-reset-and-continuity",component:d("/docs/v2/consumer/session-reset-and-continuity","75f"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/consumer/ui-integration",component:d("/docs/v2/consumer/ui-integration","3d9"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/deep-dive",component:d("/docs/v2/deep-dive","e52"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/deep-dive/data-model",component:d("/docs/v2/deep-dive/data-model","0ac"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/deep-dive/developer-guide",component:d("/docs/v2/deep-dive/developer-guide","de7"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/deep-dive/examples",component:d("/docs/v2/deep-dive/examples","dd1"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/deep-dive/failure-gotchas",component:d("/docs/v2/deep-dive/failure-gotchas","4f2"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/deep-dive/file-map",component:d("/docs/v2/deep-dive/file-map","73d"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/deep-dive/improvement-backlog",component:d("/docs/v2/deep-dive/improvement-backlog","9ee"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/deep-dive/intent-and-schema",component:d("/docs/v2/deep-dive/intent-and-schema","c0c"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/deep-dive/lifecycle",component:d("/docs/v2/deep-dive/lifecycle","af8"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/deep-dive/mcp-audit",component:d("/docs/v2/deep-dive/mcp-audit","444"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/deep-dive/pipeline-steps",component:d("/docs/v2/deep-dive/pipeline-steps","ca5"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/deep-dive/request-lifecycle",component:d("/docs/v2/deep-dive/request-lifecycle","4a2"),exact:!0},{path:"/docs/v2/deep-dive/rules-responses",component:d("/docs/v2/deep-dive/rules-responses","3d0"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/deep-dive/v2-features",component:d("/docs/v2/deep-dive/v2-features","b85"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/examples",component:d("/docs/v2/examples","1c9"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/faq",component:d("/docs/v2/faq","780"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/local-development",component:d("/docs/v2/local-development","40d"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/overview",component:d("/docs/v2/overview","3dc"),exact:!0,sidebar:"docSidebar"},{path:"/docs/v2/version-history",component:d("/docs/v2/version-history","aa1"),exact:!0,sidebar:"docSidebar"}]}]}]},{path:"/",component:d("/","2e1"),exact:!0},{path:"*",component:d("*")}]},8587(e,t,n){"use strict";function o(e,t){if(null==e)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(-1!==t.indexOf(o))continue;n[o]=e[o]}return n}n.d(t,{A:()=>o})},8774(e,t,n){"use strict";n.d(t,{A:()=>m});var o=n(6540),a=n(4625),i=n(440),s=n(4586),r=n(6654),l=n(8193),c=n(3427),u=n(6025),d=n(4848);function p({isNavLink:e,to:t,href:n,activeClassName:p,isActive:m,"data-noBrokenLinkCheck":g,autoAddBaseUrl:f=!0,...h},v){const{siteConfig:y}=(0,s.A)(),{trailingSlash:b,baseUrl:E}=y,S=y.future.experimental_router,{withBaseUrl:T}=(0,u.hH)(),_=(0,c.A)(),C=(0,o.useRef)(null);(0,o.useImperativeHandle)(v,()=>C.current);const I=t||n;const R=(0,r.A)(I),A=I?.replace("pathname://","");let N=void 0!==A?(x=A,f&&(e=>e.startsWith("/"))(x)?T(x):x):void 0;var x;"hash"===S&&N?.startsWith("./")&&(N=N?.slice(1)),N&&R&&(N=(0,i.Ks)(N,{trailingSlash:b,baseUrl:E}));const w=(0,o.useRef)(!1),P=e?a.k2:a.N_,k=l.A.canUseIntersectionObserver,O=(0,o.useRef)(),L=()=>{w.current||null==N||(window.docusaurus.preload(N),w.current=!0)};(0,o.useEffect)(()=>(!k&&R&&l.A.canUseDOM&&null!=N&&window.docusaurus.prefetch(N),()=>{k&&O.current&&O.current.disconnect()}),[O,N,k,R]);const D=N?.startsWith("#")??!1,M=!h.target||"_self"===h.target,U=!N||!R||!M||D&&"hash"!==S;g||!D&&U||_.collectLink(N),h.id&&_.collectAnchor(h.id);const F={};return U?(0,d.jsx)("a",{ref:C,href:N,...I&&!R&&{target:"_blank",rel:"noopener noreferrer"},...h,...F}):(0,d.jsx)(P,{...h,onMouseEnter:L,onTouchStart:L,innerRef:e=>{C.current=e,k&&e&&R&&(O.current=new window.IntersectionObserver(t=>{t.forEach(t=>{e===t.target&&(t.isIntersecting||t.intersectionRatio>0)&&(O.current.unobserve(e),O.current.disconnect(),null!=N&&window.docusaurus.prefetch(N))})}),O.current.observe(e))},to:N,...e&&{isActive:m,activeClassName:p},...F})}const m=o.forwardRef(p)},9169(e,t,n){"use strict";n.d(t,{Dt:()=>r,ys:()=>s});var o=n(6540),a=n(8328),i=n(4586);function s(e,t){const n=e=>(!e||e.endsWith("/")?e:`${e}/`)?.toLowerCase();return n(e)===n(t)}function r(){const{baseUrl:e}=(0,i.A)().siteConfig;return(0,o.useMemo)(()=>function({baseUrl:e,routes:t}){function n(t){return t.path===e&&!0===t.exact}function o(t){return t.path===e&&!t.exact}return function e(t){if(0===t.length)return;return t.find(n)||e(t.filter(o).flatMap(e=>e.routes??[]))}(t)}({routes:a.A,baseUrl:e}),[e])}},9532(e,t,n){"use strict";n.d(t,{Be:()=>c,ZC:()=>r,_q:()=>s,dV:()=>l,fM:()=>u});var o=n(6540),a=n(205),i=n(4848);function s(e){const t=(0,o.useRef)(e);return(0,a.A)(()=>{t.current=e},[e]),(0,o.useCallback)((...e)=>t.current(...e),[])}function r(e){const t=(0,o.useRef)();return(0,a.A)(()=>{t.current=e}),t.current}class l extends Error{constructor(e,t){super(),this.name="ReactContextError",this.message=`Hook ${this.stack?.split("\n")[1]?.match(/at (?:\w+\.)?(?<name>\w+)/)?.groups.name??""} is called outside the <${e}>. ${t??""}`}}function c(e){const t=Object.entries(e);return t.sort((e,t)=>e[0].localeCompare(t[0])),(0,o.useMemo)(()=>e,t.flat())}function u(e){return({children:t})=>(0,i.jsx)(i.Fragment,{children:e.reduceRight((e,t)=>(0,i.jsx)(t,{children:e}),t)})}},9698(e,t){"use strict";var n=Symbol.for("react.transitional.element"),o=Symbol.for("react.fragment");function a(e,t,o){var a=null;if(void 0!==o&&(a=""+o),void 0!==t.key&&(a=""+t.key),"key"in t)for(var i in o={},t)"key"!==i&&(o[i]=t[i]);else o=t;return t=o.ref,{$$typeof:n,type:e,key:a,ref:void 0!==t?t:null,props:o}}t.Fragment=o,t.jsx=a,t.jsxs=a},9700(){!function(e){function t(e,t){return"___"+e.toUpperCase()+t+"___"}Object.defineProperties(e.languages["markup-templating"]={},{buildPlaceholders:{value:function(n,o,a,i){if(n.language===o){var s=n.tokenStack=[];n.code=n.code.replace(a,function(e){if("function"==typeof i&&!i(e))return e;for(var a,r=s.length;-1!==n.code.indexOf(a=t(o,r));)++r;return s[r]=e,a}),n.grammar=e.languages.markup}}},tokenizePlaceholders:{value:function(n,o){if(n.language===o&&n.tokenStack){n.grammar=e.languages[o];var a=0,i=Object.keys(n.tokenStack);!function s(r){for(var l=0;l<r.length&&!(a>=i.length);l++){var c=r[l];if("string"==typeof c||c.content&&"string"==typeof c.content){var u=i[a],d=n.tokenStack[u],p="string"==typeof c?c:c.content,m=t(o,u),g=p.indexOf(m);if(g>-1){++a;var f=p.substring(0,g),h=new e.Token(o,e.tokenize(d,n.grammar),"language-"+o,d),v=p.substring(g+m.length),y=[];f&&y.push.apply(y,s([f])),y.push(h),v&&y.push.apply(y,s([v])),"string"==typeof c?r.splice.apply(r,[l,1].concat(y)):c.content=y}}else c.content&&s(c.content)}return r}(n.tokens)}}}})}(Prism)},9869(e,t){"use strict";var n=Symbol.for("react.transitional.element"),o=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.for("react.activity"),g=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,v={};function y(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||f}function b(){}function E(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=y.prototype;var S=E.prototype=new b;S.constructor=E,h(S,y.prototype),S.isPureReactComponent=!0;var T=Array.isArray;function _(){}var C={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function R(e,t,o){var a=o.ref;return{$$typeof:n,type:e,key:t,ref:void 0!==a?a:null,props:o}}function A(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var N=/\/+/g;function x(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(n=""+e.key,o={"=":"=0",":":"=2"},"$"+n.replace(/[=:]/g,function(e){return o[e]})):t.toString(36);var n,o}function w(e,t,a,i,s){var r=typeof e;"undefined"!==r&&"boolean"!==r||(e=null);var l,c,u=!1;if(null===e)u=!0;else switch(r){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case o:u=!0;break;case p:return w((u=e._init)(e._payload),t,a,i,s)}}if(u)return s=s(e),u=""===i?"."+x(e,0):i,T(s)?(a="",null!=u&&(a=u.replace(N,"$&/")+"/"),w(s,t,a,"",function(e){return e})):null!=s&&(A(s)&&(l=s,c=a+(null==s.key||e&&e.key===s.key?"":(""+s.key).replace(N,"$&/")+"/")+u,s=R(l.type,c,l.props)),t.push(s)),1;u=0;var d,m=""===i?".":i+":";if(T(e))for(var f=0;f<e.length;f++)u+=w(i=e[f],t,a,r=m+x(i,f),s);else if("function"==typeof(f=null===(d=e)||"object"!=typeof d?null:"function"==typeof(d=g&&d[g]||d["@@iterator"])?d:null))for(e=f.call(e),f=0;!(i=e.next()).done;)u+=w(i=i.value,t,a,r=m+x(i,f++),s);else if("object"===r){if("function"==typeof e.then)return w(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(_,_):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,a,i,s);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function P(e,t,n){if(null==e)return e;var o=[],a=0;return w(e,o,"","",function(e){return t.call(n,e,a++)}),o}function k(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},L={map:P,forEach:function(e,t,n){P(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return P(e,function(){t++}),t},toArray:function(e){return P(e,function(e){return e})||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};t.Activity=m,t.Children=L,t.Component=y,t.Fragment=a,t.Profiler=s,t.PureComponent=E,t.StrictMode=i,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return C.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cacheSignal=function(){return null},t.cloneElement=function(e,t,n){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var o=h({},e.props),a=e.key;if(null!=t)for(i in void 0!==t.key&&(a=""+t.key),t)!I.call(t,i)||"key"===i||"__self"===i||"__source"===i||"ref"===i&&void 0===t.ref||(o[i]=t[i]);var i=arguments.length-2;if(1===i)o.children=n;else if(1<i){for(var s=Array(i),r=0;r<i;r++)s[r]=arguments[r+2];o.children=s}return R(e.type,a,o)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:r,_context:e},e},t.createElement=function(e,t,n){var o,a={},i=null;if(null!=t)for(o in void 0!==t.key&&(i=""+t.key),t)I.call(t,o)&&"key"!==o&&"__self"!==o&&"__source"!==o&&(a[o]=t[o]);var s=arguments.length-2;if(1===s)a.children=n;else if(1<s){for(var r=Array(s),l=0;l<s;l++)r[l]=arguments[l+2];a.children=r}if(e&&e.defaultProps)for(o in s=e.defaultProps)void 0===a[o]&&(a[o]=s[o]);return R(e,i,a)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:p,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=C.T,n={};C.T=n;try{var o=e(),a=C.S;null!==a&&a(n,o),"object"==typeof o&&null!==o&&"function"==typeof o.then&&o.then(_,O)}catch(i){O(i)}finally{null!==t&&null!==n.types&&(t.types=n.types),C.T=t}},t.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},t.use=function(e){return C.H.use(e)},t.useActionState=function(e,t,n){return C.H.useActionState(e,t,n)},t.useCallback=function(e,t){return C.H.useCallback(e,t)},t.useContext=function(e){return C.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return C.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return C.H.useEffect(e,t)},t.useEffectEvent=function(e){return C.H.useEffectEvent(e)},t.useId=function(){return C.H.useId()},t.useImperativeHandle=function(e,t,n){return C.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return C.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return C.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return C.H.useMemo(e,t)},t.useOptimistic=function(e,t){return C.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return C.H.useReducer(e,t,n)},t.useRef=function(e){return C.H.useRef(e)},t.useState=function(e){return C.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return C.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return C.H.useTransition()},t.version="19.2.3"},9982(e,t,n){"use strict";e.exports=n(4477)}},e=>{e.O(0,[1869],()=>{return t=4351,e(e.s=t);var t});e.O()}]);