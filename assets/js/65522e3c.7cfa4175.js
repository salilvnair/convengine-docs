"use strict";(globalThis.webpackChunkconvengine_docs=globalThis.webpackChunkconvengine_docs||[]).push([[0],{5450(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"consumer/configuration","title":"Configuration","description":"ceprompttemplate in detail","source":"@site/docs/consumer/configuration.mdx","sourceDirName":"consumer","slug":"/consumer/configuration","permalink":"/docs/consumer/configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/salilvnair/convengine-docs/tree/main/docs/consumer/configuration.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Configuration","sidebar_position":2},"sidebar":"docSidebar","previous":{"title":"Backend Integration","permalink":"/docs/consumer/backend-integration"},"next":{"title":"Extensions","permalink":"/docs/consumer/extensions"}}');var i=t(4848),r=t(8453),l=t(3224);const o={title:"Configuration",sidebar_position:2},c="Configuration Deep Guide",a={},d=[{value:"<code>ce_prompt_template</code> in detail",id:"ce_prompt_template-in-detail",level:2},{value:"<code>ce_config</code> in detail",id:"ce_config-in-detail",level:2},{value:"<code>ce_output_schema</code> in detail",id:"ce_output_schema-in-detail",level:2},{value:"<code>ce_response</code> in detail",id:"ce_response-in-detail",level:2},{value:"<code>ce_rule</code> in detail",id:"ce_rule-in-detail",level:2},{value:"Prompt variable guidance",id:"prompt-variable-guidance",level:2},{value:"Runtime transport/audit properties",id:"runtime-transportaudit-properties",level:2},{value:"New 1.0.8+ runtime controls explained",id:"new-108-runtime-controls-explained",level:2},{value:"RabbitMQ relay example",id:"rabbitmq-relay-example",level:2},{value:"Redis example (via STOMP gateway/bridge)",id:"redis-example-via-stomp-gatewaybridge",level:2}];function p(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"configuration-deep-guide",children:"Configuration Deep Guide"})}),"\n",(0,i.jsxs)(n.h2,{id:"ce_prompt_template-in-detail",children:[(0,i.jsx)(n.code,{children:"ce_prompt_template"})," in detail"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ce_prompt_template"})," holds reusable prompt text for both schema extraction and derived response generation."]}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"response_type"})," to route templates:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SCHEMA_JSON"})," for schema extraction prompts"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TEXT"})," for derived text response prompts"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"JSON"})," for derived json response prompts"]}),"\n"]}),"\n",(0,i.jsx)(l.vl,{title:"Example ce_prompt_template rows",language:"sql",children:"-- Schema extraction template\nINSERT INTO ce_prompt_template\n(intent_code, state_code, response_type, system_prompt, user_prompt, enabled)\nVALUES\n('DISCONNECT_ELECTRICITY', 'COLLECTING', 'SCHEMA_JSON',\n'Extract required fields strictly as JSON. No commentary.',\n'User: {{user_input}}\nContext: {{context}}\nSchema: {{schema}}',\ntrue);\n\n-- Derived text response template\nINSERT INTO ce_prompt_template\n(intent_code, state_code, response_type, system_prompt, user_prompt, enabled)\nVALUES\n('REQUEST_TRACKER', 'IDLE', 'TEXT',\n'You are a concise status assistant. Keep response under 3 lines.',\n'User: {{user_input}}\nContext: {{context}}\nSession: {{session}}',\ntrue);"}),"\n",(0,i.jsxs)(n.h2,{id:"ce_config-in-detail",children:[(0,i.jsx)(n.code,{children:"ce_config"})," in detail"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ce_config"})," stores runtime tunables keyed by component class."]}),"\n",(0,i.jsx)(n.p,{children:"Common keys:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"AgentIntentResolver.MIN_CONFIDENCE"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"AgentIntentResolver.COLLISION_GAP_THRESHOLD"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"AgentIntentResolver.SYSTEM_PROMPT"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"AgentIntentResolver.USER_PROMPT"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"McpPlanner.SYSTEM_PROMPT"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"McpPlanner.USER_PROMPT"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"ResetResolvedIntentStep.RESET_INTENT_CODES"})}),"\n"]}),"\n",(0,i.jsx)(l.vl,{title:"Example ce_config rows",language:"sql",children:"INSERT INTO ce_config (config_type, config_key, config_value, enabled) VALUES\n('AgentIntentResolver', 'MIN_CONFIDENCE', '0.60', true),\n('AgentIntentResolver', 'COLLISION_GAP_THRESHOLD', '0.15', true),\n('ResetResolvedIntentStep', 'RESET_INTENT_CODES', 'RESET_SESSION,START_OVER', true),\n('McpPlanner', 'SYSTEM_PROMPT', 'You are an MCP planner. Prefer safe calls and minimal arguments.', true),\n('McpPlanner', 'USER_PROMPT', 'User: {{user_input}}\nTools: {{mcp_tools}}\nContext: {{context}}', true);"}),"\n",(0,i.jsx)(l.p,{title:"Implemented type/action values",columns:["Field","Allowed values","Notes"],rows:[["ce_response.response_type","EXACT, DERIVED","EXACT bypasses LLM generation"],["ce_response.output_format","TEXT, JSON","Used by output format resolver"],["ce_rule.rule_type","EXACT, REGEX, JSON_PATH","Must match installed rule type resolvers"],["ce_rule.action","SET_INTENT, SET_STATE, SET_JSON, GET_CONTEXT, GET_SCHEMA_JSON, GET_SESSION, SET_TASK","Must match installed action resolvers"]]}),"\n",(0,i.jsxs)(n.h2,{id:"ce_output_schema-in-detail",children:[(0,i.jsx)(n.code,{children:"ce_output_schema"})," in detail"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ce_output_schema"})," defines extraction contract per intent/state. ",(0,i.jsx)(n.code,{children:"SchemaExtractionStep"})," uses this JSON schema to detect missing fields and drive clarification flow."]}),"\n",(0,i.jsx)(l.vl,{title:"ce_output_schema shape (DDL-style)",language:"sql",children:"-- Core columns (simplified)\nCREATE TABLE ce_output_schema (\n  schema_id BIGSERIAL PRIMARY KEY,\n  intent_code TEXT NOT NULL,\n  state_code TEXT NOT NULL,\n  schema_name TEXT,\n  schema_description TEXT,\n  json_schema JSONB NOT NULL,\n  enabled BOOLEAN NOT NULL DEFAULT TRUE,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()\n);"}),"\n",(0,i.jsx)(l.vl,{title:"Example ce_output_schema row",language:"sql",children:'INSERT INTO ce_output_schema\n(intent_code, state_code, schema_name, schema_description, json_schema, enabled)\nVALUES\n(\n\'DISCONNECT_ELECTRICITY\',\n\'COLLECTING\',\n\'disconnect_request\',\n\'Required data to process electricity disconnect request.\',\n\'{\n   "type":"object",\n   "required":["accountNumber","reason"],\n   "properties":{\n     "accountNumber":{"type":"string"},\n     "reason":{"type":"string","enum":["MOVE_OUT","TEMP_CLOSE","PERMANENT_CLOSE"]},\n     "requestedDate":{"type":"string","format":"date"}\n   }\n }\'::jsonb,\ntrue\n);'}),"\n",(0,i.jsxs)(n.h2,{id:"ce_response-in-detail",children:[(0,i.jsx)(n.code,{children:"ce_response"})," in detail"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ce_response"})," maps resolved intent/state to response strategy."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"EXACT"}),": static response body from DB."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DERIVED"}),": runtime generated response (LLM), optionally using ",(0,i.jsx)(n.code,{children:"ce_prompt_template"}),"."]}),"\n"]}),"\n",(0,i.jsx)(l.vl,{title:"ce_response shape (DDL-style)",language:"sql",children:"CREATE TABLE ce_response (\n  response_id BIGSERIAL PRIMARY KEY,\n  intent_code TEXT NOT NULL,\n  state_code TEXT NOT NULL,\n  response_type TEXT NOT NULL,  -- EXACT | DERIVED\n  output_format TEXT NOT NULL,  -- TEXT | JSON\n  response_text TEXT,\n  response_json JSONB,\n  enabled BOOLEAN NOT NULL DEFAULT TRUE,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()\n);"}),"\n",(0,i.jsx)(l.vl,{title:"Example ce_response rows",language:"sql",children:"-- EXACT TEXT response\nINSERT INTO ce_response\n(intent_code, state_code, response_type, output_format, response_text, enabled)\nVALUES\n('FAQ', 'IDLE', 'EXACT', 'TEXT', 'Yes, you can move your connection using Zapper app.', true);\n\n-- DERIVED JSON response\nINSERT INTO ce_response\n(intent_code, state_code, response_type, output_format, response_json, enabled)\nVALUES\n('REQUEST_TRACKER', 'IDLE', 'DERIVED', 'JSON', '{\"template\":\"status-card\"}'::jsonb, true);"}),"\n",(0,i.jsxs)(n.h2,{id:"ce_rule-in-detail",children:[(0,i.jsx)(n.code,{children:"ce_rule"})," in detail"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ce_rule"})," is the conditional transition/action layer executed in ",(0,i.jsx)(n.code,{children:"RulesStep"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"rule_type"}),": ",(0,i.jsx)(n.code,{children:"EXACT"}),", ",(0,i.jsx)(n.code,{children:"REGEX"}),", ",(0,i.jsx)(n.code,{children:"JSON_PATH"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"action"}),": ",(0,i.jsx)(n.code,{children:"SET_INTENT"}),", ",(0,i.jsx)(n.code,{children:"SET_STATE"}),", ",(0,i.jsx)(n.code,{children:"SET_JSON"}),", ",(0,i.jsx)(n.code,{children:"GET_CONTEXT"}),", ",(0,i.jsx)(n.code,{children:"GET_SCHEMA_JSON"}),", ",(0,i.jsx)(n.code,{children:"GET_SESSION"}),", ",(0,i.jsx)(n.code,{children:"SET_TASK"})]}),"\n"]}),"\n",(0,i.jsx)(l.vl,{title:"ce_rule shape (DDL-style)",language:"sql",children:"CREATE TABLE ce_rule (\n  rule_id BIGSERIAL PRIMARY KEY,\n  intent_code TEXT NOT NULL,\n  state_code TEXT NOT NULL,\n  stage TEXT NOT NULL,\n  rule_type TEXT NOT NULL,\n  condition_expr TEXT,\n  action TEXT NOT NULL,\n  action_payload JSONB,\n  priority INT NOT NULL DEFAULT 100,\n  enabled BOOLEAN NOT NULL DEFAULT TRUE,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()\n);"}),"\n",(0,i.jsx)(l.vl,{title:"Example ce_rule rows",language:"sql",children:"-- If user says reset keywords, set reset intent\nINSERT INTO ce_rule\n(intent_code, state_code, stage, rule_type, condition_expr, action, action_payload, priority, enabled)\nVALUES\n('FAQ', 'IDLE', 'PRE_RESPONSE', 'REGEX', '(?i)^(reset|restart)$', 'SET_INTENT', '{\"intent\":\"RESET_SESSION\"}'::jsonb, 10, true);\n\n-- Pull context snapshot into payload path\nINSERT INTO ce_rule\n(intent_code, state_code, stage, rule_type, condition_expr, action, action_payload, priority, enabled)\nVALUES\n('REQUEST_TRACKER', 'IDLE', 'PRE_RESPONSE', 'EXACT', 'true', 'GET_CONTEXT', '{\"target\":\"payload.context\"}'::jsonb, 50, true);"}),"\n",(0,i.jsx)(n.h2,{id:"prompt-variable-guidance",children:"Prompt variable guidance"}),"\n",(0,i.jsx)(n.p,{children:"Common variables used in templates:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"{{user_input}}"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"{{context}}"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"{{session}}"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"{{schema}}"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"{{conversation_history}}"})}),"\n",(0,i.jsxs)(n.li,{children:["schema helpers: ",(0,i.jsx)(n.code,{children:"{{missing_fields}}"}),", ",(0,i.jsx)(n.code,{children:"{{missing_field_options}}"}),", ",(0,i.jsx)(n.code,{children:"{{schema_description}}"})]}),"\n"]}),"\n",(0,i.jsx)(l.f4,{type:"warning",title:"Prompt variable safety",children:(0,i.jsx)(n.p,{children:"Engine now controls prompt variable exposure and blocks unsafe system-derived keys from being unintentionally injected into prompt templates."})}),"\n",(0,i.jsx)(n.h2,{id:"runtime-transportaudit-properties",children:"Runtime transport/audit properties"}),"\n",(0,i.jsx)(l.vl,{title:"application.yml (feature toggles)",language:"yaml",children:'convengine:\ntransport:\n  stomp:\n    enabled: true\n    broker:\n      mode: SIMPLE # SIMPLE | RELAY\n      relay-destination-prefixes: /topic,/queue\n      relay-host: localhost\n      relay-port: 61613\n      client-login: ""\n      client-passcode: ""\n      system-login: ""\n      system-passcode: ""\n      virtual-host: ""\n      system-heartbeat-send-interval-ms: 10000\n      system-heartbeat-receive-interval-ms: 10000\n\naudit:\n  enabled: true\n  level: ALL # ALL | STANDARD | ERROR_ONLY | NONE\n  include-stages: []\n  exclude-stages: []\n  persistence:\n    mode: IMMEDIATE # IMMEDIATE | DEFERRED_BULK\n    jdbc-batch-size: 200\n    max-buffered-events: 5000\n    flush-stages: ENGINE_KNOWN_FAILURE,ENGINE_UNKNOWN_FAILURE\n    final-step-names: PipelineEndGuardStep\n    flush-on-stop-outcome: true\n  dispatch:\n    async-enabled: false\n    worker-threads: 2\n    queue-capacity: 2000\n    rejection-policy: CALLER_RUNS # CALLER_RUNS | DROP_NEWEST | DROP_OLDEST | ABORT\n    keep-alive-seconds: 60\n  rate-limit:\n    enabled: false\n    max-events: 200\n    window-ms: 1000\n    per-conversation: true\n    per-stage: true\n    max-tracked-buckets: 20000'}),"\n",(0,i.jsx)(l.vl,{title:"Optional annotations",language:"java",children:"@EnableConvEngine(stream = true)\n@EnableConvEngineAsyncAuditDispatch\n@EnableConvEngineStompBrokerRelay\n@SpringBootApplication\npublic class MyApplication {\npublic static void main(String[] args) {\n  SpringApplication.run(MyApplication.class, args);\n}\n}"}),"\n",(0,i.jsx)(n.h2,{id:"new-108-runtime-controls-explained",children:"New 1.0.8+ runtime controls explained"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Async audit dispatch:"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Moves transport fan-out off request thread when enabled."}),"\n",(0,i.jsxs)(n.li,{children:["Configure with ",(0,i.jsx)(n.code,{children:"convengine.audit.dispatch.*"})," or ",(0,i.jsx)(n.code,{children:"@EnableConvEngineAsyncAuditDispatch"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Backpressure policy:"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Queue capacity + rejection policy control behavior under burst."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CALLER_RUNS"})," is safest default; ",(0,i.jsx)(n.code,{children:"DROP_*"})," favors latency; ",(0,i.jsx)(n.code,{children:"ABORT"})," is strict."]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Stage-level audit controls:"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"level"}),", ",(0,i.jsx)(n.code,{children:"include-stages"}),", ",(0,i.jsx)(n.code,{children:"exclude-stages"}),", and ",(0,i.jsx)(n.code,{children:"rate-limit"})," reduce noisy audit traffic."]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"Deferred bulk persistence:"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"convengine.audit.persistence.mode=DEFERRED_BULK"})," buffers events and writes batch inserts."]}),"\n",(0,i.jsx)(n.li,{children:"Flushes on terminal step/error (configurable), plus request-end safety flush."}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:"STOMP broker mode:"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SIMPLE"})," (default): in-memory broker."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RELAY"}),": external STOMP broker (RabbitMQ/other relay supporting STOMP)."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"rabbitmq-relay-example",children:"RabbitMQ relay example"}),"\n",(0,i.jsx)(l.vl,{title:"application-rabbitmq-relay.yml",language:"yaml",children:"convengine:\ntransport:\n  stomp:\n    enabled: true\n    endpoint: /ws-convengine\n    app-destination-prefix: /app\n    topic-prefix: /topic\n    audit-destination-base: /topic/convengine/audit\n    broker:\n      mode: RELAY\n      relay-destination-prefixes: /topic,/queue\n      relay-host: localhost\n      relay-port: 61613\n      client-login: guest\n      client-passcode: guest\n      system-login: guest\n      system-passcode: guest\n      virtual-host: /\n      system-heartbeat-send-interval-ms: 10000\n      system-heartbeat-receive-interval-ms: 10000"}),"\n",(0,i.jsx)(n.h2,{id:"redis-example-via-stomp-gatewaybridge",children:"Redis example (via STOMP gateway/bridge)"}),"\n",(0,i.jsx)(l.f4,{type:"warning",title:"Redis note",children:(0,i.jsx)(n.p,{children:"ConvEngine STOMP relay requires a STOMP-compatible broker endpoint. Redis alone is not a native STOMP broker; use a STOMP gateway/bridge in front of Redis."})}),"\n",(0,i.jsx)(l.vl,{title:"application-redis-bridge-relay.yml",language:"yaml",children:'convengine:\ntransport:\n  stomp:\n    enabled: true\n    broker:\n      mode: RELAY\n      relay-destination-prefixes: /topic,/queue\n      relay-host: redis-stomp-bridge.local\n      relay-port: 61613\n      client-login: ""\n      client-passcode: ""\n      system-login: ""\n      system-passcode: ""\n      virtual-host: ""'})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}}}]);