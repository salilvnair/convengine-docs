"use strict";(globalThis.webpackChunkconvengine_docs=globalThis.webpackChunkconvengine_docs||[]).push([[230],{7495(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"architecture","title":"Architecture","description":"Layers","source":"@site/docs/architecture.mdx","sourceDirName":".","slug":"/architecture","permalink":"/docs/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/salilvnair/convengine-docs/tree/main/docs/architecture.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Architecture","sidebar_position":2},"sidebar":"docSidebar","previous":{"title":"Overview","permalink":"/docs/overview"},"next":{"title":"Examples","permalink":"/docs/examples"}}');var s=i(4848),t=i(8453),l=i(9131);const a={title:"Architecture",sidebar_position:2},c="Architecture",o={},d=[{value:"Layers",id:"layers",level:2},{value:"API Layer",id:"api-layer",level:3},{value:"Engine Layer",id:"engine-layer",level:3},{value:"Resolver Layer",id:"resolver-layer",level:3},{value:"Persistence Layer",id:"persistence-layer",level:3},{value:"Transport Layer (configurable)",id:"transport-layer-configurable",level:3},{value:"Request Path (high-level)",id:"request-path-high-level",level:2},{value:"Code references",id:"code-references",level:2}];function h(e){const n={admonition:"admonition",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,s.jsx)(n.h2,{id:"layers",children:"Layers"}),"\n",(0,s.jsx)(n.h3,{id:"api-layer",children:"API Layer"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(l.pu,{children:"ConversationController"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["request DTO: ",(0,s.jsx)(l.pu,{children:"ConversationRequest"})]}),"\n",(0,s.jsxs)(n.li,{children:["response DTO: ",(0,s.jsx)(l.pu,{children:"ConversationResponse"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"engine-layer",children:"Engine Layer"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(l.pu,{children:"DefaultConversationalEngine"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(l.pu,{children:"EnginePipelineFactory"})," (DAG sort + wrappers + timing + step hooks)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(l.pu,{children:"EngineSession"})," (per-turn mutable state)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"resolver-layer",children:"Resolver Layer"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"intent: classifier + agent + collision resolver"}),"\n",(0,s.jsx)(n.li,{children:"rules: type/action factories"}),"\n",(0,s.jsx)(n.li,{children:"response: response type + output format factories"}),"\n",(0,s.jsx)(n.li,{children:"MCP: planner + registry + DB executor"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"persistence-layer",children:"Persistence Layer"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["JPA repositories on ",(0,s.jsx)(l.Mn,{children:"ce_*"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(l.Mn,{children:"ce_conversation"})," and ",(0,s.jsx)(l.Mn,{children:"ce_audit"})," write path"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"transport-layer-configurable",children:"Transport Layer (configurable)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"SSE stream endpoint"}),"\n",(0,s.jsx)(n.li,{children:"STOMP/WebSocket publisher"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"request-path-high-level",children:"Request Path (high-level)"}),"\n",(0,s.jsx)(l.zM,{step:"1",title:"Controller receives request",children:(0,s.jsxs)(n.p,{children:["Builds ",(0,s.jsx)(l.pu,{children:"EngineContext"})," from ",(0,s.jsx)(l.pu,{children:"conversationId"}),", ",(0,s.jsx)(l.pu,{children:"message"}),", ",(0,s.jsx)(l.pu,{children:"inputParams"}),", optional ",(0,s.jsx)(l.pu,{children:"reset"})," flag."]})}),"\n",(0,s.jsx)(l.zM,{step:"2",title:"Engine opens session",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(l.pu,{children:"EngineSessionFactory"})," creates session and history provider injects last turns."]})}),"\n",(0,s.jsx)(l.zM,{step:"3",title:"Pipeline runs ordered steps",children:(0,s.jsx)(n.p,{children:"Each step receives same session instance and may mutate intent/state/context/payload."})}),"\n",(0,s.jsx)(l.zM,{step:"4",title:"Persist + return result",children:(0,s.jsx)(n.p,{children:"Final payload is persisted and returned as TEXT/JSON response."})}),"\n",(0,s.jsx)(n.h2,{id:"code-references",children:"Code references"}),"\n",(0,s.jsx)(l.vl,{title:"Engine entrypoint",language:"java",packagePath:"com.github.salilvnair.convengine.engine.provider",filePath:"src/main/java/com/github/salilvnair/convengine/engine/provider/DefaultConversationalEngine.java",defaultOpen:!1,children:"@Override\npublic EngineResult process(EngineContext engineContext) {\n  EngineSession session = sessionFactory.open(engineContext);\n  session.setConversationHistory(historyProvider.lastTurns(session.getConversationId(), 10));\n  EnginePipeline pipeline = pipelineFactory.create();\n  return pipeline.execute(session);\n}"}),"\n",(0,s.jsx)(l.vl,{title:"Pipeline execution loop",language:"java",packagePath:"com.github.salilvnair.convengine.engine.pipeline",filePath:"src/main/java/com/github/salilvnair/convengine/engine/pipeline/EnginePipeline.java",children:"for (EngineStep step : steps) {\n  StepResult r = step.execute(session);\n  if (r instanceof StepResult.Stop(EngineResult result)) {\n      return result;\n  }\n}"}),"\n",(0,s.jsx)(n.admonition,{title:"Intervention point",type:"tip",children:(0,s.jsxs)(n.p,{children:["You can intercept any step via ",(0,s.jsx)(l.pu,{children:"EngineStepHook"})," (",(0,s.jsx)(l.pu,{children:"beforeStep"}),", ",(0,s.jsx)(l.pu,{children:"afterStep"}),", ",(0,s.jsx)(l.pu,{children:"onStepError"}),") without forking the engine."]})}),"\n",(0,s.jsx)(l.f4,{type:"warning",title:"DAG-ordering model",children:(0,s.jsx)(n.p,{children:"Step order is never hardcoded as a list. It is computed from annotations and validated for cycles/missing dependencies."})})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);