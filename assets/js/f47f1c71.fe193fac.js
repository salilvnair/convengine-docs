"use strict";(globalThis.webpackChunkconvengine_docs=globalThis.webpackChunkconvengine_docs||[]).push([[3674],{1470(e,t,n){n.d(t,{A:()=>A});var i=n(6540),s=n(4164),a=n(7559),o=n(3104),r=n(6347),l=n(205),c=n(7485),u=n(1682),d=n(679);function p(e){return i.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:t,children:n}=e;return(0,i.useMemo)(()=>{const e=t??function(e){return p(e).map(({props:{value:e,label:t,attributes:n,default:i}})=>({value:e,label:t,attributes:n,default:i}))}(n);return function(e){const t=(0,u.XI)(e,(e,t)=>e.value===t.value);if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[t,n])}function v({value:e,tabValues:t}){return t.some(t=>t.value===e)}function g({queryString:e=!1,groupId:t}){const n=(0,r.W6)(),s=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,c.aZ)(s),(0,i.useCallback)(e=>{if(!s)return;const t=new URLSearchParams(n.location.search);t.set(s,e),n.replace({...n.location,search:t.toString()})},[s,n])]}function x(e){const{defaultValue:t,queryString:n=!1,groupId:s}=e,a=h(e),[o,r]=(0,i.useState)(()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!v({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const n=t.find(e=>e.default)??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:a})),[c,u]=g({queryString:n,groupId:s}),[p,x]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,s]=(0,d.Dv)(t);return[n,(0,i.useCallback)(e=>{t&&s.set(e)},[t,s])]}({groupId:s}),m=(()=>{const e=c??p;return v({value:e,tabValues:a})?e:null})();(0,l.A)(()=>{m&&r(m)},[m]);return{selectedValue:o,selectValue:(0,i.useCallback)(e=>{if(!v({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);r(e),u(e),x(e)},[u,x,a]),tabValues:a}}var m=n(2303);const f="tabList__CuJ",b="tabItem_LNqP";var j=n(4848);function E({className:e,block:t,selectedValue:n,selectValue:i,tabValues:a}){const r=[],{blockElementScrollPositionUntilNextRender:l}=(0,o.a_)(),c=e=>{const t=e.currentTarget,s=r.indexOf(t),o=a[s].value;o!==n&&(l(t),i(o))},u=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=r.indexOf(e.currentTarget)+1;t=r[n]??r[0];break}case"ArrowLeft":{const n=r.indexOf(e.currentTarget)-1;t=r[n]??r[r.length-1];break}}t?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":t},e),children:a.map(({value:e,label:t,attributes:i})=>(0,j.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{r.push(e)},onKeyDown:u,onClick:c,...i,className:(0,s.A)("tabs__item",b,i?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function y({lazy:e,children:t,selectedValue:n}){const a=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=a.find(e=>e.props.value===n);return e?(0,i.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:a.map((e,t)=>(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function T(e){const t=x(e);return(0,j.jsxs)("div",{className:(0,s.A)(a.G.tabs.container,"tabs-container",f),children:[(0,j.jsx)(E,{...t,...e}),(0,j.jsx)(y,{...t,...e})]})}function A(e){const t=(0,m.A)();return(0,j.jsx)(T,{...e,children:p(e.children)},String(t))}},5007(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>u,default:()=>m,frontMatter:()=>c,metadata:()=>i,toc:()=>g,v2ExtDetails:()=>v,v2ExtEdges:()=>h,v2ExtNodes:()=>p});const i=JSON.parse('{"id":"deep-dive/developer-guide","title":"Developer Guide","description":"This page is the full implementation starter for consumers building flows on top of ConvEngine.","source":"@site/docs/v2/deep-dive/developer-guide.mdx","sourceDirName":"deep-dive","slug":"/deep-dive/developer-guide","permalink":"/docs/v2/deep-dive/developer-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/salilvnair/convengine-docs/tree/main/docs/v2/deep-dive/developer-guide.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Developer Guide","sidebar_position":5,"hide_table_of_contents":true},"sidebar":"docSidebar","previous":{"title":"Data Model","permalink":"/docs/v2/deep-dive/data-model"},"next":{"title":"File Map","permalink":"/docs/v2/deep-dive/file-map"}}');var s=n(4848),a=n(8453),o=n(1470),r=n(9365),l=n(9131);const c={title:"Developer Guide",sidebar_position:5,hide_table_of_contents:!0},u="Developer Guide",d={},p=[{id:"v2x1",position:{x:20,y:60},data:{label:"DialogueActStep"}},{id:"v2x2",position:{x:260,y:60},data:{label:"InteractionPolicyStep"}},{id:"v2x3",position:{x:500,y:60},data:{label:"PendingActionStep"}},{id:"v2x4",position:{x:740,y:60},data:{label:"ToolOrchestrationStep"}},{id:"v2x5",position:{x:20,y:230},data:{label:"GuardrailStep"}},{id:"v2x6",position:{x:260,y:230},data:{label:"StateGraphStep"}},{id:"v2x7",position:{x:500,y:230},data:{label:"DisambiguationStep"}},{id:"v2x8",position:{x:740,y:230},data:{label:"CeTaskExecutor"}}],h=[{id:"v2xe1",source:"v2x1",target:"v2x2"},{id:"v2xe2",source:"v2x2",target:"v2x3"},{id:"v2xe3",source:"v2x3",target:"v2x4"},{id:"v2xe4",source:"v2x4",target:"v2x5"},{id:"v2xe5",source:"v2x5",target:"v2x6"},{id:"v2xe6",source:"v2x6",target:"v2x7"},{id:"v2xe7",source:"v2x7",target:"v2x8"}],v={v2x1:{title:"Dialogue Act",file:"engine/steps/DialogueActStep.java",method:"execute(...) ",stage:"DIALOGUE_ACT_RESOLVED",summary:"Resolves abstract acts like AFFIRM, NEGATE, EDIT.",session:["dialogueAct attached to session"],tables:["none"]},v2x2:{title:"Policy Engine",file:"engine/steps/InteractionPolicyStep.java",method:"execute(...) ",stage:"POLICY_APPLIED",summary:"Maps dialogue acts to system functions using interaction matrix.",session:["systemAction triggered (e.g. EXECUTE_PENDING_ACTION)"],tables:["none"]},v2x3:{title:"Pending Actions",file:"engine/steps/PendingActionStep.java",method:"execute(...) ",stage:"ACTION_LIFECYCLE",summary:"Runs deferred confirmation tasks via CeTaskExecutor.",session:["task result stored"],tables:["ce_pending_action"]},v2x4:{title:"Tool Runner",file:"engine/steps/ToolOrchestrationStep.java",method:"execute(...) ",stage:"TOOL_EXECUTED",summary:"Calls external downstream logic.",session:["tool_status and result merged"],tables:["ce_mcp_tool, ce_mcp_db_tool"]},v2x5:{title:"Guardrails",file:"engine/steps/GuardrailStep.java",method:"execute(...) ",stage:"GUARDRAIL_VIOLATION",summary:"Proactively redacts or fails-closed unsafe user text.",session:["redacted input / pipeline stop"],tables:["none"]},v2x6:{title:"State Graph",file:"engine/steps/StateGraphStep.java",method:"execute(...) ",stage:"INVALID_STATE_TRANSITION",summary:"Enforces statically bounded turn transitions.",session:["state transition audited"],tables:["none"]},v2x7:{title:"Disambiguation",file:"engine/steps/DisambiguationStep.java",method:"execute(...) ",stage:"CLARIFICATION_REQUIRED",summary:"Detects intent collisions and asks user to choose.",session:["clarification list prepped"],tables:["none"]},v2x8:{title:"Task Extension",file:"api/tasks/CeTaskExecutor.java",method:"executeTask(...) ",stage:"TASK_RUNNING",summary:"Consumer-injected Java component logic.",session:["consumer mutates map state"],tables:["none"]}},g=[{value:"Build order for a new flow",id:"build-order-for-a-new-flow",level:2},{value:"Review: <code>convengine.flow.*</code> features",id:"review-convengineflow-features",level:2},{value:"Extension points",id:"extension-points",level:2},{value:"Operational safety checklist",id:"operational-safety-checklist",level:2},{value:"Regression strategy",id:"regression-strategy",level:2}];function x(e){const t={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"developer-guide",children:"Developer Guide"})}),"\n",(0,s.jsx)(t.p,{children:"This page is the full implementation starter for consumers building flows on top of ConvEngine."}),"\n",(0,s.jsx)(l.il,{title:"Pipeline Extension Map",subtitle:"Click each node to inspect the components.",nodes:p,edges:h,detailsById:v,defaultSelectedId:"v2x2"}),"\n",(0,s.jsx)(t.h2,{id:"build-order-for-a-new-flow",children:"Build order for a new flow"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Define intent/state and response rows in ",(0,s.jsx)(t.code,{children:"ce_intent"})," and ",(0,s.jsx)(t.code,{children:"ce_response"}),"."]}),"\n",(0,s.jsx)(t.li,{children:"Define schema row (if slot collection needed)."}),"\n",(0,s.jsxs)(t.li,{children:["Define rule transitions by phase (",(0,s.jsx)(t.code,{children:"ce_rule"}),")."]}),"\n",(0,s.jsxs)(t.li,{children:["Define pending actions in ",(0,s.jsx)(t.code,{children:"ce_pending_action"})," for explicit AFFIRM/NEGATE confirmation flows."]}),"\n",(0,s.jsxs)(t.li,{children:["Configure ",(0,s.jsx)(t.code,{children:"convengine.flow.*"})," namespaces (e.g. state graph restrictions, disambiguation limits)."]}),"\n",(0,s.jsxs)(t.li,{children:["Add tool rows and adapters to the orchestration library if external execution is needed via ",(0,s.jsx)(t.code,{children:"McpToolExecutor"}),"."]}),"\n",(0,s.jsx)(t.li,{children:"Replay test with expected intent/state/dialogue-act assertions."}),"\n"]}),"\n",(0,s.jsxs)(t.h2,{id:"review-convengineflow-features",children:["Review: ",(0,s.jsx)(t.code,{children:"convengine.flow.*"})," features"]}),"\n",(0,s.jsxs)(t.p,{children:["Use your ",(0,s.jsx)(t.code,{children:"application.yml"})," to tune the pipeline without writing Java extension components."]}),"\n",(0,s.jsx)(l.p,{title:"Flow Features",columns:["Subsystem","Purpose","Example Property"],rows:[["dialogue-act.*","Detect foundational speech acts (AFFIRM, NEGATE) instead of strict intents.","resolute: REGEX_THEN_LLM"],["interaction-policy.*","Map acts to system outcomes like EXECUTE_PENDING_ACTION.","matrix: PENDING_ACTION:AFFIRM -> EXECUTE"],["action-lifecycle.*","Evict old confirmations out of memory.","ttl-turns: 3"],["disambiguation.*","Ask the user to clarify between colliding priorities.","max-options: 5"],["guardrail.*","Prevent prompt-injection and sanitize text.","approval-gate-fail-closed: true"],["state-graph.*","Enforce strict state transition bounds.","soft-block-on-violation: false"]]}),"\n",(0,s.jsx)(t.h2,{id:"extension-points",children:"Extension points"}),"\n",(0,s.jsxs)(o.A,{groupId:"extensions",children:[(0,s.jsx)(r.A,{value:"tasks",label:"CeTask",default:!0,children:(0,s.jsx)(l.vl,{title:"Creating a Pending Action Task",language:"java",packagePath:"com.zapper.convengine.tasks",children:'@Component("shippingConfirmationTask")\npublic class ShippingConfirmationTask implements CeTask {\n@Override\npublic TaskResult execute(EngineSession session, CePendingAction action) {\n  String trackingId = (String) session.getInputParams().get("trackingId");\n  // Call downstream API\n  session.putInputParam("shippingStatus", "DISPATCHED");\n  return TaskResult.success();\n}\n}'})}),(0,s.jsx)(r.A,{value:"tools",label:"McpToolExecutor",children:(0,s.jsx)(l.vl,{title:"Tool execution adapter",language:"java",packagePath:"com.zapper.convengine.tools",children:'@Component("billingToolAdapter")\npublic class BillingToolAdapter implements McpToolExecutor {\n@Override\npublic ToolExecutionResult invoke(ToolRequest request, EngineSession session) {\n  if (request.getToolGroup().equals("BILLING")) {\n     return ToolExecutionResult.success(Map.of("balance", 0.00));\n  }\n  return ToolExecutionResult.skipped();\n}\n}'})}),(0,s.jsx)(r.A,{value:"memory",label:"Memory Store",children:(0,s.jsx)(l.vl,{title:"Custom Session Snapshotting",language:"java",packagePath:"com.zapper.convengine.stores",children:"@Component\npublic class CustomMemoryStore implements ConversationMemoryStore {\n@Override\npublic String summarize(List<TurnSnapshot> turns) {\n    // Use LLM to compress 20 turns into a 100 character context injection\n    return llmClient.summarizeWithLimits(turns, 100);\n}\n}"})})]}),"\n",(0,s.jsx)(t.h2,{id:"operational-safety-checklist",children:"Operational safety checklist"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Configure Fallbacks"}),": Configure fallback response rows for ",(0,s.jsx)(t.code,{children:"UNKNOWN"})," / ",(0,s.jsx)(t.code,{children:"ANY"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Phase Targeting"}),": Do not depend on one rule only; cleanly separate constraints into ",(0,s.jsx)(t.code,{children:"PRE_EVAL"}),", ",(0,s.jsx)(t.code,{children:"EVAL"}),", and ",(0,s.jsx)(t.code,{children:"POST_EVAL"})," rule phases."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Priority Bounds"}),": Verify pending-action catalog priorities to avoid ambiguous execution hooks during interaction policy overlaps."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Guardrails"}),": Monitor the ",(0,s.jsx)(t.code,{children:"ce_audit"})," log for ",(0,s.jsx)(t.code,{children:"GUARDRAIL_VIOLATION"})," to track potential malicious end-user prompt injection."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Strict Bounds"}),": Enable ",(0,s.jsx)(t.code,{children:"state-graph"})," validation before promoting a new flow to production."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"regression-strategy",children:"Regression strategy"}),"\n",(0,s.jsxs)(t.p,{children:["Use ",(0,s.jsx)(t.code,{children:"ConversationReplayService"})," to replay scripted turns and assert the expected variables at each turn."]}),"\n",(0,s.jsx)(l.vl,{title:"ConversationReplayService assertion",language:"java",filePath:"src/test/java/com/zapper/RegressionTests.java",children:'@Test\npublic void testShippingFlow() {\n ReplayResult finalTurn = replayService.runScript("shipping_confirmation_script.json");\n \n assertEquals("SHIPPING_CONFIRMED", finalTurn.getFinalIntent());\n assertEquals("EXECUTE_PENDING_ACTION", finalTurn.getAuditStages().getLastSystemAction());\n}'})]})}function m(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(x,{...e})}):x(e)}},9365(e,t,n){n.d(t,{A:()=>o});n(6540);var i=n(4164);const s="tabItem_Ymn6";var a=n(4848);function o({children:e,hidden:t,className:n}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,i.A)(s,n),hidden:t,children:e})}}}]);