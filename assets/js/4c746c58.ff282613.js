"use strict";(globalThis.webpackChunkconvengine_docs=globalThis.webpackChunkconvengine_docs||[]).push([[7843],{7954(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>v,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"api/stream-api","title":"Stream API (Socket)","description":"Base transport endpoints","source":"@site/docs/v2/api/stream-api.mdx","sourceDirName":"api","slug":"/api/stream-api","permalink":"/docs/v2/api/stream-api","draft":false,"unlisted":false,"editUrl":"https://github.com/salilvnair/convengine-docs/tree/main/docs/v2/api/stream-api.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Stream API (Socket)","sidebar_position":2},"sidebar":"docSidebar","previous":{"title":"REST API","permalink":"/docs/v2/api/rest-api"},"next":{"title":"Java API","permalink":"/docs/v2/api/java-api"}}');var i=t(4848),o=t(8453),a=t(7555);const r={title:"Stream API (Socket)",sidebar_position:2},c="Stream API (Socket)",l={},d=[{value:"Base transport endpoints",id:"base-transport-endpoints",level:2},{value:"SSE subscription",id:"sse-subscription",level:2},{value:"STOMP subscription",id:"stomp-subscription",level:2},{value:"Socket payload contract (v2.0.8)",id:"socket-payload-contract-v208",level:2},{value:"Socket + Audit API usage",id:"socket--audit-api-usage",level:2}];function p(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"stream-api-socket",children:"Stream API (Socket)"})}),"\n",(0,i.jsx)(n.h2,{id:"base-transport-endpoints",children:"Base transport endpoints"}),"\n",(0,i.jsx)(a.p,{title:"Streaming endpoints",columns:["Transport","Endpoint / Destination","Purpose"],rows:[["SSE","GET /api/v1/conversation/stream/{conversationId}","Server-sent live audit events for one conversation"],["STOMP WS","WS handshake: /ws-convengine","WebSocket endpoint for STOMP clients"],["STOMP topic","/topic/convengine/audit/{conversationId}","Conversation-scoped audit stream destination"]]}),"\n",(0,i.jsx)(a.f4,{type:"info",title:"Flow contract",children:(0,i.jsxs)(n.p,{children:["Conversation turns are submitted through ",(0,i.jsx)(a.pu,{children:"POST /api/v1/conversation/message"}),".",(0,i.jsx)(n.br,{}),"\n","Socket/SSE channels stream audit stages for that same ",(0,i.jsx)(a.pu,{children:"conversationId"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"sse-subscription",children:"SSE subscription"}),"\n",(0,i.jsx)(a.vl,{title:"SSE client (browser)",language:"javascript",children:'const conversationId = "9bf7540a-b129-4685-a120-730e8a0cb94b";\nconst source = new EventSource(\n"/api/v1/conversation/stream/" + conversationId\n);\n\nsource.onmessage = (event) => {\n// fallback event channel\nconsole.log("SSE message:", event.data);\n};\n\nsource.addEventListener("STEP_ENTER", (event) => {\nconsole.log("STEP_ENTER:", JSON.parse(event.data));\n});\n\nsource.addEventListener("ASSISTANT_OUTPUT", (event) => {\nconsole.log("ASSISTANT_OUTPUT:", JSON.parse(event.data));\n});\n\nsource.addEventListener("VERBOSE", (event) => {\nconsole.log("VERBOSE:", JSON.parse(event.data));\n});'}),"\n",(0,i.jsx)(n.h2,{id:"stomp-subscription",children:"STOMP subscription"}),"\n",(0,i.jsx)(a.vl,{title:"STOMP client (JS)",language:"javascript",children:'// npm i @stomp/stompjs sockjs-client\nimport { Client } from "@stomp/stompjs";\nimport SockJS from "sockjs-client";\n\nconst conversationId = "9bf7540a-b129-4685-a120-730e8a0cb94b";\nconst client = new Client({\nwebSocketFactory: () => new SockJS("/ws-convengine"),\nreconnectDelay: 5000,\nonConnect: () => {\n  client.subscribe(\n    "/topic/convengine/audit/" + conversationId,\n    (message) => console.log("STOMP audit:", JSON.parse(message.body))\n  );\n},\n});\n\nclient.activate();'}),"\n",(0,i.jsx)(n.h2,{id:"socket-payload-contract-v208",children:"Socket payload contract (v2.0.8)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"2.0.8"})," introduces envelope type separation in the stream payload."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'eventType: "AUDIT"'})," for audit stage events"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'eventType: "VERBOSE"'})," for verbose runtime progress/error events"]}),"\n"]}),"\n",(0,i.jsx)(a.vl,{title:"AUDIT envelope example",language:"json",children:'{\n"eventType": "AUDIT",\n"auditId": 12031,\n"stage": "STEP_ENTER",\n"createdAt": "2026-02-14T10:22:01.102Z",\n"payload": {\n  "_meta": {\n    "stage": "STEP_ENTER",\n    "conversationId": "9bf7540a-b129-4685-a120-730e8a0cb94b",\n    "intent": "FAQ",\n    "state": "IDLE"\n  }\n},\n"verbose": null\n}'}),"\n",(0,i.jsx)(a.vl,{title:"VERBOSE envelope example",language:"json",children:'{\n"eventType": "VERBOSE",\n"auditId": null,\n"stage": "VERBOSE",\n"createdAt": "2026-02-27T13:40:24.250Z",\n"payload": {\n  "verbose": {\n    "verboseId": 4,\n    "eventType": "VERBOSE_PROGRESS",\n    "stepName": "McpToolStep",\n    "determinant": "MCP_TOOL_CALL",\n    "intent": "LOAN_APPLICATION",\n    "state": "COLLECTING_DETAILS",\n    "ruleId": null,\n    "toolCode": "loan.credit.rating.check",\n    "level": "INFO",\n    "text": "Checking credit rating from credit union."\n  }\n},\n"verbose": {\n  "verboseId": 4,\n  "eventType": "VERBOSE_PROGRESS",\n  "stepName": "McpToolStep",\n  "determinant": "MCP_TOOL_CALL",\n  "level": "INFO",\n  "text": "Checking credit rating from credit union."\n}\n}'}),"\n",(0,i.jsx)(n.h2,{id:"socket--audit-api-usage",children:"Socket + Audit API usage"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Call ",(0,i.jsx)(a.Mn,{children:"POST /api/v1/conversation/message"})," with ",(0,i.jsx)(n.code,{children:"conversationId"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Subscribe to SSE/STOMP for live stages."}),"\n",(0,i.jsxs)(n.li,{children:["Query ",(0,i.jsxs)(a.Mn,{children:["GET /api/v1/conversation/audit/","{conversationId}"]})," for raw events."]}),"\n",(0,i.jsxs)(n.li,{children:["Query ",(0,i.jsxs)(a.Mn,{children:["GET /api/v1/conversation/audit/","{conversationId}","/trace"]})," for normalized step timeline."]}),"\n"]}),"\n",(0,i.jsx)(a.f4,{type:"tip",title:"Operational recommendation",children:(0,i.jsx)(n.p,{children:"Use REST endpoints for deterministic request/response behavior, and use streaming endpoints for observability UX."})})]})}function v(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}}}]);