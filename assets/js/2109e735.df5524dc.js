"use strict";(globalThis.webpackChunkconvengine_docs=globalThis.webpackChunkconvengine_docs||[]).push([[893],{3076(n,e,o){o.r(e),o.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>g,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"consumer/backend-integration","title":"Backend Integration","description":"This page uses your demo repos directly:","source":"@site/docs/consumer/backend-integration.mdx","sourceDirName":"consumer","slug":"/consumer/backend-integration","permalink":"/docs/consumer/backend-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/salilvnair/convengine-docs/tree/main/docs/consumer/backend-integration.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Backend Integration","sidebar_position":3},"sidebar":"docSidebar","previous":{"title":"UI Integration","permalink":"/docs/consumer/ui-integration"},"next":{"title":"Configuration","permalink":"/docs/consumer/configuration"}}');var t=o(4848),a=o(8453),s=o(2073);const r={title:"Backend Integration",sidebar_position:3},c="Backend Integration",l={},d=[{value:"What each demo proves",id:"what-each-demo-proves",level:2},{value:"convengine-demo: Core app bootstrap",id:"convengine-demo-core-app-bootstrap",level:2},{value:"convengine-demo: Runtime config",id:"convengine-demo-runtime-config",level:2},{value:"convengine-demo: Transport + Hook diagnostics",id:"convengine-demo-transport--hook-diagnostics",level:2},{value:"zapper-ui: How frontend consumes backend",id:"zapper-ui-how-frontend-consumes-backend",level:2}];function p(n){const e={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",ul:"ul",...(0,a.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"backend-integration",children:"Backend Integration"})}),"\n",(0,t.jsx)(e.p,{children:"This page uses your demo repos directly:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["backend reference: ",(0,t.jsx)(s.Mn,{children:"convengine-demo"})]}),"\n",(0,t.jsxs)(e.li,{children:["UI reference: ",(0,t.jsx)(s.Mn,{children:"zapper-ui"})]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"what-each-demo-proves",children:"What each demo proves"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(s.Mn,{children:"convengine-demo"}),": Spring Boot consumer setup, transport mode config, step hooks, LLM wiring."]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(s.Mn,{children:"zapper-ui"}),": conversation client, SSE subscription, audit timeline UI."]}),"\n"]}),"\n",(0,t.jsx)(s.zM,{step:"1",title:"Enable ConvEngine in backend",children:(0,t.jsxs)(e.p,{children:["Add ",(0,t.jsx)(s.pu,{children:"@EnableConvEngine"})," and provide required beans."]})}),"\n",(0,t.jsx)(s.zM,{step:"2",title:"Configure transport mode",children:(0,t.jsxs)(e.p,{children:["Use profile yaml (",(0,t.jsx)(e.code,{children:"sse"}),", ",(0,t.jsx)(e.code,{children:"stomp"}),", ",(0,t.jsx)(e.code,{children:"both"}),") to switch runtime behavior."]})}),"\n",(0,t.jsx)(s.zM,{step:"3",title:"Connect frontend",children:(0,t.jsx)(e.p,{children:"Frontend posts to message endpoint and listens to SSE/STOMP for audit updates."})}),"\n",(0,t.jsx)(e.h2,{id:"convengine-demo-core-app-bootstrap",children:"convengine-demo: Core app bootstrap"}),"\n",(0,t.jsx)(s.vl,{title:"ConvengineDemoApplication.java",language:"java",packagePath:"com.github.salilvnair",filePath:"convengine-demo/src/main/java/com/github/salilvnair/ConvengineDemoApplication.java",children:'@SpringBootApplication\n@ComponentScan(basePackages = {"com.github.salilvnair.convengdemo"})\n@EntityScan(basePackages = {"com.github.salilvnair.convengdemo.entity"})\n@EnableJpaRepositories(basePackages = {"com.github.salilvnair.convengdemo.repo"})\npublic class ConvengineDemoApplication {\npublic static void main(String[] args) {\n  SpringApplication.run(ConvengineDemoApplication.class, args);\n}\n}'}),"\n",(0,t.jsx)(s.vl,{title:"ConvEngineConfig.java",language:"java",packagePath:"com.github.salilvnair.convengdemo.config",filePath:"convengine-demo/src/main/java/com/github/salilvnair/convengdemo/config/ConvEngineConfig.java",children:"@Configuration\n@EnableConvEngine\n@EnableConvEngineAsyncAuditDispatch // optional\n@EnableConvEngineStompBrokerRelay   // optional\n@EnableCcfCore\npublic class ConvEngineConfig {\n@Bean\npublic RestWebServiceFacade restWebServiceFacade() {\n  return new RestWebServiceFacade();\n}\n\n@Bean\npublic ObjectMapper objectMapper() {\n  return new ObjectMapper();\n}\n}"}),"\n",(0,t.jsx)(e.h2,{id:"convengine-demo-runtime-config",children:"convengine-demo: Runtime config"}),"\n",(0,t.jsx)(s.vl,{title:"application.yml",language:"yaml",filePath:"convengine-demo/src/main/resources/application.yml",children:'server:\nport: 8080\n\nspring:\ndatasource:\n  url: jdbc:postgresql://localhost:5432/convengine\n  username: convengine_user\n  password: convengine_pwd\n\nconvengine:\ndemo:\n  stream-mode: SSE\n  step-hook:\n    enabled: true\n\nllm:\n  provider: openai\n  openai:\n    api-key: ${OPENAI_API_KEY}\n    model: gpt-4.1\n\ntransport:\n  sse:\n    enabled: true\n    emitter-timeout-ms: 1800000\n  stomp:\n    enabled: false\n    endpoint: /ws-convengine\n    app-destination-prefix: /app\n    topic-prefix: /topic\n    audit-destination-base: /topic/convengine/audit\n    allowed-origin-pattern: "*"\n    sock-js: true\n    broker:\n      mode: SIMPLE\n      relay-destination-prefixes: /topic,/queue\n      relay-host: localhost\n      relay-port: 61613\n      client-login: ""\n      client-passcode: ""\n      system-login: ""\n      system-passcode: ""\n      virtual-host: ""\n      system-heartbeat-send-interval-ms: 10000\n      system-heartbeat-receive-interval-ms: 10000\n\naudit:\n  enabled: true\n  level: ALL\n  include-stages: []\n  exclude-stages: []\n  persistence:\n    mode: IMMEDIATE\n    jdbc-batch-size: 200\n    max-buffered-events: 5000\n    flush-stages: ENGINE_KNOWN_FAILURE,ENGINE_UNKNOWN_FAILURE\n    final-step-names: PipelineEndGuardStep\n    flush-on-stop-outcome: true\n  dispatch:\n    async-enabled: false\n    worker-threads: 2\n    queue-capacity: 2000\n    rejection-policy: CALLER_RUNS\n    keep-alive-seconds: 60\n  rate-limit:\n    enabled: false\n    max-events: 200\n    window-ms: 1000\n    per-conversation: true\n    per-stage: true\n    max-tracked-buckets: 20000'}),"\n",(0,t.jsx)(s.vl,{title:"application-sse.yml",language:"yaml",filePath:"convengine-demo/src/main/resources/application-sse.yml",children:"convengine:\ndemo:\n  stream-mode: SSE\ntransport:\n  sse:\n    enabled: true\n  stomp:\n    enabled: false"}),"\n",(0,t.jsx)(s.vl,{title:"application-stomp.yml",language:"yaml",filePath:"convengine-demo/src/main/resources/application-stomp.yml",children:"convengine:\ndemo:\n  stream-mode: STOMP\ntransport:\n  sse:\n    enabled: false\n  stomp:\n    enabled: true"}),"\n",(0,t.jsx)(s.vl,{title:"application-both.yml",language:"yaml",filePath:"convengine-demo/src/main/resources/application-both.yml",children:"convengine:\ndemo:\n  stream-mode: BOTH\ntransport:\n  sse:\n    enabled: true\n  stomp:\n    enabled: true"}),"\n",(0,t.jsx)(s.f4,{type:"tip",title:"Relay + async audit rollout",children:(0,t.jsxs)(e.p,{children:["Keep ",(0,t.jsx)(e.code,{children:"broker.mode: SIMPLE"})," and ",(0,t.jsx)(e.code,{children:"audit.dispatch.async-enabled: false"})," for baseline. Enable relay and async in non-prod first, then tune ",(0,t.jsx)(e.code,{children:"queue-capacity"}),", ",(0,t.jsx)(e.code,{children:"rejection-policy"}),", and ",(0,t.jsx)(e.code,{children:"rate-limit"})," using audit volume."]})}),"\n",(0,t.jsx)(e.h2,{id:"convengine-demo-transport--hook-diagnostics",children:"convengine-demo: Transport + Hook diagnostics"}),"\n",(0,t.jsx)(s.vl,{title:"DemoTransportProperties.java",language:"java",filePath:"convengine-demo/src/main/java/com/github/salilvnair/convengdemo/config/DemoTransportProperties.java",children:'@Component\n@ConfigurationProperties(prefix = "convengine.demo")\npublic class DemoTransportProperties {\nprivate StreamMode streamMode = StreamMode.SSE;\nprivate StepHook stepHook = new StepHook();\n\npublic enum StreamMode { SSE, STOMP, BOTH }\n\npublic static class StepHook {\n  private boolean enabled = true;\n}\n}'}),"\n",(0,t.jsx)(s.vl,{title:"ConvEngineTransportStartupLogger.java",language:"java",filePath:"convengine-demo/src/main/java/com/github/salilvnair/convengdemo/config/ConvEngineTransportStartupLogger.java",children:"@Component\n@RequiredArgsConstructor\npublic class ConvEngineTransportStartupLogger {\nprivate final DemoTransportProperties demoTransportProperties;\nprivate final ConvEngineTransportConfig transportConfig;\nprivate final Environment environment;\n\n@EventListener(ApplicationReadyEvent.class)\npublic void logTransportConfiguration() {\n  boolean sseEnabled = transportConfig.getSse().isEnabled();\n  boolean stompEnabled = transportConfig.getStomp().isEnabled();\n  // validates mode and prints endpoints\n}\n}"}),"\n",(0,t.jsx)(s.vl,{title:"DemoEngineStepHook.java",language:"java",filePath:"convengine-demo/src/main/java/com/github/salilvnair/convengdemo/config/DemoEngineStepHook.java",children:'@Component\n@RequiredArgsConstructor\npublic class DemoEngineStepHook implements EngineStepHook {\nprivate static final Set<String> TRACKED_STEPS = Set.of(\n  "IntentResolutionStep", "SchemaExtractionStep", "RulesStep", "ResponseResolutionStep"\n);\n\n@Override\npublic boolean supports(String stepName, EngineSession session) {\n  return demoTransportProperties.getStepHook().isEnabled() && TRACKED_STEPS.contains(stepName);\n}\n\n@Override\npublic void beforeStep(String stepName, EngineSession session) { /* logs */ }\n@Override\npublic void afterStep(String stepName, EngineSession session, StepResult result) { /* logs */ }\n@Override\npublic void onStepError(String stepName, EngineSession session, Throwable error) { /* logs */ }\n}'}),"\n",(0,t.jsx)(e.h2,{id:"zapper-ui-how-frontend-consumes-backend",children:"zapper-ui: How frontend consumes backend"}),"\n",(0,t.jsx)(s.vl,{title:"convengine.api.js (zapper-ui)",language:"js",filePath:"zapper-ui/src/api/convengine.api.js",children:'const API_BASE = "http://localhost:8080/api/v1/conversation";\n\nexport async function sendMessage(conversationId, message, inputParams = {}, reset = false) { /* ... */ }\nexport async function fetchAudits(conversationId) { /* ... */ }\nexport function subscribeConversationSse(conversationId, handlers = {}) { /* ... */ }\n// STOMP scaffold commented for optional enablement'}),"\n",(0,t.jsx)(s.vl,{title:"App.jsx (zapper-ui)",language:"jsx",filePath:"zapper-ui/src/App.jsx",children:"useEffect(() => {\nconst stream = subscribeConversationSse(conversationId, {\n  onConnected: () => setAuditVersion(v => v + 1),\n  onEvent: () => setAuditVersion(v => v + 1),\n});\nreturn () => stream.close();\n}, [conversationId]);"}),"\n",(0,t.jsx)(s.vl,{title:"ChatPanel.jsx (zapper-ui)",language:"jsx",filePath:"zapper-ui/src/components/ChatPanel.jsx",children:'const res = await sendMessage(conversationId, userText);\nsetMessages(m => [...m, { role: "assistant", text: assistantText }]);\n// Typing indicator shown while request is in-flight'}),"\n",(0,t.jsx)(s.f4,{type:"info",title:"Backend + UI runbook",children:(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["Start backend (",(0,t.jsx)(e.code,{children:"convengine-demo"}),") with profile ",(0,t.jsx)(s.pu,{children:"sse"}),", ",(0,t.jsx)(s.pu,{children:"stomp"}),", or ",(0,t.jsx)(s.pu,{children:"both"}),"."]}),"\n",(0,t.jsxs)(e.li,{children:["Start ",(0,t.jsx)(s.Mn,{children:"zapper-ui"})," and point API base to backend URL."]}),"\n",(0,t.jsx)(e.li,{children:"Send message, verify live timeline from stream + detailed payloads from audit API."}),"\n"]})}),"\n",(0,t.jsx)(s.vl,{title:"Run commands",language:"bash",defaultOpen:!1,children:"# backend (convengine-demo)\n./mvnw spring-boot:run -Dspring-boot.run.profiles=sse\n# or\n./mvnw spring-boot:run -Dspring-boot.run.profiles=stomp\n# or\n./mvnw spring-boot:run -Dspring-boot.run.profiles=both\n\n# frontend (zapper-ui)\nnpm install\nnpm run dev"})]})}function g(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(p,{...n})}):p(n)}}}]);