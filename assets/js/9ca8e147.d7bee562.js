"use strict";(globalThis.webpackChunkconvengine_docs=globalThis.webpackChunkconvengine_docs||[]).push([[6257],{6850(e,n,l){l.r(n),l.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"local-development","title":"Local Development","description":"This page covers the practical local setup loop for the current v2 framework, not the early-v2 minimum-only setup.","source":"@site/docs/v2/local-development.mdx","sourceDirName":".","slug":"/local-development","permalink":"/docs/v2/local-development","draft":false,"unlisted":false,"editUrl":"https://github.com/salilvnair/convengine-docs/tree/main/docs/v2/local-development.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Local Development","sidebar_position":4},"sidebar":"docSidebar","previous":{"title":"FAQ","permalink":"/docs/v2/faq"},"next":{"title":"Consumer","permalink":"/docs/v2/consumer/"}}');var s=l(4848),o=l(8453),c=l(7555);const r={title:"Local Development",sidebar_position:4},t="Local Development",a={},d=[{value:"Local prerequisites",id:"local-prerequisites",level:2},{value:"Minimal application wiring",id:"minimal-application-wiring",level:2},{value:"Required consumer-owned pieces",id:"required-consumer-owned-pieces",level:2},{value:"Recommended local config",id:"recommended-local-config",level:2},{value:"Local database setup strategy",id:"local-database-setup-strategy",level:2},{value:"Core local test loop",id:"core-local-test-loop",level:2},{value:"Cache-aware local development",id:"cache-aware-local-development",level:2},{value:"Debugging the most important runtime surfaces",id:"debugging-the-most-important-runtime-surfaces",level:2},{value:"1. Rule and state debugging",id:"1-rule-and-state-debugging",level:3},{value:"2. Prompt and LLM debugging",id:"2-prompt-and-llm-debugging",level:3},{value:"3. MCP debugging",id:"3-mcp-debugging",level:3},{value:"4. Direct tool debugging",id:"4-direct-tool-debugging",level:3},{value:"When to enable optional local features",id:"when-to-enable-optional-local-features",level:2},{value:"STOMP",id:"stomp",level:3},{value:"Async audit dispatch",id:"async-audit-dispatch",level:3},{value:"Experimental SQL generation",id:"experimental-sql-generation",level:3},{value:"Most common local-development mistakes",id:"most-common-local-development-mistakes",level:2},{value:"Good local-development target",id:"good-local-development-target",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"local-development",children:"Local Development"})}),"\n",(0,s.jsx)(n.p,{children:"This page covers the practical local setup loop for the current v2 framework, not the early-v2 minimum-only setup."}),"\n",(0,s.jsx)(n.p,{children:"The modern local dev workflow should help you do five things reliably:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"boot the engine with the right annotations"}),"\n",(0,s.jsx)(n.li,{children:"run one full conversation locally"}),"\n",(0,s.jsx)(n.li,{children:"inspect audit and trace output"}),"\n",(0,s.jsx)(n.li,{children:"reload static config safely"}),"\n",(0,s.jsx)(n.li,{children:"debug rule, prompt, MCP, and response behavior quickly"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"local-prerequisites",children:"Local prerequisites"}),"\n",(0,s.jsx)(n.p,{children:"Use these as the baseline:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Java 21"}),"\n",(0,s.jsx)(n.li,{children:"a Spring Boot host application"}),"\n",(0,s.jsxs)(n.li,{children:["a local relational database with the current ",(0,s.jsx)(n.code,{children:"ce_*"})," schema"]}),"\n",(0,s.jsxs)(n.li,{children:["one working ",(0,s.jsx)(n.code,{children:"LlmClient"})," bean"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Recommended for a productive setup:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"one seeded example intent"}),"\n",(0,s.jsx)(n.li,{children:"audit enabled"}),"\n",(0,s.jsx)(n.li,{children:"SSE enabled"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"@EnableConvEngineCaching"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"@EnableConvEngineAsyncConversation"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"minimal-application-wiring",children:"Minimal application wiring"}),"\n",(0,s.jsx)(c.vl,{title:"Recommended local bootstrap",language:"java",children:"@SpringBootApplication\n@EnableConvEngine(stream = true)\n@EnableConvEngineCaching\n@EnableConvEngineAsyncConversation\npublic class MyApplication {\npublic static void main(String[] args) {\n  SpringApplication.run(MyApplication.class, args);\n}\n}"}),"\n",(0,s.jsxs)(n.p,{children:["Add ",(0,s.jsx)(n.code,{children:"@EnableConvEngineAsyncAuditDispatch"})," only if you want to test async audit dispatch behavior locally."]}),"\n",(0,s.jsx)(n.h2,{id:"required-consumer-owned-pieces",children:"Required consumer-owned pieces"}),"\n",(0,s.jsx)(n.p,{children:"Your local app still owns:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"LlmClient"})}),"\n",(0,s.jsx)(n.li,{children:"datasource and JPA config"}),"\n",(0,s.jsx)(n.li,{children:"any custom task executors"}),"\n",(0,s.jsx)(n.li,{children:"any tool handlers or transport adapters"}),"\n",(0,s.jsx)(n.li,{children:"any response/container transformers you use"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"If any of those are missing, the framework may start but your target flow will still be incomplete."}),"\n",(0,s.jsx)(n.h2,{id:"recommended-local-config",children:"Recommended local config"}),"\n",(0,s.jsx)(c.vl,{title:"Local application.yml baseline",language:"yaml",children:'server:\nport: 8080\n\nspring:\ndatasource:\n  url: jdbc:postgresql://localhost:5432/convengine\n  username: convengine_user\n  password: convengine_pwd\n\nconvengine:\nflow:\n  dialogue-act:\n    resolute: REGEX_THEN_LLM\n    llm-threshold: 0.90\n  conversation-history:\n    max-turns: 20\n  interaction-policy:\n    execute-pending-on-affirm: true\n    reject-pending-on-negate: true\n    fill-pending-slot-on-non-new-request: true\n    require-resolved-intent-and-state: true\n  action-lifecycle:\n    enabled: true\n    ttl-turns: 3\n    ttl-minutes: 30\n  tool-orchestration:\n    enabled: true\n  guardrail:\n    enabled: true\n    sanitize-input: true\n    require-approval-for-sensitive-actions: false\n    approval-gate-fail-closed: false\n    sensitive-patterns: []\n  state-graph:\n    enabled: true\n    soft-block-on-violation: false\n  disambiguation:\n    enabled: true\n    max-options: 5\n  memory:\n    enabled: true\n    summary-max-chars: 1200\n    recent-turns-for-summary: 3\n  query-rewrite:\n    enabled: true\n\ntransport:\n  sse:\n    enabled: true\n    emitter-timeout-ms: 1800000\n  stomp:\n    enabled: false\n    endpoint: /ws-convengine\n    app-destination-prefix: /app\n    topic-prefix: /topic\n    audit-destination-base: /topic/convengine/audit\n    allowed-origin-pattern: "*"\n    sock-js: true\n    broker:\n      mode: SIMPLE\n      relay-destination-prefixes:\n        - /topic\n        - /queue\n      relay-host: localhost\n      relay-port: 61613\n\naudit:\n  enabled: true\n  persist-meta: true\n  cache-inspector: false\n  level: ALL\n  include-stages: []\n  exclude-stages: []\n  persistence:\n    mode: IMMEDIATE\n    jdbc-batch-size: 200\n    max-buffered-events: 5000\n    flush-stages:\n      - ENGINE_KNOWN_FAILURE\n      - ENGINE_UNKNOWN_FAILURE\n    final-step-names:\n      - PipelineEndGuardStep\n    flush-on-stop-outcome: true\n  dispatch:\n    async-enabled: false\n    worker-threads: 2\n    queue-capacity: 2000\n    rejection-policy: CALLER_RUNS\n    keep-alive-seconds: 60\n\nmcp:\n  guardrail:\n    enabled: false\n    fail-closed: false\n\nexperimental:\n  enabled: false'}),"\n",(0,s.jsx)(n.h2,{id:"local-database-setup-strategy",children:"Local database setup strategy"}),"\n",(0,s.jsx)(n.p,{children:"For local development, do not start by seeding everything."}),"\n",(0,s.jsx)(n.p,{children:"A cleaner path is:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Apply the current DDL for your database dialect."}),"\n",(0,s.jsx)(n.li,{children:"Seed one tiny end-to-end intent."}),"\n",(0,s.jsx)(n.li,{children:"Add one response."}),"\n",(0,s.jsx)(n.li,{children:"Add schema, rules, tools, or pending actions only when the base flow is stable."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The smallest useful local slice is:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["one ",(0,s.jsx)(n.code,{children:"ce_intent"})]}),"\n",(0,s.jsxs)(n.li,{children:["one ",(0,s.jsx)(n.code,{children:"ce_intent_classifier"})]}),"\n",(0,s.jsxs)(n.li,{children:["one ",(0,s.jsx)(n.code,{children:"ce_prompt_template"})]}),"\n",(0,s.jsxs)(n.li,{children:["one ",(0,s.jsx)(n.code,{children:"ce_response"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Then add:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ce_output_schema"})," if the flow collects structured fields"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ce_rule"})," if the flow has transitions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ce_verbose"})," if you want readable progress feedback"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ce_mcp_tool"})," / ",(0,s.jsx)(n.code,{children:"ce_mcp_planner"})," only when testing MCP"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"core-local-test-loop",children:"Core local test loop"}),"\n",(0,s.jsx)(n.p,{children:"This is the fastest stable loop for current v2:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Call ",(0,s.jsx)(n.code,{children:"POST /api/v1/conversation/message"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Inspect ",(0,s.jsx)(n.code,{children:"GET /api/v1/conversation/audit/{conversationId}"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Inspect ",(0,s.jsx)(n.code,{children:"GET /api/v1/conversation/audit/{conversationId}/trace"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Fix DML, prompt rows, or config."}),"\n",(0,s.jsx)(n.li,{children:"Refresh caches if needed."}),"\n",(0,s.jsxs)(n.li,{children:["Re-run the same or a fresh ",(0,s.jsx)(n.code,{children:"conversationId"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"That loop is still the single most useful way to debug behavior."}),"\n",(0,s.jsx)(n.h2,{id:"cache-aware-local-development",children:"Cache-aware local development"}),"\n",(0,s.jsx)(n.p,{children:"The current framework caches static control-plane data. That is good for runtime performance, but it changes how local iteration feels."}),"\n",(0,s.jsx)(n.p,{children:"When you change seeded rows in tables like:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_rule"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_response"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_output_schema"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_prompt_template"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_pending_action"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_mcp_tool"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_mcp_planner"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_verbose"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"you should refresh the static cache before assuming the runtime sees the new data."}),"\n",(0,s.jsx)(n.p,{children:"Useful endpoints:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"POST /api/v1/cache/refresh"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"GET /api/v1/cache/analyze"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Use cache analysis when you need to confirm whether the expected table cache is actually populated and active."}),"\n",(0,s.jsx)(n.h2,{id:"debugging-the-most-important-runtime-surfaces",children:"Debugging the most important runtime surfaces"}),"\n",(0,s.jsx)(n.h3,{id:"1-rule-and-state-debugging",children:"1. Rule and state debugging"}),"\n",(0,s.jsx)(n.p,{children:"Check:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"RULE_MATCH"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"RULE_APPLIED"})}),"\n",(0,s.jsxs)(n.li,{children:["final ",(0,s.jsx)(n.code,{children:"intent_code"})," and ",(0,s.jsx)(n.code,{children:"state_code"})]}),"\n",(0,s.jsx)(n.li,{children:"trace step ordering"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:'If the engine is "technically working" but answering incorrectly, this is often where the root cause lives.'}),"\n",(0,s.jsx)(n.h3,{id:"2-prompt-and-llm-debugging",children:"2. Prompt and LLM debugging"}),"\n",(0,s.jsx)(n.p,{children:"Check:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"DIALOGUE_ACT_LLM_*"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"INTENT_*"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"SCHEMA_EXTRACTION_LLM_*"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"MCP_PLAN_LLM_*"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"RESOLVE_RESPONSE_LLM_*"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Modern v2 uses shared prompt rendering, so a prompt-variable issue can affect multiple steps."}),"\n",(0,s.jsx)(n.h3,{id:"3-mcp-debugging",children:"3. MCP debugging"}),"\n",(0,s.jsx)(n.p,{children:"Check:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"context.mcp.lifecycle.*"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"context.mcp.toolExecution.*"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"MCP_TOOL_CALL"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"MCP_TOOL_RESULT"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"MCP_TOOL_ERROR"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"MCP_FINAL_ANSWER"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Remember that current MCP scope is explicit. If a tool is not visible, verify ",(0,s.jsx)(n.code,{children:"intent_code"}),", ",(0,s.jsx)(n.code,{children:"state_code"}),", and whether the row is too narrow or too broad."]}),"\n",(0,s.jsx)(n.h3,{id:"4-direct-tool-debugging",children:"4. Direct tool debugging"}),"\n",(0,s.jsx)(n.p,{children:"Check:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"tool_request"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"tool_result"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"tool_status"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"TOOL_ORCHESTRATION_REQUEST"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"TOOL_ORCHESTRATION_RESULT"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"TOOL_ORCHESTRATION_ERROR"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"when-to-enable-optional-local-features",children:"When to enable optional local features"}),"\n",(0,s.jsx)(n.h3,{id:"stomp",children:"STOMP"}),"\n",(0,s.jsx)(n.p,{children:"Use STOMP locally only when you need to test websocket clients or broker behavior."}),"\n",(0,s.jsx)(n.p,{children:"If you do not need bidirectional messaging yet, keep:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"SSE enabled"}),"\n",(0,s.jsx)(n.li,{children:"STOMP disabled"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"async-audit-dispatch",children:"Async audit dispatch"}),"\n",(0,s.jsx)(n.p,{children:"Use it when you need to test local behavior under heavier audit load. Keep it off when you want the simplest, most deterministic debugging path."}),"\n",(0,s.jsx)(n.h3,{id:"experimental-sql-generation",children:"Experimental SQL generation"}),"\n",(0,s.jsx)(n.p,{children:"Enable only when you are explicitly testing the experimental SQL generator APIs:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"POST /api/v1/conversation/experimental/generate-sql"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"POST /api/v1/conversation/experimental/generate-sql/zip"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["These routes are gated behind ",(0,s.jsx)(n.code,{children:"convengine.experimental.enabled=true"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"most-common-local-development-mistakes",children:"Most common local-development mistakes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Editing database config and forgetting to refresh caches."}),"\n",(0,s.jsxs)(n.li,{children:["Testing with multiple browser tabs against the same ",(0,s.jsx)(n.code,{children:"conversationId"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Enabling too many features before one base flow is stable."}),"\n",(0,s.jsx)(n.li,{children:"Treating prompt rows as plain text instead of behavior contracts."}),"\n",(0,s.jsx)(n.li,{children:"Inspecting only the final response and not the trace."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"good-local-development-target",children:"Good local-development target"}),"\n",(0,s.jsx)(n.p,{children:"Your local environment is in good shape when you can do all of the following quickly:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"reproduce a good turn"}),"\n",(0,s.jsx)(n.li,{children:"reproduce a bad turn"}),"\n",(0,s.jsx)(n.li,{children:"explain the exact step where it went wrong"}),"\n",(0,s.jsx)(n.li,{children:"fix the config"}),"\n",(0,s.jsx)(n.li,{children:"rerun and verify the correction"}),"\n"]}),"\n",(0,s.jsx)(c.f4,{type:"info",title:"Best local workflow",children:(0,s.jsxs)(n.p,{children:["For current v2, the fastest path is still: change config, refresh cache, call ",(0,s.jsx)(n.code,{children:"/message"}),", inspect audit/trace, repeat. The framework is heavily data-driven, so a disciplined local trace loop is more valuable than ad hoc code debugging."]})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);