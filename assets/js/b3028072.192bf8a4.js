"use strict";(globalThis.webpackChunkconvengine_docs=globalThis.webpackChunkconvengine_docs||[]).push([[939],{1470(e,n,t){t.d(n,{A:()=>T});var a=t(6540),s=t(4164),i=t(7559),r=t(3104),o=t(6347),l=t(205),c=t(7485),u=t(1682),p=t(679);function d(e){return a.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function m(e){const{values:n,children:t}=e;return(0,a.useMemo)(()=>{const e=n??function(e){return d(e).map(({props:{value:e,label:n,attributes:t,default:a}})=>({value:e,label:n,attributes:t,default:a}))}(t);return function(e){const n=(0,u.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function g({value:e,tabValues:n}){return n.some(n=>n.value===e)}function v({queryString:e=!1,groupId:n}){const t=(0,o.W6)(),s=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(s),(0,a.useCallback)(e=>{if(!s)return;const n=new URLSearchParams(t.location.search);n.set(s,e),t.replace({...t.location,search:n.toString()})},[s,t])]}function h(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,i=m(e),[r,o]=(0,a.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!g({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:i})),[c,u]=v({queryString:t,groupId:s}),[d,h]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,s]=(0,p.Dv)(n);return[t,(0,a.useCallback)(e=>{n&&s.set(e)},[n,s])]}({groupId:s}),f=(()=>{const e=c??d;return g({value:e,tabValues:i})?e:null})();(0,l.A)(()=>{f&&o(f)},[f]);return{selectedValue:r,selectValue:(0,a.useCallback)(e=>{if(!g({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),h(e)},[u,h,i]),tabValues:i}}var f=t(2303);const b="tabList__CuJ",x="tabItem_LNqP";var E=t(4848);function S({className:e,block:n,selectedValue:t,selectValue:a,tabValues:i}){const o=[],{blockElementScrollPositionUntilNextRender:l}=(0,r.a_)(),c=e=>{const n=e.currentTarget,s=o.indexOf(n),r=i[s].value;r!==t&&(l(n),a(r))},u=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=o.indexOf(e.currentTarget)+1;n=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(e.currentTarget)-1;n=o[t]??o[o.length-1];break}}n?.focus()};return(0,E.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},e),children:i.map(({value:e,label:n,attributes:a})=>(0,E.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{o.push(e)},onKeyDown:u,onClick:c,...a,className:(0,s.A)("tabs__item",x,a?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function y({lazy:e,children:n,selectedValue:t}){const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=i.find(e=>e.props.value===t);return e?(0,a.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,E.jsx)("div",{className:"margin-top--md",children:i.map((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function j(e){const n=h(e);return(0,E.jsxs)("div",{className:(0,s.A)(i.G.tabs.container,"tabs-container",b),children:[(0,E.jsx)(S,{...n,...e}),(0,E.jsx)(y,{...n,...e})]})}function T(e){const n=(0,f.A)();return(0,E.jsx)(j,{...e,children:d(e.children)},String(n))}},5711(e,n,t){t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>u,default:()=>f,extDetails:()=>g,extEdges:()=>m,extNodes:()=>d,frontMatter:()=>c,metadata:()=>a,toc:()=>v});const a=JSON.parse('{"id":"deep-dive/developer-guide","title":"Developer Guide","description":"This page is the full implementation starter for consumers integrating ConvEngine into a Spring Boot service.","source":"@site/docs/deep-dive/developer-guide.mdx","sourceDirName":"deep-dive","slug":"/deep-dive/developer-guide","permalink":"/docs/deep-dive/developer-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/salilvnair/convengine-docs/tree/main/docs/deep-dive/developer-guide.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Developer Guide","sidebar_position":1,"hide_table_of_contents":true},"sidebar":"docSidebar","previous":{"title":"Data Model","permalink":"/docs/deep-dive/data-model"},"next":{"title":"File Map","permalink":"/docs/deep-dive/file-map"}}');var s=t(4848),i=t(8453),r=t(1470),o=t(9365),l=t(9131);const c={title:"Developer Guide",sidebar_position:1,hide_table_of_contents:!0},u="Developer Guide",p={},d=[{id:"x1",position:{x:20,y:60},data:{label:"ConversationController.message"}},{id:"x2",position:{x:260,y:60},data:{label:"ContainerDataInterceptor"}},{id:"x3",position:{x:500,y:60},data:{label:"EngineSessionFactory.open"}},{id:"x4",position:{x:740,y:60},data:{label:"EnginePipeline.execute"}},{id:"x5",position:{x:20,y:230},data:{label:"EngineStepHook.beforeStep"}},{id:"x6",position:{x:260,y:230},data:{label:"Step.execute"}},{id:"x7",position:{x:500,y:230},data:{label:"EngineStepHook.afterStep/onStepError"}},{id:"x8",position:{x:740,y:230},data:{label:"ContainerDataTransformer"}},{id:"x9",position:{x:260,y:400},data:{label:"ResponseResolutionStep"}},{id:"x10",position:{x:500,y:400},data:{label:"ResponseTransformer"}},{id:"x11",position:{x:740,y:400},data:{label:"HTTP/SSE/STOMP output"}}],m=[{id:"xe1",source:"x1",target:"x2"},{id:"xe2",source:"x2",target:"x3"},{id:"xe3",source:"x3",target:"x4"},{id:"xe4",source:"x4",target:"x5"},{id:"xe5",source:"x5",target:"x6"},{id:"xe6",source:"x6",target:"x7"},{id:"xe7",source:"x7",target:"x8"},{id:"xe8",source:"x8",target:"x9"},{id:"xe9",source:"x9",target:"x10"},{id:"xe10",source:"x10",target:"x11"}],g={x1:{title:"API Entry",file:"api/controller/ConversationController.java",method:"message(...)",stage:"HTTP_ENTRY",summary:"Builds EngineContext and delegates to engine.",session:["userText, conversationId, inputParams"],tables:["none"]},x2:{title:"Input interception",file:"engine/interceptor/ContainerDataInterceptor.java",method:"intercept(...) ",stage:"INPUT_INTERCEPT",summary:"Mutate input params before session start.",session:["inputParams can be enriched"],tables:["none"]},x3:{title:"Session bootstrap",file:"engine/factory/EngineSessionFactory.java",method:"open(...) ",stage:"SESSION_BOOTSTRAP",summary:"Loads persisted conversation facts.",session:["intent/state/context hydrated"],tables:["ce_conversation (R/W bootstrap)"]},x4:{title:"DAG execution",file:"engine/pipeline/EnginePipeline.java",method:"execute(...) ",stage:"STEP_LOOP",summary:"Runs step chain with wrappers.",session:["STEP_ENTER/EXIT tracked"],tables:["ce_audit (W)"]},x5:{title:"Pre-step hook",file:"engine/hook/EngineStepHook.java",method:"beforeStep(...) ",stage:"STEP_ENTER",summary:"Consumer mutates session before target step.",session:["set hints/context/params"],tables:["none"]},x6:{title:"Core step",file:"engine/steps/*",method:"execute(EngineSession)",stage:"STEP_CORE",summary:"Intent/state/schema/rules/response handling.",session:["major mutations happen here"],tables:["ce_intent, ce_rule, ce_response, ..."]},x7:{title:"Post-step hook",file:"engine/hook/EngineStepHook.java",method:"afterStep(...) / onStepError(...) ",stage:"STEP_EXIT/STEP_ERROR",summary:"Consumer gets outcome and can append diagnostics.",session:["read and augment session"],tables:["none"]},x8:{title:"Container transform",file:"engine/transformer/ContainerDataTransformer.java",method:"transform(...) ",stage:"CONTAINER_TRANSFORM",summary:"Transforms intermediate container payload.",session:["container rewritten"],tables:["none"]},x9:{title:"Response resolve",file:"engine/steps/ResponseResolutionStep.java",method:"execute(...) ",stage:"ASSISTANT_OUTPUT",summary:"Selects EXACT/DERIVED mapping.",session:["output payload generated"],tables:["ce_response (R), ce_prompt_template (R)"]},x10:{title:"Response transform",file:"engine/transformer/ResponseTransformer.java",method:"transform(...) ",stage:"RESPONSE_TRANSFORM",summary:"Last-mile normalization/redaction.",session:["final payload rewrite"],tables:["none"]},x11:{title:"Transport",file:"transport/sse/* + transport/stomp/*",method:"emit/publish",stage:"HTTP_RESPONSE or STREAM_EVENT",summary:"Returns direct response or emits stream events.",session:["conversationId routing key"],tables:["none"]}},v=[{value:"1. Start a Spring Boot project",id:"1-start-a-spring-boot-project",level:2},{value:"2. Required schema (DDL)",id:"2-required-schema-ddl",level:2},{value:"3. Minimal DML for FAQ scenario",id:"3-minimal-dml-for-faq-scenario",level:2},{value:"4. application.yml (full consumer starter)",id:"4-applicationyml-full-consumer-starter",level:2},{value:"application.yml tag reference",id:"applicationyml-tag-reference",level:3},{value:"5. API entry and session contracts",id:"5-api-entry-and-session-contracts",level:2},{value:"6. Extension examples",id:"6-extension-examples",level:2},{value:"7. Persistence, audit and streaming tuning",id:"7-persistence-audit-and-streaming-tuning",level:2}];function h(e){const n={h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"developer-guide",children:"Developer Guide"})}),"\n",(0,s.jsx)(n.p,{children:"This page is the full implementation starter for consumers integrating ConvEngine into a Spring Boot service."}),"\n",(0,s.jsx)(l.il,{title:"Consumer Extension Map",subtitle:"Click each node to inspect extension timing, file, method and expected session state.",nodes:d,edges:m,detailsById:g,defaultSelectedId:"x5"}),"\n",(0,s.jsx)(n.h2,{id:"1-start-a-spring-boot-project",children:"1. Start a Spring Boot project"}),"\n",(0,s.jsxs)(r.A,{groupId:"bootstrap",children:[(0,s.jsx)(o.A,{value:"maven",label:"pom.xml",default:!0,children:(0,s.jsx)(l.vl,{title:"Maven dependency",language:"xml",packagePath:"project build",children:"\n<dependency>\n  <groupId>com.github.salilvnair</groupId>\n  <artifactId>convengine</artifactId>\n  <version>1.0.15</version>\n</dependency>"})}),(0,s.jsx)(o.A,{value:"gradle",label:"build.gradle.kts",children:(0,s.jsx)(l.vl,{title:"Gradle dependency",language:"kotlin",packagePath:"project build",children:'implementation("com.github.salilvnair:convengine:1.0.15")'})}),(0,s.jsx)(o.A,{value:"app",label:"Application class",children:(0,s.jsx)(l.vl,{title:"Enable ConvEngine",language:"java",packagePath:"com.zapper.demo",filePath:"src/main/java/com/acme/demo/DemoApplication.java",children:"@SpringBootApplication\n  @EnableConvEngine(stream = true)\n  public class DemoApplication {\n    public static void main(String[] args) {\n      SpringApplication.run(DemoApplication.class, args);\n    }\n  }"})})]}),"\n",(0,s.jsx)(n.h2,{id:"2-required-schema-ddl",children:"2. Required schema (DDL)"}),"\n",(0,s.jsxs)(r.A,{groupId:"ce-ddl-dialect",children:[(0,s.jsx)(o.A,{value:"postgres",label:"Postgres",default:!0,children:(0,s.jsx)(l.vl,{title:"Postgres DDL source",language:"sql",packagePath:"src/main/resources/sql",children:"-- Use full script from:\n-- src/main/resources/sql/ddl_postgres.sql\n-- (legacy path still available: src/main/resources/sql/ddl.sql)"})}),(0,s.jsx)(o.A,{value:"oracle",label:"Oracle",children:(0,s.jsx)(l.vl,{title:"Oracle DDL source",language:"sql",packagePath:"src/main/resources/sql",children:"-- Use full script from:\n-- src/main/resources/sql/ddl_oracle.sql"})}),(0,s.jsx)(o.A,{value:"sqlite",label:"SQLite",children:(0,s.jsx)(l.vl,{title:"SQLite DDL source",language:"sql",packagePath:"src/main/resources/sql",children:"-- Use full script from:\n-- src/main/resources/sql/ddl_sqlite.sql"})})]}),"\n",(0,s.jsxs)(l.f4,{type:"info",title:"Source of truth",children:[(0,s.jsx)(n.p,{children:"Use the dialect-specific DDL file from ConvEngine:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(l.Mn,{children:"src/main/resources/sql/ddl_postgres.sql"})," (or legacy ",(0,s.jsx)(l.Mn,{children:"src/main/resources/sql/ddl.sql"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(l.Mn,{children:"src/main/resources/sql/ddl_oracle.sql"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(l.Mn,{children:"src/main/resources/sql/ddl_sqlite.sql"}),"\n"]}),"\n"]})]}),"\n",(0,s.jsx)(n.h2,{id:"3-minimal-dml-for-faq-scenario",children:"3. Minimal DML for FAQ scenario"}),"\n",(0,s.jsx)(l.vl,{title:"FAQ DML example",language:"sql",packagePath:"db/seed",children:"insert into ce_intent(intent_code, state_code, enabled)\nvalues ('FAQ', null, true);\n\ninsert into ce_intent_classifier(intent_code, pattern, priority, enabled)\nvalues ('FAQ', '(?i).*(office|location|address).*', 10, true);\n\ninsert into ce_response(intent_code, state_code, response_type, output_format, exact_text, enabled)\nvalues ('FAQ', null, 'EXACT', 'TEXT', 'Our office is at 123 Tech Park, Silicon Valley.', true);\n\ninsert into ce_config(config_key, config_value, enabled)\nvalues ('RESET_COMMAND', 'RESET_SESSION', true);"}),"\n",(0,s.jsx)(l.p,{title:"FAQ seed preview",columns:["Table","Key values"],rows:[["ce_intent","intent_code=FAQ"],["ce_intent_classifier","pattern=(?i).*(office|location|address).*"],["ce_response","response_type=EXACT, output_format=TEXT"],["ce_config","RESET_COMMAND=RESET_SESSION"]]}),"\n",(0,s.jsx)(n.h2,{id:"4-applicationyml-full-consumer-starter",children:"4. application.yml (full consumer starter)"}),"\n",(0,s.jsx)(l.vl,{title:"application.yml",language:"yaml",packagePath:"src/main/resources",children:'server:\n  port: 8080\n\nspring:\n  datasource:\n    url: jdbc:postgresql://localhost:5432/convengine\n    username: convengine_user\n    password: convengine_pwd\n\nconvengine:\ntransport:\n  sse:\n    enabled: true\n    emitter-timeout-ms: 1800000\n  stomp:\n    enabled: false\n    endpoint: /ws-convengine\n    app-destination-prefix: /app\n    topic-prefix: /topic\n    audit-destination-base: /topic/convengine/audit\n    allowed-origin-pattern: "*"\n    sock-js: true\n    broker:\n      mode: SIMPLE   # SIMPLE | RELAY\n      relay-destination-prefixes: ["/topic", "/queue"]\n      relay-host: localhost\n      relay-port: 61613\n      client-login: ""\n      client-passcode: ""\n      system-login: ""\n      system-passcode: ""\n      virtual-host: ""\n      system-heartbeat-send-interval-ms: 10000\n      system-heartbeat-receive-interval-ms: 10000\n\naudit:\n  enabled: true\n  persist-meta: true\n  level: ALL         # ALL | STANDARD | ERROR_ONLY | NONE\n  include-stages: []\n  exclude-stages: []\n  dispatch:\n    async-enabled: true\n    worker-threads: 2\n    queue-capacity: 2000\n    rejection-policy: DROP_OLDEST  # CALLER_RUNS | DROP_NEWEST | DROP_OLDEST | ABORT\n    keep-alive-seconds: 60\n  rate-limit:\n    enabled: false\n    max-events: 200\n    window-ms: 1000\n    per-conversation: true\n    per-stage: true\n    max-tracked-buckets: 20000\n  persistence:\n    mode: DEFERRED_BULK   # IMMEDIATE | DEFERRED_BULK\n    jdbc-batch-size: 200\n    max-buffered-events: 5000\n    flush-stages: ["ENGINE_KNOWN_FAILURE", "ENGINE_UNKNOWN_FAILURE"]\n    final-step-names: ["PipelineEndGuardStep"]\n    flush-on-stop-outcome: true'}),"\n",(0,s.jsx)(n.h3,{id:"applicationyml-tag-reference",children:"application.yml tag reference"}),"\n",(0,s.jsx)(l.p,{title:"server + datasource",className:"ce-config-ref-table",columns:["Tag","What it controls","Expected values","Default/notes"],rows:[["server.port","HTTP port for your app","integer","8080 in sample"],["spring.datasource.url","DB connection URL","jdbc URL","Must point to DB with ce_* tables"],["spring.datasource.username","DB username","string","DB user with read/write on ce_*"],["spring.datasource.password","DB password","string","Use secret manager/env var in prod"]]}),"\n",(0,s.jsx)(l.p,{title:"convengine.transport.sse",className:"ce-config-ref-table",columns:["Tag","What it controls","Expected values","Default/notes"],rows:[["convengine.transport.sse.enabled","Enable SSE endpoints/publishers","true | false","Default true"],["convengine.transport.sse.emitter-timeout-ms","SSE emitter timeout","milliseconds","Default 1800000 (30 min)"]]}),"\n",(0,s.jsx)(l.p,{title:"convengine.transport.stomp",className:"ce-config-ref-table",columns:["Tag","What it controls","Expected values","Default/notes"],rows:[["convengine.transport.stomp.enabled","Enable STOMP websocket transport","true | false","Default false"],["convengine.transport.stomp.endpoint","WebSocket handshake endpoint","path","Default /ws-convengine"],["convengine.transport.stomp.app-destination-prefix","Client send prefix","path prefix","Default /app"],["convengine.transport.stomp.topic-prefix","Server publish topic prefix","path prefix","Default /topic"],["convengine.transport.stomp.audit-destination-base","Audit topic base path","path","Default /topic/convengine/audit"],["convengine.transport.stomp.allowed-origin-pattern","CORS origin pattern","origin pattern","Default *"],["convengine.transport.stomp.sock-js","SockJS fallback toggle","true | false","Default true"]]}),"\n",(0,s.jsx)(l.p,{title:"convengine.transport.stomp.broker",className:"ce-config-ref-table",columns:["Tag","What it controls","Expected values","Default/notes"],rows:[["convengine.transport.stomp.broker.mode","Broker mode selection","SIMPLE | RELAY","SIMPLE uses in-memory broker"],["convengine.transport.stomp.broker.relay-destination-prefixes","Relay destinations to enable","list of prefixes","Default [/topic, /queue]"],["convengine.transport.stomp.broker.relay-host","Relay broker host","hostname","Used when mode=RELAY"],["convengine.transport.stomp.broker.relay-port","Relay broker port","integer","Default 61613"],["convengine.transport.stomp.broker.client-login","Client login to relay","string","Optional"],["convengine.transport.stomp.broker.client-passcode","Client passcode to relay","string","Optional"],["convengine.transport.stomp.broker.system-login","System login to relay","string","Optional"],["convengine.transport.stomp.broker.system-passcode","System passcode to relay","string","Optional"],["convengine.transport.stomp.broker.virtual-host","Relay vhost","string","Optional"],["convengine.transport.stomp.broker.system-heartbeat-send-interval-ms","Outbound heartbeat","milliseconds","Default 10000"],["convengine.transport.stomp.broker.system-heartbeat-receive-interval-ms","Inbound heartbeat","milliseconds","Default 10000"]]}),"\n",(0,s.jsx)(l.p,{title:"convengine.audit (root)",className:"ce-config-ref-table",columns:["Tag","What it controls","Expected values","Default/notes"],rows:[["convengine.audit.enabled","Master audit enable switch","true | false","Default true"],["convengine.audit.persist-meta","Persist `_meta` into `ce_audit.payload_json`","true | false","Default true"],["convengine.audit.level","Audit verbosity","ALL | STANDARD | ERROR_ONLY | NONE","STANDARD suppresses STEP_ENTER/STEP_EXIT"],["convengine.audit.include-stages","Allowlist stages","list of stage patterns","Empty = no allowlist filter"],["convengine.audit.exclude-stages","Blocklist stages","list of stage patterns","Applied after include filter"]]}),"\n",(0,s.jsx)(l.p,{title:"convengine.audit.dispatch + rate-limit + persistence",className:"ce-config-ref-table",columns:["Tag","What it controls","Expected values","Default/notes"],rows:[["convengine.audit.dispatch.async-enabled","Async listener dispatch","true | false","Default false unless enabled"],["convengine.audit.dispatch.worker-threads","Async worker count","integer >= 1","Default 2"],["convengine.audit.dispatch.queue-capacity","Dispatch queue size","integer >= 1","Default 2000"],["convengine.audit.dispatch.rejection-policy","Backpressure behavior","CALLER_RUNS | DROP_NEWEST | DROP_OLDEST | ABORT","Default CALLER_RUNS"],["convengine.audit.dispatch.keep-alive-seconds","Thread keep-alive","seconds","Default 60"],["convengine.audit.rate-limit.enabled","Enable per-window throttling","true | false","Default false"],["convengine.audit.rate-limit.max-events","Events allowed per window","integer","Default 200"],["convengine.audit.rate-limit.window-ms","Rate-limit window","milliseconds","Default 1000"],["convengine.audit.rate-limit.per-conversation","Bucket by conversation","true | false","Default true"],["convengine.audit.rate-limit.per-stage","Bucket by stage","true | false","Default true"],["convengine.audit.rate-limit.max-tracked-buckets","Bucket cardinality cap","integer","Default 20000"],["convengine.audit.persistence.mode","DB persistence mode","IMMEDIATE | DEFERRED_BULK","Default IMMEDIATE"],["convengine.audit.persistence.jdbc-batch-size","Batch insert chunk size","integer","Default 200"],["convengine.audit.persistence.max-buffered-events","Deferred buffer cap","integer","Default 5000"],["convengine.audit.persistence.flush-stages","Stages forcing flush","list of stages","Defaults include engine failure stages"],["convengine.audit.persistence.final-step-names","Final steps that flush","list of step names","Default includes PipelineEndGuardStep"],["convengine.audit.persistence.flush-on-stop-outcome","Flush on STOP step outcome","true | false","Default true"]]}),"\n",(0,s.jsx)(l.f4,{type:"warning",title:"Streaming startup rule",children:(0,s.jsxs)(n.p,{children:["If ",(0,s.jsx)(l.pu,{children:"@EnableConvEngine(stream=true)"})," is set, startup fails when both ",(0,s.jsx)(l.pu,{children:"convengine.transport.sse.enabled=false"})," and ",(0,s.jsx)(l.pu,{children:"convengine.transport.stomp.enabled=false"}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"5-api-entry-and-session-contracts",children:"5. API entry and session contracts"}),"\n",(0,s.jsxs)(r.A,{groupId:"api-session",children:[(0,s.jsx)(o.A,{value:"api",label:"API Entry Point",default:!0,children:(0,s.jsx)(l.vl,{title:"ConversationController.message",language:"java",packagePath:"com.github.salilvnair.convengine.api.controller",filePath:"src/main/java/com/github/salilvnair/convengine/api/controller/ConversationController.java",children:'@PostMapping("/message")\npublic ConversationResponse message(@RequestBody ConversationRequest request) {\nEngineContext engineContext = EngineContext\n                                      .builder()\n                                      .conversationId(request.getConversationId())\n                                      .userText(request.getMessage())\n                                      .inputParams(request.getInputParams())\n                                      .build();\n\nEngineResult result = engine.process(engineContext);\nreturn mapToResponse(result);\n}'})}),(0,s.jsx)(o.A,{value:"session",label:"Session API",children:(0,s.jsx)(l.vl,{title:"EngineSession.java (key methods)",language:"java",packagePath:"com.github.salilvnair.convengine.engine.session",filePath:"src/main/java/com/github/salilvnair/convengine/engine/session/EngineSession.java",children:"// state management\nvoid setIntent(String intent);\nvoid setState(String state);\n\n// extras/input params\nMap<String, Object> getInputParams();\nvoid putInputParam(String key, Object value);\n\n// persisted conversation row\nCeConversation getConversation();\n\n// stop pipeline with final result\nvoid setFinalResult(EngineResult result);"})})]}),"\n",(0,s.jsx)(n.h2,{id:"6-extension-examples",children:"6. Extension examples"}),"\n",(0,s.jsxs)(r.A,{groupId:"extensions",children:[(0,s.jsx)(o.A,{value:"hooks",label:"EngineStepHook",default:!0,children:(0,s.jsx)(l.vl,{title:"Step hook with enum-safe matching",language:"java",packagePath:"com.zapper.convengine.hooks",children:'@Component\npublic class SchemaHintHook implements EngineStepHook {\n@Override\npublic boolean supports(EngineStep.Name stepName, EngineSession session) {\n  return EngineStep.Name.SchemaExtractionStep == stepName;\n}\n\n@Override\npublic void beforeStep(EngineStep.Name stepName, EngineSession session) {\n  session.putInputParam("consumer_hint", "compact");\n}\n}'})}),(0,s.jsxs)(o.A,{value:"task",label:"SET_TASK Action",children:[(0,s.jsx)(l.vl,{title:"SET_TASK via ce_rule",language:"sql",packagePath:"consumer DB",children:"INSERT INTO ce_rule\n(phase, intent_code, rule_type, match_pattern, action, action_value, priority, enabled, description)\nVALUES\n('PIPELINE_RULES', 'REQUEST_TRACKER', 'REGEX', '(?i).*track.*request.*', 'SET_TASK', 'requestTrackerTask:loadStatus', 10, true,\n 'Invoke consumer task bean');"}),(0,s.jsx)(l.vl,{title:"Consumer task bean",language:"java",packagePath:"com.zapper.convengine.tasks",children:'@Component("requestTrackerTask")\npublic class RequestTrackerTask implements CeRuleTask {\npublic void loadStatus(EngineSession session, CeRule rule) {\n  session.putInputParam("requestStatus", "IN_REVIEW");\n}\n}'})]}),(0,s.jsx)(o.A,{value:"schema-json",label:"Getting Extracted Data",children:(0,s.jsx)(l.vl,{title:"Read schema extracted values",language:"java",packagePath:"consumer logic",children:'String accountId = (String) session.getInputParams().get("accountId");'})}),(0,s.jsx)(o.A,{value:"transformers",label:"Interceptors / Transformers",children:(0,s.jsx)(l.vl,{title:"Interception chain",language:"java",packagePath:"com.zapper.convengine.ext",children:'@Component\npublic class MyInterceptor implements ContainerDataInterceptor {\n@Override\npublic Map<String, Object> intercept(Map<String, Object> inputParams) {\n  inputParams.putIfAbsent("channel", "web");\n  return inputParams;\n}\n}\n\n@Component\npublic class MyContainerTransformer implements ContainerDataTransformer {\n@Override\npublic Object transform(Object data, EngineSession session) {\n  return data;\n}\n}\n\n@Component\npublic class MyResponseTransformer implements ResponseTransformer {\n@Override\npublic OutputPayload transform(OutputPayload payload, EngineSession session) {\n  return payload;\n}\n}'})})]}),"\n",(0,s.jsx)(n.h2,{id:"7-persistence-audit-and-streaming-tuning",children:"7. Persistence, audit and streaming tuning"}),"\n",(0,s.jsx)(l.f4,{type:"tip",title:"Production sequence",children:(0,s.jsxs)(n.p,{children:["Start with direct ",(0,s.jsx)(l.pu,{children:"HTTP"})," + ",(0,s.jsx)(l.pu,{children:"IMMEDIATE"})," audit. Then enable async dispatch and bounded queue. Move to ",(0,s.jsx)(l.pu,{children:"DEFERRED_BULK"})," only after validating final-step flush behavior for your trace requirements."]})}),"\n",(0,s.jsx)(l.p,{title:"High-impact runtime knobs",columns:["Area","Config","Effect"],rows:[["Audit dispatch","convengine.audit.dispatch.*","Decouples request latency from listener work"],["Queue/backpressure","convengine.audit.dispatch.queue-capacity + rejection-policy","Bounds memory and defines overflow behavior"],["Audit persistence mode","convengine.audit.persistence.mode","IMMEDIATE or DEFERRED_BULK (JDBC batch flush)"],["Stage filtering","convengine.audit.level + include-stages/exclude-stages","Controls emitted/saved stages"],["Broker relay","convengine.transport.stomp.broker.mode=RELAY","Optional external broker for STOMP scaling"],["Stream hard requirement","@EnableConvEngine(stream=true)","Fails startup if both SSE and STOMP are disabled"]]})]})}function f(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},9365(e,n,t){t.d(n,{A:()=>r});t(6540);var a=t(4164);const s="tabItem_Ymn6";var i=t(4848);function r({children:e,hidden:n,className:t}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,a.A)(s,t),hidden:n,children:e})}}}]);