"use strict";(globalThis.webpackChunkconvengine_docs=globalThis.webpackChunkconvengine_docs||[]).push([[4367],{9098(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>a,frontMatter:()=>c,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"deep-dive/mcp-audit","title":"MCP and Audit","description":"Two tool paths in v2","source":"@site/docs/v2/deep-dive/mcp-audit.mdx","sourceDirName":"deep-dive","slug":"/deep-dive/mcp-audit","permalink":"/docs/v2/deep-dive/mcp-audit","draft":false,"unlisted":false,"editUrl":"https://github.com/salilvnair/convengine-docs/tree/main/docs/v2/deep-dive/mcp-audit.mdx","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"title":"MCP and Audit","sidebar_position":10},"sidebar":"docSidebar","previous":{"title":"Rules & Responses","permalink":"/docs/v2/deep-dive/rules-responses"},"next":{"title":"Detailed Features","permalink":"/docs/v2/deep-dive/v2-features"}}');var l=i(4848),d=i(8453);const c={title:"MCP and Audit",sidebar_position:10},r="MCP, Tool Orchestration, and Audit (v2)",o={},t=[{value:"Two tool paths in v2",id:"two-tool-paths-in-v2",level:2},{value:"Executor model",id:"executor-model",level:2},{value:"Guardrail integration",id:"guardrail-integration",level:2},{value:"Audit stages to watch",id:"audit-stages-to-watch",level:2},{value:"MCP tool scope filtering",id:"mcp-tool-scope-filtering",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",ul:"ul",...(0,d.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"mcp-tool-orchestration-and-audit-v2",children:"MCP, Tool Orchestration, and Audit (v2)"})}),"\n",(0,l.jsx)(n.h2,{id:"two-tool-paths-in-v2",children:"Two tool paths in v2"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"ToolOrchestrationStep"})}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["direct request path via ",(0,l.jsx)(n.code,{children:"tool_request"})]}),"\n",(0,l.jsx)(n.li,{children:"executes exactly one tool request"}),"\n",(0,l.jsxs)(n.li,{children:["runs ",(0,l.jsx)(n.code,{children:"TOOL_POST_EXECUTION"})," rules"]}),"\n"]}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"McpToolStep"})}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["planner loop path (",(0,l.jsx)(n.code,{children:"CALL_TOOL"}),"/",(0,l.jsx)(n.code,{children:"ANSWER"}),")"]}),"\n",(0,l.jsx)(n.li,{children:"supports up to bounded loops"}),"\n",(0,l.jsxs)(n.li,{children:["writes observations/final answer to ",(0,l.jsx)(n.code,{children:"context.mcp"})]}),"\n",(0,l.jsxs)(n.li,{children:["runs ",(0,l.jsx)(n.code,{children:"MCP_POST_LLM"})," rules"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"executor-model",children:"Executor model"}),"\n",(0,l.jsxs)(n.p,{children:["Both paths dispatch to ",(0,l.jsx)(n.code,{children:"McpToolExecutor"})," implementations by normalized ",(0,l.jsx)(n.code,{children:"tool_group"}),"."]}),"\n",(0,l.jsx)(n.p,{children:"Built-in groups:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"DB"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"HTTP_API"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"WORKFLOW_ACTION"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"DOCUMENT_RETRIEVAL"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"CALCULATOR_TRANSFORM"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"NOTIFICATION"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"FILES"})}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Adapter interfaces exist so consumers can plug business implementations without editing engine steps."}),"\n",(0,l.jsx)(n.h2,{id:"guardrail-integration",children:"Guardrail integration"}),"\n",(0,l.jsx)(n.p,{children:"If guardrail blocks execution:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"skip_tool_execution=true"})}),"\n",(0,l.jsx)(n.li,{children:"MCP/tool steps safely skip"}),"\n",(0,l.jsx)(n.li,{children:"no unhandled errors required for this branch"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"audit-stages-to-watch",children:"Audit stages to watch"}),"\n",(0,l.jsx)(n.p,{children:"Tool orchestration:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"TOOL_ORCHESTRATION_REQUEST"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"TOOL_ORCHESTRATION_RESULT"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"TOOL_ORCHESTRATION_ERROR"})}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"MCP planner:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"MCP_PLAN_LLM_INPUT"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"MCP_PLAN_LLM_OUTPUT"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"MCP_TOOL_CALL"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"MCP_TOOL_RESULT"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"MCP_TOOL_ERROR"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"MCP_FINAL_ANSWER"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"mcp-tool-scope-filtering",children:"MCP tool scope filtering"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ce_mcp_tool"})," supports optional runtime scope columns:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"intent_code"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"state_code"})}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Eligibility rules:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"NULL"})," scope values are wildcards"]}),"\n",(0,l.jsxs)(n.li,{children:["non-null scope values must match current ",(0,l.jsx)(n.code,{children:"session.intent"})," and ",(0,l.jsx)(n.code,{children:"session.state"})]}),"\n",(0,l.jsxs)(n.li,{children:["if no MCP tool matches current scope, MCP step skips safely and emits ",(0,l.jsx)(n.code,{children:"MCP_NO_TOOLS_AVAILABLE"})]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}}}]);