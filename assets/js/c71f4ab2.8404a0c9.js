"use strict";(globalThis.webpackChunkconvengine_docs=globalThis.webpackChunkconvengine_docs||[]).push([[4201],{1470(e,t,n){n.d(t,{A:()=>O});var o=n(6540),r=n(4164),i=n(7559),s=n(3104),a=n(6347),l=n(205),c=n(7485),u=n(1682),d=n(679);function p(e){return o.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function E(e){const{values:t,children:n}=e;return(0,o.useMemo)(()=>{const e=t??function(e){return p(e).map(({props:{value:e,label:t,attributes:n,default:o}})=>({value:e,label:t,attributes:n,default:o}))}(n);return function(e){const t=(0,u.XI)(e,(e,t)=>e.value===t.value);if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[t,n])}function m({value:e,tabValues:t}){return t.some(t=>t.value===e)}function _({queryString:e=!1,groupId:t}){const n=(0,a.W6)(),r=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,c.aZ)(r),(0,o.useCallback)(e=>{if(!r)return;const t=new URLSearchParams(n.location.search);t.set(r,e),n.replace({...n.location,search:t.toString()})},[r,n])]}function T(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,i=E(e),[s,a]=(0,o.useState)(()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const n=t.find(e=>e.default)??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:i})),[c,u]=_({queryString:n,groupId:r}),[p,T]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,r]=(0,d.Dv)(t);return[n,(0,o.useCallback)(e=>{t&&r.set(e)},[t,r])]}({groupId:r}),h=(()=>{const e=c??p;return m({value:e,tabValues:i})?e:null})();(0,l.A)(()=>{h&&a(h)},[h]);return{selectedValue:s,selectValue:(0,o.useCallback)(e=>{if(!m({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);a(e),u(e),T(e)},[u,T,i]),tabValues:i}}var h=n(2303);const A="tabList__CuJ",I="tabItem_LNqP";var N=n(4848);function S({className:e,block:t,selectedValue:n,selectValue:o,tabValues:i}){const a=[],{blockElementScrollPositionUntilNextRender:l}=(0,s.a_)(),c=e=>{const t=e.currentTarget,r=a.indexOf(t),s=i[r].value;s!==n&&(l(t),o(s))},u=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=a.indexOf(e.currentTarget)+1;t=a[n]??a[0];break}case"ArrowLeft":{const n=a.indexOf(e.currentTarget)-1;t=a[n]??a[a.length-1];break}}t?.focus()};return(0,N.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},e),children:i.map(({value:e,label:t,attributes:o})=>(0,N.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{a.push(e)},onKeyDown:u,onClick:c,...o,className:(0,r.A)("tabs__item",I,o?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function R({lazy:e,children:t,selectedValue:n}){const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=i.find(e=>e.props.value===n);return e?(0,o.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,N.jsx)("div",{className:"margin-top--md",children:i.map((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function C(e){const t=T(e);return(0,N.jsxs)("div",{className:(0,r.A)(i.G.tabs.container,"tabs-container",A),children:[(0,N.jsx)(S,{...t,...e}),(0,N.jsx)(R,{...t,...e})]})}function O(e){const t=(0,h.A)();return(0,N.jsx)(C,{...e,children:p(e.children)},String(t))}},3916(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>u,default:()=>m,frontMatter:()=>c,metadata:()=>o,toc:()=>p});const o=JSON.parse('{"id":"deep-dive/examples","title":"Real World Examples","description":"This page is intentionally dense. Each flow is shown as:","source":"@site/docs/v2/deep-dive/examples.mdx","sourceDirName":"deep-dive","slug":"/deep-dive/examples","permalink":"/docs/v2/deep-dive/examples","draft":false,"unlisted":false,"editUrl":"https://github.com/salilvnair/convengine-docs/tree/main/docs/v2/deep-dive/examples.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Real World Examples","sidebar_position":3,"hide_table_of_contents":true},"sidebar":"docSidebar","previous":{"title":"Request Lifecycle","permalink":"/docs/v2/deep-dive/lifecycle"},"next":{"title":"Data Model","permalink":"/docs/v2/deep-dive/data-model"}}');var r=n(4848),i=n(8453),s=n(1470),a=n(9365),l=n(7555);const c={title:"Real World Examples",sidebar_position:3,hide_table_of_contents:!0},u="Real World Examples",d={},p=[{value:"Example 1: FAQ (informational path)",id:"example-1-faq-informational-path",level:2},{value:"Example 2: CONNECTION_TRANSFER (multi-turn + confirmation + pending action)",id:"example-2-connection_transfer-multi-turn--confirmation--pending-action",level:2},{value:"Example 3: ORDER_CANCELLATION (multi-turn with interaction policy)",id:"example-3-order_cancellation-multi-turn-with-interaction-policy",level:2},{value:"Example 4: INVENTORY_LOOKUP (Tool Orchestration)",id:"example-4-inventory_lookup-tool-orchestration",level:2},{value:"Example 5: SUPPORT_DIAGNOSTIC (Memory Summarization)",id:"example-5-support_diagnostic-memory-summarization",level:2}];function E(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"real-world-examples",children:"Real World Examples"})}),"\n",(0,r.jsx)(t.p,{children:"This page is intentionally dense. Each flow is shown as:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Chat transcript"}),"\n",(0,r.jsx)(t.li,{children:"Per-turn step trace (what executed and why)"}),"\n",(0,r.jsxs)(t.li,{children:["Required control-plane rows (",(0,r.jsx)(t.code,{children:"ce_*"}),")"]}),"\n",(0,r.jsx)(t.li,{children:"Audit timeline with payload-level checkpoints"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"example-1-faq-informational-path",children:"Example 1: FAQ (informational path)"}),"\n",(0,r.jsxs)(s.A,{groupId:"v2-faq-deep",children:[(0,r.jsxs)(a.A,{value:"chat",label:"Chat Transcript",default:!0,children:[(0,r.jsxs)(l.sy,{title:"FAQ conversation",children:[(0,r.jsx)(l.KJ,{info:["Informational FAQ request.","No pending action path required."],children:"How do I transfer my electricity connection?"}),(0,r.jsx)(l.Fb,{tables:["ce_intent","ce_intent_classifier","ce_response"],info:["Intent=FAQ.","FAQ response returned from configured mapping."],children:"Share customerId, phone, email, source city, and target city. Then confirm to submit transfer."})]}),(0,r.jsx)(l.p,{title:"Intent and state outcome",columns:["Field","Expected value","Why"],rows:[["intent","FAQ","Classifier matches informational query language"],["state","IDLE","No slot collection / no pending action required"],["responseType","DERIVED (TEXT)","FAQ answer generated from prompt/context"]]})]}),(0,r.jsxs)(a.A,{value:"trace",label:"Per-turn Step Trace",children:[(0,r.jsx)(l.p,{title:"Turn T1 runtime trace",columns:["Order","Step","Input facts","Output facts"],rows:[["1","LoadOrCreateConversationStep","conversationId present or new","session opened/hydrated"],["1a","CacheInspectAuditStep","cache-inspector enabled","CACHE_INSPECTION audit row (conditional)"],["2","AuditUserInputStep","raw user text","USER_INPUT audit row"],["3","DialogueActStep","question sentence","dialogue_act=QUESTION"],["4","InteractionPolicyStep","no pending_action, no pending_slot","policy_decision=RECLASSIFY_INTENT"],["5","IntentResolutionStep","classifiers + agent hints","intent=FAQ, state=IDLE"],["6","SchemaExtractionStep","FAQ schema (light)","schema facts available"],["7","RulesStep","no FAQ rule action","RULE_NO_MATCH or no mutation"],["8","ResponseResolutionStep","FAQ response row + prompt","assistant output prepared"],["9","MemoryStep","recent turn context","memory_session_summary"],["10","PersistConversationStep","final session","conversation/audit persisted"]]}),(0,r.jsx)(l.f4,{type:"info",title:"Why no pending-action path here",children:(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"InteractionPolicyStep"})," sees no ",(0,r.jsx)(t.code,{children:"pending_action"})," signal and does not produce ",(0,r.jsx)(t.code,{children:"EXECUTE_PENDING_ACTION"}),". The turn continues as a regular intent-resolution flow."]})})]}),(0,r.jsxs)(a.A,{value:"db",label:"Required ce_* Rows",children:[(0,r.jsx)(l.p,{title:"Minimum rows required for FAQ flow",columns:["Table","Required row shape","Used by"],rows:[["ce_intent","intent_code=FAQ","IntentResolutionStep"],["ce_intent_classifier","intent_code=FAQ, rule_type=REGEX","IntentResolutionStep"],["ce_prompt_template","intent_code=FAQ, response_type=TEXT","ResponseResolutionStep (DERIVED)"],["ce_response","intent_code=FAQ, state_code=IDLE","ResponseResolutionStep"],["ce_container_config","intent_code=FAQ (optional context source)","AddContainerDataStep"],["ce_config","AgentIntentResolver + SchemaExtractionStep prompt keys","Intent/Schema steps"]]}),(0,r.jsx)(l.vl,{title:"FAQ seed snippet",language:"sql",children:"INSERT INTO ce_intent (intent_code, description, priority, enabled)\nVALUES ('FAQ', 'Answer informational questions from FAQ knowledge base', 10, true);\n\nINSERT INTO ce_intent_classifier (intent_code, rule_type, pattern, priority, enabled)\nVALUES ('FAQ', 'REGEX', '(?i)\\b(what|how|help|faq|information|details|explain)\\b', 10, true);\n\nINSERT INTO ce_prompt_template (intent_code, state_code, response_type, system_prompt, user_prompt, temperature, enabled)\nVALUES ('FAQ', 'IDLE', 'TEXT',\n      'You are a concise FAQ assistant. Answer directly and clearly.',\n      'User question: {{user_input}}\\nFAQ context: {{container_data}}\\nReturn short helpful answer.',\n      0.10, true);\n\nINSERT INTO ce_response (intent_code, state_code, output_format, response_type, derivation_hint, priority, enabled)\nVALUES ('FAQ', 'IDLE', 'TEXT', 'DERIVED',\n      'Answer FAQ using available context and user question.', 10, true);"})]}),(0,r.jsxs)(a.A,{value:"audit",label:"Audit + Payload Postmortem",children:[(0,r.jsx)(l.p,{title:"Expected audit stages (ordered)",columns:["Order","Stage","Must contain"],rows:[["1","USER_INPUT","original user message"],["2","DIALOGUE_ACT_CLASSIFIED","dialogueAct=QUESTION"],["3","INTERACTION_POLICY_DECIDED","policyDecision=RECLASSIFY_INTENT"],["4","INTENT_RESOLVED_BY_*","intent=FAQ"],["5","RESOLVE_RESPONSE_SELECTED","responseType=DERIVED"],["6","ASSISTANT_OUTPUT","output text or json payload"],["7","MEMORY_UPDATED","summaryChars/recalled flags"]]}),(0,r.jsx)(l.vl,{title:"Audit payload checkpoint: DIALOGUE_ACT_CLASSIFIED",language:"json",children:'{\n"_meta": { "stage": "DIALOGUE_ACT_CLASSIFIED" },\n"userText": "How do I transfer my electricity connection?",\n"dialogueAct": "QUESTION",\n"dialogueActConfidence": 0.70,\n"dialogueActSource": "REGEX"\n}'}),(0,r.jsx)(l.vl,{title:"Audit payload checkpoint: INTERACTION_POLICY_DECIDED",language:"json",children:'{\n"_meta": { "stage": "INTERACTION_POLICY_DECIDED" },\n"dialogueAct": "QUESTION",\n"policyDecision": "RECLASSIFY_INTENT",\n"skipIntentResolution": false,\n"hasPendingAction": false,\n"hasPendingSlot": false\n}'})]})]}),"\n",(0,r.jsx)(t.h2,{id:"example-2-connection_transfer-multi-turn--confirmation--pending-action",children:"Example 2: CONNECTION_TRANSFER (multi-turn + confirmation + pending action)"}),"\n",(0,r.jsxs)(s.A,{groupId:"v2-transfer-deep",children:[(0,r.jsx)(a.A,{value:"chat",label:"Chat Transcript",default:!0,children:(0,r.jsxs)(l.sy,{title:"Connection transfer conversation",children:[(0,r.jsx)(l.KJ,{info:["Initial transfer request.","State expected to move to collection mode."],children:"Move my electricity connection from City1 to City2."}),(0,r.jsx)(l.Fb,{tables:["ce_output_schema"],info:["Required fields are missing.","Assistant prompts for slots."],children:"Please provide customerId, phone, email, sourceCity, and targetCity."}),(0,r.jsxs)(l.KJ,{info:["All required fields provided.","Schema should become complete."],children:["customerId 9912, phone 9988776655, email ",(0,r.jsx)(t.a,{href:"mailto:user@zapper.com",children:"user@zapper.com"}),", sourceCity City1, targetCity City2"]}),(0,r.jsx)(l.Fb,{tables:["ce_rule","ce_pending_action"],info:["Transition to AWAITING_CONFIRMATION.","Pending action staged."],children:"Do you want to move this connection right away?"}),(0,r.jsx)(l.KJ,{info:["AFFIRM dialogue act.","Policy should execute pending action."],children:"yes please"}),(0,r.jsx)(l.Fb,{tables:["ce_audit","ce_response"],info:["Pending action executed.","Final completion response emitted."],children:"Connection transfer request submitted successfully."})]})}),(0,r.jsxs)(a.A,{value:"trace",label:"Per-turn Step Trace",children:[(0,r.jsx)(l.p,{title:"Turn T1 (initial request)",columns:["Step","Key output","Notes"],rows:[["IntentResolutionStep","intent=CONNECTION_TRANSFER","Classifier picks transfer intent"],["SchemaExtractionStep","missing fields computed","Required slots are incomplete"],["RulesStep","state -> COLLECT_INPUTS","Bootstrap collection state"],["ResponseResolutionStep","ask for required fields","Prompt user for missing slots"]]}),(0,r.jsx)(l.p,{title:"Turn T2 (slot fill)",columns:["Step","Key output","Notes"],rows:[["SchemaExtractionStep","customerId/phone/email/sourceCity/targetCity extracted","Schema complete"],["RulesStep","COLLECT_INPUTS -> AWAITING_CONFIRMATION","User must confirm execution"],["ResponseResolutionStep","confirmation prompt",""]]}),(0,r.jsx)(l.p,{title:"Turn T3 (affirm)",columns:["Order","Step","Key output","Why it matters"],rows:[["1","DialogueActStep","AFFIRM","Converts 'yes please' into execution signal"],["2","InteractionPolicyStep","EXECUTE_PENDING_ACTION","Policy routes to pending action"],["3","ActionLifecycleStep","OPEN -> IN_PROGRESS","Runtime status tracked in context"],["4","DisambiguationStep","not required","Single eligible action"],["5","GuardrailStep","ALLOW","No sensitive/approval block"],["6","PendingActionStep","EXECUTED","Task bean/method invoked from ce_pending_action"],["7","RulesStep","AWAITING_CONFIRMATION -> COMPLETED","Final state transition"],["8","ResponseResolutionStep","success response","User receives completion"]]})]}),(0,r.jsxs)(a.A,{value:"db",label:"Required ce_* Rows",children:[(0,r.jsx)(l.p,{title:"Control-plane requirements",columns:["Table","Must have","Consumed by"],rows:[["ce_intent","CONNECTION_TRANSFER","IntentResolutionStep"],["ce_intent_classifier","transfer/move regex","IntentResolutionStep"],["ce_output_schema","required slots for transfer","SchemaExtractionStep"],["ce_rule","state bootstrap + completeness + completion rules","RulesStep"],["ce_pending_action","action_key + bean_name + method_names","ActionLifecycleStep/PendingActionStep"],["ce_response","COLLECT_INPUTS, AWAITING_CONFIRMATION, COMPLETED responses","ResponseResolutionStep"],["ce_config","dialogue/prompt keys","DialogueActStep/Schema steps"],["ce_policy","optional policy blocks","PolicyEnforcementStep"]]}),(0,r.jsx)(l.vl,{title:"Seed snippet: pending action + rules",language:"sql",children:"INSERT INTO ce_pending_action\n(intent_code, state_code, action_key, bean_name, method_names, priority, enabled, description)\nVALUES\n('CONNECTION_TRANSFER', 'AWAITING_CONFIRMATION', 'FINALIZE_CONNECTION_TRANSFER',\n'faqRuleTask', 'injectContainerData', 1, true,\n'Demo finalize action for connection transfer');\n\nINSERT INTO ce_rule (phase, intent_code, state_code, rule_type, match_pattern, \"action\", action_value, priority, enabled)\nVALUES\n('PRE_RESPONSE_RESOLUTION', 'CONNECTION_TRANSFER', 'IDLE', 'REGEX', '.*', 'SET_STATE', 'COLLECT_INPUTS', 10, true),\n('PRE_RESPONSE_RESOLUTION', 'CONNECTION_TRANSFER', 'COLLECT_INPUTS', 'JSON_PATH',\n'$[?(@.state == ''COLLECT_INPUTS'' && @.customerId && @.phone && @.email && @.sourceCity && @.targetCity)]',\n'SET_STATE', 'AWAITING_CONFIRMATION', 100, true),\n('PRE_RESPONSE_RESOLUTION', 'CONNECTION_TRANSFER', 'AWAITING_CONFIRMATION', 'JSON_PATH',\n'$[?(@.state == ''AWAITING_CONFIRMATION'' && (@.pending_action_result == ''EXECUTED'' || @.inputParams.pending_action_result == ''EXECUTED''))]',\n'SET_STATE', 'COMPLETED', 200, true);"})]}),(0,r.jsxs)(a.A,{value:"audit",label:"Audit + Payload Postmortem",children:[(0,r.jsx)(l.p,{title:"Confirmation turn audit chain (must appear in order)",columns:["Order","Stage","Payload keys to verify"],rows:[["1","DIALOGUE_ACT_CLASSIFIED","dialogueAct=AFFIRM, confidence, source"],["2","INTERACTION_POLICY_DECIDED","policyDecision=EXECUTE_PENDING_ACTION"],["3","PENDING_ACTION_LIFECYCLE","status=IN_PROGRESS"],["4","GUARDRAIL_ALLOW","result=ALLOW"],["5","PENDING_ACTION_EXECUTED","pendingActionResult=EXECUTED"],["6","RULE_APPLIED","state transition to COMPLETED"],["7","ASSISTANT_OUTPUT","final completion response"],["8","MEMORY_UPDATED","summary updated"]]}),(0,r.jsx)(l.vl,{title:"Audit payload checkpoint: PENDING_ACTION_EXECUTED",language:"json",children:'{\n"_meta": { "stage": "PENDING_ACTION_EXECUTED" },\n"policyDecision": "EXECUTE_PENDING_ACTION",\n"pendingActionRef": "faqRuleTask:injectContainerData",\n"pendingActionResult": "EXECUTED",\n"intent": "CONNECTION_TRANSFER",\n"state": "AWAITING_CONFIRMATION"\n}'}),(0,r.jsx)(l.vl,{title:"Audit payload checkpoint: RULE_APPLIED after execution",language:"json",children:'{\n"_meta": { "stage": "RULE_APPLIED" },\n"rulePhase": "PRE_RESPONSE_RESOLUTION",\n"intent": "CONNECTION_TRANSFER",\n"ruleStateCode": "AWAITING_CONFIRMATION",\n"action": "SET_STATE",\n"actionValue": "COMPLETED"\n}'}),(0,r.jsxs)(l.f4,{type:"success",title:"Fast failure triage",children:[(0,r.jsx)(t.p,{children:'If user says "yes" but flow loops back to confirmation, check in order:'}),(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"DIALOGUE_ACT_CLASSIFIED"})," must be ",(0,r.jsx)(t.code,{children:"AFFIRM"})]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"INTERACTION_POLICY_DECIDED"})," must be ",(0,r.jsx)(t.code,{children:"EXECUTE_PENDING_ACTION"})]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"PENDING_ACTION_EXECUTED"})," must exist"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"RULE_APPLIED"})," must transition state from ",(0,r.jsx)(t.code,{children:"AWAITING_CONFIRMATION"})," to terminal state."]}),"\n"]})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"example-3-order_cancellation-multi-turn-with-interaction-policy",children:"Example 3: ORDER_CANCELLATION (multi-turn with interaction policy)"}),"\n",(0,r.jsxs)(s.A,{groupId:"v2-cancel-deep",children:[(0,r.jsx)(a.A,{value:"chat",label:"Chat Transcript",default:!0,children:(0,r.jsxs)(l.sy,{title:"Protected Order Cancellation",children:[(0,r.jsx)(l.KJ,{info:["Cancellation intent request.","Order number not yet present."],children:"Cancel my shoe order."}),(0,r.jsx)(l.Fb,{tables:["ce_output_schema","ce_response"],info:["Missing field follow-up.","Collect orderNumber before confirm step."],children:"I can help you cancel your order. What is your order number?"}),(0,r.jsx)(l.KJ,{info:["Provides required orderNumber.","Unlocks confirmation stage."],children:"It's 48392."}),(0,r.jsx)(l.Fb,{tables:["ce_rule","ce_pending_action"],info:["Awaiting explicit confirmation.","Pending action in OPEN/IN_PROGRESS path."],children:"Are you sure you want to cancel order 48392? This action is irreversible."}),(0,r.jsx)(l.KJ,{info:["AFFIRM turn.","Interaction policy decides EXECUTE_PENDING_ACTION."],children:"Yes please do that."}),(0,r.jsx)(l.Fb,{tables:["ce_audit","ce_response"],info:["Action executed and state transitioned.","Cancellation response returned."],children:"Order 48392 has been completely cancelled."})]})}),(0,r.jsx)(a.A,{value:"trace",label:"Per-turn Step Trace",children:(0,r.jsx)(l.p,{title:"Action Policy Trace",columns:["Turn","Pipeline Step","Internal Engine Action"],rows:[["Turn 1","SchemaExtractionStep","Detects `CANCEL_ORDER`. Fails to extract `orderNumber`. State remains `IDLE`."],["Turn 1","ResponseResolutionStep","Outputs IDLE message asking for order number."],["Turn 2","SchemaExtractionStep","Engine extracts `orderNumber: 48392`. Flags `schemaComplete=true`."],["Turn 2","RulesStep","Auto-advance rule fires, transitioning state to `CONFIRM_CANCEL`."],["Turn 2","ActionLifecycleStep","Stages `stripeCancelTask` into `pending_action_runtime` context with `OPEN` status."],["Turn 2","ResponseResolutionStep","Generates derived string parsing the memory context `orderNumber`."],["Turn 3","DialogueActStep","User says 'Yes'. Act classifier marks input as `AFFIRM`."],["Turn 3","InteractionPolicyStep","Matrix outputs `EXECUTE_PENDING_ACTION`. Locks classifier logic."],["Turn 3","GuardrailStep","Checks patterns for malicious prompt. Trace output: `GUARDRAIL_ALLOW`."],["Turn 3","PendingActionStep","Execution triggered. External API drops order. Status updated to `EXECUTED`."],["Turn 3","RulesStep","Rule sees `EXECUTED` task status and triggers state transition to `CANCELLED`."],["Turn 3","ResponseResolutionStep","Resolves final derived string using historical `orderNumber`."]]})}),(0,r.jsx)(a.A,{value:"db",label:"Required ce_* Rows",children:(0,r.jsx)(l.vl,{title:"Dynamic Slot & Task DML",language:"sql",defaultOpen:!0,children:"INSERT INTO ce_intent (intent_code, enabled) VALUES ('CANCEL_ORDER', true);\n\nINSERT INTO ce_output_schema (intent_code, format_type, schema_json, enabled)\nVALUES ('CANCEL_ORDER', 'JSON', '{\"type\":\"object\",\"properties\":{\"orderNumber\":{\"type\":\"string\"}},\"required\":[\"orderNumber\"]}', true);\n\nINSERT INTO ce_prompt_template (intent_code, response_type, system_prompt, enabled)\nVALUES ('CANCEL_ORDER', 'SCHEMA_COLLECTION', 'Extract JSON schema fields.', true);\n\nINSERT INTO ce_rule (intent_code, state_code, rule_type, rule_value, action, action_value, phase, priority, enabled)\nVALUES ('CANCEL_ORDER', 'IDLE', 'JSON_PATH', '$[?(@.context.orderNumber != null && @.context.orderNumber != '''')]', 'SET_STATE', 'CONFIRM_CANCEL', 'PRE_RESPONSE_RESOLUTION', 10, true);\n\nINSERT INTO ce_response (intent_code, state_code, response_type, exact_text, enabled)\nVALUES ('CANCEL_ORDER', 'IDLE', 'EXACT', 'I can help you cancel your order. What is your order number?', true);\n\nINSERT INTO ce_prompt_template (intent_code, response_type, system_prompt, user_prompt, template_id, enabled)\nVALUES ('CANCEL_ORDER', 'DERIVED', 'Format order number cleanly.', 'Are you sure you want to cancel order {{context.orderNumber}}? This action is irreversible.', 'tmpl_confirm_cancel', true);\n\nINSERT INTO ce_response (intent_code, state_code, response_type, template_id, enabled)\nVALUES ('CANCEL_ORDER', 'CONFIRM_CANCEL', 'DERIVED', 'tmpl_confirm_cancel', true);\n\nINSERT INTO ce_pending_action (intent_code, state_code, action_key, bean_name, method_names, priority, enabled, description)\nVALUES ('CANCEL_ORDER', 'CONFIRM_CANCEL', 'stripe_cancel', 'stripeCancelTask', 'execute', 10, true, 'Cancel the order in the provider system');\n\nINSERT INTO ce_rule (intent_code, state_code, rule_type, rule_value, action, action_value, phase, priority, enabled)\nVALUES ('CANCEL_ORDER', 'CONFIRM_CANCEL', 'EXACT', 'ANY', 'SET_STATE', 'CANCELLED', 'PRE_RESPONSE_RESOLUTION', 20, true);\n\nINSERT INTO ce_prompt_template (intent_code, response_type, system_prompt, user_prompt, template_id, enabled)\nVALUES ('CANCEL_ORDER', 'DERIVED', 'Format cleanly.', 'Order {{context.orderNumber}} has been completely cancelled.', 'tmpl_cancelled', true);\n\nINSERT INTO ce_response (intent_code, state_code, response_type, template_id, enabled)\nVALUES ('CANCEL_ORDER', 'CANCELLED', 'DERIVED', 'tmpl_cancelled', true);"})}),(0,r.jsxs)(a.A,{value:"audit",label:"Audit + Payload Postmortem",children:[(0,r.jsx)(l.p,{title:"Confirmation turn audit chain",columns:["Order","Stage","Must contain"],rows:[["1","DIALOGUE_ACT_CLASSIFIED","dialogueAct=AFFIRM"],["2","INTERACTION_POLICY_DECIDED","policyDecision=EXECUTE_PENDING_ACTION"],["3","GUARDRAIL_ALLOW","result=ALLOW"],["4","PENDING_ACTION_EXECUTED","pendingActionResult=EXECUTED"],["5","RULE_APPLIED","state transition to CANCELLED"],["6","ASSISTANT_OUTPUT","final response"]]}),(0,r.jsx)(l.vl,{title:"Audit payload checkpoint: PENDING_ACTION_EXECUTED",language:"json",children:'{\n"_meta": { "stage": "PENDING_ACTION_EXECUTED" },\n"policyDecision": "EXECUTE_PENDING_ACTION",\n"pendingActionRef": "stripeCancelTask",\n"pendingActionResult": "EXECUTED",\n"intent": "CANCEL_ORDER",\n"state": "CONFIRM_CANCEL"\n}'})]})]}),"\n",(0,r.jsx)(t.h2,{id:"example-4-inventory_lookup-tool-orchestration",children:"Example 4: INVENTORY_LOOKUP (Tool Orchestration)"}),"\n",(0,r.jsxs)(s.A,{groupId:"v2-inventory-deep",children:[(0,r.jsx)(a.A,{value:"chat",label:"Chat Transcript",default:!0,children:(0,r.jsxs)(l.sy,{title:"DB Orchestration Flow",children:[(0,r.jsx)(l.KJ,{info:["Inventory question needing tool/data call.","Intent resolves to DATABASE_QUERY flow."],children:"How many running shoes are left in warehouse B?"}),(0,r.jsx)(l.Fb,{tables:["ce_mcp_tool"],info:["Tool dispatch started.","Waiting for adapter/tool result."],children:"Checking the inventory database..."}),(0,r.jsx)(l.KJ,{info:["Represents in-flight tool call latency.","No state mutation by user here."],children:(0,r.jsx)(t.em,{children:"[System delay executing Tool]"})}),(0,r.jsx)(l.Fb,{tables:["ce_audit","ce_response"],info:["tool_result consumed by response derivation.","Final count rendered for user."],children:"We currently have 421 units of running shoes allocated to warehouse B."})]})}),(0,r.jsx)(a.A,{value:"trace",label:"Per-turn Step Trace",children:(0,r.jsx)(l.p,{title:"Tool Dispatch Trace",columns:["Pipeline Step","Internal Engine Action"],rows:[["IntentResolutionStep","Detects `DATABASE_QUERY` intent. State=`IDLE`."],["ToolOrchestrationStep","Identifies `INVENTORY_DB` mapping. Routes payload to connected Java component adapting `McpToolExecutor`."],["Tool Execution (Java Adapter)","Adapter processes input, runs `SELECT count FROM inventory`. Returns JSON payload `{'count': 421}`."],["ToolOrchestrationStep","Writes returned JSON into engine session variable `tool_result.dbList`. Traces `TOOL_ORCHESTRATION_RESULT`."],["RulesStep","Evaluates optional `POST_TOOL_EXECUTION` rules."],["ResponseResolutionStep","Injects the `421` count into the derived template context and calls LLM."]]})}),(0,r.jsx)(a.A,{value:"db",label:"Required ce_* Rows",children:(0,r.jsx)(l.vl,{title:"Tool Orchestration DML",language:"sql",defaultOpen:!0,children:"INSERT INTO ce_intent (intent_code, enabled) VALUES ('DATABASE_QUERY', true);\n\nINSERT INTO ce_mcp_tool (intent_code, tool_group, required_params_json, execution_timeout_ms, enabled)\nVALUES ('DATABASE_QUERY', 'INVENTORY_DB', '[\"itemType\", \"warehouseId\"]', 5000, true);\n\nINSERT INTO ce_prompt_template (intent_code, response_type, system_prompt, user_prompt, template_id, enabled)\nVALUES ('DATABASE_QUERY', 'DERIVED', 'You are an inventory assistant.', 'Answer from these database results: {{tool_result.dbList}}', 'tmpl_inventory_gen', true);\n\nINSERT INTO ce_response (intent_code, state_code, response_type, template_id, priority, enabled)\nVALUES ('DATABASE_QUERY', 'IDLE', 'DERIVED', 'tmpl_inventory_gen', 10, true);"})}),(0,r.jsx)(a.A,{value:"audit",label:"Audit + Payload Postmortem",children:(0,r.jsx)(l.p,{title:"Tool Orchestration Checkpoints",columns:["Order","Stage","Payload details"],rows:[["1","TOOL_ORCHESTRATION_DISPATCH","toolGroup=INVENTORY_DB, toolParams"],["2","TOOL_ORCHESTRATION_RESULT","toolResult={'count': 421}, executionMs"],["3","ASSISTANT_OUTPUT","final response interpolation"]]})})]}),"\n",(0,r.jsx)(t.h2,{id:"example-5-support_diagnostic-memory-summarization",children:"Example 5: SUPPORT_DIAGNOSTIC (Memory Summarization)"}),"\n",(0,r.jsxs)(s.A,{groupId:"v2-support-deep",children:[(0,r.jsx)(a.A,{value:"chat",label:"Chat Transcript",default:!0,children:(0,r.jsxs)(l.sy,{title:"Long Context Support Thread",children:[(0,r.jsx)(l.KJ,{info:["Initial problem statement.","Starts long troubleshooting flow."],children:"My router is broken."}),(0,r.jsx)(l.Fb,{info:["Assistant begins diagnostic questions.","No tool/action execution yet."],children:"Let's check the lights. Are they green?"}),(0,r.jsx)(l.KJ,{info:["Represents many intermediate turns.","Conversation memory grows significantly."],children:(0,r.jsx)(t.em,{children:"[12 more dialogue turns testing different cables and lights]"})}),(0,r.jsxs)(l.Fb,{tables:["ce_conversation_history"],info:["Assistant gives reset URL and PIN.","Critical details should be retained in memory summary."],children:["I suggest performing a factory reset via ",(0,r.jsx)(t.a,{href:"http://router.local/admin_reset",children:"http://router.local/admin_reset"})," with PIN 1234."]}),(0,r.jsx)(l.KJ,{info:["Time gap before follow-up.","Memory recall scenario."],children:(0,r.jsx)(t.em,{children:"[User is quiet for minutes]"})}),(0,r.jsx)(l.KJ,{info:["Late-turn recall question.","Requires memory-assisted response."],children:"[Turn 15]: Wait, what link did you tell me to use for the firmware reset again?"}),(0,r.jsxs)(l.Fb,{tables:["ce_audit","ce_conversation_history"],info:["Memory summary injected.","Assistant recalls prior URL and PIN correctly."],children:["Based on our previous troubleshooting, you should use ",(0,r.jsx)(t.a,{href:"http://router.local/admin_reset",children:"http://router.local/admin_reset"})," with the default PIN 1234."]})]})}),(0,r.jsx)(a.A,{value:"trace",label:"Per-turn Step Trace",children:(0,r.jsx)(l.p,{title:"Memory Compression Trace (Turn 15)",columns:["Pipeline Step","Internal Engine Action"],rows:[["MemoryStep (Background)","Fetches raw history and asks LLM to re-summarize it into a tight timeline snapshot. Persists to `ce_memory`."],["DialogueActStep","User asks 'what link did you tell me to use?'. Abstracted act=`QUESTION`."],["MemoryStep (Injection)","Injects the compressed `memory.session_summary` variable directly into current Turn 15 context."],["IntentResolutionStep","Resolves exact `SUPPORT_DIAGNOSTIC` intent leveraging memory context."],["ResponseResolutionStep","Template retrieves the exact `http://router.local` string generated 10 turns ago."]]})}),(0,r.jsx)(a.A,{value:"db",label:"Required Configuration",children:(0,r.jsx)(l.vl,{title:"Memory Auto-Summarization Config",language:"yaml",defaultOpen:!0,children:"convengine:\nflow:\n  memory:\n    enabled: true\n    # Max token size for the compressed summary string\n    summary-max-chars: 1200\n    # Number of turns to trigger a new summary compression cycle\n    recent-turns-for-summary: 3"})}),(0,r.jsx)(a.A,{value:"audit",label:"Audit + Payload Postmortem",children:(0,r.jsx)(l.p,{title:"Memory Checkpoints",columns:["Order","Stage","Payload details"],rows:[["1","MEMORY_EVALUATED","evaluatedTurns, previousSummaryLen"],["2","MEMORY_UPDATED","newSummary generated and injected"],["3","INTENT_RESOLVED","context aware resolution"]]})})]})]})}function m(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(E,{...e})}):E(e)}},9365(e,t,n){n.d(t,{A:()=>s});n(6540);var o=n(4164);const r="tabItem_Ymn6";var i=n(4848);function s({children:e,hidden:t,className:n}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,o.A)(r,n),hidden:t,children:e})}}}]);