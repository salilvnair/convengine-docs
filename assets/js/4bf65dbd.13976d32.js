"use strict";(globalThis.webpackChunkconvengine_docs=globalThis.webpackChunkconvengine_docs||[]).push([[1164],{7506(e,n,i){i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"deep-dive/v2-features","title":"Detailed Features","description":"This page reflects the current v2 codebase, not just the original 2.0.0 launch set. It consolidates the active runtime behavior across the v2 release line through the current repo state (including later additions such as CorrectionStep, cemcpplanner, ce_verbose, extra rule phases, and Thymeleaf-backed prompt rendering).","source":"@site/docs/v2/deep-dive/v2-features.mdx","sourceDirName":"deep-dive","slug":"/deep-dive/v2-features","permalink":"/docs/v2/deep-dive/v2-features","draft":false,"unlisted":false,"editUrl":"https://github.com/salilvnair/convengine-docs/tree/main/docs/v2/deep-dive/v2-features.mdx","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"title":"Detailed Features","sidebar_position":11},"sidebar":"docSidebar","previous":{"title":"MCP and Audit","permalink":"/docs/v2/deep-dive/mcp-audit"},"next":{"title":"Data Correctness Gotchas","permalink":"/docs/v2/deep-dive/failure-gotchas"}}');var s=i(4848),r=i(8453);const c={title:"Detailed Features",sidebar_position:11},d="ConvEngine Detailed Features (Current v2 Line)",t={},o=[{value:"1. Runtime Pipeline Is Now a Full Multi-Step DAG",id:"1-runtime-pipeline-is-now-a-full-multi-step-dag",level:2},{value:"2. Dialogue Handling Is More Than Intent Classification",id:"2-dialogue-handling-is-more-than-intent-classification",level:2},{value:"<code>DialogueActStep</code>",id:"dialogueactstep",level:3},{value:"<code>InteractionPolicyStep</code>",id:"interactionpolicystep",level:3},{value:"<code>CorrectionStep</code> (newer v2 addition)",id:"correctionstep-newer-v2-addition",level:3},{value:"3. Pending Actions Are Runtime-Controlled, Not Just Static Rows",id:"3-pending-actions-are-runtime-controlled-not-just-static-rows",level:2},{value:"<code>ce_pending_action</code>",id:"ce_pending_action",level:3},{value:"<code>ActionLifecycleStep</code>",id:"actionlifecyclestep",level:3},{value:"<code>DisambiguationStep</code>",id:"disambiguationstep",level:3},{value:"<code>PendingActionStep</code>",id:"pendingactionstep",level:3},{value:"4. Tool Execution Is Split Into Two Distinct Paths",id:"4-tool-execution-is-split-into-two-distinct-paths",level:2},{value:"Direct tool path: <code>ToolOrchestrationStep</code>",id:"direct-tool-path-toolorchestrationstep",level:3},{value:"Supported tool group model",id:"supported-tool-group-model",level:3},{value:"5. MCP Is Now Planner-Scoped, Guarded, and Explicitly Scoped",id:"5-mcp-is-now-planner-scoped-guarded-and-explicitly-scoped",level:2},{value:"<code>ce_mcp_tool</code> scope rules (correct current behavior)",id:"ce_mcp_tool-scope-rules-correct-current-behavior",level:3},{value:"<code>ce_mcp_planner</code> (newer v2 addition)",id:"ce_mcp_planner-newer-v2-addition",level:3},{value:"<code>McpToolStep</code>",id:"mcptoolstep",level:3},{value:"MCP runtime metadata (important for <code>ce_rule</code> JSON_PATH)",id:"mcp-runtime-metadata-important-for-ce_rule-json_path",level:3},{value:"MCP next-tool guardrails",id:"mcp-next-tool-guardrails",level:3},{value:"6. Rules Are Broader Than the Original v2 Rule Model",id:"6-rules-are-broader-than-the-original-v2-rule-model",level:2},{value:"Current rule phases",id:"current-rule-phases",level:3},{value:"Current rule actions",id:"current-rule-actions",level:3},{value:"7. Schema, Prompt, and Response Handling Are Richer in Current v2",id:"7-schema-prompt-and-response-handling-are-richer-in-current-v2",level:2},{value:"<code>SchemaExtractionStep</code>",id:"schemaextractionstep",level:3},{value:"<code>AutoAdvanceStep</code>",id:"autoadvancestep",level:3},{value:"<code>ResponseResolutionStep</code>",id:"responseresolutionstep",level:3},{value:"Prompt template interaction semantics",id:"prompt-template-interaction-semantics",level:3},{value:"Shared prompt renderer (current v2)",id:"shared-prompt-renderer-current-v2",level:3},{value:"8. Verbose Runtime and Step Telemetry Are First-Class Features",id:"8-verbose-runtime-and-step-telemetry-are-first-class-features",level:2},{value:"<code>ce_verbose</code> (newer v2 addition)",id:"ce_verbose-newer-v2-addition",level:3},{value:"Determinant coverage",id:"determinant-coverage",level:3},{value:"Stream transport",id:"stream-transport",level:3},{value:"Step telemetry in session",id:"step-telemetry-in-session",level:3},{value:"9. Memory, Continuity, and Reset Handling Expanded",id:"9-memory-continuity-and-reset-handling-expanded",level:2},{value:"<code>MemoryStep</code>",id:"memorystep",level:3},{value:"Query rewrite and resolved input",id:"query-rewrite-and-resolved-input",level:3},{value:"Reset and fallback handling",id:"reset-and-fallback-handling",level:3},{value:"10. Cache, Startup Validation, and Operational Safety Are Core v2 Features",id:"10-cache-startup-validation-and-operational-safety-are-core-v2-features",level:2},{value:"Static cache model",id:"static-cache-model",level:3},{value:"Startup integrity validation",id:"startup-integrity-validation",level:3},{value:"Cache analysis and refresh",id:"cache-analysis-and-refresh",level:3},{value:"11. Consumer Integration and Extension Points Are Broader",id:"11-consumer-integration-and-extension-points-are-broader",level:2},{value:"12. What Changed From the Old Page",id:"12-what-changed-from-the-old-page",level:2},{value:"Related Deep Dives",id:"related-deep-dives",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"convengine-detailed-features-current-v2-line",children:"ConvEngine Detailed Features (Current v2 Line)"})}),"\n",(0,s.jsxs)(n.p,{children:["This page reflects the current v2 codebase, not just the original ",(0,s.jsx)(n.code,{children:"2.0.0"})," launch set. It consolidates the active runtime behavior across the v2 release line through the current repo state (including later additions such as ",(0,s.jsx)(n.code,{children:"CorrectionStep"}),", ",(0,s.jsx)(n.code,{children:"ce_mcp_planner"}),", ",(0,s.jsx)(n.code,{children:"ce_verbose"}),", extra rule phases, and Thymeleaf-backed prompt rendering)."]}),"\n",(0,s.jsx)(n.p,{children:"If you need exact internals for one subsystem, use the linked deep-dive pages. This page is the high-level, top-to-bottom feature inventory."}),"\n",(0,s.jsx)(n.h2,{id:"1-runtime-pipeline-is-now-a-full-multi-step-dag",children:"1. Runtime Pipeline Is Now a Full Multi-Step DAG"}),"\n",(0,s.jsx)(n.p,{children:"v2 is no longer a simple intent -> response flow. The engine now runs a richer directed pipeline with explicit step ordering and lifecycle hooks."}),"\n",(0,s.jsx)(n.p,{children:"Core runtime stages include:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Conversation bootstrap and persistence:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"LoadOrCreateConversationStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PersistConversationBootstrapStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PersistConversationStep"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Early governance:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"CacheInspectAuditStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ResetConversationStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PolicyEnforcementStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"AuditUserInputStep"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Turn interpretation and routing:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"DialogueActStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"InteractionPolicyStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"CorrectionStep"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Multi-turn task handling:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ActionLifecycleStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"DisambiguationStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PendingActionStep"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Main conversational processing:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"IntentResolutionStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ResetResolvedIntentStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"FallbackIntentStateStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"AddContainerDataStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"SchemaExtractionStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"AutoAdvanceStep"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Tooling and orchestration:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"GuardrailStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ToolOrchestrationStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"McpToolStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"RulesStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"StateGraphStep"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Output and closeout:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ResponseResolutionStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"MemoryStep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PipelineEndGuardStep"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This matters operationally because most v2 behavior is step-driven and data-driven. Consumer apps should configure tables and properties, not hardcode domain branching in controller logic."}),"\n",(0,s.jsx)(n.h2,{id:"2-dialogue-handling-is-more-than-intent-classification",children:"2. Dialogue Handling Is More Than Intent Classification"}),"\n",(0,s.jsx)(n.h3,{id:"dialogueactstep",children:(0,s.jsx)(n.code,{children:"DialogueActStep"})}),"\n",(0,s.jsx)(n.p,{children:"The engine resolves turn semantics before intent resolution:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["resolve modes:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"REGEX_ONLY"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"REGEX_THEN_LLM"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"LLM_ONLY"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["default config comes from ",(0,s.jsx)(n.code,{children:"convengine.flow.dialogue-act.*"})]}),"\n",(0,s.jsx)(n.li,{children:"regex remains the fast path for low-cost turns"}),"\n",(0,s.jsx)(n.li,{children:"LLM fallback is used when configured mode and confidence thresholds require it"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Current runtime outputs include:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"dialogue_act"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"dialogue_act_confidence"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"standalone_query"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"resolved_user_input"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Current v2 dialogue acts now include:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"AFFIRM"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"NEGATE"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"EDIT"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"RESET"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"QUESTION"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"NEW_REQUEST"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ANSWER"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Current verbose/audit coverage includes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"DIALOGUE_ACT_LLM_INPUT"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"DIALOGUE_ACT_LLM_OUTPUT"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"DIALOGUE_ACT_LLM_ERROR"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"DIALOGUE_ACT_CLASSIFIED"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"interactionpolicystep",children:(0,s.jsx)(n.code,{children:"InteractionPolicyStep"})}),"\n",(0,s.jsx)(n.p,{children:'This step is still the deterministic routing layer, but it is now part of a broader routing chain instead of being the only "policy" feature.'}),"\n",(0,s.jsxs)(n.p,{children:["Config comes from ",(0,s.jsx)(n.code,{children:"convengine.flow.interaction-policy.*"}),", including:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["boolean shortcuts such as ",(0,s.jsx)(n.code,{children:"executePendingOnAffirm"})]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"requireResolvedIntentAndState"})}),"\n",(0,s.jsxs)(n.li,{children:["a configurable ",(0,s.jsx)(n.code,{children:"matrix"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The main deterministic outcomes remain:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"EXECUTE_PENDING_ACTION"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"REJECT_PENDING_ACTION"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"FILL_PENDING_SLOT"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"RECLASSIFY_INTENT"})}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"correctionstep-newer-v2-addition",children:[(0,s.jsx)(n.code,{children:"CorrectionStep"})," (newer v2 addition)"]}),"\n",(0,s.jsx)(n.p,{children:"This is one of the biggest changes missing from the old page."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"CorrectionStep"})," now handles confirmation/correction turns before intent/schema are re-run:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["resets per-turn ",(0,s.jsx)(n.code,{children:"routing_decision"})]}),"\n",(0,s.jsx)(n.li,{children:"supports in-place retry handling"}),"\n",(0,s.jsxs)(n.li,{children:["supports confirmation accept (",(0,s.jsx)(n.code,{children:"AFFIRM"}),") when current schema is already complete"]}),"\n",(0,s.jsxs)(n.li,{children:["supports single-field correction patching for ",(0,s.jsx)(n.code,{children:"EDIT"})," turns"]}),"\n",(0,s.jsx)(n.li,{children:"can skip intent resolution and schema extraction for safe in-place corrections"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"It uses:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["active ",(0,s.jsx)(n.code,{children:"ce_output_schema"})]}),"\n",(0,s.jsx)(n.li,{children:"current context JSON"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ce_prompt_template"})," interaction semantics"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Important current routing decisions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"CONTINUE_STANDARD_FLOW"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"HANDLE_AS_ANSWER"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"RETRY_IN_PLACE"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PROCEED_CONFIRMED"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"APPLY_CORRECTION"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This means v2 can now continue, retry, confirm, or patch an existing turn without forcing a full reclassification loop."}),"\n",(0,s.jsx)(n.h2,{id:"3-pending-actions-are-runtime-controlled-not-just-static-rows",children:"3. Pending Actions Are Runtime-Controlled, Not Just Static Rows"}),"\n",(0,s.jsx)(n.h3,{id:"ce_pending_action",children:(0,s.jsx)(n.code,{children:"ce_pending_action"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ce_pending_action"})," remains the control-plane catalog for pending actions, but in the current repo it is stricter than the original docs implied:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"intent_code"})," is required"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"state_code"})," is required"]}),"\n",(0,s.jsx)(n.li,{children:"static scope validation runs at startup"}),"\n",(0,s.jsx)(n.li,{children:"rows are resolved from static cache, not ad hoc table scans on every turn"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The actual runtime lifecycle is stored in session/context (",(0,s.jsx)(n.code,{children:"pending_action_runtime"}),"), not in the table itself."]}),"\n",(0,s.jsx)(n.h3,{id:"actionlifecyclestep",children:(0,s.jsx)(n.code,{children:"ActionLifecycleStep"})}),"\n",(0,s.jsx)(n.p,{children:"Current behavior:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"manages TTL by turns and time"}),"\n",(0,s.jsxs)(n.li,{children:["tracks lifecycle states such as:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"OPEN"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"IN_PROGRESS"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"EXECUTED"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"REJECTED"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"EXPIRED"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["uses ",(0,s.jsx)(n.code,{children:"convengine.flow.action-lifecycle.ttl-turns"})]}),"\n",(0,s.jsxs)(n.li,{children:["uses ",(0,s.jsx)(n.code,{children:"convengine.flow.action-lifecycle.ttl-minutes"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"disambiguationstep",children:(0,s.jsx)(n.code,{children:"DisambiguationStep"})}),"\n",(0,s.jsx)(n.p,{children:"This step now explicitly pauses execution when multiple pending actions remain eligible at the winning priority:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"asks a targeted clarification question"}),"\n",(0,s.jsx)(n.li,{children:"writes pending clarification state into session/context"}),"\n",(0,s.jsx)(n.li,{children:"prevents accidental execution when multiple actions look valid"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"pendingactionstep",children:(0,s.jsx)(n.code,{children:"PendingActionStep"})}),"\n",(0,s.jsx)(n.p,{children:"This is the execution/rejection stage:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"executes or rejects the selected pending action"}),"\n",(0,s.jsxs)(n.li,{children:["delegates to ",(0,s.jsx)(n.code,{children:"CeTaskExecutor"})]}),"\n",(0,s.jsx)(n.li,{children:"updates runtime pending action status/result"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"4-tool-execution-is-split-into-two-distinct-paths",children:"4. Tool Execution Is Split Into Two Distinct Paths"}),"\n",(0,s.jsx)(n.p,{children:"Current v2 supports both direct one-shot tool execution and planner-driven MCP loops."}),"\n",(0,s.jsxs)(n.h3,{id:"direct-tool-path-toolorchestrationstep",children:["Direct tool path: ",(0,s.jsx)(n.code,{children:"ToolOrchestrationStep"})]}),"\n",(0,s.jsxs)(n.p,{children:["This step executes exactly one tool when the request contains ",(0,s.jsx)(n.code,{children:"tool_request"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Current contract:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["request input:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"tool_request.tool_code"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"tool_request.tool_group"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"tool_request.args"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["runtime outputs:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"tool_result"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"tool_status"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"context.mcp.toolExecution.*"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Current behavior:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["honors ",(0,s.jsx)(n.code,{children:"convengine.flow.tool-orchestration.enabled"})]}),"\n",(0,s.jsxs)(n.li,{children:["resolves tool by ",(0,s.jsx)(n.code,{children:"tool_code"})," within current scope"]}),"\n",(0,s.jsxs)(n.li,{children:["falls back to ",(0,s.jsx)(n.code,{children:"tool_group"})," when code resolution is not possible"]}),"\n",(0,s.jsxs)(n.li,{children:["writes rich ",(0,s.jsx)(n.code,{children:"_meta"})," data into the result payload"]}),"\n",(0,s.jsxs)(n.li,{children:["runs rules in ",(0,s.jsx)(n.code,{children:"POST_TOOL_EXECUTION"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Current status/outcome coverage includes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"SUCCESS"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ERROR"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"SCOPE_MISMATCH"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"supported-tool-group-model",children:"Supported tool group model"}),"\n",(0,s.jsx)(n.p,{children:"The unified v2 tool contract supports these normalized groups:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"DB"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"HTTP_API"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"WORKFLOW_ACTION"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"DOCUMENT_RETRIEVAL"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"CALCULATOR_TRANSFORM"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"NOTIFICATION"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"FILES"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"On the MCP side, HTTP execution now supports multiple handler models:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"HttpApiProcessorToolHandler"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"HttpApiRequestingToolHandler"})}),"\n",(0,s.jsxs)(n.li,{children:["classic ",(0,s.jsx)(n.code,{children:"HttpApiToolHandler"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Framework-managed HTTP policy support includes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"connect/read timeouts"}),"\n",(0,s.jsx)(n.li,{children:"retry and backoff"}),"\n",(0,s.jsx)(n.li,{children:"in-memory circuit breaker"}),"\n",(0,s.jsx)(n.li,{children:"auth/provider hooks"}),"\n",(0,s.jsx)(n.li,{children:"response mapping"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Those defaults come from ",(0,s.jsx)(n.code,{children:"convengine.mcp.http-api.defaults.*"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"5-mcp-is-now-planner-scoped-guarded-and-explicitly-scoped",children:"5. MCP Is Now Planner-Scoped, Guarded, and Explicitly Scoped"}),"\n",(0,s.jsxs)(n.h3,{id:"ce_mcp_tool-scope-rules-correct-current-behavior",children:[(0,s.jsx)(n.code,{children:"ce_mcp_tool"})," scope rules (correct current behavior)"]}),"\n",(0,s.jsxs)(n.p,{children:["The old statement about optional ",(0,s.jsx)(n.code,{children:"intent_code"})," / ",(0,s.jsx)(n.code,{children:"state_code"})," with ",(0,s.jsx)(n.code,{children:"NULL"})," wildcard is no longer true."]}),"\n",(0,s.jsx)(n.p,{children:"Current behavior:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ce_mcp_tool.intent_code"})," is mandatory"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ce_mcp_tool.state_code"})," is mandatory"]}),"\n",(0,s.jsx)(n.li,{children:"null/blank scope is not allowed"}),"\n",(0,s.jsxs)(n.li,{children:["valid scope values are:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["exact configured ",(0,s.jsx)(n.code,{children:"intent_code"})," / ",(0,s.jsx)(n.code,{children:"state_code"})]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ANY"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"UNKNOWN"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Startup integrity validation now fails fast on invalid scope rows to prevent cross-intent tool leakage."}),"\n",(0,s.jsxs)(n.h3,{id:"ce_mcp_planner-newer-v2-addition",children:[(0,s.jsx)(n.code,{children:"ce_mcp_planner"})," (newer v2 addition)"]}),"\n",(0,s.jsxs)(n.p,{children:["MCP prompt selection is now data-driven via ",(0,s.jsx)(n.code,{children:"ce_mcp_planner"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Current planner prompt resolution order:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["exact ",(0,s.jsx)(n.code,{children:"intent_code + state_code"})]}),"\n",(0,s.jsxs)(n.li,{children:["exact ",(0,s.jsx)(n.code,{children:"intent_code + ANY"})]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ANY + ANY"})}),"\n",(0,s.jsxs)(n.li,{children:["legacy fallback from ",(0,s.jsx)(n.code,{children:"ce_config"})," ",(0,s.jsx)(n.code,{children:"McpPlanner"})," keys when planner rows are unavailable"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Like ",(0,s.jsx)(n.code,{children:"ce_mcp_tool"}),", ",(0,s.jsx)(n.code,{children:"ce_mcp_planner.intent_code"})," and ",(0,s.jsx)(n.code,{children:"state_code"})," are mandatory and validated at startup."]}),"\n",(0,s.jsx)(n.h3,{id:"mcptoolstep",children:(0,s.jsx)(n.code,{children:"McpToolStep"})}),"\n",(0,s.jsx)(n.p,{children:"This step is now much more feature-rich than the old page described."}),"\n",(0,s.jsx)(n.p,{children:"Current behavior includes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["runs ",(0,s.jsx)(n.code,{children:"PRE_AGENT_MCP"})," rules before planning"]}),"\n",(0,s.jsxs)(n.li,{children:["skips MCP when:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SKIP_TOOL_EXECUTION"})," is set"]}),"\n",(0,s.jsx)(n.li,{children:"guardrails already blocked the turn"}),"\n",(0,s.jsx)(n.li,{children:"required schema is incomplete"}),"\n",(0,s.jsx)(n.li,{children:"dialogue act indicates the turn should not enter MCP"}),"\n",(0,s.jsx)(n.li,{children:"the user turn is just a greeting"}),"\n",(0,s.jsx)(n.li,{children:"pending clarification exists"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["resolves scoped tools from ",(0,s.jsx)(n.code,{children:"McpToolRegistry"})]}),"\n",(0,s.jsxs)(n.li,{children:["runs a bounded planner/tool loop (",(0,s.jsx)(n.code,{children:"MAX_LOOPS = 5"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["stores observations in ",(0,s.jsx)(n.code,{children:"context.mcp.observations"})]}),"\n",(0,s.jsxs)(n.li,{children:["stores final planner answer in ",(0,s.jsx)(n.code,{children:"context.mcp.finalAnswer"})]}),"\n",(0,s.jsxs)(n.li,{children:["runs ",(0,s.jsx)(n.code,{children:"POST_AGENT_MCP"})," rules after MCP completion/block/fallback"]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"mcp-runtime-metadata-important-for-ce_rule-json_path",children:["MCP runtime metadata (important for ",(0,s.jsx)(n.code,{children:"ce_rule"})," JSON_PATH)"]}),"\n",(0,s.jsx)(n.p,{children:"Current rule branching can inspect:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"context.mcp.lifecycle.*"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"context.mcp.toolExecution.*"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This exposes deterministic rule conditions such as:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"blocked vs skipped vs answered"}),"\n",(0,s.jsx)(n.li,{children:"last action/tool"}),"\n",(0,s.jsx)(n.li,{children:"tool status and outcome"}),"\n",(0,s.jsx)(n.li,{children:"scope mismatch"}),"\n",(0,s.jsx)(n.li,{children:"error flags and messages"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"mcp-next-tool-guardrails",children:"MCP next-tool guardrails"}),"\n",(0,s.jsx)(n.p,{children:"In addition to general turn guardrails, MCP has a post-planner next-tool guard:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["enabled with ",(0,s.jsx)(n.code,{children:"convengine.mcp.guardrail.enabled"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"failClosed"})," can block when no allowed-next rule exists"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"allowedNextByCurrentTool"})," whitelists legal tool transitions"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"If the planner proposes a blocked next tool:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"the engine writes the fallback blocked answer"}),"\n",(0,s.jsx)(n.li,{children:"lifecycle metadata is updated deterministically"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"POST_AGENT_MCP"})," rules still run"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"6-rules-are-broader-than-the-original-v2-rule-model",children:"6. Rules Are Broader Than the Original v2 Rule Model"}),"\n",(0,s.jsx)(n.h3,{id:"current-rule-phases",children:"Current rule phases"}),"\n",(0,s.jsx)(n.p,{children:"The runtime rule surface is larger now:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"POST_DIALOGUE_ACT"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"POST_SCHEMA_EXTRACTION"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PRE_AGENT_MCP"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PRE_RESPONSE_RESOLUTION"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"POST_AGENT_INTENT"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"POST_AGENT_MCP"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"POST_TOOL_EXECUTION"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Legacy names are still normalized at runtime:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"PIPELINE_RULES"})," -> ",(0,s.jsx)(n.code,{children:"PRE_RESPONSE_RESOLUTION"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"AGENT_POST_INTENT"})," -> ",(0,s.jsx)(n.code,{children:"POST_AGENT_INTENT"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"AGENT_POST_MCP"})," -> ",(0,s.jsx)(n.code,{children:"POST_AGENT_MCP"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"TOOL_POST_EXECUTION"})," -> ",(0,s.jsx)(n.code,{children:"POST_TOOL_EXECUTION"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"current-rule-actions",children:"Current rule actions"}),"\n",(0,s.jsx)(n.p,{children:"The rule engine now supports both retrieval-style and mutation-style actions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"GET_CONTEXT"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"GET_SCHEMA_JSON"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"GET_SESSION"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"SET_DIALOGUE_ACT"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"SET_INPUT_PARAM"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"SET_INTENT"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"SET_JSON"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"SET_STATE"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"SET_TASK"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["That means ",(0,s.jsx)(n.code,{children:"ce_rule"})," is not just for state transitions anymore. It can mutate input params, inject task directives, and branch across more pipeline phases."]}),"\n",(0,s.jsx)(n.h2,{id:"7-schema-prompt-and-response-handling-are-richer-in-current-v2",children:"7. Schema, Prompt, and Response Handling Are Richer in Current v2"}),"\n",(0,s.jsx)(n.h3,{id:"schemaextractionstep",children:(0,s.jsx)(n.code,{children:"SchemaExtractionStep"})}),"\n",(0,s.jsx)(n.p,{children:"Current behavior includes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["schema-driven extraction from ",(0,s.jsx)(n.code,{children:"ce_output_schema"})]}),"\n",(0,s.jsx)(n.li,{children:"schema completeness tracking"}),"\n",(0,s.jsx)(n.li,{children:"missing-required-field detection"}),"\n",(0,s.jsxs)(n.li,{children:["post-extraction rule execution in ",(0,s.jsx)(n.code,{children:"POST_SCHEMA_EXTRACTION"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"autoadvancestep",children:(0,s.jsx)(n.code,{children:"AutoAdvanceStep"})}),"\n",(0,s.jsx)(n.p,{children:"This step computes schema facts used later in the flow:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"schema complete vs incomplete"}),"\n",(0,s.jsx)(n.li,{children:"whether any values were captured"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"responseresolutionstep",children:(0,s.jsx)(n.code,{children:"ResponseResolutionStep"})}),"\n",(0,s.jsxs)(n.p,{children:["The response layer still uses ",(0,s.jsx)(n.code,{children:"ce_response"})," and ",(0,s.jsx)(n.code,{children:"ce_prompt_template"}),", but current v2 has tighter runtime metadata and better prompt handling."]}),"\n",(0,s.jsx)(n.h3,{id:"prompt-template-interaction-semantics",children:"Prompt template interaction semantics"}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.code,{children:"2.0.9+"}),", ",(0,s.jsx)(n.code,{children:"ce_prompt_template"})," is also part of turn-routing semantics:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"interaction_mode"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"interaction_contract"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This is what ",(0,s.jsx)(n.code,{children:"CorrectionStep"})," should use for confirm/edit/retry semantics instead of inferring behavior from state naming conventions."]}),"\n",(0,s.jsx)(n.h3,{id:"shared-prompt-renderer-current-v2",children:"Shared prompt renderer (current v2)"}),"\n",(0,s.jsx)(n.p,{children:"Prompt rendering now goes through a shared Thymeleaf-backed path."}),"\n",(0,s.jsx)(n.p,{children:"Supported template styles:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["legacy ",(0,s.jsx)(n.code,{children:"{{var}}"})]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"#{...}"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"[${...}]"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Current prompt/session variables now include:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"session"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"inputParams"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"rawInputParams"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"context"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"schema"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"schemaJson"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"promptVars"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"standalone_query"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"resolved_user_input"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This same rendering path is used by:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"prompt templates"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_verbose.message"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_verbose.error_message"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"8-verbose-runtime-and-step-telemetry-are-first-class-features",children:"8. Verbose Runtime and Step Telemetry Are First-Class Features"}),"\n",(0,s.jsxs)(n.h3,{id:"ce_verbose-newer-v2-addition",children:[(0,s.jsx)(n.code,{children:"ce_verbose"})," (newer v2 addition)"]}),"\n",(0,s.jsx)(n.p,{children:"The old page did not cover the current verbose runtime model."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ce_verbose"})," is now a core control-plane table for runtime progress/error messaging:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"statically cached"}),"\n",(0,s.jsx)(n.li,{children:"startup validated"}),"\n",(0,s.jsxs)(n.li,{children:["scoped by ",(0,s.jsx)(n.code,{children:"intent_code"})," and ",(0,s.jsx)(n.code,{children:"state_code"})]}),"\n",(0,s.jsx)(n.li,{children:"matched by determinant + step matcher + optional rule/tool filters"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Current matching inputs include:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"intent_code"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"state_code"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"determinant"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"step_match"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"step_value"})}),"\n",(0,s.jsxs)(n.li,{children:["optional ",(0,s.jsx)(n.code,{children:"rule_id"})]}),"\n",(0,s.jsxs)(n.li,{children:["optional ",(0,s.jsx)(n.code,{children:"tool_code"})]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"priority"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Step match types are validated (",(0,s.jsx)(n.code,{children:"EXACT"}),", ",(0,s.jsx)(n.code,{children:"REGEX"}),", ",(0,s.jsx)(n.code,{children:"JSON_PATH"}),")."]}),"\n",(0,s.jsx)(n.h3,{id:"determinant-coverage",children:"Determinant coverage"}),"\n",(0,s.jsx)(n.p,{children:"Current runtime emits determinants across:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"step enter/exit/error"}),"\n",(0,s.jsx)(n.li,{children:"dialogue act LLM lifecycle"}),"\n",(0,s.jsx)(n.li,{children:"intent resolution lifecycle"}),"\n",(0,s.jsx)(n.li,{children:"schema extraction lifecycle"}),"\n",(0,s.jsx)(n.li,{children:"MCP planning/tool lifecycle"}),"\n",(0,s.jsx)(n.li,{children:"direct tool orchestration lifecycle"}),"\n",(0,s.jsx)(n.li,{children:"rule matching/application"}),"\n",(0,s.jsx)(n.li,{children:"response generation lifecycle"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"stream-transport",children:"Stream transport"}),"\n",(0,s.jsx)(n.p,{children:"Both SSE and STOMP now publish:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"AUDIT"})," events"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"VERBOSE"})," events"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The stream envelope includes a ",(0,s.jsx)(n.code,{children:"VerboseStreamPayload"})," so clients can render progress updates without scraping audit rows."]}),"\n",(0,s.jsx)(n.h3,{id:"step-telemetry-in-session",children:"Step telemetry in session"}),"\n",(0,s.jsxs)(n.p,{children:["Current v2 also records per-step execution details in ",(0,s.jsx)(n.code,{children:"EngineSession.stepInfos"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"status"}),"\n",(0,s.jsx)(n.li,{children:"timing"}),"\n",(0,s.jsx)(n.li,{children:"outcome"}),"\n",(0,s.jsx)(n.li,{children:"error metadata"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This supports deterministic diagnostics and replay-friendly inspection."}),"\n",(0,s.jsx)(n.h2,{id:"9-memory-continuity-and-reset-handling-expanded",children:"9. Memory, Continuity, and Reset Handling Expanded"}),"\n",(0,s.jsx)(n.h3,{id:"memorystep",children:(0,s.jsx)(n.code,{children:"MemoryStep"})}),"\n",(0,s.jsxs)(n.p,{children:["Memory remains optional and config-driven through ",(0,s.jsx)(n.code,{children:"convengine.flow.memory.*"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Current behavior:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["writes ",(0,s.jsx)(n.code,{children:"memory.session_summary"})," into context"]}),"\n",(0,s.jsxs)(n.li,{children:["can use pluggable ",(0,s.jsx)(n.code,{children:"ConversationMemoryStore"})]}),"\n",(0,s.jsx)(n.li,{children:"compresses recent conversation context instead of endlessly replaying full history"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"query-rewrite-and-resolved-input",children:"Query rewrite and resolved input"}),"\n",(0,s.jsx)(n.p,{children:"Current v2 also supports query rewriting:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"convengine.flow.query-rewrite.enabled"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"standalone_query"})," can be generated for follow-up turns"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"resolved_user_input"}),' gives downstream steps a stable "effective user text"']}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This is important for MCP, schema extraction, and prompt rendering because the framework now distinguishes raw user text from resolved conversational intent."}),"\n",(0,s.jsx)(n.h3,{id:"reset-and-fallback-handling",children:"Reset and fallback handling"}),"\n",(0,s.jsx)(n.p,{children:"The v2 line also includes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"explicit conversation reset"}),"\n",(0,s.jsxs)(n.li,{children:["reset-by-configured-intent via ",(0,s.jsx)(n.code,{children:"ResetResolvedIntentStep"})]}),"\n",(0,s.jsxs)(n.li,{children:["fallback filling of missing intent/state through ",(0,s.jsx)(n.code,{children:"FallbackIntentStateStep"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"10-cache-startup-validation-and-operational-safety-are-core-v2-features",children:"10. Cache, Startup Validation, and Operational Safety Are Core v2 Features"}),"\n",(0,s.jsx)(n.p,{children:"The current v2 line is much stricter operationally than the original feature list suggested."}),"\n",(0,s.jsx)(n.h3,{id:"static-cache-model",children:"Static cache model"}),"\n",(0,s.jsx)(n.p,{children:"Control-plane tables are preloaded and cached, including:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_intent"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_intent_classifier"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_rule"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_response"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_output_schema"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_prompt_template"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_pending_action"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_mcp_tool"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_mcp_planner"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_verbose"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"startup-integrity-validation",children:"Startup integrity validation"}),"\n",(0,s.jsx)(n.p,{children:"Startup validation now checks scope correctness and row integrity for critical tables such as:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_pending_action"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_mcp_tool"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_mcp_planner"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ce_verbose"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This means invalid scope rows or malformed verbose matchers can fail startup instead of producing unpredictable runtime behavior."}),"\n",(0,s.jsx)(n.h3,{id:"cache-analysis-and-refresh",children:"Cache analysis and refresh"}),"\n",(0,s.jsx)(n.p,{children:"Operational tooling now includes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"cache refresh endpoint"}),"\n",(0,s.jsx)(n.li,{children:"cache analyzer endpoint for visibility into cache wiring and warm state"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"These were added specifically to reduce config debugging friction in real deployments."}),"\n",(0,s.jsx)(n.h2,{id:"11-consumer-integration-and-extension-points-are-broader",children:"11. Consumer Integration and Extension Points Are Broader"}),"\n",(0,s.jsx)(n.p,{children:"Current v2 supports several framework-level integration hooks beyond the original basic engine enablement."}),"\n",(0,s.jsx)(n.p,{children:"Key annotations and extension surfaces include:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"@EnableConvEngine"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"@EnableConvEngineCaching"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"@EnableConvEngineAsyncConversation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"@EnableConvEngineAsyncAuditDispatch"})}),"\n",(0,s.jsx)(n.li,{children:"optional streaming enablement for SSE/STOMP paths"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Consumer-side custom code can also extend behavior through:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"tool handlers/executors"}),"\n",(0,s.jsx)(n.li,{children:"container transformers"}),"\n",(0,s.jsx)(n.li,{children:"response transformers"}),"\n",(0,s.jsxs)(n.li,{children:["verbose adapter publishing (",(0,s.jsx)(n.code,{children:"ConvEngineVerboseAdapter"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This lets consumers add UI progress messaging, custom transport shaping, and domain logic without forking core engine flow."}),"\n",(0,s.jsx)(n.h2,{id:"12-what-changed-from-the-old-page",children:"12. What Changed From the Old Page"}),"\n",(0,s.jsx)(n.p,{children:"The old version of this document was incomplete and partially outdated. The main gaps were:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["it treated MCP tool scope as nullable/wildcard, but current v2 requires explicit scope with ",(0,s.jsx)(n.code,{children:"ANY"})," / ",(0,s.jsx)(n.code,{children:"UNKNOWN"})]}),"\n",(0,s.jsxs)(n.li,{children:["it missed ",(0,s.jsx)(n.code,{children:"CorrectionStep"})]}),"\n",(0,s.jsxs)(n.li,{children:["it missed ",(0,s.jsx)(n.code,{children:"PendingActionStep"}),", ",(0,s.jsx)(n.code,{children:"AutoAdvanceStep"}),", ",(0,s.jsx)(n.code,{children:"PolicyEnforcementStep"}),", reset/fallback steps, and the broader DAG"]}),"\n",(0,s.jsxs)(n.li,{children:["it missed ",(0,s.jsx)(n.code,{children:"ce_mcp_planner"})]}),"\n",(0,s.jsxs)(n.li,{children:["it missed newer rule phases (",(0,s.jsx)(n.code,{children:"POST_DIALOGUE_ACT"}),", ",(0,s.jsx)(n.code,{children:"POST_SCHEMA_EXTRACTION"}),", ",(0,s.jsx)(n.code,{children:"PRE_AGENT_MCP"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["it missed ",(0,s.jsx)(n.code,{children:"SET_INPUT_PARAM"})]}),"\n",(0,s.jsxs)(n.li,{children:["it missed ",(0,s.jsx)(n.code,{children:"ce_verbose"}),", stream verbose events, and step telemetry"]}),"\n",(0,s.jsx)(n.li,{children:"it missed Thymeleaf-backed prompt rendering and the newer prompt variable model"}),"\n",(0,s.jsx)(n.li,{children:"it did not reflect the stricter startup validation and static cache architecture now present in the repo"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-deep-dives",children:"Related Deep Dives"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/v2/deep-dive/pipeline-steps",children:"Pipeline & Steps"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/v2/deep-dive/rules-responses",children:"Rules & Responses"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/v2/deep-dive/verbose-and-conversation-runtime",children:"Verbose and Conversation Runtime"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/v2/deep-dive/mcp-audit",children:"MCP and Audit"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/v2/version-history",children:"Version History"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}}}]);